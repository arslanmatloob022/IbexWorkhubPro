import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-5f85507f.js";import{_ as l}from"./VRadio.vue_vue_type_style_index_0_lang-ce6a14d3.js";import{_ as a}from"./VSwitchBlock.vue_vue_type_style_index_0_lang-072f5ed6.js";import{e as t,r as s,o,A as u,B as r,N as i,F as n,D as d,E as p,J as m,l as c,C as _,M as v,H as f,U as y,I as g,P as V,S as b}from"./index-6822cb6c.js";import{_ as h}from"./VIcon.vue_vue_type_script_setup_true_lang-60b95533.js";import{_ as U}from"./VAvatar.vue_vue_type_style_index_0_lang-44706e4c.js";import{_ as I}from"./VFilePond.vue_vue_type_script_lang-8e5d5aa1.js";import{_ as w}from"./VField.vue_vue_type_script_setup_true_lang-631d5387.js";import{_ as j}from"./VControl-82cc88a1.js";import{_ as k}from"./VInput.vue_vue_type_script_setup_true_lang-81ee3232.js";import{_ as x}from"./VLabel.vue_vue_type_script_setup_true_lang-c267a264.js";import{u as A}from"./useAPI-8ffd32d3.js";import{u as M}from"./useNotyf-58075e13.js";import{a as P}from"./useSupportElement-04dac3f0.js";const C={class:"modal-form columns is-multiline"},E={class:"column is-6"},S={class:"columns is-multiline"},N={class:"column is-3"},R={key:0,class:"column is-3"},F={class:"multiselect-single-label"},H=["src"],z=["src"],B={class:"column is-12"},J=b(t({__name:"AddUpdateUser",props:{isModalOpen:{type:Boolean,default:!1},userRole:{default:""},userId:{default:""},supplierId:{default:""}},emits:["update:closeModalHandler","update:actionUpdateHandler"],setup(t,{emit:b}){const J=t,q=M(),D=A(),L=s(""),O=s(!1),$=s(!1);s();const K=s([{value:"javascript",name:"Javascript",icon:"/images/icons/stacks/js.svg"}]),W=()=>{b("update:closeModalHandler",!1)},Y=s({username:"",email:"",password:"",is_sentMail:!1,status:"",role:"",phoneNumber:"",avatar:"",supplier:""}),Z=e=>{const l=e?.target;if(l&&l.files&&l.files.length>0){const e=l.files[0];Y.value.avatar=e;const a=new FileReader;a.onload=e=>{L.value=e.target?.result},a.readAsDataURL(e)}else console.error("No file selected")},G=()=>{Y.value.avatar=null,L.value=null},Q=async()=>{try{$.value=!0,J.supplierId&&(Y.value.supplier=J.supplierId);const e=P(Y.value,["avatar"]);if(J.userId){await D.patch(`/api/users/${J.userId}/`,e);q.info("User updated successfully")}else{await D.post("/api/users/",e);q.success("User added successfully")}b("update:actionUpdateHandler",null),W()}catch(e){e.response?.data?.email&&e.response.data.email.includes("user with this email already exists.")?q.error("Email already exists. Please use a different email."):q.error("An error occurred. Please try again.")}finally{$.value=!1}},T=s(!1);return o((()=>{J.userId&&(async()=>{try{$.value=!0;const e=await D.get(`/api/users/${J.userId}`);L.value=e.data.avatar?e.data.avatar:"",T.value=e.data.avatar?e.data.avatar:"",Y.value=e.data}catch(e){console.error(e)}finally{$.value=!1}})(),Y.value.role=J.userRole,(async()=>{try{const e=await D.get("/api/users/by-role-option/supplier/");K.value=e.data.map((e=>({value:e.id,name:e.username,icon:e.avatar})))}catch(e){console.log(e)}})(),J.supplierId&&(Y.value.supplier=J.supplierId)})),(t,s)=>{const o=x,b=k,A=j,M=w,P=I,q=U,D=h,T=V,X=a,ee=u("Multiselect"),le=l,ae=e;return r(),i(ae,{is:"form",open:J.isModalOpen,title:J.userId?"Update user":"Add user",size:"big",actions:"right",onSubmit:g(Q,["prevent"]),onClose:W},{content:n((()=>[d("div",C,[d("div",E,[d("div",S,[p(M,{class:"column is-12"},{default:n((()=>[p(o,null,{default:n((()=>[m("Full Name")])),_:1}),p(A,null,{default:n((()=>[p(b,{required:"",modelValue:c(Y).username,"onUpdate:modelValue":s[0]||(s[0]=e=>c(Y).username=e),type:"text",placeholder:"Enter name"},null,8,["modelValue"])])),_:1})])),_:1}),p(M,{class:"column is-12"},{default:n((()=>[p(o,null,{default:n((()=>[m("Phone")])),_:1}),p(A,null,{default:n((()=>[p(b,{modelValue:c(Y).phoneNumber,"onUpdate:modelValue":s[1]||(s[1]=e=>c(Y).phoneNumber=e),type:"phone",placeholder:"Enter phone number"},null,8,["modelValue"])])),_:1})])),_:1})])]),d("div",N,[p(M,null,{default:n((()=>[p(o,null,{default:n((()=>[m("Picture")])),_:1}),p(A,null,{default:n((()=>[p(P,{class:"profile-filepond",name:"profile_filepond","chunk-retry-delays":[500,1e3,3e3],"label-idle":"<i class='lnil lnil-cloud-upload'></i>","accepted-file-types":["image/png","image/jpeg","image/gif"],"image-preview-height":180,"image-resize-target-width":180,"image-resize-target-height":180,"image-crop-aspect-ratio":"1:1","style-panel-layout":"compact circle","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom",onChange:Z,onRemovefile:G})])),_:1})])),_:1})]),c(L)?(r(),_("div",R,[p(M,null,{default:n((()=>[p(o,null,{default:n((()=>[m("Preview")])),_:1}),c(L)?(r(),i(q,{key:0,picture:c(L),size:"xl",alt:"Avatar Preview"},null,8,["picture"])):v("",!0)])),_:1})])):v("",!0),p(M,{class:"column is-6"},{default:n((()=>[p(o,null,{default:n((()=>[m("Email")])),_:1}),p(A,null,{default:n((()=>[p(b,{required:"",modelValue:c(Y).email,"onUpdate:modelValue":s[2]||(s[2]=e=>c(Y).email=e),type:"email",placeholder:"Enter mail"},null,8,["modelValue"])])),_:1})])),_:1}),J.userId?v("",!0):(r(),i(M,{key:1,class:"column is-6",label:"Password",addons:""},{default:n((()=>[p(A,{expanded:""},{default:n((()=>[p(b,{modelValue:c(Y).password,"onUpdate:modelValue":s[3]||(s[3]=e=>c(Y).password=e),type:c(O)?"text":"password",class:"input",placeholder:"Enter Password"},null,8,["modelValue","type"])])),_:1}),p(A,null,{default:n((()=>[p(T,{color:"primary",onClick:s[4]||(s[4]=e=>O.value=!c(O))},{default:n((()=>[c(O)?(r(),i(D,{key:0,icon:"lucide:eye-off"})):(r(),i(D,{key:1,icon:"lucide:eye"}))])),_:1})])),_:1})])),_:1})),p(M,{class:f([J.userId?"mt-5":"","column is-3"])},{default:n((()=>[p(A,null,{default:n((()=>[p(X,{modelValue:c(Y).is_sentMail,"onUpdate:modelValue":s[5]||(s[5]=e=>c(Y).is_sentMail=e),label:"Send email",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1},8,["class"]),p(M,{class:f([J.userId?"mt-5":"","column is-3"])},{default:n((()=>[p(A,null,{default:n((()=>[p(X,{modelValue:c(Y).is_active,"onUpdate:modelValue":s[6]||(s[6]=e=>c(Y).is_active=e),label:"Active",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1},8,["class"]),"worker"==J.userRole?(r(),i(M,{key:2,class:"column is-6"},{default:n((({id:e})=>[p(A,null,{default:n((()=>[p(ee,{modelValue:c(Y).supplier,"onUpdate:modelValue":s[7]||(s[7]=e=>c(Y).supplier=e),attrs:{id:e},placeholder:"Select a sub-contractor",label:"name",options:c(K),searchable:!0,"track-by":"name","max-height":145},{singlelabel:n((({value:e})=>[d("div",F,[d("img",{class:"select-label-icon",src:e.icon,alt:""},null,8,H),m(" "+y(e.name),1)])])),option:n((({option:e})=>[d("img",{class:"select-option-icon",src:e.icon,alt:""},null,8,z),m(" "+y(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):v("",!0),d("div",B,[p(M,{label:"User role"},{default:n((()=>[p(A,null,{default:n((()=>[p(le,{modelValue:c(Y).role,"onUpdate:modelValue":s[8]||(s[8]=e=>c(Y).role=e),value:"manager",label:"Manager",name:"outlined_radio",color:"primary"},null,8,["modelValue"]),p(le,{modelValue:c(Y).role,"onUpdate:modelValue":s[9]||(s[9]=e=>c(Y).role=e),value:"worker",label:"Worker",name:"outlined_radio",color:"primary"},null,8,["modelValue"]),p(le,{modelValue:c(Y).role,"onUpdate:modelValue":s[10]||(s[10]=e=>c(Y).role=e),value:"contractor",label:"Contractor",name:"outlined_radio",color:"info"},null,8,["modelValue"]),p(le,{modelValue:c(Y).role,"onUpdate:modelValue":s[11]||(s[11]=e=>c(Y).role=e),value:"supplier",label:"Sub Contractor",name:"outlined_radio",color:"success"},null,8,["modelValue"]),p(le,{modelValue:c(Y).role,"onUpdate:modelValue":s[12]||(s[12]=e=>c(Y).role=e),value:"client",label:"Client",name:"outlined_radio",color:"warning"},null,8,["modelValue"])])),_:1})])),_:1})])])])),action:n((()=>[p(T,{loading:c($),type:"submit",color:"primary",raised:""},{default:n((()=>[m(y(J.userId?"Update":"Add"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}}),[["__scopeId","data-v-6d789f06"]]);export{J as _};
