import{e,s as l,r as a,Z as t,b as o,_ as s,o as n,B as i,N as u,F as r,D as d,E as c,K as p,W as m,l as v,C as b,V as f,U as _,J as h,M as y,j as C,T as g,I as w,O as I,a4 as k,a6 as V,a0 as T,P as x,Q as P,R as S,i as M,A as D,aR as U,H as A,G as O}from"./index-e0cd5955.js";import{_ as j}from"./VModal.vue_vue_type_style_index_0_lang-96b91895.js";import{_ as E}from"./VInput.vue_vue_type_script_setup_true_lang-b40a410d.js";import{_ as L}from"./VTextarea.vue_vue_type_script_setup_true_lang-0804d4ce.js";import{_ as N}from"./VField.vue_vue_type_script_setup_true_lang-fd16b076.js";import{_ as H}from"./VControl-f6e54973.js";import{a as q,_ as B}from"./VOption.vue_vue_type_style_index_0_lang-42913ab0.js";import{u as R}from"./useAPI-1ca2c210.js";import{u as $}from"./useNotyf-8e789831.js";import{a as Q}from"./useSupportElement-0a987e1f.js";import{u as z}from"./userSession-6cd011ad.js";import{_ as F}from"./VAvatar.vue_vue_type_style_index_0_lang-dac16305.js";import{_ as W}from"./VCheckbox.vue_vue_type_style_index_0_lang-5ffb66ef.js";import{_ as G}from"./VRadio.vue_vue_type_style_index_0_lang-69e127d9.js";import{c as K,g as J,a as Y}from"./proposalItems-b5d6355d.js";import{_ as Z}from"./SweetAlert.vue_vue_type_style_index_0_lang-e2c7c1dd.js";import{_ as X}from"./VDropdown.vue_vue_type_style_index_0_lang-ee12b32f.js";const ee={class:"modal-form columns is-multiline"},le={class:"columns is-multiline"},ae={class:"field column is-12 mb-0"},te=d("label",null,"Title: ",-1),oe={class:"control"},se=["disabled"],ne={class:"field column is-6"},ie=d("label",{for:""},"Cost Type",-1),ue={class:"field column is-6"},re=d("label",{for:""},"Catalog",-1),de={class:"field column is-6"},ce=d("label",{for:""},"Mark As",-1),pe={class:"field column is-6"},me=d("label",{for:""},"Cost Code *",-1),ve={class:"field column is-6"},be=d("label",{for:""},"Group Cost",-1),fe={class:"field column is-12 mb-0"},_e=d("label",{for:"",class:"label"},"Description",-1),he={class:"field column is-12 mb-0"},ye=d("label",{for:"",class:"label"},"Internal Notes",-1),Ce={class:"columns is-multiline"},ge={class:"field column is-6"},we=d("label",null,"Unit Cost",-1),Ie={class:"field column is-6"},ke=d("label",null,"Quantity",-1),Ve={class:"field column is-6"},Te=d("label",null,"Unit",-1),xe={class:"field column is-6"},Pe=d("label",null,"Builder Cost",-1),Se={class:"field column is-6"},Me=d("label",null,"Markup (%)",-1),De={class:"field column is-6"},Ue=d("label",null,"Client Price",-1),Ae={class:"field column is-6"},Oe=d("label",null,"Margin (%)",-1),je=e({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:V}){const T=e,x=l();z();const P=$(),S=R(),M=a(!1);a([]),a([]);const D=a({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,group:"",proposal:T.proposalId}),U=a([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]),A=a([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]),O=a([{value:"Tiling",label:"Tiling"},{value:"Material",label:"Material"},{value:"Paint",label:"Paint"},{value:"Carpenter",label:"Carpenter"}]),F=a([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]);a([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const W=async()=>{try{M.value=!0;const e=Q(D.value,[]);if(T.costItemId){await S.patch(`/api/cost/${T.costItemId}/`,e)}else{await S.post("/api/cost/",e)}G(),K(),P.success("Item added successfully.")}catch(e){P.error(` ${e}, New Worker`)}finally{M.value=!1}},G=()=>{V("update:modalHandler",!1)},K=()=>{V("update:OnSuccess",null)};a(0),a(0);const J=t((()=>D.value.unit_cost*D.value.quantity));a(0),a(0);const Y=t((()=>D.value.markup>0?J.value+J.value*D.value.markup/100:D.value.margin>0?J.value/(1-D.value.margin/100):J.value));t((()=>(Y.value-J.value)/J.value*100)),t((()=>(Y.value-J.value)/Y.value*100));const Z=o((()=>s((()=>import("./ckeditor-433e508c.js").then((e=>e.c))),["assets/ckeditor-433e508c.js","assets/index-e0cd5955.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-bfbcc68a.js"]).then((e=>e.default.component)))),X={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},je=a(!1);return n((async()=>{x.value=await s((()=>import("./ckeditor-805cd633.js").then((e=>e.c))),["assets/ckeditor-805cd633.js","assets/index-e0cd5955.js","assets/index-ce8747cd.css"]).then((e=>e.default)),T.previousItemIndex&&(D.value.previousItemIndex=T.previousItemIndex),T.costItemId&&(async()=>{try{je.value=!0;const e=await S.get(`/api/cost/${T.costItemId}/`);D.value=e.data}catch(e){console.log(e)}finally{je.value=!1}})()})),(e,l)=>{const a=B,t=q,o=H,s=N,n=I,V=L,P=k,S=E,R=j;return i(),u(R,{is:"form",open:T.costItemModal,title:"Cost Item ",size:"xl",actions:"right",onSubmit:w(W,["prevent"]),onClose:G},{content:r((()=>[d("div",ee,[c(P,{class:"column is-12"},{default:r((()=>[d("div",le,[d("div",ae,[te,d("div",oe,[p(d("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>v(D).title=e),required:"",disabled:T.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,se),[[m,v(D).title]])])]),d("div",ne,[ie,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(t,{modelValue:v(D).cost_type,"onUpdate:modelValue":l[1]||(l[1]=e=>v(D).cost_type=e),disabled:T.previewCostItems},{default:r((()=>[(i(!0),b(_,null,f(v(U),((e,l)=>(i(),u(a,{value:e.value},{default:r((()=>[h(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",ue,[re,d("div",null,[c(n,{size:"small"},{default:r((()=>[h("Add in Catalog")])),_:1})])]),d("div",de,[ce,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(t,{modelValue:v(D).mark_as,"onUpdate:modelValue":l[2]||(l[2]=e=>v(D).mark_as=e),disabled:T.previewCostItems},{default:r((()=>[(i(!0),b(_,null,f(v(F),((e,l)=>(i(),u(a,{value:e.value},{default:r((()=>[h(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",pe,[me,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(t,{modelValue:v(D).cost_code,"onUpdate:modelValue":l[3]||(l[3]=e=>v(D).cost_code=e),disabled:T.previewCostItems},{default:r((()=>[(i(!0),b(_,null,f(v(A),((e,l)=>(i(),u(a,{value:e.value},{default:r((()=>[h(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",ve,[be,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(t,{modelValue:v(D).group,"onUpdate:modelValue":l[4]||(l[4]=e=>v(D).group=e),disabled:T.previewCostItems},{default:r((()=>[(i(!0),b(_,null,f(v(O),((e,l)=>(i(),u(a,{value:e.value},{default:r((()=>[h(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",fe,[_e,v(x)?(i(),u(v(Z),{key:0,disabled:T.previewCostItems,modelValue:v(D).description,"onUpdate:modelValue":l[5]||(l[5]=e=>v(D).description=e),editor:v(x),config:X},null,8,["disabled","modelValue","editor"])):y("",!0)]),d("div",he,[ye,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(V,{modelValue:v(D).internal_notes,"onUpdate:modelValue":l[6]||(l[6]=e=>v(D).internal_notes=e),disabled:T.previewCostItems,rows:"4",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),c(P,{class:"column is-12 mt-3"},{default:r((()=>[d("div",Ce,[d("div",ge,[we,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(S,{modelValue:v(D).unit_cost,"onUpdate:modelValue":l[7]||(l[7]=e=>v(D).unit_cost=e),disabled:T.previewCostItems,type:"number",name:"unitCost",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Ie,[ke,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(S,{modelValue:v(D).quantity,"onUpdate:modelValue":l[8]||(l[8]=e=>v(D).quantity=e),disabled:T.previewCostItems,type:"number",name:"quantity",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Ve,[Te,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(S,{modelValue:v(D).unit,"onUpdate:modelValue":l[9]||(l[9]=e=>v(D).unit=e),disabled:T.previewCostItems,type:"text",name:"unit",placeholder:"Unit"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",xe,[Pe,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(S,{modelValue:v(J),"onUpdate:modelValue":l[10]||(l[10]=e=>C(J)?J.value=e:null),disabled:T.previewCostItems,type:"number",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Se,[Me,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(S,{modelValue:v(D).markup,"onUpdate:modelValue":l[11]||(l[11]=e=>v(D).markup=e),disabled:T.previewCostItems,type:"number",name:"markup",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",De,[Ue,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(S,{modelValue:v(Y),"onUpdate:modelValue":l[12]||(l[12]=e=>C(Y)?Y.value=e:null),disabled:T.previewCostItems,type:"number",name:"markup",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Ae,[Oe,c(s,null,{default:r((()=>[c(o,null,{default:r((()=>[c(S,{modelValue:v(D).margin,"onUpdate:modelValue":l[13]||(l[13]=e=>v(D).margin=e),disabled:T.previewCostItems,type:"number",name:"markup",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1})])])),action:r((()=>[c(n,{loading:v(M),type:"submit",color:"primary",icon:T.costItemId?"":"fas fa-plus",raised:""},{default:r((()=>[h(g(T.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","onSubmit"])}}}),Ee=V("useProposal",(()=>{const e=a(!0),l=$(),t=R(),o=a("");a("");const s=a([]),n=a([]),i=a({id:"",title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",worksheetItems:[],type:"proposal"}),u=a([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:u,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await t.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(o){l.error(` ${o}, Lead`)}finally{e.value=!1}},getCompanyProposals:async()=>{try{e.value=!0;const l=await t.get("/api/lead-proposal/");s.value=l.data}catch(a){l.error(` ${a}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{o.value=e;const l=await t.get(`/api/cost/by-proposal/${e}/`);u.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){o.value="",u.value=[]}}})),Le={class:"modal-form columns is-multiline"},Ne={class:"column is-full"},He={class:"field"},qe=d("label",{class:"label"},"Send To ",-1),Be={class:"control"},Re={class:"column is-full"},$e={class:"field"},Qe=d("label",{class:"label"},"Subject ",-1),ze={class:"control"},Fe={class:"field column is-full mt-5"},We=d("label",{class:"label"},"Message",-1),Ge=d("i",{class:"feather:mail"},null,-1),Ke=e({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const f=e,_=R();a(!1);const C=$(),g=a(!1),k=a(""),V=l(),x=window.origin,P=a(`${x}/proposal-view/?proposal=${f.proposalData?.id}`),S=()=>{t("update:modalHandler",!1)};k.value="<b> Hi  <br />\nIbex Management <br />\n</b>";const M=a({scheduleAt:"",sendToGroup:[],link:"",sendTo:"",subject:"",message:`<p><b>Dear [Client's Name],</b></p>\n  \n  <p>We hope this message finds you well.</p>\n  \n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing. \n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n  \n  <p>\n    You can review the full proposal, including the cost breakdown, by clicking the link below: <br />\n    <a href="${P.value}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal</a>\n  </p>\n\n  \n  <p><b>Summary of Charges:</b></p>\n  <ul>\n    <li><b>Total Items:</b> [Number of Items]</li>\n    <li><b>Total Amount:</b> [Total Cost]</li>\n  </ul>\n  \n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience. \n    We are here to assist you.\n  </p>\n  \n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n  \n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`}),D=async()=>{try{g.value=!0;await _.post(`/api/lead-proposal/${f.proposalData?.id}/send-proposal-template/`,{email:M.value.sendTo,subject:M.value.subject,message:M.value.message,scheduleAt:M.value.scheduleAt,link:P.value,column:f.columnsToShow});C.success("Email sent to worker successfully"),S()}catch(e){console.log(e)}finally{g.value=!1}},U=o((()=>s((()=>import("./ckeditor-433e508c.js").then((e=>e.c))),["assets/ckeditor-433e508c.js","assets/index-e0cd5955.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-bfbcc68a.js"]).then((e=>e.default.component)))),A={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return n((async()=>{V.value=await s((()=>import("./ckeditor-805cd633.js").then((e=>e.c))),["assets/ckeditor-805cd633.js","assets/index-e0cd5955.js","assets/index-ce8747cd.css"]).then((e=>e.default))})),(e,l)=>{const a=I,t=j;return i(),b("div",null,[c(T,{name:"fade-slow"},{default:r((()=>[c(t,{is:"form",open:f.proposalSenderModal,title:"Schedule Email",size:"large",actions:"right",onSubmit:w(D,["prevent"]),onClose:S},{content:r((()=>[d("div",Le,[d("div",Ne,[d("div",He,[qe,d("div",Be,[p(d("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>v(M).sendTo=e)},null,512),[[m,v(M).sendTo]])])])]),d("div",Re,[d("div",$e,[Qe,d("div",ze,[p(d("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>v(M).subject=e)},null,512),[[m,v(M).subject]])])])]),d("div",Fe,[We,v(V)?(i(),u(v(U),{key:0,modelValue:v(M).message,"onUpdate:modelValue":l[2]||(l[2]=e=>v(M).message=e),editor:v(V),config:A},null,8,["modelValue","editor"])):y("",!0)])])])),action:r((()=>[c(a,{type:"submit",color:"primary",loading:v(g),raised:""},{default:r((()=>[Ge,h(" Send Proposal")])),_:1},8,["loading"])])),cancel:r((()=>[c(a,{color:"light",onClick:S,raised:""},{default:r((()=>[h("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),Je={class:"columns is-multiline"},Ye=d("div",{class:"column is-9"},[d("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),d("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1),Ze={class:"column is-4"},Xe=d("h1",{class:"subtitle is-5 is-bold"},"Layout Options",-1),el=d("h1",{class:"subtitle is-6 mb-0"},"Header",-1),ll=d("h1",{class:"subtitle is-6 mb-0"},"Body",-1),al={class:"column is-4"},tl=d("h1",{class:"subtitle is-5 is-bold"},"Customer Information",-1),ol={class:"column is-4"},sl=d("h1",{class:"subtitle is-5 is-bold"},"Company Information",-1),nl={class:"column is-12"},il={class:"invoice-wrapper"},ul=d("div",{class:"left"},[d("h3",null,"Proposal-ID PD-456-14")],-1),rl=d("a",{class:"action"},[d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"})],-1),dl=d("a",{class:"action"},[d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"})],-1),cl=[d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)],pl={class:"invoice-body"},ml={class:"invoice-card"},vl={class:"invoice-section is-flex is-bordered"},bl=d("div",{class:"meta"},null,-1),fl=d("div",{class:"end"},[d("span",null,"PO Box 242"),d("span",null,"Evergreen, CO 80437-0242"),d("span",null,"Phone: 720 272-9061"),d("span",null,"Premium Trades for Premier Builders")],-1),_l=d("div",{class:"invoice-section is-flex is-bordered"},[d("div",{class:"meta"},[d("h3",null,"Client Name"),d("span",null,"Client Phone"),d("span",null,"25724 Independence Trail Evergreen, CO 80439")]),d("div",{class:"end is-left"},[d("h3",null,"Friday Jan 17, 2025"),d("p",null," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quod equidem non reprehendo. ")])],-1),hl={class:"invoice-section"},yl={class:"responsive-table"},Cl=["innerHTML"],gl={key:1},wl={class:"invoice-section is-flex mt-0 pt-0"},Il={class:"end is-left"},kl={class:"text-right"},Vl=d("p",null,"Mentioned price are final",-1),Tl=e({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const l=e,o=Ee(),s=a(""),p=a(!0),m=a(!1),h=a(!0),w=a(!0),I=a(!0);t((()=>K.value.reduce(((e,l)=>e+l.price*l.quantity),0)));const k=a({}),V=()=>{k.value=l.proposalData,T.value=l.columnsToShow,m.value=!m.value},T=a([]);return n((()=>{})),(e,a)=>{const t=G,n=H,k=N,x=W,P=F,S=Ke;return i(),b("div",Je,[Ye,d("div",Ze,[Xe,el,c(k,null,{default:r((()=>[c(n,{class:"flex-columns"},{default:r((()=>[c(t,{modelValue:v(s),"onUpdate:modelValue":a[0]||(a[0]=e=>C(s)?s.value=e:null),value:"center",label:"Centralized",name:"outlined_radio",color:"info",class:"m-0 p-2"},null,8,["modelValue"]),c(t,{modelValue:v(s),"onUpdate:modelValue":a[1]||(a[1]=e=>C(s)?s.value=e:null),value:"split",label:"Space between",name:"outlined_radio",color:"info",class:"m-0 p-2"},null,8,["modelValue"])])),_:1})])),_:1}),ll,c(k,null,{default:r((()=>[c(n,{class:"flex-columns"},{default:r((()=>[c(t,{modelValue:v(p),"onUpdate:modelValue":a[2]||(a[2]=e=>C(p)?p.value=e:null),value:"column",label:"Columns",name:"outlined_radio",color:"info",class:"m-0 p-2"},null,8,["modelValue"]),c(t,{modelValue:v(p),"onUpdate:modelValue":a[3]||(a[3]=e=>C(p)?p.value=e:null),value:"multiline",label:"Multiline",name:"outlined_radio",color:"info",class:"m-0 p-2"},null,8,["modelValue"]),c(t,{modelValue:v(p),"onUpdate:modelValue":a[4]||(a[4]=e=>C(p)?p.value=e:null),value:"none",label:"None",name:"outlined_radio",color:"info",class:"m-0 p-2"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",al,[tl,c(k,{class:"flex-columns"},{default:r((()=>[c(n,{raw:"",subcontrol:""},{default:r((()=>[c(x,{class:"mt-2 p-0",modelValue:v(h),"onUpdate:modelValue":a[5]||(a[5]=e=>C(h)?h.value=e:null),label:"Show Client Contact and Phone",color:"info"},null,8,["modelValue"])])),_:1}),c(n,{raw:"",subcontrol:""},{default:r((()=>[c(x,{class:"mt-4 p-0",modelValue:v(w),"onUpdate:modelValue":a[6]||(a[6]=e=>C(w)?w.value=e:null),label:"Show Address"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",ol,[sl,c(k,{class:"flex-columns"},{default:r((()=>[c(n,{raw:"",subcontrol:""},{default:r((()=>[c(x,{class:"mt-2 p-0",modelValue:v(I),"onUpdate:modelValue":a[7]||(a[7]=e=>C(I)?I.value=e:null),label:"Show Company One Liner"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",nl,[d("div",il,[d("div",{class:"invoice-header"},[ul,d("div",{class:"right"},[d("div",{class:"controls"},[rl,dl,d("a",{class:"action",onClick:V},cl)])])]),d("div",pl,[d("div",ml,[d("div",vl,[c(P,{size:"xl",picture:"/logos/IbexFavicon.png"}),bl,fl]),_l,d("div",hl,[d("table",yl,[d("thead",null,[(i(!0),b(_,null,f(l.columnsToShow,((e,l)=>(i(),b("th",{key:l},g(v(J)[e]),1)))),128))]),d("tbody",null,[(i(!0),b(_,null,f(v(o).proposalCostItems,((e,a)=>(i(),b("tr",{key:e.id},[(i(!0),b(_,null,f(l.columnsToShow,((l,a)=>(i(),b("td",{key:a},["Description"===l?(i(),b("div",{key:0,innerHTML:e[v(Y)[l]]},null,8,Cl)):(i(),b("span",gl,g(e[v(Y)[l]]),1))])))),128))])))),128))])])]),d("div",wl,[d("div",Il,[d("h3",kl," Total Price: $"+g(l.proposalData.proposalAmount),1),Vl])])])])])]),v(m)?(i(),u(S,{key:0,proposalSenderModal:v(m),proposalData:l.proposalData,columnsToShow:v(T),"onUpdate:modalHandler":a[8]||(a[8]=e=>m.value=!1)},null,8,["proposalSenderModal","proposalData","columnsToShow"])):y("",!0)])}}}),xl=e=>(x("data-v-2ecb0489"),e=e(),P(),e),Pl={class:"datatable-wrapper mt-0"},Sl={class:"table-container"},Ml={class:"table datatable-table is-fullwidth",id:"external-events"},Dl=xl((()=>d("th",null,"Item#",-1))),Ul=xl((()=>d("th",null,"Actions",-1))),Al=["data-event","onDragstart","onDrop"],Ol={class:"is-relative"},jl=["onClick"],El=xl((()=>d("i",{style:{cursor:"grab"},class:"lnir lnir-sort","aria-hidden":"true"},null,-1))),Ll=["innerHTML"],Nl={key:1},Hl=["onClick"],ql=[xl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1))),xl((()=>d("div",{class:"meta"},[d("span",null,"View"),d("span",null,"View user details")],-1)))],Bl=["onClick"],Rl=[xl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),xl((()=>d("div",{class:"meta"},[d("span",null,"Edit"),d("span",null,"Edit Cost Item")],-1)))],$l=xl((()=>d("hr",{class:"dropdown-divider"},null,-1))),Ql=["onClick"],zl=[xl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),xl((()=>d("div",{class:"meta"},[d("span",null,"Remove"),d("span",null,"Remove from list")],-1)))],Fl=e({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{}},setup(e){const l=e,t=Ee(),o=$(),s=a({CostCode:"Cost Code",Title:"Title",Unit:"Unit",Description:"Description",CostType:"Cost Type",MarkAs:"Mark As",Quantity:"Quantity",UnitCost:"Unit Cost",BuilderCost:"Builder Cost",Markup:"Markup",MarkupAmount:"Markup Amount",Status:"Status",ClientPrice:"Client Price",GroupPrice:"Group Price",TotalCost:"Total Cost",TotalMarkup:"Total Markup",Profit:"Profit",Notes:"Internal Notes",State:"State"}),p=a({CostCode:"cost_code",Title:"title",Unit:"unit",Description:"description",CostType:"cost_type",MarkAs:"mark_as",Quantity:"quantity",UnitCost:"unit_cost",ClientPrice:"total_price",BuilderCost:"builder_cost",Markup:"markup",Status:"status",GroupPrice:"group_amount",TotalMarkup:"total_markup",Profit:"profit",Notes:"internal_notes",MarkupAmount:"markup_amount"}),m=a({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),h=R(),C=a(""),I=a(!1);a([]);const k=e=>{e.preventDefault()},V=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},T=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},x=a(""),P=a(0),S=a(""),M=a(!1),D=a(!1),U=async()=>{try{D.value=!0;await h.delete(`/api/cost/${S.value}/`);O(),m.value.isSweetAlertOpen=!1,o.success("Cost item deleted")}catch(e){console.log(e)}finally{D.value=!1}},A=(e,l=!1)=>{S.value=e.id,M.value=l,x.value=e.proposal,I.value=!I.value},O=()=>{t.getProposalCostItems(x.value)};return n((()=>{})),(e,a)=>{const o=X,n=Z,D=je;return i(),b("div",Pl,[d("div",Sl,[d("table",Ml,[d("thead",null,[Dl,(i(!0),b(_,null,f(l.columnsToShow,((e,l)=>(i(),b("th",{key:l},g(v(s)[e]),1)))),128)),Ul]),d("tbody",null,[v(t).proposalCostItems.length>0?(i(!0),b(_,{key:0},f(v(t).proposalCostItems,((e,a)=>(i(),b("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,C.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=t.proposalCostItems.find((e=>e.id===C.value)),a=t.proposalCostItems.find((l=>l.id===e));if(l&&a){h.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=t.proposalCostItems.indexOf(l),o=t.proposalCostItems.indexOf(a);e>=0&&o>=0&&(t.proposalCostItems.splice(e,1),t.proposalCostItems.splice(o,0,l))}else console.error("Dragged or Dropped Item not found");C.value=null})(e.id),onDragover:k,onDragenter:V,onDragleave:T,class:"draggable-item events"},[d("td",Ol,[d("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","font-weight":"600"},onClick:l=>(e=>{x.value=e.proposal,P.value=e.index,I.value=!I.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,jl),El]),(i(!0),b(_,null,f(l.columnsToShow,((l,a)=>(i(),b("td",{key:a},["Description"===l?(i(),b("div",{key:0,innerHTML:e[v(p)[l]]},null,8,Ll)):(i(),b("span",Nl,g(e[v(p)[l]]),1))])))),128)),d("td",null,[c(o,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:""},{content:r((({close:l})=>[d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:w((()=>{A(e,!0),l()}),["prevent"])},ql,8,Hl),d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:w((()=>{A(e,!1),l()}),["prevent"])},Rl,8,Bl),$l,d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:w((()=>{(e=>{S.value=e.id,x.value=e.proposal,m.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},zl,8,Ql)])),_:2},1024)])],40,Al)))),128)):y("",!0)])])]),v(m).isSweetAlertOpen?(i(),u(n,{key:0,isSweetAlertOpen:v(m).isSweetAlertOpen,title:v(m).title,subtitle:v(m).subtitle,btntext:v(m).btntext,onConfirm:U,onCancel:()=>v(m).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):y("",!0),v(I)?(i(),u(D,{key:1,costItemModal:v(I),proposalId:v(x),costItemId:v(S),previousItemIndex:v(P),previewCostItems:v(M),"onUpdate:modalHandler":a[0]||(a[0]=e=>I.value=!1),"onUpdate:OnSuccess":O},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):y("",!0)])}}}),Wl=S(Fl,[["__scopeId","data-v-2ecb0489"]]),Gl={class:"columns is-multiline"},Kl={class:"column is-12 is-flex space-between"},Jl=d("div",null,[d("h1",{class:"title is-4"},"Proposal Worksheet")],-1),Yl={key:0,class:"column is-12"},Zl={class:"tabs-wrapper column is-12 m-0"},Xl={class:"tabs-inner mt-4"},ea={class:"tabs is-boxed"},la=[d("span",null,"Worksheet",-1)],aa=[d("span",null,"Format",-1)],ta=[d("span",null,"Preview",-1)],oa={key:0,class:"column is-12"},sa={key:0,class:"column is-12"},na={class:"columns is-multiline"},ia=d("div",{class:"column is-12",style:{"text-align":"center"}},[d("h1",{class:"title is-4"},"Connect your clients to their projects"),d("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),ua={class:"column is-12"},ra={key:0,class:"column is-12"},da=e({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const p=e,m=l();z(),$(),R(),a(!1),a({});const f=Ee();a(!1);const _=a(["Title","CostCode","Description","Quantity","UnitCost","Unit","ClientPrice"]),g=[{value:"ItemNumber",label:"Item Number"},{value:"Title",label:"Title"},{value:"CostCode",label:"Cost Code"},{value:"Description",label:"Description"},{value:"Quantity",label:"Quantity"},{value:"UnitCost",label:"Unit Cost"},{value:"Unit",label:"Unit"},{value:"BuilderCost",label:"Builder Cost"},{value:"Markup",label:"Markup"},{value:"ClientPrice",label:"Client Price"},{value:"CostType",label:"Cost Type"},{value:"GroupPrice",label:"Group Price"},{value:"TotalMarkup",label:"Total Markup"},{value:"MarkupAmount",label:"Markup Amount"},{value:"Profit",label:"Profit"},{value:"Notes",label:"Notes"}];a({title:"",description:"",quantity:0,unit:0,unitCost:0,markup:0,clientPrice:0,costCode:"",costType:"",builderCost:"",margin:0,profit:0,internalNotes:""}),a({title:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",worksheetItems:[]});const V=a("worksheet");o((()=>s((()=>import("./ckeditor-433e508c.js").then((e=>e.c))),["assets/ckeditor-433e508c.js","assets/index-e0cd5955.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-bfbcc68a.js"]).then((e=>e.default.component))));const T=a(!1),x=a(!1);a({id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",costType:"",description:"",quantity:0,unit:0,unit_cost:0,markup:0,clientPrice:0,costCode:"",builderCost:"",margin:0,profit:0,internalNotes:"",includeInCatalog:!1,markAs:"",group:"",proposal:""});const P=async()=>{try{f.getProposalCostItems(p.proposalId)}catch(e){console.log(e)}};return n((async()=>{m.value=await s((()=>import("./ckeditor-805cd633.js").then((e=>e.c))),["assets/ckeditor-805cd633.js","assets/index-e0cd5955.js","assets/index-ce8747cd.css"]).then((e=>e.default)),p.proposalId&&P()})),M((()=>{f.clearProposalId()})),(e,l)=>{const a=I,t=D("Multiselect"),o=H,s=N,n=Wl,m=k,f=Tl,S=je;return i(),b("div",null,[d("div",Gl,[d("div",Kl,[Jl,d("div",null,[c(a,{size:"small",light:"",outlined:"",icon:"fas fa-cog",class:"mr-2",color:v(x)?"danger":"success",onClick:l[0]||(l[0]=e=>x.value=!v(x))},{default:r((()=>[h("Table")])),_:1},8,["color"]),c(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"info",onClick:l[1]||(l[1]=e=>T.value=!v(T))},{default:r((()=>[h("Import")])),_:1}),c(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"primary",onClick:l[2]||(l[2]=e=>T.value=!v(T))},{default:r((()=>[h("Add From")])),_:1}),c(a,{size:"small",light:"",outlined:"",color:"warning",onClick:l[3]||(l[3]=e=>T.value=!v(T))},{default:r((()=>[h("Add Item")])),_:1})])]),c(U,{class:"fade-slow",name:"fade-slow"},{default:r((()=>[v(x)?(i(),b("div",Yl,[c(s,{label:"Choose what to show to lead",class:"column is-12"},{default:r((({id:e})=>[c(o,null,{default:r((()=>[c(t,{modelValue:v(_),"onUpdate:modelValue":l[4]||(l[4]=e=>C(_)?_.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:g,placeholder:"Add columns"},null,8,["modelValue","attrs"])])),_:2},1024)])),_:1})])):y("",!0)])),_:1}),d("div",Zl,[d("div",Xl,[d("div",ea,[d("ul",null,[d("li",{class:A(["worksheet"===v(V)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:l[5]||(l[5]=O(w((e=>V.value="worksheet"),["prevent"]),["space"])),onClick:l[6]||(l[6]=e=>V.value="worksheet")},la,32)],2),d("li",{class:A(["format"===v(V)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:l[7]||(l[7]=O(w((e=>V.value="format"),["prevent"]),["space"])),onClick:l[8]||(l[8]=e=>V.value="format")},aa,32)],2),d("li",{class:A(["preview"===v(V)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:l[9]||(l[9]=O(w((e=>V.value="preview"),["prevent"]),["space"])),onClick:l[10]||(l[10]=e=>V.value="preview")},ta,32)],2)])])])]),c(U,{class:"fade-slow",name:"slide-x"},{default:r((()=>["worksheet"===v(V)?(i(),b("div",oa,[c(n,{columnsToShow:v(_),proposalId:p.proposalId},null,8,["columnsToShow","proposalId"])])):y("",!0)])),_:1}),c(U,{class:"fade-slow",name:"slide-x"},{default:r((()=>["format"===v(V)?(i(),b("div",sa,[d("div",na,[c(s,{label:"Choose what to show to lead",class:"column is-12"},{default:r((({id:e})=>[c(o,null,{default:r((()=>[c(t,{modelValue:v(_),"onUpdate:modelValue":l[11]||(l[11]=e=>C(_)?_.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:g,placeholder:"Add tags"},null,8,["modelValue","attrs"])])),_:2},1024)])),_:1})]),c(m,{class:"columns is-multiline m-0"},{default:r((()=>[ia,d("div",ua,[c(n,{columnsToShow:v(_)},null,8,["columnsToShow"])])])),_:1})])):y("",!0)])),_:1}),c(U,{class:"fade-slow",name:"slide-x"},{default:r((()=>["preview"===v(V)?(i(),b("div",ra,[c(f,{proposalData:p.proposalData,columnsToShow:v(_)},null,8,["proposalData","columnsToShow"])])):y("",!0)])),_:1})]),v(T)?(i(),u(S,{key:0,costItemModal:v(T),proposalId:p.proposalId,"onUpdate:modalHandler":l[12]||(l[12]=e=>T.value=!1),"onUpdate:OnSuccess":P},null,8,["costItemModal","proposalId"])):y("",!0)])}}});export{da as _,je as a,Ee as u};
