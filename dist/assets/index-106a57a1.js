import{s as t}from"./index-35f65aad.js";function e(t){if(t)throw t}function n(t){if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)}function o(){const t=[],e={run:function(...e){let n=-1;const o=e.pop();if("function"!=typeof o)throw new TypeError("Expected function as last argument, not "+o);!function i(s,...r){const c=t[++n];let a=-1;if(s)o(s);else{for(;++a<e.length;)null!==r[a]&&void 0!==r[a]||(r[a]=e[a]);e=r,c?function(t,e){let n;return o;function o(...e){const o=t.length>e.length;let c;o&&e.push(i);try{c=t.apply(this,e)}catch(s){if(o&&n)throw s;return i(s)}o||(c&&c.then&&"function"==typeof c.then?c.then(r,i):c instanceof Error?i(c):r(c))}function i(t,...o){n||(n=!0,e(t,...o))}function r(t){i(null,t)}}(c,i)(...r):o(null,...r)}}(null,...e)},use:function(n){if("function"!=typeof n)throw new TypeError("Expected `middelware` to be a function, not "+n);return t.push(n),e}};return e}function i(t){return r(t&&t.line)+":"+r(t&&t.column)}function s(t){return i(t&&t.start)+"-"+i(t&&t.end)}function r(t){return t&&"number"==typeof t?t:1}class c extends Error{constructor(t,e,n){super(),"string"==typeof e&&(n=e,e=void 0);let o="",r={},c=!1;if(e&&(r="line"in e&&"column"in e||"start"in e&&"end"in e?{place:e}:"type"in e?{ancestors:[e],place:e.position}:{...e}),"string"==typeof t?o=t:!r.cause&&t&&(c=!0,o=t.message,r.cause=t),!r.ruleId&&!r.source&&"string"==typeof n){const t=n.indexOf(":");-1===t?r.ruleId=n:(r.source=n.slice(0,t),r.ruleId=n.slice(t+1))}if(!r.place&&r.ancestors&&r.ancestors){const t=r.ancestors[r.ancestors.length-1];t&&(r.place=t.position)}const a=r.place&&"start"in r.place?r.place.start:r.place;var h;this.ancestors=r.ancestors||void 0,this.cause=r.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file,this.message=o,this.line=a?a.line:void 0,this.name=((h=r.place)&&"object"==typeof h?"position"in h||"type"in h?s(h.position):"start"in h||"end"in h?s(h):"line"in h||"column"in h?i(h):"":"")||"1:1",this.place=r.place||void 0,this.reason=this.message,this.ruleId=r.ruleId||void 0,this.source=r.source||void 0,this.stack=c&&r.cause&&"string"==typeof r.cause.stack?r.cause.stack:"",this.actual,this.expected,this.note,this.url}}c.prototype.file="",c.prototype.name="",c.prototype.reason="",c.prototype.message="",c.prototype.stack="",c.prototype.column=void 0,c.prototype.line=void 0,c.prototype.ancestors=void 0,c.prototype.cause=void 0,c.prototype.fatal=void 0,c.prototype.place=void 0,c.prototype.ruleId=void 0,c.prototype.source=void 0;const a={basename:function(t,e){if(void 0!==e&&"string"!=typeof e)throw new TypeError('"ext" argument must be a string');h(t);let n,o=0,i=-1,s=t.length;if(void 0===e||0===e.length||e.length>t.length){for(;s--;)if(47===t.codePointAt(s)){if(n){o=s+1;break}}else i<0&&(n=!0,i=s+1);return i<0?"":t.slice(o,i)}if(e===t)return"";let r=-1,c=e.length-1;for(;s--;)if(47===t.codePointAt(s)){if(n){o=s+1;break}}else r<0&&(n=!0,r=s+1),c>-1&&(t.codePointAt(s)===e.codePointAt(c--)?c<0&&(i=s):(c=-1,i=r));o===i?i=r:i<0&&(i=t.length);return t.slice(o,i)},dirname:function(t){if(h(t),0===t.length)return".";let e,n=-1,o=t.length;for(;--o;)if(47===t.codePointAt(o)){if(e){n=o;break}}else e||(e=!0);return n<0?47===t.codePointAt(0)?"/":".":1===n&&47===t.codePointAt(0)?"//":t.slice(0,n)},extname:function(t){h(t);let e,n=t.length,o=-1,i=0,s=-1,r=0;for(;n--;){const c=t.codePointAt(n);if(47!==c)o<0&&(e=!0,o=n+1),46===c?s<0?s=n:1!==r&&(r=1):s>-1&&(r=-1);else if(e){i=n+1;break}}if(s<0||o<0||0===r||1===r&&s===o-1&&s===i+1)return"";return t.slice(s,o)},join:function(...t){let e,n=-1;for(;++n<t.length;)h(t[n]),t[n]&&(e=void 0===e?t[n]:e+"/"+t[n]);return void 0===e?".":function(t){h(t);const e=47===t.codePointAt(0);let n=function(t,e){let n,o,i="",s=0,r=-1,c=0,a=-1;for(;++a<=t.length;){if(a<t.length)n=t.codePointAt(a);else{if(47===n)break;n=47}if(47===n){if(r===a-1||1===c);else if(r!==a-1&&2===c){if(i.length<2||2!==s||46!==i.codePointAt(i.length-1)||46!==i.codePointAt(i.length-2))if(i.length>2){if(o=i.lastIndexOf("/"),o!==i.length-1){o<0?(i="",s=0):(i=i.slice(0,o),s=i.length-1-i.lastIndexOf("/")),r=a,c=0;continue}}else if(i.length>0){i="",s=0,r=a,c=0;continue}e&&(i=i.length>0?i+"/..":"..",s=2)}else i.length>0?i+="/"+t.slice(r+1,a):i=t.slice(r+1,a),s=a-r-1;r=a,c=0}else 46===n&&c>-1?c++:c=-1}return i}(t,!e);0!==n.length||e||(n=".");n.length>0&&47===t.codePointAt(t.length-1)&&(n+="/");return e?"/"+n:n}(e)},sep:"/"};function h(t){if("string"!=typeof t)throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const f={cwd:function(){return"/"}};function u(t){return Boolean(null!==t&&"object"==typeof t&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&void 0===t.auth)}function l(t){if("string"==typeof t)t=new URL(t);else if(!u(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if("file:"!==t.protocol){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return function(t){if(""!==t.hostname){const t=new TypeError('File URL host must be "localhost" or empty on darwin');throw t.code="ERR_INVALID_FILE_URL_HOST",t}const e=t.pathname;let n=-1;for(;++n<e.length;)if(37===e.codePointAt(n)&&50===e.codePointAt(n+1)){const t=e.codePointAt(n+2);if(70===t||102===t){const t=new TypeError("File URL path must not include encoded / characters");throw t.code="ERR_INVALID_FILE_URL_PATH",t}}return decodeURIComponent(e)}(t)}const p=["history","path","basename","stem","extname","dirname"];class d{constructor(t){let e;e=t?u(t)?{path:t}:"string"==typeof t||function(t){return Boolean(t&&"object"==typeof t&&"byteLength"in t&&"byteOffset"in t)}(t)?{value:t}:t:{},this.cwd="cwd"in e?"":f.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n,o=-1;for(;++o<p.length;){const t=p[o];t in e&&void 0!==e[t]&&null!==e[t]&&(this[t]="history"===t?[...e[t]]:e[t])}for(n in e)p.includes(n)||(this[n]=e[n])}get basename(){return"string"==typeof this.path?a.basename(this.path):void 0}set basename(t){m(t,"basename"),y(t,"basename"),this.path=a.join(this.dirname||"",t)}get dirname(){return"string"==typeof this.path?a.dirname(this.path):void 0}set dirname(t){g(this.basename,"dirname"),this.path=a.join(t||"",this.basename)}get extname(){return"string"==typeof this.path?a.extname(this.path):void 0}set extname(t){if(y(t,"extname"),g(this.dirname,"extname"),t){if(46!==t.codePointAt(0))throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=a.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){u(t)&&(t=l(t)),m(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return"string"==typeof this.path?a.basename(this.path,this.extname):void 0}set stem(t){m(t,"stem"),y(t,"stem"),this.path=a.join(this.dirname||"",t+(this.extname||""))}fail(t,e,n){const o=this.message(t,e,n);throw o.fatal=!0,o}info(t,e,n){const o=this.message(t,e,n);return o.fatal=void 0,o}message(t,e,n){const o=new c(t,e,n);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(t){if(void 0===this.value)return"";if("string"==typeof this.value)return this.value;return new TextDecoder(t||void 0).decode(this.value)}}function y(t,e){if(t&&t.includes(a.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+a.sep+"`")}function m(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function g(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}const w=function(t){const e=this.constructor.prototype,n=e[t],o=function(){return n.apply(o,arguments)};Object.setPrototypeOf(o,e);const i=Object.getOwnPropertyNames(n);for(const s of i){const t=Object.getOwnPropertyDescriptor(n,s);t&&Object.defineProperty(o,s,t)}return o},v={}.hasOwnProperty;class b extends w{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=o()}copy(){const e=new b;let n=-1;for(;++n<this.attachers.length;){const t=this.attachers[n];e.use(...t)}return e.data(t(this.namespace)),e}data(t,e){return"string"==typeof t?2===arguments.length?(A("data",this.frozen),this.namespace[t]=e,this):v.call(this.namespace,t)&&this.namespace[t]||void 0:t?(A("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[e,...n]=this.attachers[this.freezeIndex];if(!1===n[0])continue;!0===n[0]&&(n[0]=void 0);const o=e.call(t,...n);"function"==typeof o&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const e=O(t),n=this.parser||this.Parser;return P("parse",n),n(String(e),e)}process(t,e){const n=this;return this.freeze(),P("process",this.parser||this.Parser),x("process",this.compiler||this.Compiler),e?o(void 0,e):new Promise(o);function o(o,i){const s=O(t),r=n.parse(s);function c(t,n){t||!n?i(t):o?o(n):e(void 0,n)}n.run(r,s,(function(t,e,o){if(t||!e||!o)return c(t);const i=e,s=n.stringify(i,o);var r;"string"==typeof(r=s)||function(t){return Boolean(t&&"object"==typeof t&&"byteLength"in t&&"byteOffset"in t)}(r)?o.value=s:o.result=s,c(t,o)}))}}processSync(t){let n,o=!1;return this.freeze(),P("processSync",this.parser||this.Parser),x("processSync",this.compiler||this.Compiler),this.process(t,(function(t,i){o=!0,e(t),n=i})),T("processSync","process",o),n}run(t,e,n){I(t),this.freeze();const o=this.transformers;return n||"function"!=typeof e||(n=e,e=void 0),n?i(void 0,n):new Promise(i);function i(i,s){const r=O(e);o.run(t,r,(function(e,o,r){const c=o||t;e?s(e):i?i(c):n(void 0,c,r)}))}}runSync(t,n){let o,i=!1;return this.run(t,n,(function(t,n){e(t),o=n,i=!0})),T("runSync","run",i),o}stringify(t,e){this.freeze();const n=O(e),o=this.compiler||this.Compiler;return x("stringify",o),I(t),o(t,n)}use(e,...o){const i=this.attachers,s=this.namespace;if(A("use",this.frozen),null==e);else if("function"==typeof e)h(e,o);else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`");Array.isArray(e)?a(e):c(e)}return this;function r(t){if("function"==typeof t)h(t,[]);else{if("object"!=typeof t)throw new TypeError("Expected usable value, not `"+t+"`");if(Array.isArray(t)){const[e,...n]=t;h(e,n)}else c(t)}}function c(e){if(!("plugins"in e)&&!("settings"in e))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(e.plugins),e.settings&&(s.settings={...s.settings,...t(e.settings)})}function a(t){let e=-1;if(null==t);else{if(!Array.isArray(t))throw new TypeError("Expected a list of plugins, not `"+t+"`");for(;++e<t.length;){r(t[e])}}}function h(e,o){let s=-1,r=-1;for(;++s<i.length;)if(i[s][0]===e){r=s;break}if(-1===r)i.push([e,...o]);else if(o.length>0){let[s,...c]=o;const a=i[r][1];n(a)&&n(s)&&(s=t({...a,...s})),i[r]=[e,s,...c]}}}}const E=(new b).freeze();function P(t,e){if("function"!=typeof e)throw new TypeError("Cannot `"+t+"` without `parser`")}function x(t,e){if("function"!=typeof e)throw new TypeError("Cannot `"+t+"` without `compiler`")}function A(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function I(t){if(!n(t)||"string"!=typeof t.type)throw new TypeError("Expected node, got `"+t+"`")}function T(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function O(t){return function(t){return Boolean(t&&"object"==typeof t&&"message"in t&&"messages"in t)}(t)?t:new d(t)}export{E as unified};
