import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-d8767172.js";import{_ as t}from"./UpdateTask.vue_vue_type_script_setup_true_lang-e7740c10.js";import{_ as a}from"./VModal.vue_vue_type_style_index_0_lang-e44a152d.js";import{f as r,C as l,O as s,G as o,F as n,K as i,P as d,r as c,b as u,w as p,o as m,D as v,E as f,J as k,m as y,k as g,N as w,I as _,U as h,V as b,W as x,Q as C,R as j,S}from"./index-ad60eb89.js";import{_ as D}from"./WorkerCalendar-794cfc50.js";import{_ as I}from"./VIconBox.vue_vue_type_style_index_0_lang-da0a0190.js";import{_ as T}from"./VDropdown.vue_vue_type_style_index_0_lang-a1ec1456.js";import{_ as A}from"./VField.vue_vue_type_script_setup_true_lang-33a8026b.js";import{_ as P}from"./VControl-51dce2e2.js";import{_ as M}from"./VInput.vue_vue_type_script_setup_true_lang-e1023b08.js";import{F as O}from"./FullCalendar-d0d75c97.js";import{i as H}from"./index-04e05ac8.js";import{i as V}from"./index-5790eff9.js";import{u as L}from"./useNotyf-49f4c377.js";import{u as U}from"./useAPI-7fa47a36.js";const W=r({__name:"WorkersTaskCalendarModal",props:{workerTasksModal:{type:Boolean},workerId:{},workerName:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const r=e,c=()=>{t("update:modalHandler",!0)};return(e,t)=>{const u=D,p=d,m=a;return l(),s(m,{open:r.workerTasksModal,title:`${r.workerName} Tasks`,actions:"right",size:"xl",onClose:c},{content:o((()=>[n(u,{workerId:r.workerId},null,8,["workerId"])])),action:o((()=>[n(p,{style:{display:"none"},color:"primary",raised:""},{default:o((()=>[i(" Confirm ")])),_:1})])),cancel:o((()=>[n(p,{onClick:c,raised:""},{default:o((()=>[i(" Close ")])),_:1})])),_:1},8,["open","title"])}}}),E=e=>(C("data-v-974ad4a1"),e=e(),j(),e),N={class:"flex-list-toolbar"},Y=["onSubmit"],F={class:"datatable-toolbar align-items-center space-between"},$={key:0,class:"rota-loader"},R={class:"is-flex is-align-items-center"},z=[E((()=>f("div",{class:"icon"},[f("i",{class:"lnil lnil-menu","aria-hidden":"true"})],-1))),E((()=>f("div",{class:"meta"},[f("span",null,"All"),f("span",null,"All projects owned by company")],-1)))],B=[E((()=>f("div",{class:"icon"},[f("i",{class:"lnil lnil-play","aria-hidden":"true"})],-1))),E((()=>f("div",{class:"meta"},[f("span",null,"Active"),f("span",null,"Projects that are in progress")],-1)))],q=[E((()=>f("div",{class:"icon"},[f("i",{class:"lnil lnil-alarm-clock","aria-hidden":"true"})],-1))),E((()=>f("div",{class:"meta"},[f("span",null,"Pending"),f("span",null,"Projects listed but not started")],-1)))],J=E((()=>f("hr",{class:"dropdown-divider"},null,-1))),K=[E((()=>f("div",{class:"icon"},[f("i",{class:"lnil lnil-round-box-check","aria-hidden":"true"})],-1))),E((()=>f("div",{class:"meta"},[f("span",null,"Completed"),f("span",null,"Projects that are done")],-1)))],G={class:"project-full-calendar"},Q={style:{height:"100%",position:"relative"}},X={key:0,style:{"font-weight":"500","margin-bottom":"0px",color:"#000 !important"}},Z={key:1,style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},ee=["onClick"],te={key:0,class:"avatars"},ae=["src","onClick","title","data-bs-original-title"],re=["onClick","data-bs-original-title","title"],le=["onClick","data-bs-original-title","title"],se=["onClick"],oe=["onClick"],ne=S(r({__name:"ProjectManagerCalendar",setup(a){const r=U(),i=c(null),d=u(),C=L(),j=c(!1),S=c(!1),D=c("all"),E=c(""),ne=c([]),ie=c([]),de=c([]),ce=c(0),ue=c(""),pe=c(""),me=c(""),ve=c(""),fe=c(!0),ke=c(!1),ye=c(""),ge=c(!1),we=c({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),_e=c({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),he=c({plugins:[H,V],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineYear",initialDate:(new Date).toISOString().split("T")[0],height:"auto",themeSystem:"cerulean",resourceAreaWidth:"16%",slotMinHeight:20,resourcesInitiallyExpanded:!1,selectable:!0,dragScroll:!0,resourceClickable:!0,nowIndicator:!0,eventOrder:"start",resourceOrder:"start",headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},resourceAreaHeaderContent:"Projects",resources:[],events:[],buttonText:{today:"Today",resourceTimelineWeek:"Week",resourceTimelineMonth:"Month",resourceTimelineYear:"Year"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}},resourceTimelineYear:{type:"resourceTimeline",duration:{month:12},titleFormat:{year:"numeric"},title:"Year",slotLabelFormat:[{month:"short"},{day:"numeric"},{weekday:"short"}],slotMinWidth:30,dayMinWidth:30,slotMinHeight:28,dayMinHeight:26}},eventDidMount:function(e){if(e.el&&e.event&&e.event._def&&e.event._def.resourceIds){const t=e.event._def.resourceIds[0];e.el.setAttribute("data-resource-id",t)}},resourceLabelDidMount:function(e){const t=e.resource;e.el.style.cursor="pointer",e.el.style.color="blue",e.el.addEventListener("click",(function(){console.log("Clicked resource:",t.title,t.id),setTimeout((()=>{const e=document.querySelector(`.fc-event[data-resource-id="${t.id}"]`);e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})}),100)}))},dayCellDidMount:function(e){const t=e.date.getDay();0!==t&&6!==t||e.el.classList.add("fc-day-sat","fc-day-sun")},eventDrop:e=>{be(e),e.revert()},eventResize:e=>{be(e)},select:e=>{"contractor"!==d.user.role&&("manager"!==d.user.role||e.resource.extendedProps.managers.includes(d.user.id))&&(ye.value=0,ce.value=e.resource.extendedProps.project,pe.value=e.startStr,me.value=e.endStr,ke.value=!0)}}),be=e=>{if("contractor"===d.user.role)return void e.revert();if("manager"===d.user.role&&!e.event.extendedProps.managers.includes(d.user.id))return e.revert(),void C.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);e.event.id==e.event._def.publicId?_e.value={title:"Confirm Update",subtitle:`Are you sure you want to update the project "${e.event.title}" date from ${t} to ${a}?`,btntext:"Confirm",isSweetAlertOpen:!0,onConfirm:()=>{Se(e.event.id,t,a),_e.value.isSweetAlertOpen=!1},onCancel:()=>{_e.value.isSweetAlertOpen=!1,e.revert()}}:e.revert()},xe=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},Ce=e=>{ve.value=e.id,ue.value=e.username,ge.value=!0},je=e=>{"contractor"!==d.user.role&&("manager"!==d.user.role||e.event.extendedProps.managers.includes(d.user.id)?(pe.value="",ce.value=0,ye.value=e.event.id,ke.value=!0):C.error("You can modify the task only for the projects for which you are a manager"))},Se=async(e,t,a)=>{try{await r.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),C.success("Task updated successfully"),await Ae(),await Pe(),Ie()}catch(l){C.error("Something went wrong")}},De=e=>{const t=de.value.find((t=>t.id===e));return t?t.managers:[]},Ie=()=>{const e=de.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color})));const t=[...ne.value.map((e=>({id:e.id,resourceId:e.id,project:e.project,start:e.startDate,end:xe(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:we[e?.status],managers:De(e.project)}))),...e].sort(((e,t)=>new Date(e.start)-new Date(t.start))),a=de.value.map((e=>{const t=ne.value.filter((t=>t.project===e.id)).map((e=>({id:e.id,title:e.title,project:e.project,initiallyExpanded:!0})));return{id:e.id,title:e.title,eventBackgroundColor:e.color,project:e.id,initiallyExpanded:!0,children:t,extendedProps:{isSubResource:!1}}}));he.value.resources=a,he.value.events=t},Te=()=>{if("all"!==D.value){let e=de.value.filter((e=>e.status===D.value));ie.value=e}else ie.value=de.value;E.value&&(ie.value=de.value.filter((e=>e.title.toLowerCase().includes(E.value.toLowerCase())))),he.value.resources=ie.value},Ae=async()=>{try{j.value=!0;let e=(await r.get("/api/project/projects/",{})).data;de.value=e,ie.value=e}catch(e){console.error(e),de.value=[],ie.value=[]}finally{j.value=!1}},Pe=async()=>{try{j.value=!0;let e=(await r.get("/api/task/",{})).data.map((e=>({...e,workers:e.workers.map((e=>({...e,picture:e.avatar||"default-avatar.png",initials:e.username?e.username.slice(0,2).toUpperCase():"N/A"})))})));ne.value=e}catch(e){console.error("Error fetching tasks:",e),ne.value=[]}finally{j.value=!1}};p(D,((e,t)=>{Te()}));const Me=async()=>{j.value=!0,await Promise.all([Ae(),Pe()]),await Ie(),j.value=!1},Oe=c(null);return m((async()=>{await Me(),fe.value=!0,document.querySelectorAll(".fc-datagrid-cell-cushion").forEach((e=>{e.addEventListener("click",(()=>{const t=e.closest("[data-resource-id]")?.getAttribute("data-resource-id");t&&console.log("Clicked resource ID:",t)}))}))})),(a,r)=>{const d=M,c=P,u=A,p=T,m=I,C=W,H=t,V=e;return l(),v(b,null,[f("div",{class:_(["main-div",{"fullscreen-sim":y(S)}]),ref_key:"toolbarRef",ref:Oe},[f("div",N,[f("form",{onSubmit:k(Te,["prevent"])},[f("div",F,[n(u,{elevated:""},{default:o((()=>[n(c,{icon:"fas fa-search"},{default:o((()=>[n(d,{type:"text",placeholder:"Search projects...",modelValue:y(E),"onUpdate:modelValue":r[0]||(r[0]=e=>g(E)?E.value=e:null),onInput:r[1]||(r[1]=e=>Te()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),y(j)?(l(),v("div",$)):w("",!0),f("div",R,[n(p,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:o((()=>[f("a",{onClick:r[2]||(r[2]=()=>{Te(),D.value="all"}),class:_(["dropdown-item is-media","all"==y(D)?"is-active":""])},z,2),f("a",{href:"#",onClick:r[3]||(r[3]=()=>{Te(),D.value="active"}),class:_(["active"==y(D)?"is-active":"","dropdown-item is-media"])},B,2),f("a",{onClick:r[4]||(r[4]=()=>{Te(),D.value="pending"}),class:_(["pending"==y(D)?"is-active":"","dropdown-item is-media"])},q,2),J,f("a",{onClick:r[5]||(r[5]=()=>{Te(),D.value="completed"}),class:_(["completed"==y(D)?"is-active":"","dropdown-item is-media"])},K,2)])),_:1}),n(m,{bordered:"",onClick:r[6]||(r[6]=e=>{S.value=!S.value}),color:"dark",size:"medium",class:"cu-pointer"},{default:o((()=>[f("i",{class:_(y(S)?"fa fa-compress":"fa fa-expand")},null,2)])),_:1})])])],40,Y)]),f("div",G,[n(y(O),{options:y(he),ref_key:"calendarRef",ref:i},{eventContent:o((e=>[f("div",Q,["background"==e.event?.display?(l(),v("p",X," Job: "+h(e.event.title),1)):(l(),v("div",Z,[f("p",{onClick:t=>je(e),style:{"font-weight":"500","margin-bottom":"0px","padding-left":"1px","padding-right":"1px","z-index":"99","text-shadow":"2px 2px 2px black"}},[(l(!0),v(b,null,x(e.event.extendedProps?.workers,(e=>(l(),v("span",{key:e.id},h(e.username)+", ",1)))),128))],8,ee),e.event.extendedProps?.workers?.length?(l(),v("div",te,[(l(!0),v(b,null,x(e.event.extendedProps?.workers,(t=>(l(),v("div",{class:"avatars__item",key:t.id},[t.avatar?(l(),v("img",{key:0,src:t.avatar,onClick:e=>Ce(t),title:t.username,"data-bs-original-title":t.username?t.username.slice(0,2).toUpperCase():"Hi"},null,8,ae)):w("",!0),0==e.event.extendedProps?.workers?.length?(l(),v("div",{key:1,onClick:e=>Ce(t),"data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[f("h6",{class:"mb-0",onClick:e=>Ce(t),style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username},h(t.username?t.username.slice(0,2):"AA"),9,le)],8,re)):w("",!0),f("p",{onClick:e=>Ce(t)},h(t.username),9,se)])))),128))])):w("",!0),e.event.extendedProps?.workers?.length||"background"==e.event?.display?w("",!0):(l(),v("p",{key:1,onClick:t=>je(e),style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}}," No worker is assigned yet ",8,oe))]))])])),_:1},8,["options"])]),y(ge)?(l(),s(C,{key:0,workerTasksModal:y(ge),workerId:y(ve),workerName:y(ue),"onUpdate:modalHandler":r[7]||(r[7]=e=>ge.value=!y(ge))},null,8,["workerTasksModal","workerId","workerName"])):w("",!0),y(ke)?(l(),s(H,{key:1,isOpen:y(ke),taskIdSelected:y(ye),projectID:y(ce),startDate:y(pe),endDate:y(me),"onUpdate:OnSuccess":Me,"onUpdate:modalHandler":r[8]||(r[8]=()=>{ke.value=!1})},null,8,["isOpen","taskIdSelected","projectID","startDate","endDate"])):w("",!0)],2),y(_e).isSweetAlertOpen?(l(),s(V,{key:0,isSweetAlertOpen:y(_e).isSweetAlertOpen,title:y(_e).title,loading:!1,subtitle:y(_e).subtitle,btntext:y(_e).btntext,onConfirm:y(_e).onConfirm,onCancel:y(_e).onCancel},null,8,["isSweetAlertOpen","title","subtitle","btntext","onConfirm","onCancel"])):w("",!0)],64)}}}),[["__scopeId","data-v-974ad4a1"]]);export{W as _,ne as a};
