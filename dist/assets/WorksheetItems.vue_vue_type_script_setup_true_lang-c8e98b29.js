import{e,s as l,r as a,Z as t,b as o,_ as s,o as n,B as i,N as r,F as u,D as d,E as c,K as p,W as _,l as m,C as v,V as f,U as b,J as y,M as h,j as I,T as g,I as w,O as C,a4 as k,a6 as P,a0 as V,X as x,P as D,Q as T,R as S,i as j,A,aR as M,H as U,G as O}from"./index-68d93679.js";import{_ as E}from"./VModal.vue_vue_type_style_index_0_lang-534df148.js";import{_ as F}from"./VInput.vue_vue_type_script_setup_true_lang-5d6ce4b5.js";import{_ as L}from"./VTextarea.vue_vue_type_script_setup_true_lang-009ad0b2.js";import{_ as H}from"./VField.vue_vue_type_script_setup_true_lang-2b2e4149.js";import{_ as $}from"./VControl-2c1563a4.js";import{a as q,_ as N}from"./VOption.vue_vue_type_style_index_0_lang-a6e31f0b.js";import{u as B}from"./useAPI-e8c71844.js";import{u as R}from"./useNotyf-f9383838.js";import{a as z,e as W}from"./useSupportElement-8c4eca99.js";import{u as J}from"./userSession-0e276ce7.js";import{_ as G}from"./VAvatar.vue_vue_type_style_index_0_lang-37c2b9fc.js";import{_ as Q}from"./SweetAlert.vue_vue_type_style_index_0_lang-d53fa087.js";import{_ as K}from"./VDropdown.vue_vue_type_style_index_0_lang-c862c535.js";const Y={class:"modal-form columns is-multiline"},X={class:"columns is-multiline"},Z={class:"field column is-12 mb-0"},ee=d("label",null,"Title: ",-1),le={class:"control"},ae=["disabled"],te={class:"field column is-6"},oe=d("label",{for:""},"Cost Type",-1),se={class:"field column is-3"},ne=d("label",{for:""},"Catalog",-1),ie={class:"field column is-3"},re=d("label",{for:""},"Mark As",-1),ue={class:"field column is-6"},de=d("label",{for:""},"Cost Code *",-1),ce={class:"field column is-6"},pe=d("label",{for:""},"Group Cost",-1),_e={class:"field column is-12 mb-0"},me=d("label",{for:"",class:"label"},"Description",-1),ve={class:"field column is-12 mb-0"},fe=d("label",{for:"",class:"label"},"Internal Notes",-1),be={class:"columns is-multiline"},ye={class:"field column is-6"},he=d("label",null,"Unit Cost",-1),Ie={class:"field column is-6"},ge=d("label",null,"Quantity",-1),we={class:"field column is-6"},Ce=d("label",null,"Unit",-1),ke={class:"field column is-6"},Pe=d("label",null,"Builder Cost",-1),Ve={class:"field column is-6"},xe=d("label",null,"Markup (%)",-1),De={class:"field column is-6"},Te=d("label",null,"Client Price",-1),Se={class:"field column is-6"},je=d("label",null,"Margin (%)",-1),Ae=e({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:P}){const V=e,x=l();J();const D=R(),T=B(),S=a(!1);a([]),a([]);const j=a({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,group:"",proposal:V.proposalId}),A=a([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]),M=a([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]),U=a([{value:"Tiling",label:"Tiling"},{value:"Material",label:"Material"},{value:"Paint",label:"Paint"},{value:"Carpenter",label:"Carpenter"}]),O=a([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]);a([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const W=async()=>{try{S.value=!0;const e=z(j.value,[]);if(V.costItemId){await T.patch(`/api/cost/${V.costItemId}/`,e)}else{await T.post("/api/cost/",e)}G(),Q(),D.success("Item added successfully.")}catch(e){D.error(` ${e}, New Worker`)}finally{S.value=!1}},G=()=>{P("update:modalHandler",!1)},Q=()=>{P("update:OnSuccess",null)};a(0),a(0);const K=t((()=>j.value.unit_cost*j.value.quantity));a(0),a(0);const Ae=t((()=>j.value.markup>0?K.value+K.value*j.value.markup/100:j.value.margin>0?K.value/(1-j.value.margin/100):K.value));t((()=>(Ae.value-K.value)/K.value*100)),t((()=>(Ae.value-K.value)/Ae.value*100));const Me=o((()=>s((()=>import("./ckeditor-fbd8f3be.js").then((e=>e.c))),["assets/ckeditor-fbd8f3be.js","assets/index-68d93679.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-cafaf688.js"]).then((e=>e.default.component)))),Ue={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},Oe=a(!1);return n((async()=>{x.value=await s((()=>import("./ckeditor-4fe47de5.js").then((e=>e.c))),["assets/ckeditor-4fe47de5.js","assets/index-68d93679.js","assets/index-ce8747cd.css"]).then((e=>e.default)),V.previousItemIndex&&(j.value.previousItemIndex=V.previousItemIndex),V.costItemId&&(async()=>{try{Oe.value=!0;const e=await T.get(`/api/cost/${V.costItemId}/`);j.value=e.data}catch(e){console.log(e)}finally{Oe.value=!1}})()})),(e,l)=>{const a=N,t=q,o=$,s=H,n=C,P=L,D=k,T=F,B=E;return i(),r(B,{is:"form",open:V.costItemModal,title:"Cost Item ",size:"xl",actions:"right",onSubmit:w(W,["prevent"]),onClose:G},{content:u((()=>[d("div",Y,[c(D,{class:"column is-12"},{default:u((()=>[d("div",X,[d("div",Z,[ee,d("div",le,[p(d("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>m(j).title=e),required:"",disabled:V.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,ae),[[_,m(j).title]])])]),d("div",te,[oe,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(t,{modelValue:m(j).cost_type,"onUpdate:modelValue":l[1]||(l[1]=e=>m(j).cost_type=e),disabled:V.previewCostItems},{default:u((()=>[(i(!0),v(b,null,f(m(A),((e,l)=>(i(),r(a,{value:e.value},{default:u((()=>[y(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",se,[ne,d("div",null,[c(n,{color:"info",light:"",raised:"",size:"small"},{default:u((()=>[y("Add in Catalog")])),_:1})])]),d("div",ie,[re,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(t,{modelValue:m(j).mark_as,"onUpdate:modelValue":l[2]||(l[2]=e=>m(j).mark_as=e),disabled:V.previewCostItems},{default:u((()=>[(i(!0),v(b,null,f(m(O),((e,l)=>(i(),r(a,{value:e.value},{default:u((()=>[y(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",ue,[de,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(t,{modelValue:m(j).cost_code,"onUpdate:modelValue":l[3]||(l[3]=e=>m(j).cost_code=e),disabled:V.previewCostItems},{default:u((()=>[(i(!0),v(b,null,f(m(M),((e,l)=>(i(),r(a,{value:e.value},{default:u((()=>[y(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",ce,[pe,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(t,{modelValue:m(j).group,"onUpdate:modelValue":l[4]||(l[4]=e=>m(j).group=e),disabled:V.previewCostItems},{default:u((()=>[(i(!0),v(b,null,f(m(U),((e,l)=>(i(),r(a,{value:e.value},{default:u((()=>[y(g(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",_e,[me,m(x)?(i(),r(m(Me),{key:0,disabled:V.previewCostItems,modelValue:m(j).description,"onUpdate:modelValue":l[5]||(l[5]=e=>m(j).description=e),editor:m(x),config:Ue},null,8,["disabled","modelValue","editor"])):h("",!0)]),d("div",ve,[fe,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(P,{modelValue:m(j).internal_notes,"onUpdate:modelValue":l[6]||(l[6]=e=>m(j).internal_notes=e),disabled:V.previewCostItems,rows:"4",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),c(D,{class:"column is-12 mt-3"},{default:u((()=>[d("div",be,[d("div",ye,[he,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(T,{modelValue:m(j).unit_cost,"onUpdate:modelValue":l[7]||(l[7]=e=>m(j).unit_cost=e),disabled:V.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Ie,[ge,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(T,{modelValue:m(j).quantity,"onUpdate:modelValue":l[8]||(l[8]=e=>m(j).quantity=e),disabled:V.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",we,[Ce,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(T,{modelValue:m(j).unit,"onUpdate:modelValue":l[9]||(l[9]=e=>m(j).unit=e),disabled:V.previewCostItems,type:"text",name:"unit",placeholder:"Unit"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",ke,[Pe,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(T,{modelValue:m(K),"onUpdate:modelValue":l[10]||(l[10]=e=>I(K)?K.value=e:null),disabled:V.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Ve,[xe,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(T,{modelValue:m(j).markup,"onUpdate:modelValue":l[11]||(l[11]=e=>m(j).markup=e),disabled:V.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",De,[Te,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(T,{modelValue:m(Ae),"onUpdate:modelValue":l[12]||(l[12]=e=>I(Ae)?Ae.value=e:null),disabled:V.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Se,[je,c(s,null,{default:u((()=>[c(o,null,{default:u((()=>[c(T,{modelValue:m(j).margin,"onUpdate:modelValue":l[13]||(l[13]=e=>m(j).margin=e),disabled:V.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1})])])),action:u((()=>[c(n,{loading:m(S),type:"submit",color:"primary",icon:V.costItemId?"":"fas fa-plus",raised:""},{default:u((()=>[y(g(V.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","onSubmit"])}}}),Me=P("useProposal",(()=>{const e=a(!0),l=R(),t=B(),o=a("");a("");const s=a([]),n=a([]),i=a({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),r=a([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:r,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await t.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(o){l.error(` ${o}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const l=await t.get(`/api/lead-proposal/${e}/detail/`);i.value=l.data}catch(l){console.log(l)}},getCompanyProposals:async()=>{try{e.value=!0;const l=await t.get("/api/lead-proposal/");s.value=l.data}catch(a){l.error(` ${a}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{o.value=e;const l=await t.get(`/api/cost/by-proposal/${e}/`);r.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){o.value="",r.value=[]}}})),Ue={class:"modal-form columns is-multiline"},Oe={class:"column is-full"},Ee={class:"field"},Fe=d("label",{class:"label"},"Send To ",-1),Le={class:"control"},He={class:"column is-full"},$e={class:"field"},qe=d("label",{class:"label"},"Subject ",-1),Ne={class:"control"},Be={class:"field column is-full mt-5"},Re=d("label",{class:"label"},"Message",-1),ze=d("i",{class:"feather:mail"},null,-1),We=e({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const f=e,b=Me(),I=B();a(!1);const g=R(),k=a(!1),P=a(""),x=l(),D=window.origin,T=a(`${D}/proposal-view/?proposal=${f.proposalData?.id}`),S=()=>{t("update:modalHandler",!1)};P.value="<b> Hi  <br />\nIbex Management <br />\n</b>";const j=a({scheduleAt:"",sendToGroup:[],link:"",sendTo:b.leadProposalFormData?.jobInfo?.clientInfo?.email?b.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:"",message:`<p><b>Hi ${b.leadProposalFormData?.jobInfo?.clientInfo?.username?b.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${b.leadProposalFormData?.jobInfo?.clientInfo?.last_name?b.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n  \n  <p>We hope this message finds you well.</p>\n  \n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing. \n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n  \n  <p>\n    You can review the full proposal, including the cost breakdown, by clicking the link below: <br />\n    <a href="${T.value}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal</a>\n  </p>\n\n  \n  <p><b>Summary of Charges:</b></p>\n  <ul>\n    <li><b>Total Items:</b> ${b.leadProposalFormData.proposalAmount??0}</li>\n    <li><b>Total Amount:</b>$${b.leadProposalFormData.proposalAmount??0}</li>\n  </ul>\n  \n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience. \n    We are here to assist you.\n  </p>\n  \n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n  \n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`}),A=async()=>{try{k.value=!0;await I.post(`/api/lead-proposal/${f.proposalData?.id}/send-proposal-template/`,{email:j.value.sendTo,subject:j.value.subject,message:j.value.message,scheduleAt:j.value.scheduleAt,link:T.value,column:f.columnsToShow});g.success("Email sent to worker successfully"),S()}catch(e){console.log(e)}finally{k.value=!1}},M=o((()=>s((()=>import("./ckeditor-fbd8f3be.js").then((e=>e.c))),["assets/ckeditor-fbd8f3be.js","assets/index-68d93679.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-cafaf688.js"]).then((e=>e.default.component)))),U={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return n((async()=>{x.value=await s((()=>import("./ckeditor-4fe47de5.js").then((e=>e.c))),["assets/ckeditor-4fe47de5.js","assets/index-68d93679.js","assets/index-ce8747cd.css"]).then((e=>e.default))})),(e,l)=>{const a=C,t=E;return i(),v("div",null,[c(V,{name:"fade-slow"},{default:u((()=>[c(t,{is:"form",open:f.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:w(A,["prevent"]),onClose:S},{content:u((()=>[d("div",Ue,[d("div",Oe,[d("div",Ee,[Fe,d("div",Le,[p(d("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>m(j).sendTo=e)},null,512),[[_,m(j).sendTo]])])])]),d("div",He,[d("div",$e,[qe,d("div",Ne,[p(d("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>m(j).subject=e)},null,512),[[_,m(j).subject]])])])]),d("div",Be,[Re,m(x)?(i(),r(m(M),{key:0,modelValue:m(j).message,"onUpdate:modelValue":l[2]||(l[2]=e=>m(j).message=e),editor:m(x),config:U},null,8,["modelValue","editor"])):h("",!0)])])])),action:u((()=>[c(a,{type:"submit",color:"primary",loading:m(k),raised:""},{default:u((()=>[ze,y(" Send Proposal")])),_:1},8,["loading"])])),cancel:u((()=>[c(a,{color:"light",onClick:S,raised:""},{default:u((()=>[y("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),Je=a(["title","cost_code","description","quantity","unit_cost","unit","total_price"]),Ge=[{value:"title",label:"Title"},{value:"cost_code",label:"Cost Code"},{value:"description",label:"Description"},{value:"quantity",label:"Quantity"},{value:"unit_cost",label:"Unit Cost"},{value:"unit",label:"Unit"},{value:"builder_cost",label:"Builder Cost"},{value:"markup",label:"Markup"},{value:"margin",label:"Margin"},{value:"total_price",label:"Client Price"},{value:"cost_type",label:"Cost Type"},{value:"group_amount",label:"Group Amount"},{value:"notes",label:"Notes"},{value:"profit",label:"Profit"}],Qe=a({cost_code:"cost_code",title:"title",unit:"unit",description:"description",cost_type:"cost_type",mark_as:"mark_as",quantity:"quantity",unit_cost:"unit_cost",total_price:"total_price",builder_cost:"builder_cost",markup:"markup",status:"status",group_amount:"group_amount",profit:"profit",internal_notes:"internal_notes"}),Ke=a({cost_code:"Cost Code",title:"Title",unit:"Unit",description:"Description",cost_type:"Cost Type",mark_as:"Mark As",quantity:"Quantity",unit_cost:"Unit Cost",builder_cost:"Builder Cost",markup:"Markup",markup_amount:"Markup Amount",status:"Status",total_price:"Client Price",group_amount:"Group Price",TotalCost:"Total Cost",total_markup:"Total Markup",profit:"Profit",notes:"Internal Notes",state:"State"}),Ye=e=>(D("data-v-cb33cfee"),e=e(),T(),e),Xe={class:"columns is-multiline"},Ze=Ye((()=>d("div",{class:"column is-9"},[d("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),d("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),el={class:"column is-12"},ll={class:"invoice-wrapper"},al={class:"invoice-header"},tl={class:"left"},ol=Ye((()=>d("a",{class:"action"},[d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"})],-1))),sl=Ye((()=>d("a",{class:"action"},[d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"})],-1))),nl=[Ye((()=>d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],il={class:"invoice-body"},rl={class:"invoice-card"},ul={class:"invoice-section is-flex is-bordered"},dl=Ye((()=>d("div",{class:"meta"},null,-1))),cl=Ye((()=>d("div",{class:"end is-right"},[d("span",null,"PO Box 242"),d("span",null,"Evergreen, CO 80437-0242"),d("span",null,"Phone: 720 272-9061"),d("span",null,"Premium Trades for Premier Builders")],-1))),pl={class:"invoice-section is-flex is-bordered"},_l={class:"meta"},ml={class:"end is-left"},vl={class:"invoice-section"},fl={class:"responsive-table"},bl=["innerHTML"],yl={key:1},hl={class:"invoice-section is-flex mt-0 pt-0"},Il={class:"end is-left"},gl={class:"text-right"},wl=x('<div class="invoice-section is-flex mt-0 pt-0" data-v-cb33cfee><div class="footer" data-v-cb33cfee><div class="footer-meta" data-v-cb33cfee><p data-v-cb33cfee>Signature:</p><div data-v-cb33cfee> ___________________________________________________________________________________ </div></div><div class="footer-meta" data-v-cb33cfee><p data-v-cb33cfee>Date:</p><div data-v-cb33cfee> ___________________________________________________________________________________ </div></div><div class="footer-meta" data-v-cb33cfee><p class="no-wrap" data-v-cb33cfee>Print Name:</p><div data-v-cb33cfee> ___________________________________________________________________________________ </div></div></div></div>',1),Cl=S(e({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const l=e,t=Me(),o=a(!1),s=a([]),u=a({}),p=()=>{u.value=l.proposalData,s.value=Je,o.value=!o.value};return n((()=>{})),(e,a)=>{const n=G,u=We;return i(),v("div",Xe,[Ze,d("div",el,[d("div",ll,[d("div",al,[d("div",tl,[d("h3",null," Proposal-ID "+g(m(t).leadProposalFormData?.id.slice(1,8)),1)]),d("div",{class:"right"},[d("div",{class:"controls"},[ol,sl,d("a",{class:"action",onClick:p},nl)])])]),d("div",il,[d("div",rl,[d("div",ul,[c(n,{size:"xl",picture:"/logos/IbexFavicon.png"}),dl,cl]),d("div",pl,[d("div",_l,[d("h3",null,g(m(t).leadProposalFormData?.jobInfo?.clientInfo?.username??"N/A")+" "+g(m(t).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1),d("span",null,g(m(t).leadProposalFormData?.jobInfo?.clientInfo?.email?m(t).leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A"),1)]),d("div",ml,[d("h3",null,g(m(W)(m(t).leadProposalFormData?.created_at)),1),d("p",null," Job Address: "+g(m(t).leadProposalFormData?.jobInfo?.address??"N/A"),1)])]),d("div",vl,[d("table",fl,[d("thead",null,[(i(!0),v(b,null,f(m(Je),((e,l)=>(i(),v("th",{key:l},g(m(Ke)[e]),1)))),128))]),d("tbody",null,[(i(!0),v(b,null,f(m(t).proposalCostItems,((e,l)=>(i(),v("tr",{key:e.id},[(i(!0),v(b,null,f(m(Je),((l,a)=>(i(),v("td",{key:a},["Description"===l?(i(),v("div",{key:0,innerHTML:e[m(Qe)[l]]},null,8,bl)):(i(),v("span",yl,g(e[m(Qe)[l]]),1))])))),128))])))),128))])])]),d("div",hl,[d("div",Il,[d("h3",gl," Total Price: $"+g(m(t).leadProposalFormData?.proposalAmount),1)])]),wl])])])]),m(o)?(i(),r(u,{key:0,proposalSenderModal:m(o),proposalData:l.proposalData,columnsToShow:m(s),"onUpdate:modalHandler":a[0]||(a[0]=e=>o.value=!1)},null,8,["proposalSenderModal","proposalData","columnsToShow"])):h("",!0)])}}}),[["__scopeId","data-v-cb33cfee"]]),kl=e=>(D("data-v-eafba95d"),e=e(),T(),e),Pl={class:"datatable-wrapper mt-0"},Vl={class:"table-container"},xl={class:"table datatable-table is-fullwidth",id:"external-events"},Dl=kl((()=>d("th",null,"Item#",-1))),Tl=kl((()=>d("th",null,"Actions",-1))),Sl=["data-event","onDragstart","onDrop"],jl={class:"is-relative"},Al=["onClick"],Ml=kl((()=>d("i",{style:{cursor:"grab"},class:"lnir lnir-sort","aria-hidden":"true"},null,-1))),Ul=["innerHTML"],Ol={key:1},El=["onClick"],Fl=[kl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1))),kl((()=>d("div",{class:"meta"},[d("span",null,"View"),d("span",null,"View user details")],-1)))],Ll=["onClick"],Hl=[kl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),kl((()=>d("div",{class:"meta"},[d("span",null,"Edit"),d("span",null,"Edit Cost Item")],-1)))],$l=kl((()=>d("hr",{class:"dropdown-divider"},null,-1))),ql=["onClick"],Nl=[kl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),kl((()=>d("div",{class:"meta"},[d("span",null,"Remove"),d("span",null,"Remove from list")],-1)))],Bl=S(e({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{}},setup(e){const l=e,t=Me(),o=R(),s=a({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),p=B(),_=a(""),I=a(!1);a([]);const C=e=>{e.preventDefault()},k=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},P=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},V=a(""),x=a(0),D=a(""),T=a(!1),S=a(!1),j=async()=>{try{S.value=!0;await p.delete(`/api/cost/${D.value}/`);M(),s.value.isSweetAlertOpen=!1,o.success("Cost item deleted")}catch(e){console.log(e)}finally{S.value=!1}},A=(e,l=!1)=>{D.value=e.id,T.value=l,V.value=e.proposal,I.value=!I.value},M=()=>{t.getProposalCostItems(V.value)};return n((()=>{})),(e,a)=>{const o=K,n=Q,S=Ae;return i(),v("div",Pl,[d("div",Vl,[d("table",xl,[d("thead",null,[Dl,(i(!0),v(b,null,f(l.columnsToShow,((e,l)=>(i(),v("th",{key:l},g(m(Ke)[e]),1)))),128)),Tl]),d("tbody",null,[m(t).proposalCostItems.length>0?(i(!0),v(b,{key:0},f(m(t).proposalCostItems,((e,a)=>(i(),v("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,_.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=t.proposalCostItems.find((e=>e.id===_.value)),a=t.proposalCostItems.find((l=>l.id===e));if(l&&a){p.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=t.proposalCostItems.indexOf(l),o=t.proposalCostItems.indexOf(a);e>=0&&o>=0&&(t.proposalCostItems.splice(e,1),t.proposalCostItems.splice(o,0,l))}else console.error("Dragged or Dropped Item not found");_.value=null})(e.id),onDragover:C,onDragenter:k,onDragleave:P,class:"draggable-item events"},[d("td",jl,[d("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","font-weight":"600"},onClick:l=>(e=>{V.value=e.proposal,x.value=e.index,I.value=!I.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,Al),Ml,y(" "+g(a+1),1)]),(i(!0),v(b,null,f(l.columnsToShow,((l,a)=>(i(),v("td",{key:a},["description"===l?(i(),v("div",{key:0,innerHTML:e[m(Qe)[l]]},null,8,Ul)):(i(),v("span",Ol,g(e[m(Qe)[l]]),1))])))),128)),d("td",null,[c(o,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:""},{content:u((({close:l})=>[d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:w((()=>{A(e,!0),l()}),["prevent"])},Fl,8,El),d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:w((()=>{A(e,!1),l()}),["prevent"])},Hl,8,Ll),$l,d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:w((()=>{(e=>{D.value=e.id,V.value=e.proposal,s.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},Nl,8,ql)])),_:2},1024)])],40,Sl)))),128)):h("",!0)])])]),m(s).isSweetAlertOpen?(i(),r(n,{key:0,isSweetAlertOpen:m(s).isSweetAlertOpen,title:m(s).title,subtitle:m(s).subtitle,btntext:m(s).btntext,onConfirm:j,onCancel:()=>m(s).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):h("",!0),m(I)?(i(),r(S,{key:1,costItemModal:m(I),proposalId:m(V),costItemId:m(D),previousItemIndex:m(x),previewCostItems:m(T),"onUpdate:modalHandler":a[0]||(a[0]=e=>I.value=!1),"onUpdate:OnSuccess":M},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):h("",!0)])}}}),[["__scopeId","data-v-eafba95d"]]),Rl={class:"columns is-multiline"},zl={class:"column is-12 is-flex space-between"},Wl=d("div",null,[d("h1",{class:"title is-4"},"Proposal Worksheet")],-1),Jl={key:0,class:"column is-12"},Gl={class:"tabs-wrapper column is-12 m-0"},Ql={class:"tabs-inner mt-4"},Kl={class:"tabs is-boxed"},Yl=[d("span",null,"Worksheet",-1)],Xl=[d("span",null,"Format",-1)],Zl=[d("span",null,"Preview",-1)],ea={key:0,class:"column is-12"},la={key:0,class:"column is-12"},aa={class:"columns is-multiline"},ta=d("div",{class:"column is-12",style:{"text-align":"center"}},[d("h1",{class:"title is-4"},"Connect your clients to their projects"),d("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),oa={class:"column is-12"},sa={key:0,class:"column is-12"},na=e({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const p=e,_=l(),f=Me(),b=a(!1),g=a(!1),P=a("worksheet");o((()=>s((()=>import("./ckeditor-fbd8f3be.js").then((e=>e.c))),["assets/ckeditor-fbd8f3be.js","assets/index-68d93679.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-cafaf688.js"]).then((e=>e.default.component))));const V=async()=>{try{f.getProposalCostItems(p.proposalId)}catch(e){console.log(e)}};return n((async()=>{_.value=await s((()=>import("./ckeditor-4fe47de5.js").then((e=>e.c))),["assets/ckeditor-4fe47de5.js","assets/index-68d93679.js","assets/index-ce8747cd.css"]).then((e=>e.default)),p.proposalId&&(V(),f.getProposalDetail(p.proposalId))})),j((()=>{f.clearProposalId()})),(e,l)=>{const a=C,t=A("Multiselect"),o=$,s=H,n=Bl,_=k,f=Cl,x=Ae;return i(),v("div",null,[d("div",Rl,[d("div",zl,[Wl,d("div",null,[c(a,{size:"small",light:"",outlined:"",icon:"fas fa-cog",class:"mr-2",color:m(g)?"danger":"success",onClick:l[0]||(l[0]=e=>g.value=!m(g))},{default:u((()=>[y("Table")])),_:1},8,["color"]),c(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"info",onClick:l[1]||(l[1]=e=>b.value=!m(b))},{default:u((()=>[y("Import")])),_:1}),c(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"primary",onClick:l[2]||(l[2]=e=>b.value=!m(b))},{default:u((()=>[y("Add From")])),_:1}),c(a,{size:"small",light:"",outlined:"",color:"warning",onClick:l[3]||(l[3]=e=>b.value=!m(b))},{default:u((()=>[y("Add Item")])),_:1})])]),c(M,{class:"fade-slow",name:"fade-slow"},{default:u((()=>[m(g)?(i(),v("div",Jl,[c(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[c(o,null,{default:u((()=>[c(t,{modelValue:m(Je),"onUpdate:modelValue":l[4]||(l[4]=e=>I(Je)?Je.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:m(Ge),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):h("",!0)])),_:1}),d("div",Gl,[d("div",Ql,[d("div",Kl,[d("ul",null,[d("li",{class:U(["worksheet"===m(P)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:l[5]||(l[5]=O(w((e=>P.value="worksheet"),["prevent"]),["space"])),onClick:l[6]||(l[6]=e=>P.value="worksheet")},Yl,32)],2),d("li",{class:U(["format"===m(P)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:l[7]||(l[7]=O(w((e=>P.value="format"),["prevent"]),["space"])),onClick:l[8]||(l[8]=e=>P.value="format")},Xl,32)],2),d("li",{class:U(["preview"===m(P)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:l[9]||(l[9]=O(w((e=>P.value="preview"),["prevent"]),["space"])),onClick:l[10]||(l[10]=e=>P.value="preview")},Zl,32)],2)])])])]),c(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["worksheet"===m(P)?(i(),v("div",ea,[c(n,{columnsToShow:m(Je),proposalId:p.proposalId},null,8,["columnsToShow","proposalId"])])):h("",!0)])),_:1}),c(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["format"===m(P)?(i(),v("div",la,[d("div",aa,[c(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[c(o,null,{default:u((()=>[c(t,{modelValue:m(Je),"onUpdate:modelValue":l[11]||(l[11]=e=>I(Je)?Je.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:m(Ge),placeholder:"Add tags"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),c(_,{class:"columns is-multiline m-0"},{default:u((()=>[ta,d("div",oa,[c(n,{columnsToShow:m(Je)},null,8,["columnsToShow"])])])),_:1})])):h("",!0)])),_:1}),c(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["preview"===m(P)?(i(),v("div",sa,[c(f,{proposalData:p.proposalData,columnsToShow:m(Je)},null,8,["proposalData","columnsToShow"])])):h("",!0)])),_:1})]),m(b)?(i(),r(x,{key:0,costItemModal:m(b),proposalId:p.proposalId,"onUpdate:modalHandler":l[12]||(l[12]=e=>b.value=!1),"onUpdate:OnSuccess":V},null,8,["costItemModal","proposalId"])):h("",!0)])}}});export{na as _,Ae as a,Je as s,Me as u};
