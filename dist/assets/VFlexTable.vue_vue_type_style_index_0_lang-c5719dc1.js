import{e,y as a,z as l,V as t,O as o,N as r,Z as s,h as n,ay as u,r as i,az as c,w as d,a9 as p,f as v,al as m,a7 as y,k as f,aA as b,Q as g,R as k,H as w,a1 as h,J as x,l as C,P as $,C as j,B as H,I as S,K as T}from"./index-023a2237.js";const V=["data-th"],B=e({__name:"VFlexTableCell",props:{column:{default:()=>({})}},setup(e){const r=e;return(e,s)=>(a(),l("div",{class:o(["flex-table-cell is-relative",[r.column.bold&&"is-bold",r.column.media&&"is-media",!0===r.column.grow&&"is-grow","lg"===r.column.grow&&"is-grow-lg","xl"===r.column.grow&&"is-grow-xl",r.column.scrollX&&!r.column.scrollY&&"has-slimscroll-x",!r.column.scrollX&&r.column.scrollY&&"has-slimscroll",r.column.scrollX&&r.column.scrollY&&"has-slimscroll-all","end"===r.column.align&&"cell-end","center"===r.column.align&&"cell-center",r.column.cellClass]]),"data-th":r.column.label||void 0},[t(e.$slots,"default")],10,V))}}),O=e({props:{id:{type:String,required:!0},label:{type:String,default:void 0},modelValue:{type:String,default:void 0},noRouter:{type:Boolean,default:void 0},routerQueryKey:{type:String,default:"sort"}},emits:["update:modelValue"],setup(e,a){const l=r(),t=s((()=>e.modelValue??l.query[e.routerQueryKey]??"")),o=s((()=>t.value===`${e.id}:asc`)),i=s((()=>t.value===`${e.id}:desc`)),c=s((()=>o.value?`${e.id}:desc`:i.value?void 0:`${e.id}:asc`)),d=s((()=>{if(e.noRouter)return{};const a={...l.query};return e.routerQueryKey&&(a[e.routerQueryKey]=c.value),{name:l.name,params:l.params,query:a}})),p=l=>{if(a.emit("update:modelValue",c.value),e.noRouter)return l.preventDefault(),l.stopPropagation(),!1};return()=>{const l=a.slots?.default?.({isDesc:i.value,isAsc:o.value,nextSort:c.value,value:t.value}),r=n(u,{to:d.value,onClick:p,onKeydown(e){"Space"===e.code&&(e.preventDefault(),e.stopPropagation(),e.target instanceof HTMLAnchorElement&&e.target.dispatchEvent(new MouseEvent("click")))}},{default(){const a=n("span",{key:`${t.value}`,class:"is-inline"},n("span",{class:"ml-3 iconify is-inline","data-icon":o.value?"fa6-solid:sort-up":i.value?"fa6-solid:sort-down":"fa6-solid:sort"}));return[l??e.label,a]}});return n("span",{},r)}}}),R=Symbol(),K=e=>e,_=({key:e,order:a,a:l,b:t})=>{const o=l[e],r=t[e];return"string"==typeof o?"asc"===a?o.localeCompare(r):r.localeCompare(o):o>r?"asc"===a?1:-1:o<r?"asc"===a?-1:1:0},A=e({props:{data:{type:[Array,Function],default:void 0},columns:{type:Object,default:void 0},sort:{type:String,default:void 0},searchTerm:{type:String,default:void 0},limit:{type:Number,default:void 0},page:{type:Number,default:void 0},total:{type:Number,default:void 0},debounceSearch:{type:Number,default:300}},emits:["update:sort","update:page","update:limit","update:searchTerm"],setup(e,a){const l=i(),t=i(!1),o=i(""),r=s({get:()=>e.sort??o.value,set(l){void 0===e.sort?o.value=l:a.emit("update:sort",l)}}),u=i(""),y=s({get:()=>e.searchTerm??u.value,set(l){void 0===e.searchTerm?u.value=l:a.emit("update:searchTerm",l)}}),f=i(1),b=s({get:()=>e.page??f.value,set(l){void 0===e.page?f.value=l:a.emit("update:page",l)}}),g=i(10),k=s({get:()=>Math.max(1,e.limit??g.value),set(l){void 0===e.limit?g.value=l:a.emit("update:limit",l)}}),w=s((()=>{const a=e.columns;if(!a)return a;const l={};return Object.keys(a).reduce(((e,l)=>{const t=a[l];return"string"==typeof t?e[l]={format:K,label:t,key:l}:"object"==typeof t&&(e[l]={format:K,label:l,key:l,...t},!0===t.sortable&&(t.renderHeader?e[l].renderHeader=()=>n(O,{id:l,noRouter:!0,modelValue:r.value,"onUpdate:modelValue":e=>r.value=e},{default:t.renderHeader}):e[l].renderHeader=()=>n(O,{id:l,label:t.label??l,noRouter:!0,modelValue:r.value,"onUpdate:modelValue":e=>r.value=e})),!0!==t.searchable||t.sort||(e[l].sort=_)),e}),l),l})),h=s((()=>{let a=l.value;if(!a)return a;if("function"==typeof e.data)return a;if($.value){const e=w.value?Object.values(w.value).filter((e=>!(!e||"string"==typeof e)&&!0===e.searchable)):[];if(e.length){const l=new RegExp($.value,"i");a=a.filter(((a,t)=>e.some((e=>{if(!e.key)return!1;const o=a[e.key];return e.filter?e.filter({searchTerm:$.value,value:o,row:a,column:e,index:t}):"string"==typeof o&&o.match(l)}))))}}return a})),x=s((()=>{let a=h.value;if(!a)return a;if("function"==typeof e.data)return a;if(r.value&&r.value.includes(":")){const[e,l]=r.value.split(":"),t=w.value?Object.values(w.value).find((a=>!(!a||"string"==typeof a)&&(!0===a.sortable&&a.key===e))):null;if(t){const e=[...a];e.sort(((e,a)=>t.key&&t.sort?t.sort({order:l,column:t,key:t.key,a:e,b:a}):0)),a=e}}return a})),C=s((()=>{if("function"==typeof e.data)return l.value;if(!l.value)return l.value;let a=x.value;return a?.slice(H.value,H.value+k.value)})),$=c(y,e.debounceSearch),j=s((()=>e.total??x.value?.length??0)),H=s((()=>(b.value-1)*k.value)),S=s((()=>j.value?Math.ceil(j.value/k.value):0));async function T(a){if("function"==typeof e.data){t.value=!0;try{l.value=await e.data({searchTerm:$.value,start:H.value,limit:k.value,sort:r.value,controller:a})}finally{t.value=!1}}}d([$,k],(()=>{1!==b.value&&(b.value=1)})),p((async a=>{let t;"function"==typeof e.data?(t=new AbortController,await T(t)):l.value=e.data,a((()=>{t?.abort()}))}));const V=v({data:C,columns:w,loading:t,searchInput:y,searchTerm:$,start:H,page:b,limit:k,sort:r,total:j,totalPages:S,fetchData:T});return m(R,V),a.expose(V),()=>{const e=a.slots.default?.(V);return n("div",{class:"flex-table-wrapper"},e)}}}),N={key:0,class:"flex-table-header"},Q=["tabindex","role","onKeydown","onClick"],q={key:0},D={class:"language-json py-4"},E=e({__name:"VFlexTable",props:{data:{default:()=>[]},columns:{default:void 0},printObjects:{type:Boolean},reactive:{type:Boolean},compact:{type:Boolean},rounded:{type:Boolean},separators:{type:Boolean},clickable:{type:Boolean},subtable:{type:Boolean},noHeader:{type:Boolean}},emits:["rowClick"],setup(e,{emit:r}){const n=e,u=y(R,null),i=s((()=>u?.data?u.data:n.reactive?f(n.data)?n.data:v(n.data):b(n.data))),c=e=>e,d=s((()=>{const e=u?.columns??n.columns;let a=[];if(e)for(const[l,t]of Object.entries(e))"string"==typeof t?a.push({format:c,label:t,key:l}):a.push({format:c,label:l,key:l,...t});else if(i.value.length>0)for(const[l]of Object.entries(i.value[0]))a.push({format:c,label:l,key:l});return a}));return(e,s)=>{const u=B;return a(),l("div",{class:o(["flex-table",[n.compact&&"is-compact",n.rounded&&"is-rounded",n.separators&&"with-separators",n.noHeader&&"no-header",n.clickable&&"is-table-clickable",n.subtable&&"sub-table"]])},[t(e.$slots,"header",{},(()=>[n.noHeader?$("",!0):(a(),l("div",N,[(a(!0),l(g,null,k(C(d),(r=>t(e.$slots,"header-column",{key:"col"+r.key,column:r},(()=>[r.renderHeader?(a(),w(h({render:r.renderHeader}),{key:0,class:o([!0===r.grow&&"is-grow","lg"===r.grow&&"is-grow-lg","xl"===r.grow&&"is-grow-xl","end"===r.align&&"cell-end","center"===r.align&&"cell-center"])},null,8,["class"])):(a(),l("span",{key:1,class:o([!0===r.grow&&"is-grow","lg"===r.grow&&"is-grow-lg","xl"===r.grow&&"is-grow-xl","end"===r.align&&"cell-end","center"===r.align&&"cell-center"])},x(r.label),3))])))),128))]))])),t(e.$slots,"body",{},(()=>[(a(!0),l(g,null,k(C(i),((s,i)=>(a(),l(g,{key:i},[t(e.$slots,"body-row-pre",{row:s,columns:C(d),index:i}),j("div",{class:o(["flex-table-item",[n.clickable&&"is-clickable"]]),tabindex:n.clickable?0:void 0,role:n.clickable?"button":void 0,onKeydown:S(T((()=>{n.clickable&&r("rowClick",s,i)}),["prevent"]),["space"]),onClick:()=>{n.clickable&&r("rowClick",s,i)}},[t(e.$slots,"body-row",{row:s,columns:C(d),index:i},(()=>[(a(!0),l(g,null,k(C(d),(r=>(a(),w(u,{key:"row"+r.key,column:r},{default:H((()=>[t(e.$slots,"body-cell",{row:s,column:r,index:i,value:r.format(s[r.key],s,i)},(()=>[r.renderRow?(a(),w(h({render:()=>r.renderRow?.(s,r,i)}),{key:0})):"object"==typeof r.format(s[r.key],s,i)?(a(),l("span",{key:1,class:o([r.cellClass,r.inverted&&"dark-inverted",!r.inverted&&(r.bold?"dark-text":"light-text")])},[e.printObjects?(a(),l("details",q,[j("div",D,[j("pre",null,[j("code",null,x(r.format(s[r.key],s,i)),1)])])])):$("",!0)],2)):(a(),l("span",{key:2,class:o([r.cellClass,r.inverted&&"dark-inverted",!r.inverted&&(r.bold?"dark-text":"light-text")])},x(r.format(s[r.key],s,i)),3))]))])),_:2},1032,["column"])))),128))]))],42,Q),t(e.$slots,"body-row-post",{row:s,columns:C(d),index:i})],64)))),128))]))],2)}}});export{E as _,O as a,A as b,B as c};
