import{_ as e,a,b as s}from"./ProjectFiles-dcabd2eb.js";import{_ as l}from"./ProjectTodayTasks.vue_vue_type_style_index_0_lang-dfb866af.js";import{_ as t,a as i}from"./VOption.vue_vue_type_style_index_0_lang-59cd06f1.js";import{_ as r}from"./VLabel.vue_vue_type_script_setup_true_lang-11aa501e.js";import{_ as o}from"./VField.vue_vue_type_script_setup_true_lang-a47345d8.js";import{_ as n}from"./VControl-f79e7cbf.js";import{_ as c}from"./UserPopoverContent.vue_vue_type_script_setup_true_lang-1552f591.js";import{_ as d}from"./VAvatar.vue_vue_type_style_index_0_lang-5cbc664c.js";import{_ as u}from"./VIcon.vue_vue_type_script_setup_true_lang-aa8cc354.js";import{f as p,y as v,x as m,b as h,r as f,s as g,o as y,B as _,C as k,D as b,E as j,m as x,O as C,N as w,F as I,U as V,G as D,K as T,I as A,H as N,V as S,W as U,k as P,Q as E,R as $,J as M,S as z}from"./index-ecbaa83d.js";import{A as F}from"./vue3-apexcharts.common-77fdd0cd.js";import{u as L}from"./useNotyf-4cafb716.js";import{u as B}from"./useAPI-e0455834.js";import{a as K}from"./useSupportElement-d042a3b9.js";import{u as O}from"./useThemeColors-9d59ee33.js";const H=e=>(E("data-v-1ced318c"),e=e(),$(),e),q={class:"personal-dashboard personal-dashboard-v2"},R={class:"columns is-multiline"},G={class:"column is-12"},J={class:"dashboard-header is-relative"},Q={class:"user-meta is-dark-bordered-12"},W={class:"title is-4 is-narrow is-bold"},Y=H((()=>j("i",{class:"fas fa-home"},null,-1))),X={class:"user-action"},Z=H((()=>j("h3",{class:"title is-5 is-narrow"},"Information",-1))),ee={class:"light-text"},ae={class:"light-text"},se={class:"light-text"},le={class:"media-flex inverted-text"},te=H((()=>j("a",{class:"link inverted-text"},"Change status",-1))),ie={key:0,class:"tabs-inner"},re={class:"tabs is-boxed",slider:""},oe=[H((()=>j("span",null,"Project Info",-1)))],ne=[H((()=>j("span",null,"Tasks Calendar",-1)))],ce=[H((()=>j("span",null,"Tasks",-1)))],de=H((()=>j("li",{class:"tab-naver"},null,-1))),ue={key:1,class:"columns is-multiline"},pe={key:0,class:"column is-8"},ve={class:"dashboard-card has-margin-bottom"},me=["innerHTML"],he={class:"dashboard-card has-margin-bottom"},fe={class:"dashboard-card"},ge=H((()=>j("div",{class:"card-head"},[j("h3",{class:"dark-inverted"},"Task Completion"),j("a",{class:"action-link",tabindex:"0"},"Reports")],-1))),ye={class:"dashboard-card"},_e={class:"card-head"},ke=H((()=>j("h3",{class:"dark-inverted"},"Assigned Manager",-1))),be={class:"active-team"},je={key:0,class:"user-list"},xe={class:"user-list-info"},Ce={class:"name dark-inverted"},we={class:"position"},Ie=H((()=>j("div",{class:"user-list-icons"},null,-1))),Ve={key:1,class:"user-list"},De=[H((()=>j("div",{class:"user-list-info"},[j("div",{class:"name dark-inverted"},"No Manager assigned yet")],-1)))],Te={key:2},Ae={class:"is-flex space-between"},Ne={key:0},Se={class:"dashboard-card"},Ue={class:"card-head"},Pe=H((()=>j("h3",{class:"dark-inverted"},"Client Information",-1))),Ee={class:"active-team"},$e={key:0,class:"user-list"},Me={class:"user-list-info"},ze={class:"name dark-inverted"},Fe={class:"position"},Le=H((()=>j("div",{class:"user-list-icons"},null,-1))),Be={key:1,class:"user-list"},Ke=[H((()=>j("div",{class:"user-list-info"},[j("div",{class:"name dark-inverted"},"No Client Info Added yet")],-1)))],Oe={key:2},He={class:"dashboard-card"},qe={class:"card-head"},Re=H((()=>j("h3",{class:"dark-inverted"},"Contractor Information",-1))),Ge={class:"active-team"},Je={key:0,class:"user-list"},Qe={class:"user-list-info"},We={class:"name dark-inverted"},Ye={class:"position"},Xe=H((()=>j("div",{class:"user-list-icons"},null,-1))),Ze={key:1,class:"user-list"},ea=[H((()=>j("div",{class:"user-list-info"},[j("div",{class:"name dark-inverted"}," No contractor Info Added yet ")],-1)))],aa={key:2},sa={class:"dashboard-card"},la={key:2,class:"columns is-multiline"},ta={class:"column is-12"},ia={key:3,class:"columns is-multiline"},ra=z(p({__name:"ProjectDetail",setup(p){const E=O(),$=B(),z=L(),H=v(),ra=m(),oa=h(),na=f("detail"),ca=f(!1),da=f(!1);f(!1);const ua=f(!1);f(!1);const pa=f(!1),va=f([]),ma=f([]),ha=f([]),fa=f([]),ga=f([]);f(0);const ya=f(0),_a=f(0),ka=f(""),ba=f("");f("");const ja=f([{id:0,username:"",email:"",phoneNumber:""}]),xa=f([]),Ca=f({id:0,title:"",created:"",startDate:"",color:"",endDate:"",description:"",image:"",is_active:null,status:"",address:"",total_tasks:0,client:0,contractor:0,clientInfo:{id:0,username:"",email:"",password:"",avatar:null},uploaded_files:[],contractorInfo:{id:0,username:"",email:"",password:"",avatar:null},managers:[{id:0,username:"",avatar:null,email:"",role:""}]});f({title:"",description:"",startDate:"",endDate:"",status:"",project:H.params.id,workers:[]});const wa=f([{id:0,title:"",description:"",startDate:"",endDate:"",project:0,status:"",worker:[{id:0,username:"",email:"",role:"",avatar:""}]}]),Ia=g({height:180,type:"radialBar",series:[],title:{text:""},chart:{toolbar:{show:!1}},colors:[E.primary,E.purple,E.orange],plotOptions:{radialBar:{hollow:{size:"55%"}}},labels:["Progress"]}),Va=g({series:[],chart:{height:295,type:"pie",toolbar:{show:!1}},labels:["Active","Pending","Completed","Canceled"],colors:[E.accent,E.info,E.primary,E.orange],legend:{position:"right",horizontalAlign:"center"},responsive:[{breakpoint:480,options:{chart:{width:315,toolbar:{show:!1}},legend:{position:"top"}}}],dataLabels:{enabled:!1}}),Da=()=>{ua.value=!ua.value},Ta=()=>{da.value=!da.value},Aa=f(!1),Na=()=>{Aa.value=!Aa.value},Sa=()=>{try{pa.value=!0;$.delete(`/api/project/${H.params.id}/`);z.green("Selected project deleted successfully!"),ra.push("/sidebar/dashboard/projects")}catch(e){console.log(e)}finally{pa.value=!1}};f(0);const Ua=async()=>{try{ca.value=!0;const e=await $.get(`/api/project/${ba.value}/`);Ca.value=e.data;let a=e.data.percentage.toFixed(2);Ia.value.series.push(a),ka.value=e.data.image,ha.value=e.data.managers?e.data.managers:[],Pa()}catch(e){console.log(e)}finally{ca.value=!1}};f([]);const Pa=async()=>{try{ca.value=!0;const e=await $.get(`api/task/${H.params.id}/project/`);wa.value=e.data;const a={pending:0,completed:0,active:0,canceled:0};wa.value.forEach((e=>{const s=e.status||"Unknown";void 0!==a[s]&&a[s]++})),Va.value.series=[a.completed,a.pending,a.active,a.canceled],ca.value=!1}catch(e){console.log(e),ca.value=!1}},Ea=f([]),$a=async()=>{try{Ca.value.managers=Ea.value;let e=K(Ca.value,["image"]);e.delete("clientInfo"),e.delete("contractorInfo"),"object"==typeof Ca.value.client&&e.delete("client"),"object"==typeof Ca.value.contractor&&e.delete("contractor");const a=await $.patch(`/api/project/${H.params.id}/`,e);da.value=!1,ua.value=!1,z.green("Project updated successfully"),Aa.value=!1,Ua(a.data.id)}catch(e){console.log(e)}};f("");const Ma=e=>{ya.value=e},za=e=>{_a.value=e};return y((async()=>{ba.value=H.params.id,Ua(),(async()=>{try{pa.value=!0;const e=await $.get("/api/users/",{});ja.value=e.data.filter((e=>"worker"==e.role)),va.value=e.data.filter((e=>"client"==e.role)),ma.value=e.data.filter((e=>"contractor"==e.role)),fa.value=e.data.filter((e=>"manager"==e.role)),ga.value=fa.value.map((e=>({value:e.id.toString(),name:`${e.username}`,supplier:e.partner?e.partner:"",image:e.avatar}))),console.log("data",ja.value)}catch(e){console.log(e)}finally{pa.value=!1}})(),await Pa(),(async()=>{try{const e=await $.get(`/api/task/today-tasks/?project=${H.params.id}`);xa.value=e.data}catch(e){console.log(e)}})()})),(p,v)=>{const m=u,h=d,f=_("Address"),g=e,y=c,E=_("Tippy"),$=_("Multiselect"),z=n,L=o,B=r,K=t,O=i,pa=l,fa=a,ya=s;return k(),b("div",q,[j("div",R,[j("div",G,[j("div",J,["admin"==x(oa).user.role||"manager"==x(oa).user.role?(k(),C(m,{key:0,style:{position:"absolute",top:"10px","font-size":"18px","font-weight":"600",right:"36px",color:"var(--info)"},class:"cu-pointer",onClick:v[0]||(v[0]=()=>{x(ra).push(`/sidebar/dashboard/projects/add-project/?id=${x(Ca).id}`)}),icon:"lucide:edit"})):w("",!0),"admin"==x(oa).user.role||"manager"==x(oa).user.role?(k(),C(m,{key:1,style:{position:"absolute",top:"10px","font-size":"18px","font-weight":"600",right:"10px",color:"var(--danger)"},class:"cu-pointer",onClick:Sa,icon:"lucide:trash"})):w("",!0),I(h,{picture:x(Ca).image,squared:"",color:"primary",size:"xxl"},null,8,["picture"]),j("div",Q,[j("h3",W,V(x(Ca).title?x(Ca).title:"N/A"),1),I(f,null,{default:D((()=>[Y,T(" "+V(x(Ca).address),1)])),_:1})]),j("div",X,[Z,j("p",ee," Started at: "+V(x(Ca)?.startDate?x(Ca)?.startDate:"N/A"),1),j("p",ae," Expected end: "+V(x(Ca)?.endDate?x(Ca)?.endDate:"N/A"),1),j("p",se," Total jobs: "+V(x(Ca).total_tasks?x(Ca).total_tasks:"N/A")+" Tasks ",1)]),j("div",null,[j("div",le,[x(ca)?w("",!0):(k(),C(x(F),{key:0,id:"completion-chart",height:x(Ia).height,type:x(Ia).type,series:x(Ia).series,options:x(Ia)},null,8,["height","type","series","options"]))]),te])])])]),"admin"==x(oa).user.role||"manager"==x(oa).user.role||"client"==x(oa).user.role?(k(),b("div",ie,[j("div",re,[j("ul",null,[j("li",{class:A(["detail"===x(na)&&"is-active"])},[j("a",{tabindex:"0",role:"button",onKeydown:v[1]||(v[1]=N(M((e=>na.value="detail"),["prevent"]),["space"])),onClick:v[2]||(v[2]=e=>na.value="detail")},oe,32)],2),j("li",{class:A(["calendar"===x(na)&&"is-active"])},[j("a",{tabindex:"0",role:"button",onKeydown:v[3]||(v[3]=N(M((e=>na.value="calendar"),["prevent"]),["space"])),onClick:v[4]||(v[4]=e=>na.value="calendar")},ne,32)],2),j("li",{class:A(["tasks"===x(na)&&"is-active"])},[j("a",{tabindex:"0",role:"button",onKeydown:v[5]||(v[5]=N(M((e=>na.value="tasks"),["prevent"]),["space"])),onClick:v[6]||(v[6]=e=>na.value="tasks")},ce,32)],2),de])])])):w("",!0),"detail"===x(na)?(k(),b("div",ue,["admin"==x(oa).user.role||"manager"==x(oa).user.role?(k(),b("div",pe,[j("div",ve,[j("div",{innerHTML:x(Ca).description},null,8,me)]),j("div",he,[I(g,{projectId:x(H).params.id,files:x(Ca).uploaded_files,"onUpdate:onUploadFile":Ua},null,8,["projectId","files"])]),j("div",fe,[ge,0!=x(wa).length?(k(),C(x(F),{key:0,height:x(Va).chart.height,type:x(Va).chart.type,series:x(Va).series,options:x(Va)},null,8,["height","type","series","options"])):w("",!0)])])):w("",!0),j("div",{class:A("admin"==x(oa).user.role||"manager"==x(oa).user.role?"column is-4":"column is-12")},[j("div",ye,[j("div",_e,[ke,"admin"==x(oa).user.role||"manager"==x(oa).user.role?(k(),b("a",{key:0,onClick:Na,class:"action-link",tabindex:"0"},V(x(Aa)?"Close":"Edit"),1)):w("",!0)]),j("div",be,[x(ha).length>0?(k(),b("ul",je,[(k(!0),b(S,null,U(x(ha),(e=>(k(),b("li",{key:e.id},[j("div",null,[I(E,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:D((()=>[I(y,{user:e},null,8,["user"])])),default:D((()=>[I(h,{picture:e.avatar},null,8,["picture"])])),_:2},1024)]),j("div",xe,[j("div",Ce,V(e.username),1),j("div",we,V(e.email),1)]),Ie])))),128))])):(k(),b("ul",Ve,De)),x(Aa)?(k(),b("div",Te,[I(L,null,{default:D((({id:e})=>[I(z,null,{default:D((()=>[I($,{modelValue:x(Ea),"onUpdate:modelValue":v[7]||(v[7]=e=>P(Ea)?Ea.value=e:null),attrs:{id:e},mode:"tags",placeholder:"Select manager","track-by":"name",label:"name",searchable:!0,"create-tag":!0,options:x(ga),"max-height":145},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):w("",!0),j("div",Ae,[x(Aa)?(k(),b("a",Ne)):w("",!0),x(Aa)?(k(),b("a",{key:1,onClick:$a,class:"action-link",tabindex:"0"},"Save ")):w("",!0)])])]),j("div",Se,[j("div",Ue,[Pe,"admin"==x(oa).user.role||"manager"==x(oa).user.role?(k(),b("a",{key:0,onClick:Ta,class:"action-link",tabindex:"0"},V(x(da)?"Close":"Edit"),1)):w("",!0)]),j("div",Ee,[x(Ca).client?(k(),b("ul",$e,[j("li",null,[j("div",null,[I(E,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:D((()=>[I(y,{user:x(Ca).client},null,8,["user"])])),default:D((()=>[I(h,{picture:x(Ca).client.avatar},null,8,["picture"])])),_:1})]),j("div",Me,[j("div",ze,V(x(Ca).client.username),1),j("div",Fe,V(x(Ca).client.email),1)]),Le])])):(k(),b("ul",Be,Ke)),x(da)?(k(),b("div",Oe,[I(L,null,{default:D((()=>[I(B,null,{default:D((()=>[T("Select client")])),_:1}),I(z,null,{default:D((()=>[I(O,{modelValue:x(Ca).client,"onUpdate:modelValue":v[8]||(v[8]=e=>x(Ca).client=e),onChange:$a},{default:D((()=>[I(K,{value:""},{default:D((()=>[T(" Clients ")])),_:1}),(k(!0),b(S,null,U(x(va),(e=>(k(),C(K,{key:e.id,value:e.id},{default:D((()=>[T(V(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])):w("",!0)])]),j("div",He,[j("div",qe,[Re,"admin"==x(oa).user.role||"manager"==x(oa).user.role?(k(),b("a",{key:0,onClick:Da,class:"action-link",tabindex:"0"},V(x(ua)?"Close":"Edit"),1)):w("",!0)]),j("div",Ge,[x(Ca).contractor?(k(),b("ul",Je,[j("li",null,[j("div",null,[I(E,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:D((()=>[I(y,{user:x(Ca).contractor},null,8,["user"])])),default:D((()=>[I(h,{picture:x(Ca).contractor.avatar},null,8,["picture"])])),_:1})]),j("div",Qe,[j("div",We,V(x(Ca).contractor.username),1),j("div",Ye,V(x(Ca).contractor.email),1)]),Xe])])):(k(),b("ul",Ze,ea)),x(ua)?(k(),b("div",aa,[I(L,null,{default:D((()=>[I(B,null,{default:D((()=>[T("Select contractor")])),_:1}),I(z,null,{default:D((()=>[I(O,{modelValue:x(Ca).contractor,"onUpdate:modelValue":v[9]||(v[9]=e=>x(Ca).contractor=e),onChange:$a},{default:D((()=>[(k(!0),b(S,null,U(x(ma),(e=>(k(),C(K,{key:e.id,value:e.id},{default:D((()=>[T(V(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])):w("",!0)])]),j("div",sa,[I(pa,{projectId:x(H).params.id},null,8,["projectId"])])],2)])):w("",!0),"tasks"===x(na)?(k(),b("div",la,[j("div",ta,[I(fa,{"onUpdate:completedTasks":Ma,"onUpdate:activeTasks":za,projectID:x(H).params.id},null,8,["projectID"])])])):w("",!0),"calendar"===x(na)?(k(),b("div",ia,[I(ya,{projectID:x(H).params.id},null,8,["projectID"])])):w("",!0)])}}}),[["__scopeId","data-v-1ced318c"]]);export{ra as _};
