import{f as e,r as l,o as a,C as t,O as o,G as s,F as i,K as r,J as n,P as p,S as d,E as u,U as c,m,s as _,y as v,x as f,e as y,_ as g,av as b,D as h,N as w,L as C,X as x,H as k,A as V}from"./index-5abab93c.js";import{d as I,u as j,e as S,a as A,c as T,_ as O,f as P,g as D}from"./CreateProposalTasksModal-6750dcd1.js";import{_ as M}from"./VModal.vue_vue_type_style_index_0_lang-cc2df632.js";import{_ as U}from"./VField.vue_vue_type_script_setup_true_lang-75e62cce.js";import{_ as E}from"./VControl-85c123a4.js";import{_ as H}from"./VInput.vue_vue_type_script_setup_true_lang-37e68479.js";import{u as z}from"./useAPI-a1737641.js";import{u as F}from"./useNotyf-d70c19fd.js";import{_ as $}from"./SweetAlert.vue_vue_type_style_index_0_lang-248bedae.js";import{_ as N}from"./VCollapse.vue_vue_type_style_index_0_lang-bd7ec1fb.js";import{_ as q}from"./VTextarea.vue_vue_type_script_setup_true_lang-91706865.js";import{_ as L}from"./VRadio.vue_vue_type_style_index_0_lang-2282029d.js";import{_ as R}from"./VMessage.vue_vue_type_style_index_0_lang-f0b462d8.js";import{_ as B}from"./V-Snack.vue_vue_type_style_index_0_lang-efeda19b.js";import{u as Y}from"./useDropdown-54053c1b.js";import{u as G}from"./viewWrapper-4fb181d6.js";import"./useSupportElement-e00ebb58.js";import"./UnitAddUpdateModal.vue_vue_type_script_setup_true_lang-76b9693d.js";import"./VCheckbox.vue_vue_type_style_index_0_lang-d957a583.js";import"./VLabel.vue_vue_type_script_setup_true_lang-91e2a4e2.js";import"./useVFieldContext-df68c278.js";import"./VOption.vue_vue_type_style_index_0_lang-77331b36.js";import"./costItems-abaf23e9.js";import"./VIconButton-decf899e.js";import"./VTag.vue_vue_type_style_index_0_lang-72ae84a0.js";import"./company-f3ad797d.js";import"./VDropdown.vue_vue_type_style_index_0_lang-b46e4e01.js";import"./VIcon.vue_vue_type_script_setup_true_lang-6fcbfb3b.js";import"./notyf-76e97137.js";import"./useThemeColors-d842ca37.js";const J=d(e({__name:"CreateTemplateModal",props:{openCreateTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const u=e,c=z(),m=F();l([]);const _=l(null);l(!1);const v=l(""),f=()=>{d("update:modalHandler",!1)},y=async()=>{console.log(_);try{await c.post(`/api/lead-proposal/${u.proposalId}/create-template/`,{title:v.value});m.success("Template Create successfully!"),f()}catch(e){console.error("Error importing template:",e),m.error("Something went wrong, try again")}};return a((()=>{})),(e,l)=>{const a=H,d=E,c=U,m=p,_=M;return t(),o(_,{open:u.openCreateTemplate,size:"small",is:"form",title:"Create Template",actions:"right",onSubmit:n(y,["prevent"]),onClose:f},{content:s((()=>[i(c,{label:"Enter title to identify your saved template"},{default:s((()=>[i(d,null,{default:s((()=>[i(a,{required:"",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),type:"text",placeholder:" Template Title"},null,8,["modelValue"])])),_:1})])),_:1})])),action:s((()=>[i(m,{color:"primary",type:"submit",raised:""},{default:s((()=>[r("Confirm")])),_:1})])),cancel:s((()=>[i(m,{color:"primary",style:{display:"none"},raised:""},{default:s((()=>[r("Close")])),_:1})])),_:1},8,["open","onSubmit"])}}}),[["__scopeId","data-v-3fb59420"]]),K={class:"modal-form columns is-multiline"},X={class:"field column is-full"},Q={class:"file"},W={class:"file-label"},Z={class:"file-cta"},ee=u("span",{class:"file-icon"},[u("i",{class:"fas fa-cloud-upload-alt"})],-1),le={class:"file-label"},ae=e({__name:"UploadEstimateFileModal",props:{openEstimatesModal:{type:Boolean},proposalId:{}},emits:["close:ModalHandler","update:OnSuccess"],setup(e,{emit:d}){const _=e,v=z(),f=F(),y=l(!1),g=()=>{d("close:ModalHandler",!1)},b=l(""),h=l(null),w=e=>{const l=e.target,a=l.files?.[0];l.value="",a&&(h.value=a,b.value=a.name)},C=async()=>{try{y.value=!0;const e=await v.post(`/api/lead-proposal/upload-estimates/${_.proposalId}/`,{file:h.value});f.success(`${e.data}`),b.value="",d("update:OnSuccess",null)}catch(e){console.log(e),f.error("File is not supported.")}finally{y.value=!1,g()}};return a((()=>{})),(e,l)=>{const a=E,d=U,v=p,f=M;return t(),o(f,{is:"form",open:_.openEstimatesModal,title:"Upload Estimates File",size:"medium",actions:"right",onSubmit:n(C,["prevent"]),onClose:g},{content:s((()=>[u("div",K,[u("div",X,[i(d,{grouped:""},{default:s((()=>[i(a,null,{default:s((()=>[u("div",Q,[u("label",W,[u("input",{onChange:w,class:"file-input",type:"file",name:"resume"},null,32),u("span",Z,[ee,u("span",le,c(m(b)?m(b):"Choose a file…"),1)])])])])),_:1})])),_:1})])])])),action:s((()=>[i(v,{type:"submit",disabled:!m(h),color:"primary",loading:m(y),raised:""},{default:s((()=>[r(" Create Estimates")])),_:1},8,["disabled","loading"])])),cancel:s((()=>[i(v,{color:"light",onClick:g,raised:""},{default:s((()=>[r("Close ")])),_:1})])),_:1},8,["open","onSubmit"])}}}),te={class:"modal-form columns is-multiline"},oe={class:"column is-12 is-flex space-between align-items-center bg-transparent mx-3"},se={class:"is-flex"},ie={class:"is-flex"},re={key:0,class:"rounded-loader mr-2"},ne=u("i",{class:"fas fa-cloud-upload-alt","aria-hidden":"true"},null,-1),pe=u("i",{class:"fas fa-copy"},null,-1),de=u("i",{class:"fas fa-envelope"},null,-1),ue=u("i",{class:"fas fa-cloud-download-alt","aria-hidden":"true"},null,-1),ce=u("i",{class:"fas fa-trash"},null,-1),me={key:0,class:"column is-12"},_e={class:"field column is-6 mb-0"},ve=u("label",null,"Title: *",-1),fe={class:"control"},ye={class:"column is-6"},ge={class:"field column is-6"},be=u("label",null,"Approval Deadline *",-1),he={class:"control"},we={class:"field column is-6"},Ce=u("label",null,"Attachments",-1),xe=u("div",{class:"file"},[u("label",{class:"file-label"},[u("input",{class:"file-input",type:"file",name:"resume"}),u("span",{class:"file-cta"},[u("span",{class:"file-icon"},[u("i",{class:"fas fa-cloud-upload-alt"})]),u("span",{class:"file-label"}," Choose a file… ")])])],-1),ke={class:"field column is-12 m-3"},Ve={class:"body-inner-content"},Ie={class:"field columns is-multiline mb-0"},je={class:"field column is-11 mb-0"},Se=u("label",{for:"",class:"label"},"Internal Notes",-1),Ae={class:"field column is-11 mb-0"},Te=u("label",{for:"",class:"label"},"Introductory Text",-1),Oe={class:"field column is-11 mb-0"},Pe=u("label",{for:"",class:"label"},"Closing Text",-1),De={class:"column is-12"},Me=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const V=e,M=l();Y(M);const H=_(),G=I(),K=j(),X=F(),Q=z(),W=v(),Z=f(),ee=l(!1),le=l(!1),Me=l([]),Ue=l({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:"",email:"",role:"",avatar:null},created_by_info:null,contractor_info:{id:"",username:"",last_name:"",email:"",role:"",avatar:null},managers_list:[],title:"",description:"",image:"",color:"",startDate:"",endDate:"",status:"",is_active:!1,address:"",wifiAvaliabe:!1,parkingAvaliable:!1,property_features:null,created:"",uploaded_files:[],leadStatus:"",current_state:"",city:"",state:"",zip_code:"",confidence:"",sale_date:null,estimated_from:null,estimated_to:null,tags:[],sources:"",project_type:null,notes:"",attach_mail:null,latitude:0,longitude:0,client:"",contractor:"",created_by:null,managers:[],sales_people:[]},proposalAmount:0,cost_items:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:null,closing_text:null,payment_status:"",type:"",status:"",columns_to_show:[],client_note:null,created_at:"",updated_at:"",is_task_created:!1,is_template:!1,job:null,project:""}),Ee=l(!1),He=l(""),ze=l(!1),Fe=l(!1),$e=l(""),Ne=l(""),qe=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Le=l(!1),Re=y((()=>g((()=>import("./ckeditor-5665c43d.js").then((e=>e.c))),["assets/ckeditor-5665c43d.js","assets/index-5abab93c.js","assets/index-1012de45.css","assets/vue.runtime.esm-bundler-4ce259b7.js"]).then((e=>e.default.component)))),Be={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},Ye=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],Ge=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Je=l({id:"",title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",is_task_created:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),Ke=async()=>{try{const e=await Q.get(`/api/lead-proposal/${W.params.id}/detail/`);Je.value=e.data}catch(e){console.log(e)}},Xe=async()=>{try{ze.value=!0;await Q.delete(`/api/lead-proposal/${Ne.value}/`);Ge.value.isSweetAlertOpen=!1,X.success("Proposal delete successfully"),Z.go(-1)}catch(e){X.error(` ${e}, Proposal`),X.error("Something went wrong please try later")}finally{ze.value=!1}},Qe=async()=>{try{ze.value=!0;await Q.patch(`/api/lead-proposal/${W.params.id}/`,{status:$e.value});Ke(),X.success(`You have ${$e.value} this proposal.`),Ge.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{ze.value=!1}},We=async e=>{try{ze.value=!0;await Q.patch(`/api/lead-proposal/${W.params.id}/`,e);X.success("Proposal updated successfully"),Ke()}catch(l){console.log(l)}finally{ze.value=!1}},Ze=l(!1),el=()=>{Ue.value=K.leadProposalFormData,Me.value.push(K.leadProposalFormData),Le.value=!Le.value},ll=()=>{le.value=!0},al=()=>{(V.proposalId||W.params.id)&&Ke()};return a((async()=>{H.value=await g((()=>import("./ckeditor-3994ce54.js").then((e=>e.c))),["assets/ckeditor-3994ce54.js","assets/index-5abab93c.js","assets/index-1012de45.css"]).then((e=>e.default)),al(),G.getCostCodesHandler()})),(e,l)=>{const a=B,d=p,_=R,v=L,f=E,y=U,g=q,I=N,j=S,M=$,z=A,F=T,Y=ae,G=J,K=O,X=b("tooltip");return t(),h("div",null,[u("div",te,[u("div",oe,[u("div",se,[m(Je).is_task_created?(t(),o(a,{key:0,title:"Calendar Tasks Created ",white:"",class:"ml-2",color:"info",icon:"fas fa-calendar-check"})):w("",!0),"approved"!=m(Je).status?(t(),o(d,{key:1,onClick:l[0]||(l[0]=e=>{return l="approved",$e.value=l,void(Ge.value={title:`${$e.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==$e.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==$e.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var l}),size:"small",class:"ml-2",light:"",outlined:"",color:"info",raised:""},{default:s((()=>[r(" Approve Proposal ")])),_:1})):(t(),o(d,{key:2,light:"",size:"small",color:"primary",class:"ml-1 mt-1",icon:"fas fa-check-circle"},{default:s((()=>[r(" Approved ")])),_:1})),m(Je).is_task_created||"approved"!=m(Je).status?w("",!0):(t(),o(d,{key:3,size:"small",class:"mr-2",light:"",outlined:"",color:"success",raised:"",onClick:l[1]||(l[1]=e=>{return l=m(W).params.id,He.value=l,void(Ee.value=!0);var l})},{default:s((()=>[r(" Generate Tasks ")])),_:1}))]),u("div",ie,[m(Fe)||3==m(P)?(t(),h("div",re)):w("",!0),C((t(),o(d,{size:"small",class:"mr-2",outlined:"",color:"dark",raised:"",onClick:ll},{default:s((()=>[ne])),_:1})),[[X,"Upload File To Create Estimates",void 0,{rounded:!0,dark:!0,bottom:!0}]]),C((t(),o(d,{size:"small",class:"mr-2",light:"",outlined:"",onClick:l[2]||(l[2]=e=>ee.value=!m(ee)),color:"primary",raised:""},{default:s((()=>[pe])),_:1})),[[X,"Create Template Of This Proposal",void 0,{rounded:!0,primary:!0,bottom:!0}]]),C((t(),o(d,{size:"small",class:"mr-2",light:"",outlined:"",onClick:el,color:"warning",raised:""},{default:s((()=>[de])),_:1})),[[X,"Attach in email",void 0,{rounded:!0,warning:!0,bottom:!0}]]),C((t(),o(d,{size:"small",outlined:"",light:"",class:"mr-2",onClick:l[3]||(l[3]=e=>m(D)(m(Je),[])),color:"info",raised:""},{default:s((()=>[ue])),_:1})),[[X,"Download Proposal As PDF",void 0,{rounded:!0,info:!0,bottom:!0}]]),C((t(),o(d,{size:"small",class:"mr-2",light:"",outlined:"",onClick:l[4]||(l[4]=e=>{return l=m(Je).id,Ne.value=l,void(qe.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),color:"danger",raised:""},{default:s((()=>[ce])),_:1})),[[X,"Delete Proposal",void 0,{rounded:!0,danger:!0,bottom:!0}]])])]),m(Je).client_note&&"review"==m(Je).status?(t(),h("div",me,[i(_,{color:"warning"},{default:s((()=>[r(c(m(Je).client_note),1)])),_:1})])):w("",!0),u("div",_e,[ve,u("div",fe,[C(u("input",{type:"text",name:"firstName",onKeyup:l[5]||(l[5]=k(n((e=>We({title:m(Je).title})),["prevent"]),["enter"])),"onUpdate:modelValue":l[6]||(l[6]=e=>m(Je).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,544),[[x,m(Je).title]])])]),u("div",ye,[i(y,{class:"m-0 p-0",label:"Type"},{default:s((()=>[i(f,null,{default:s((()=>[i(v,{modelValue:m(Je).type,"onUpdate:modelValue":[l[7]||(l[7]=e=>m(Je).type=e),l[8]||(l[8]=e=>We({type:"proposal"}))],value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),i(v,{modelValue:m(Je).type,"onUpdate:modelValue":[l[9]||(l[9]=e=>m(Je).type=e),l[10]||(l[10]=e=>We({type:"change_order"}))],value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),i(v,{modelValue:m(Je).type,"onUpdate:modelValue":[l[11]||(l[11]=e=>m(Je).type=e),l[12]||(l[12]=e=>We({type:"draft"}))],value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",ge,[be,u("div",he,[C(u("input",{type:"date",name:"firstName","onUpdate:modelValue":l[13]||(l[13]=e=>m(Je).approval_deadline=e),onChange:l[14]||(l[14]=e=>We({approval_deadline:m(Je).approval_deadline})),class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,544),[[x,m(Je).approval_deadline]])])]),u("div",we,[Ce,i(y,{grouped:""},{default:s((()=>[i(f,null,{default:s((()=>[xe])),_:1})])),_:1})]),u("div",ke,[i(I,{items:Ye,"with-chevron":""},{"collapse-item-content":s((e=>[u("div",Ve,[u("div",Ie,[u("div",je,[Se,i(y,null,{default:s((()=>[i(f,null,{default:s((()=>[i(g,{modelValue:m(Je).internalNotes,"onUpdate:modelValue":l[15]||(l[15]=e=>m(Je).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",Ae,[Te,m(H)?(t(),o(m(Re),{key:0,modelValue:m(Je).introductoryText,"onUpdate:modelValue":l[16]||(l[16]=e=>m(Je).introductoryText=e),editor:m(H),config:Be},null,8,["modelValue","editor"])):w("",!0)]),u("div",Oe,[Pe,m(H)?(t(),o(m(Re),{key:0,modelValue:m(Je).closingText,"onUpdate:modelValue":l[17]||(l[17]=e=>m(Je).closingText=e),editor:m(H),config:Be},null,8,["modelValue","editor"])):w("",!0)])])])])),_:1})]),u("div",De,[m(Je)?(t(),o(j,{key:0,proposalData:m(Je),proposalId:m(W).params.id,"onUpdate:OnSuccess":Ke},null,8,["proposalData","proposalId"])):w("",!0)]),m(Ge).isSweetAlertOpen?(t(),o(M,{key:1,isSweetAlertOpen:m(Ge).isSweetAlertOpen,title:m(Ge).title,subtitle:m(Ge).subtitle,btntext:m(Ge).btntext,onConfirm:Qe,onCancel:()=>m(Ge).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):w("",!0),m(qe).isSweetAlertOpen?(t(),o(M,{key:2,isSweetAlertOpen:m(qe).isSweetAlertOpen,title:m(qe).title,subtitle:m(qe).subtitle,btntext:m(qe).btntext,onConfirm:Xe,onCancel:()=>m(qe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):w("",!0),m(Ee)?(t(),o(z,{key:3,createProposalTasksModal:m(Ee),proposalId:m(He),onCloseModalHandler:l[18]||(l[18]=e=>Ee.value=!1)},null,8,["createProposalTasksModal","proposalId"])):w("",!0),m(Le)?(t(),o(F,{key:4,proposalSenderModal:m(Le),selectedProposalsIds:m(Me),proposalData:m(Ue),"onUpdate:modalHandler":l[19]||(l[19]=e=>{Le.value=!1,Me.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData"])):w("",!0)]),m(le)?(t(),o(Y,{key:0,openEstimatesModal:m(le),proposalId:m(W).params.id,"onClose:ModalHandler":l[20]||(l[20]=e=>le.value=!1),"onUpdate:OnSuccess":al},null,8,["openEstimatesModal","proposalId"])):w("",!0),m(ee)?(t(),o(G,{key:1,proposalId:m(W).params.id,openCreateTemplate:m(ee),"onUpdate:OnSuccess":l[21]||(l[21]=()=>{(V.proposalId||m(W).params.id)&&Ke()}),"onUpdate:modalHandler":l[22]||(l[22]=e=>ee.value=!1)},null,8,["proposalId","openCreateTemplate"])):w("",!0),m(Ze)?(t(),o(K,{key:2,leadId:m(Ue).project,proposalId:m(W).params.id,leadProposalModal:m(Ze),getLeadsList:!1,"onUpdate:modalHandler":l[23]||(l[23]=()=>{al(),Ze.value=!1}),onClearProposalId:l[24]||(l[24]=e=>He.value="")},null,8,["leadId","proposalId","leadProposalModal"])):w("",!0)])}}}),Ue=e({__name:"[id]",setup:e=>(G().setPageTitle("Proposal Details"),V({title:"Proposal Details - Ibex"}),(e,l)=>(t(),h("div",null,[i(Me)])))});export{Ue as default};
