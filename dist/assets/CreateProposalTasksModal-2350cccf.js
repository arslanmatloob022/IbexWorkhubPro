import{e,s as l,r as a,Z as o,b as t,_ as s,o as n,A as i,B as r,N as d,F as u,D as c,E as p,K as m,W as v,l as f,C as _,V as b,U as y,J as h,M as I,j as g,T as w,I as k,O as C,a4 as P,a6 as V,a0 as D,X as x,P as S,Q as T,R as j,i as O,aR as M,H as A,G as U}from"./index-3945af1d.js";import{_ as F}from"./VModal.vue_vue_type_style_index_0_lang-b7a7d01e.js";import{_ as E}from"./VTextarea.vue_vue_type_script_setup_true_lang-67cd9ebd.js";import{_ as L}from"./VInput.vue_vue_type_script_setup_true_lang-f1d099b2.js";import{_ as $}from"./VField.vue_vue_type_script_setup_true_lang-ffcf89bd.js";import{_ as H}from"./VControl-35e5f906.js";import{a as R,_ as q}from"./VOption.vue_vue_type_style_index_0_lang-7999977c.js";import{u as B}from"./useAPI-9c0b6639.js";import{u as N}from"./useNotyf-98e8ba5f.js";import{a as z}from"./useSupportElement-f3d65a2b.js";import{u as W}from"./userSession-0cb55279.js";import{_ as J}from"./VAvatar.vue_vue_type_style_index_0_lang-4d9c7271.js";import{_ as G}from"./VIconButton-e8eba754.js";import{a as K,g as Q,s as X,c as Y}from"./costItems-4a6ecd89.js";import{_ as Z}from"./SweetAlert.vue_vue_type_style_index_0_lang-aad81f5d.js";import{_ as ee}from"./VDropdown.vue_vue_type_style_index_0_lang-74621ed1.js";const le={class:"modal-form columns is-multiline"},ae={class:"columns is-multiline"},oe={class:"field column is-12 mb-0"},te=c("label",null,"Title: ",-1),se={class:"control"},ne=["disabled"],ie={class:"field column is-6"},re=c("label",{for:""},"Cost Type",-1),de={class:"field column is-3"},ue=c("label",{for:""},"Catalog",-1),ce={class:"field column is-3"},pe=c("label",{for:""},"Mark As",-1),me={class:"field column is-6"},ve=c("label",null,"Cost Code *",-1),fe={class:"field column is-6"},_e=c("label",{for:""},"Group Cost",-1),be={class:"field column is-12 mb-0"},ye=c("label",{for:"",class:"label"},"Description",-1),he={class:"field column is-12 mb-0"},Ie=c("label",{for:"",class:"label"},"Internal Notes",-1),ge={class:"columns is-multiline"},we={class:"field column is-6"},ke=c("label",null,"Unit Cost",-1),Ce={class:"field column is-6"},Pe=c("label",null,"Quantity",-1),Ve={class:"field column is-6"},De=c("label",null,"Unit",-1),xe={class:"field column is-6"},Se=c("label",null,"Builder Cost",-1),Te={class:"field column is-6"},je=c("label",null,"Markup (%)",-1),Oe={class:"field column is-6"},Me=c("label",null,"Client Price",-1),Ae={class:"field column is-6"},Ue=c("label",null,"Margin (%)",-1),Fe=e({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:V}){const D=e,x=l();W();const S=N(),T=B(),j=a(!1);a([]),a([]);const O=a({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,group:"",proposal:D.proposalId}),M=a([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]),A=a([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]);a([{value:"Tiling",label:"Tiling"},{value:"Material",label:"Material"},{value:"Paint",label:"Paint"},{value:"Carpenter",label:"Carpenter"}]);const U=a([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]);a([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const J=async()=>{try{j.value=!0;const e=z(O.value,[]);if(D.costItemId){await T.patch(`/api/cost/${D.costItemId}/`,e)}else{await T.post("/api/cost/",e)}G(),K(),S.success("Item added successfully.")}catch(e){S.error(` ${e}, New Worker`)}finally{j.value=!1}},G=()=>{V("update:modalHandler",!1)},K=()=>{V("update:OnSuccess",null)};a(0),a(0);const Q=o((()=>O.value.unit_cost*O.value.quantity));a(0),a(0);const X=o((()=>O.value.markup>0?Q.value+Q.value*O.value.markup/100:O.value.margin>0?Q.value/(1-O.value.margin/100):Q.value));o((()=>(X.value-Q.value)/Q.value*100)),o((()=>(X.value-Q.value)/X.value*100));const Y=t((()=>s((()=>import("./ckeditor-4752a33c.js").then((e=>e.c))),["assets/ckeditor-4752a33c.js","assets/index-3945af1d.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-60de206f.js"]).then((e=>e.default.component)))),Z={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},ee=a(!1),Fe=a(!1);return n((async()=>{x.value=await s((()=>import("./ckeditor-fae0a979.js").then((e=>e.c))),["assets/ckeditor-fae0a979.js","assets/index-3945af1d.js","assets/index-ce8747cd.css"]).then((e=>e.default)),D.previousItemIndex&&(O.value.previousItemIndex=D.previousItemIndex),D.costItemId&&(async()=>{try{ee.value=!0;const e=await T.get(`/api/cost/${D.costItemId}/`);O.value=e.data}catch(e){console.log(e)}finally{ee.value=!1}})(),(async()=>{try{Fe.value=!0;const e=await T.get("/api/cost-code/");A.value=e.data.map((e=>({value:e.id,label:e.name})))}catch(e){console.log(e)}finally{Fe.value=!1}})()})),(e,l)=>{const a=q,o=R,t=H,s=$,n=C,V=i("Multiselect"),S=L,T=E,B=P,N=F;return r(),d(N,{is:"form",open:D.costItemModal,title:"Cost Item ",size:"xl",actions:"right",onSubmit:k(J,["prevent"]),onClose:G},{content:u((()=>[c("div",le,[p(B,{class:"column is-12"},{default:u((()=>[c("div",ae,[c("div",oe,[te,c("div",se,[m(c("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>f(O).title=e),required:"",disabled:D.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,ne),[[v,f(O).title]])])]),c("div",ie,[re,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(o,{modelValue:f(O).cost_type,"onUpdate:modelValue":l[1]||(l[1]=e=>f(O).cost_type=e),disabled:D.previewCostItems},{default:u((()=>[(r(!0),_(y,null,b(f(M),((e,l)=>(r(),d(a,{value:e.value},{default:u((()=>[h(w(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",de,[ue,c("div",null,[p(n,{color:"info",light:"",raised:"",size:"small"},{default:u((()=>[h("Add in Catalog")])),_:1})])]),c("div",ce,[pe,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(o,{modelValue:f(O).mark_as,"onUpdate:modelValue":l[2]||(l[2]=e=>f(O).mark_as=e),disabled:D.previewCostItems},{default:u((()=>[(r(!0),_(y,null,b(f(U),((e,l)=>(r(),d(a,{value:e.value},{default:u((()=>[h(w(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",me,[ve,p(s,null,{default:u((({id:e})=>[p(t,null,{default:u((()=>[p(V,{required:"",modelValue:f(O).cost_code,"onUpdate:modelValue":l[3]||(l[3]=e=>f(O).cost_code=e),disabled:D.previewCostItems,attrs:{id:e},searchable:!0,options:f(A),placeholder:"Select a cost code"},null,8,["modelValue","disabled","attrs","options"])])),_:2},1024)])),_:1})]),c("div",fe,[_e,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(O).group,"onUpdate:modelValue":l[4]||(l[4]=e=>f(O).group=e),name:"gcost",placeholder:"Group Cost"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",be,[ye,f(x)?(r(),d(f(Y),{key:0,disabled:D.previewCostItems,modelValue:f(O).description,"onUpdate:modelValue":l[5]||(l[5]=e=>f(O).description=e),editor:f(x),config:Z},null,8,["disabled","modelValue","editor"])):I("",!0)]),c("div",he,[Ie,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(T,{modelValue:f(O).internal_notes,"onUpdate:modelValue":l[6]||(l[6]=e=>f(O).internal_notes=e),disabled:D.previewCostItems,rows:"4",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),p(B,{class:"column is-12 mt-3"},{default:u((()=>[c("div",ge,[c("div",we,[ke,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(O).unit_cost,"onUpdate:modelValue":l[7]||(l[7]=e=>f(O).unit_cost=e),disabled:D.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Ce,[Pe,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(O).quantity,"onUpdate:modelValue":l[8]||(l[8]=e=>f(O).quantity=e),disabled:D.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Ve,[De,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(O).unit,"onUpdate:modelValue":l[9]||(l[9]=e=>f(O).unit=e),disabled:D.previewCostItems,type:"text",name:"unit",placeholder:"Unit"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",xe,[Se,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(Q),"onUpdate:modelValue":l[10]||(l[10]=e=>g(Q)?Q.value=e:null),disabled:D.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Te,[je,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(O).markup,"onUpdate:modelValue":l[11]||(l[11]=e=>f(O).markup=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Oe,[Me,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(X),"onUpdate:modelValue":l[12]||(l[12]=e=>g(X)?X.value=e:null),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Ae,[Ue,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:f(O).margin,"onUpdate:modelValue":l[13]||(l[13]=e=>f(O).margin=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1})])])),action:u((()=>[p(n,{loading:f(j),type:"submit",color:"primary",icon:D.costItemId?"":"fas fa-plus",raised:""},{default:u((()=>[h(w(D.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","onSubmit"])}}}),Ee=V("useProposal",(()=>{const e=a(!0),l=N(),o=B(),t=a("");a("");const s=a([]),n=a([]),i=a({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),r=a([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:r,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await o.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(t){l.error(` ${t}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const l=await o.get(`/api/lead-proposal/${e}/detail/`);i.value=l.data}catch(l){console.log(l)}},getCompanyProposals:async()=>{try{e.value=!0;const l=await o.get("/api/lead-proposal/");s.value=l.data}catch(a){l.error(` ${a}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{t.value=e;const l=await o.get(`/api/cost/by-proposal/${e}/`);r.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){t.value="",r.value=[]}}})),Le={class:"modal-form columns is-multiline"},$e={class:"column is-full"},He={class:"field"},Re=c("label",{class:"label"},"Send To ",-1),qe={class:"control"},Be={class:"column is-full"},Ne={class:"field"},ze=c("label",{class:"label"},"Subject ",-1),We={class:"control"},Je={class:"field column is-full mt-5"},Ge=c("label",{class:"label"},"Message",-1),Ke=c("i",{class:"feather:mail"},null,-1),Qe=e({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{},selectedProposalsIds:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:o}){const i=e,b=Ee(),y=B(),g=N(),w=a(!1),P=l(),V=window.origin;a(`${V}/proposal-view/?proposal=${i.proposalData?.id}`);const x=()=>{o("update:modalHandler",!1)},S=i.selectedProposalsIds.map((e=>e.id)),T=i.selectedProposalsIds.map((e=>e.proposalAmount)).map(((e,l)=>`<li>Total of proposal ${l+1}:<b> $${e} </b></li>`)).join("<br>"),j=S.map(((e,l)=>`<a href="${V}/proposal-view/?proposal=${e}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal ${l+1}, </a>`)).join("<br>"),O=a({email:b.leadProposalFormData?.jobInfo?.clientInfo?.email?b.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:`Proposal ${b.leadProposalFormData?.jobInfo?.title} `,message:`<p><b>Hi ${b.leadProposalFormData?.jobInfo?.clientInfo?.username?b.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${b.leadProposalFormData?.jobInfo?.clientInfo?.last_name?b.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n\n  <p>We hope this message finds you well.</p>\n\n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing.\n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n\n  <p>\n    Actions required for all proposals, and uou can review the full proposal(s), including the cost breakdown, by clicking the link below: <br />\n    ${j}\n  </p>\n\n  <p><b>Respectively proposal(s) amount are:</b></p>\n  <ul>\n    ${T}\n  </ul>\n\n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience.\n    We are here to assist you.\n  </p>\n\n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n\n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`,link:j[0],columns:["cost_code","title","description","unit_cost"],showClient:!0,proposal_ids:S}),M=async()=>{try{w.value=!0;let e=O.value;e.proposal_ids=JSON.stringify(O.value.proposal_ids),e.columns=JSON.stringify(O.value.columns);await y.post("/api/lead-proposal/send-proposal-template/",e);g.success("Email sent successfully"),x()}catch(e){console.log(e)}finally{w.value=!1}},A=t((()=>s((()=>import("./ckeditor-4752a33c.js").then((e=>e.c))),["assets/ckeditor-4752a33c.js","assets/index-3945af1d.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-60de206f.js"]).then((e=>e.default.component)))),U={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return n((async()=>{P.value=await s((()=>import("./ckeditor-fae0a979.js").then((e=>e.c))),["assets/ckeditor-fae0a979.js","assets/index-3945af1d.js","assets/index-ce8747cd.css"]).then((e=>e.default))})),(e,l)=>{const a=C,o=F;return r(),_("div",null,[p(D,{name:"fade-slow"},{default:u((()=>[p(o,{is:"form",open:i.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:k(M,["prevent"]),onClose:x},{content:u((()=>[c("div",Le,[c("div",$e,[c("div",He,[Re,c("div",qe,[m(c("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>f(O).email=e)},null,512),[[v,f(O).email]])])])]),c("div",Be,[c("div",Ne,[ze,c("div",We,[m(c("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>f(O).subject=e)},null,512),[[v,f(O).subject]])])])]),c("div",Je,[Ge,f(P)?(r(),d(f(A),{key:0,modelValue:f(O).message,"onUpdate:modelValue":l[2]||(l[2]=e=>f(O).message=e),editor:f(P),config:U},null,8,["modelValue","editor"])):I("",!0)])])])),action:u((()=>[p(a,{type:"submit",color:"primary",loading:f(w),raised:""},{default:u((()=>[Ke,h(" Send Proposal")])),_:1},8,["loading"])])),cancel:u((()=>[p(a,{color:"light",onClick:x,raised:""},{default:u((()=>[h("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),Xe=B();N();const Ye=a(0),Ze=async e=>{try{Ye.value=3;const l=await Xe.get(`/api/lead-proposal/${e.id}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`Proposal-${e.title}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)}catch(l){console.error("Error downloading PDF:",l)}finally{Ye.value=0}},el=async e=>{try{Ye.value=1;const l=await Xe.get(`/api/lead-proposal/${e}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=URL.createObjectURL(a),t=document.createElement("iframe");t.style.display="none",t.src=o,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print(),document.body.removeChild(t)}}catch(l){console.error("Error printing PDF:",l)}finally{Ye.value=0}},ll=e=>(S("data-v-5bf64ae2"),e=e(),T(),e),al={class:"columns is-multiline"},ol=ll((()=>c("div",{class:"column is-9"},[c("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),c("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),tl={class:"column is-12"},sl={class:"invoice-wrapper"},nl={class:"invoice-header"},il={class:"left"},rl={class:"right"},dl={class:"controls"},ul=[ll((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"},null,-1)))],cl=[ll((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"},null,-1)))],pl=[ll((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],ml={class:"invoice-body"},vl={class:"invoice-card"},fl={class:"invoice-section is-flex is-bordered"},_l=ll((()=>c("div",{class:"meta"},null,-1))),bl=ll((()=>c("div",{class:"end is-right"},[c("span",null,"PO Box 242"),c("span",null,"Evergreen, CO 80437-0242"),c("span",null,"Phone: 720 272-9061"),c("span",null,"Premium Trades for Premier Builders")],-1))),yl={class:"invoice-section is-flex is-bordered"},hl={class:"meta"},Il={class:"end is-left"},gl={class:"invoice-section"},wl={class:"responsive-table"},kl=["innerHTML"],Cl={key:1},Pl={key:2},Vl={class:"invoice-section is-flex mt-0 pt-0"},Dl={class:"end is-left"},xl={class:"text-right"},Sl=x('<div class="invoice-section is-flex mt-0 pt-0" data-v-5bf64ae2><div class="footer" data-v-5bf64ae2><div class="footer-meta" data-v-5bf64ae2><p data-v-5bf64ae2>Signature:</p><div data-v-5bf64ae2></div></div><div class="footer-meta" data-v-5bf64ae2><p data-v-5bf64ae2>Date:</p><div data-v-5bf64ae2></div></div><div class="footer-meta" data-v-5bf64ae2><p class="no-wrap" data-v-5bf64ae2>Print Name:</p><div data-v-5bf64ae2></div></div></div></div>',1),Tl=j(e({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const l=e,o=Ee(),t=a(!1),s=a([]),i=a([]),u=a({}),m=()=>{i.value.push(l.proposalData.id),u.value=l.proposalData,s.value=o.leadProposalFormData.columns_to_show,t.value=!t.value};return n((()=>{})),(e,a)=>{const s=G,n=J,u=Qe;return r(),_("div",al,[ol,c("div",tl,[c("div",sl,[c("div",nl,[c("div",il,[c("h3",null," Proposal-ID "+w(f(o).leadProposalFormData?.id.slice(0,8)),1)]),c("div",rl,[c("div",dl,[1==f(Ye)?(r(),d(s,{key:0,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(r(),_("a",{key:1,class:"action",onClick:a[0]||(a[0]=e=>f(el)(f(o).leadProposalFormData?.id))},ul)),3==f(Ye)?(r(),d(s,{key:2,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(r(),_("a",{key:3,class:"action",onClick:a[1]||(a[1]=e=>f(Ze)(f(o).leadProposalFormData))},cl)),c("a",{class:"action",onClick:m},pl)])])]),c("div",ml,[c("div",vl,[c("div",fl,[p(n,{size:"xl",picture:"/logos/IbexFavicon.png"}),_l,bl]),c("div",yl,[c("div",hl,[c("h3",null,w(f(o).leadProposalFormData?.jobInfo?.clientInfo?.username??"N/A")+" "+w(f(o).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1),c("span",null,w(f(o).leadProposalFormData?.jobInfo?.clientInfo?.email?f(o).leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A"),1)]),c("div",Il,[c("h3",null,w(f(o).leadProposalFormData?.title),1),c("p",null," Job Address: "+w(f(o).leadProposalFormData?.jobInfo?.address??"N/A"),1)])]),c("div",gl,[c("table",wl,[c("thead",null,[(r(!0),_(y,null,b(f(o).leadProposalFormData.columns_to_show,((e,l)=>(r(),_("th",{key:l},w(f(K)[e]),1)))),128))]),c("tbody",null,[(r(!0),_(y,null,b(f(o).proposalCostItems,((e,l)=>(r(),_("tr",{key:e.id},[(r(!0),_(y,null,b(f(o).leadProposalFormData.columns_to_show,((l,a)=>(r(),_("td",{key:a},["description"===l?(r(),_("div",{key:0,innerHTML:e[f(Q)[l]]},null,8,kl)):(r(),_("span",Cl,w(e[f(Q)[l]]),1)),"cost_code"===l?(r(),_("span",Pl,w(e?.cost_code_info?.name),1)):I("",!0)])))),128))])))),128))])])]),c("div",Vl,[c("div",Dl,[c("h3",xl," Total Price: $"+w(f(o).leadProposalFormData?.proposalAmount),1)])]),Sl])])])]),f(t)?(r(),d(u,{key:0,proposalSenderModal:f(t),selectedProposalsIds:f(i),proposalData:l.proposalData,columnsToShow:l.columnsToShow,"onUpdate:modalHandler":a[2]||(a[2]=e=>t.value=!1)},null,8,["proposalSenderModal","selectedProposalsIds","proposalData","columnsToShow"])):I("",!0)])}}}),[["__scopeId","data-v-5bf64ae2"]]),jl=e=>(S("data-v-87e119fc"),e=e(),T(),e),Ol={class:"datatable-wrapper mt-0"},Ml={class:"table-container"},Al={class:"table datatable-table is-fullwidth",id:"external-events"},Ul=jl((()=>c("th",null,null,-1))),Fl=jl((()=>c("th",null,"Actions",-1))),El=["data-event","onDragstart","onDrop","onDblclick"],Ll={class:"is-relative"},$l=["onClick"],Hl=["innerHTML"],Rl={key:1},ql={key:2},Bl=["onClick"],Nl=[jl((()=>c("div",{class:"icon"},[c("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),jl((()=>c("div",{class:"meta"},[c("span",null,"Edit"),c("span",null,"Edit Cost Item")],-1)))],zl=jl((()=>c("hr",{class:"dropdown-divider"},null,-1))),Wl=["onClick"],Jl=[jl((()=>c("div",{class:"icon"},[c("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),jl((()=>c("div",{class:"meta"},[c("span",null,"Remove"),c("span",null,"Remove from list")],-1)))],Gl=e({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{}},setup(e){const l=e,o=Ee(),t=N(),s=a({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),i=B(),m=a(""),v=a(!1);a([]);const h=e=>{e.preventDefault()},g=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},C=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},P=a(""),V=a(0),D=a(""),x=a(!1),S=a(!1),T=async()=>{try{S.value=!0;await i.delete(`/api/cost/${D.value}/`);O(),s.value.isSweetAlertOpen=!1,t.success("Cost item deleted")}catch(e){console.log(e)}finally{S.value=!1}},j=(e,l=!1)=>{D.value=e.id,x.value=l,P.value=e.proposal,v.value=!v.value},O=()=>{o.getProposalCostItems(P.value)};return n((()=>{})),(e,a)=>{const t=ee,n=Z,S=Fe;return r(),_("div",Ol,[c("div",Ml,[c("table",Al,[c("thead",null,[Ul,(r(!0),_(y,null,b(l.columnsToShow,((e,l)=>(r(),_("th",{key:l},w(f(K)[e]),1)))),128)),Fl]),c("tbody",null,[f(o).proposalCostItems.length>0?(r(!0),_(y,{key:0},b(f(o).proposalCostItems,((e,a)=>(r(),_("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,m.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=o.proposalCostItems.find((e=>e.id===m.value)),a=o.proposalCostItems.find((l=>l.id===e));if(l&&a){i.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=o.proposalCostItems.indexOf(l),t=o.proposalCostItems.indexOf(a);e>=0&&t>=0&&(o.proposalCostItems.splice(e,1),o.proposalCostItems.splice(t,0,l))}else console.error("Dragged or Dropped Item not found");m.value=null})(e.id),onDragover:h,onDragenter:g,onDragleave:C,onDblclick:l=>j(e,!1),class:"draggable-item events"},[c("td",Ll,[c("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","font-weight":"600"},onClick:l=>(e=>{P.value=e.proposal,V.value=e.index,v.value=!v.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,$l)]),(r(!0),_(y,null,b(l.columnsToShow,((l,a)=>(r(),_("td",{key:a},["description"===l?(r(),_("div",{key:0,innerHTML:e[f(Q)[l]]},null,8,Hl)):(r(),_("span",Rl,w(e[f(Q)[l]]),1)),"cost_code"===l?(r(),_("span",ql,w(e?.cost_code_info?.name),1)):I("",!0)])))),128)),c("td",null,[p(t,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:"",up:""},{content:u((({close:l})=>[c("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:k((()=>{j(e,!1),l()}),["prevent"])},Nl,8,Bl),zl,c("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:k((()=>{(e=>{D.value=e.id,P.value=e.proposal,s.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},Jl,8,Wl)])),_:2},1024)])],40,El)))),128)):I("",!0)])])]),f(s).isSweetAlertOpen?(r(),d(n,{key:0,isSweetAlertOpen:f(s).isSweetAlertOpen,title:f(s).title,subtitle:f(s).subtitle,btntext:f(s).btntext,onConfirm:T,onCancel:()=>f(s).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):I("",!0),f(v)?(r(),d(S,{key:1,costItemModal:f(v),proposalId:f(P),costItemId:f(D),previousItemIndex:f(V),previewCostItems:f(x),"onUpdate:modalHandler":a[0]||(a[0]=e=>{v.value=!1,D.value=""}),"onUpdate:OnSuccess":O},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):I("",!0)])}}}),Kl=j(Gl,[["__scopeId","data-v-87e119fc"]]),Ql={class:"columns is-multiline"},Xl={class:"column is-12 is-flex space-between"},Yl=c("div",null,[c("h1",{class:"title is-4"},"Proposal Worksheet")],-1),Zl={key:0,class:"column is-12"},ea={class:"tabs-wrapper column is-12 m-0"},la={class:"tabs-inner mt-4"},aa={class:"tabs is-boxed"},oa=[c("span",null,"Worksheet",-1)],ta=[c("span",null,"Format",-1)],sa=[c("span",null,"Preview",-1)],na={key:0,class:"column is-12"},ia={key:0,class:"column is-12"},ra={class:"columns is-multiline"},da=c("div",{class:"column is-12",style:{"text-align":"center"}},[c("h1",{class:"title is-4"},"Connect your clients to their projects"),c("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),ua={class:"column is-12"},ca={key:0,class:"column is-12"},pa=e({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:o}){const m=e,v=l(),b=Ee(),y=a(!1),w=a(!1),V=a("worksheet");t((()=>s((()=>import("./ckeditor-4752a33c.js").then((e=>e.c))),["assets/ckeditor-4752a33c.js","assets/index-3945af1d.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-60de206f.js"]).then((e=>e.default.component))));const D=async()=>{try{b.getProposalCostItems(m.proposalId)}catch(e){console.log(e)}};return n((async()=>{v.value=await s((()=>import("./ckeditor-fae0a979.js").then((e=>e.c))),["assets/ckeditor-fae0a979.js","assets/index-3945af1d.js","assets/index-ce8747cd.css"]).then((e=>e.default)),m.proposalId&&(D(),b.getProposalDetail(m.proposalId))})),O((()=>{b.clearProposalId()})),(e,l)=>{const a=C,o=i("Multiselect"),t=H,s=$,n=Kl,v=P,b=Tl,x=Fe;return r(),_("div",null,[c("div",Ql,[c("div",Xl,[Yl,c("div",null,[p(a,{size:"small",light:"",outlined:"",icon:"fas fa-cog",class:"mr-2",color:f(w)?"danger":"success",onClick:l[0]||(l[0]=e=>w.value=!f(w))},{default:u((()=>[h("Table")])),_:1},8,["color"]),p(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"info",onClick:l[1]||(l[1]=e=>y.value=!f(y))},{default:u((()=>[h("Import")])),_:1}),p(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"primary",onClick:l[2]||(l[2]=e=>y.value=!f(y))},{default:u((()=>[h("Add From")])),_:1}),p(a,{size:"small",light:"",outlined:"",color:"warning",onClick:l[3]||(l[3]=e=>y.value=!f(y))},{default:u((()=>[h("Add Item")])),_:1})])]),p(M,{class:"fade-slow",name:"fade-slow"},{default:u((()=>[f(w)?(r(),_("div",Zl,[p(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[p(t,null,{default:u((()=>[p(o,{modelValue:f(X),"onUpdate:modelValue":l[4]||(l[4]=e=>g(X)?X.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:f(Y),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):I("",!0)])),_:1}),c("div",ea,[c("div",la,[c("div",aa,[c("ul",null,[c("li",{class:A(["worksheet"===f(V)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[5]||(l[5]=U(k((e=>V.value="worksheet"),["prevent"]),["space"])),onClick:l[6]||(l[6]=e=>V.value="worksheet")},oa,32)],2),c("li",{class:A(["format"===f(V)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[7]||(l[7]=U(k((e=>V.value="format"),["prevent"]),["space"])),onClick:l[8]||(l[8]=e=>V.value="format")},ta,32)],2),c("li",{class:A(["preview"===f(V)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[9]||(l[9]=U(k((e=>V.value="preview"),["prevent"]),["space"])),onClick:l[10]||(l[10]=e=>V.value="preview")},sa,32)],2)])])])]),p(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["worksheet"===f(V)?(r(),_("div",na,[p(n,{columnsToShow:f(X),proposalId:m.proposalId},null,8,["columnsToShow","proposalId"])])):I("",!0)])),_:1}),p(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["format"===f(V)?(r(),_("div",ia,[c("div",ra,[p(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[p(t,null,{default:u((()=>[p(o,{modelValue:f(X),"onUpdate:modelValue":l[11]||(l[11]=e=>g(X)?X.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:f(Y),placeholder:"Add tags"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),p(v,{class:"columns is-multiline m-0"},{default:u((()=>[da,c("div",ua,[p(n,{columnsToShow:f(X)},null,8,["columnsToShow"])])])),_:1})])):I("",!0)])),_:1}),p(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["preview"===f(V)?(r(),_("div",ca,[p(b,{proposalData:m.proposalData,columnsToShow:f(X)},null,8,["proposalData","columnsToShow"])])):I("",!0)])),_:1})]),f(y)?(r(),d(x,{key:0,costItemModal:f(y),proposalId:m.proposalId,"onUpdate:modalHandler":l[12]||(l[12]=e=>y.value=!1),"onUpdate:OnSuccess":D},null,8,["costItemModal","proposalId"])):I("",!0)])}}}),ma=e=>(S("data-v-0317543a"),e=e(),T(),e),va={class:"columns is-multiline"},fa=ma((()=>c("div",{class:"column is-2"},null,-1))),_a={class:"column is-8"},ba=ma((()=>c("div",{class:"column is-2"},null,-1))),ya=ma((()=>c("div",{class:"column is-2"},null,-1))),ha=ma((()=>c("div",{class:"column is-8"},[c("p",null," All the tasks will be generated and will start from the date you will put. ")],-1))),Ia=ma((()=>c("div",{class:"column is-2"},null,-1))),ga=e({__name:"CreateProposalTasksModal",props:{createProposalTasksModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(e,{emit:l}){const o=e,t=N(),s=B(),i=a(""),m=a(!1),v=()=>{l("update:OnSuccess",null),l("closeModalHandler",!1)},_=async()=>{try{await s.post("/api/lead-proposal/create-tasks/",{start:i.value,proposal:o.proposalId});t.success("Tasks of this proposal are created in calendar successfully."),v()}catch(e){console.log(e),t.error("Something went wrong, please review the cost codes")}};return n((()=>{})),(e,l)=>{const a=L,t=H,s=$,n=C,b=F;return r(),d(b,{is:"form",open:o.createProposalTasksModal,title:"Generate Tasks",size:"small",actions:"center",onSubmit:k(_,["prevent"]),onClose:v},{content:u((()=>[c("div",va,[fa,c("div",_a,[p(s,{label:"Enter Tasks Starting Date"},{default:u((()=>[p(t,null,{default:u((()=>[p(a,{modelValue:f(i),"onUpdate:modelValue":l[0]||(l[0]=e=>g(i)?i.value=e:null),required:"",name:"startDate",type:"date"},null,8,["modelValue"])])),_:1})])),_:1})]),ba,ya,ha,Ia])])),cancel:u((()=>[p(n,{light:"",onClick:l[1]||(l[1]=e=>v())},{default:u((()=>[h("Cancel")])),_:1})])),action:u((()=>[p(n,{loading:f(m),type:"submit",color:"info",light:"",raised:""},{default:u((()=>[h("Generate")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),wa=j(ga,[["__scopeId","data-v-0317543a"]]);export{pa as _,Qe as a,wa as b,Fe as c,Ee as u};
