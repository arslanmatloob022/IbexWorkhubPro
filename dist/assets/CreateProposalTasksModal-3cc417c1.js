import{e,s as l,r as a,o,A as t,B as s,N as n,F as i,E as r,l as d,j as c,D as u,T as p,J as m,I as v,O as f,Z as _,b,_ as y,w as h,K as g,W as I,M as w,C as k,U as C,V,a4 as P,a6 as S,a0 as D,X as x,P as j,Q as T,R as O,i as M,aR as U,H as A,G as F}from"./index-33506c71.js";import{_ as $}from"./VModal.vue_vue_type_style_index_0_lang-5b7095c2.js";import{_ as E}from"./VField.vue_vue_type_script_setup_true_lang-f02b3a09.js";import{_ as L}from"./VControl-07dce6f5.js";import{u as H}from"./useAPI-fb206f43.js";import{u as N}from"./useNotyf-63ef8eb2.js";import{a as R}from"./useSupportElement-cb28081e.js";import{u as q}from"./userSession-fcc71f60.js";import{_ as B}from"./VTextarea.vue_vue_type_script_setup_true_lang-e8f91d30.js";import{_ as z}from"./VInput.vue_vue_type_script_setup_true_lang-48c4ae15.js";import{_ as J}from"./VCheckbox.vue_vue_type_style_index_0_lang-ad5867cc.js";import{_ as W,a as G}from"./VOption.vue_vue_type_style_index_0_lang-787e6f3f.js";import{g as K}from"./estimatesScripts-cd987e22.js";import{s as Q,g as X,a as Y,c as Z}from"./costItems-239699c4.js";import{_ as ee}from"./VAvatar.vue_vue_type_style_index_0_lang-e0d0ef81.js";import{_ as le}from"./VIconButton-455ca0c4.js";import{u as ae}from"./company-f17eeb55.js";import{_ as oe}from"./SweetAlert.vue_vue_type_style_index_0_lang-e64078f6.js";import{_ as te}from"./VDropdown.vue_vue_type_style_index_0_lang-d0dd0ddd.js";const se={class:"multiselect-single-label"},ne={class:"select-label-text"},ie={class:"select-label-text"},re=e({__name:"CostByCatalog",props:{centeredActionsOpen:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:_}){const b=e;l(),q();const y=N(),h=H(),g=a(!1),I=a(!1),w=a([]),k=a(""),C=a([]),V=()=>{_("update:modalHandler",!1)},P=()=>{_("update:OnSuccess",null)};return o((async()=>{(async()=>{try{I.value=!0;const e=await h.get("/api/cost/catalogs/");C.value=e.data,w.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{I.value=!1}})()})),(e,l)=>{const a=t("Multiselect"),o=L,_=E,I=f,S=$;return s(),n(S,{open:b.centeredActionsOpen,actions:"right",is:"form",title:"Create Cost item",onSubmit:l[1]||(l[1]=v((e=>(async()=>{const e=C.value.find((e=>e.id==k.value));e?console.log("Matched Item:",e):console.log("No item found with the given ID.");const l=R(e,[]);try{await h.post("/api/cost/",l),V(),P(),y.success("Item added successfully.")}catch(a){y.error("Failed try again")}})()),["prevent"])),onClose:l[2]||(l[2]=e=>g.value=!1)},{content:i((()=>[r(_,{class:"is-image-select m-b-80",label:"Selecte Catalog"},{default:i((({id:e})=>[r(o,null,{default:i((()=>[r(a,{modelValue:d(k),"onUpdate:modelValue":l[0]||(l[0]=e=>c(k)?k.value=e:null),attrs:{id:e},placeholder:"Select a catalog",label:"name",options:d(w)},{singlelabel:i((({value:e})=>[u("div",se,[u("span",ne,p(e.name),1)])])),option:i((({option:e})=>[u("span",ie,p(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])),action:i((()=>[r(I,{color:"primary",raised:"",type:"submit"},{default:i((()=>[m(" Confirm ")])),_:1})])),cancel:i((()=>[r(I,{color:"primary",raised:"",style:{display:"none"}},{default:i((()=>[m(" Confirm ")])),_:1})])),_:1},8,["open"])}}}),de={class:"modal-form columns is-multiline"},ce={class:"columns is-multiline"},ue={class:"field column is-6 mb-0"},pe=u("label",null,"Title: ",-1),me={class:"control"},ve=["disabled"],fe={class:"multiselect-single-label"},_e={class:"select-label-text"},be={class:"select-label-text"},ye={key:1,class:"field column is-6"},he=u("label",{for:""},"Cost Type",-1),ge={key:2,class:"field column is-3"},Ie=u("label",{for:""},"Catalog",-1),we={class:"field column is-3"},ke=u("label",{for:""},"Mark As",-1),Ce={class:"field column is-6"},Ve=u("label",null,"Cost Code *",-1),Pe={class:"field column is-6"},Se=u("label",{for:""},"Group Cost",-1),De={class:"field column is-12 mb-0"},xe=u("label",{for:"",class:"label"},"Description",-1),je={class:"field column is-12 mb-0"},Te=u("label",{for:"",class:"label"},"Internal Notes",-1),Oe={class:"columns is-multiline"},Me={class:"field column is-6"},Ue=u("label",null,"Unit Cost",-1),Ae={class:"field column is-6"},Fe=u("label",null,"Quantity",-1),$e={class:"field column is-6"},Ee=u("label",null,"Unit",-1),Le={class:"field column is-6"},He=u("label",null,"Builder Cost",-1),Ne={class:"field column is-6"},Re=u("label",null,"Markup (%)",-1),qe={class:"field column is-6"},Be=u("label",null,"Total Price",-1),ze={class:"field column is-6"},Je=u("label",null,"Margin (%)",-1),We={class:"field column is-6"},Ge=u("label",null,"Worker Cost",-1),Ke=e({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean},costMode:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:S}){const D=e,x=l();q();const j=N(),T=H(),O=a(!1),M=a(""),U=a([]),A=a([]),F=a({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"--",unit_cost:0,markup:0,margin:0,profit:0,worker_cost:0,group:"",catalog:!1,proposal:D.proposalId}),Q=a([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]),X=a([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]),Y=a([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]),Z=async()=>{try{O.value=!0;const e=R(F.value,[]);if(D.costItemId){await T.patch(`/api/cost/${D.costItemId}/`,e)}else{const l=await T.post("/api/cost/",e);if(F.value.catalog){await T.post(`/api/cost/${l.data.id}/create-catalog/`)}}ee(),le(),j.success("Item added successfully.")}catch(e){j.error(` ${e}, New Worker`)}finally{O.value=!1}},ee=()=>{S("update:modalHandler",!1)},le=()=>{S("update:OnSuccess",null)};a(0),a(0);const ae=_((()=>F.value.unit_cost*F.value.quantity));a(0),a(0);const oe=_((()=>F.value.markup>0?ae.value+ae.value*F.value.markup/100:F.value.margin>0?ae.value/(1-F.value.margin/100):ae.value));_((()=>(oe.value-ae.value)/ae.value*100)),_((()=>(oe.value-ae.value)/oe.value*100));const te=b((()=>y((()=>import("./ckeditor-6a467254.js").then((e=>e.c))),["assets/ckeditor-6a467254.js","assets/index-33506c71.js","assets/index-a879fc9d.css","assets/vue.runtime.esm-bundler-1c1e0ab2.js"]).then((e=>e.default.component)))),se={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},ne=a(!1),ie=a([]),re=a(!1);h((()=>F.value.cost_code),((e,l)=>{if(e){const l=ie.value.find((l=>l.id===e));l?(F.value.unit_cost=l.unit_cost,F.value.worker_cost=l.worker_cost,F.value.unit=l.unit):console.warn("No matching item found for cost_code:",e)}})),o((async()=>{x.value=await y((()=>import("./ckeditor-4fe1d993.js").then((e=>e.c))),["assets/ckeditor-4fe1d993.js","assets/index-33506c71.js","assets/index-a879fc9d.css"]).then((e=>e.default)),D.previousItemIndex&&(F.value.previousItemIndex=D.previousItemIndex),D.costItemId&&(async()=>{try{ne.value=!0;const e=await T.get(`/api/cost/${D.costItemId}/`);F.value=e.data}catch(e){console.log(e)}finally{ne.value=!1}})(),(async()=>{try{re.value=!0;const e=await T.get("/api/cost-code/");ie.value=e.data,X.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{re.value=!1}})(),Ke()}));const Ke=async()=>{try{ne.value=!0;const e=await T.get("/api/cost/catalogs/");U.value=e.data,A.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{ne.value=!1}};return h(M,((e,l)=>{const a=U.value.find((e=>e.id==M.value)),{id:o,...t}=a;F.value=t})),(e,l)=>{const a=t("Multiselect"),o=L,_=E,b=W,y=G,h=J,S=z,j=B,T=P,U=f,H=$;return s(),n(H,{is:"form",open:D.costItemModal,title:"catalog"==D.costMode?"Update Catalog":"Cost Item ",size:"xl",actions:"right",onSubmit:v(Z,["prevent"]),onClose:ee},{content:i((()=>[u("div",de,[r(T,{class:"column is-12"},{default:i((()=>[u("div",ce,[u("div",ue,[pe,u("div",me,[g(u("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>d(F).title=e),required:"",disabled:D.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,ve),[[I,d(F).title]])])]),"catalog"!==D.costMode?(s(),n(_,{key:0,class:"is-image-select column is-6",label:"Select Catalog"},{default:i((({id:e})=>[r(o,null,{default:i((()=>[r(a,{modelValue:d(M),"onUpdate:modelValue":l[1]||(l[1]=e=>c(M)?M.value=e:null),attrs:{id:e},placeholder:"Select a catalog",label:"name",options:d(A)},{singlelabel:i((({value:e})=>[u("div",fe,[u("span",_e,p(e.name),1)])])),option:i((({option:e})=>[u("span",be,p(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):w("",!0),"catalog"!==D.costMode?(s(),k("div",ye,[he,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(y,{modelValue:d(F).cost_type,"onUpdate:modelValue":l[2]||(l[2]=e=>d(F).cost_type=e),disabled:D.previewCostItems},{default:i((()=>[(s(!0),k(C,null,V(d(Q),((e,l)=>(s(),n(b,{value:e.value},{default:i((()=>[m(p(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})])):w("",!0),D.costItemId?w("",!0):(s(),k("div",ge,[Ie,u("div",null,[r(o,{raw:"",subcontrol:""},{default:i((()=>[r(h,{modelValue:d(F).catalog,"onUpdate:modelValue":l[3]||(l[3]=e=>d(F).catalog=e),label:"Create Template",color:"info"},null,8,["modelValue"])])),_:1})])])),u("div",we,[ke,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(y,{modelValue:d(F).mark_as,"onUpdate:modelValue":l[4]||(l[4]=e=>d(F).mark_as=e),disabled:D.previewCostItems},{default:i((()=>[(s(!0),k(C,null,V(d(Y),((e,l)=>(s(),n(b,{value:e.value},{default:i((()=>[m(p(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),u("div",Ce,[Ve,r(_,null,{default:i((({id:e})=>[r(o,null,{default:i((()=>[r(a,{required:"",modelValue:d(F).cost_code,"onUpdate:modelValue":l[5]||(l[5]=e=>d(F).cost_code=e),disabled:D.previewCostItems,attrs:{id:e},searchable:!0,options:d(X),placeholder:"Select a cost code"},null,8,["modelValue","disabled","attrs","options"])])),_:2},1024)])),_:1})]),u("div",Pe,[Se,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(F).group,"onUpdate:modelValue":l[6]||(l[6]=e=>d(F).group=e),name:"gcost",placeholder:"Group Cost"},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",De,[xe,d(x)?(s(),n(d(te),{key:0,disabled:D.previewCostItems,modelValue:d(F).description,"onUpdate:modelValue":l[7]||(l[7]=e=>d(F).description=e),editor:d(x),config:se},null,8,["disabled","modelValue","editor"])):w("",!0)]),u("div",je,[Te,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(j,{modelValue:d(F).internal_notes,"onUpdate:modelValue":l[8]||(l[8]=e=>d(F).internal_notes=e),disabled:D.previewCostItems,rows:"4",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),r(T,{class:"column is-12 mt-3"},{default:i((()=>[u("div",Oe,[u("div",Me,[Ue,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(F).unit_cost,"onUpdate:modelValue":l[9]||(l[9]=e=>d(F).unit_cost=e),disabled:D.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),u("div",Ae,[Fe,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(F).quantity,"onUpdate:modelValue":l[10]||(l[10]=e=>d(F).quantity=e),disabled:D.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),u("div",$e,[Ee,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(y,{disabled:D.previewCostItems,modelValue:d(F).unit,"onUpdate:modelValue":l[11]||(l[11]=e=>d(F).unit=e)},{default:i((()=>[r(b,{value:""},{default:i((()=>[m(" Select Unit ")])),_:1}),(s(!0),k(C,null,V(d(K),(e=>(s(),n(b,{value:e.value},{default:i((()=>[m(p(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1})]),u("div",Le,[He,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(ae),"onUpdate:modelValue":l[12]||(l[12]=e=>c(ae)?ae.value=e:null),disabled:D.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),u("div",Ne,[Re,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(F).markup,"onUpdate:modelValue":l[13]||(l[13]=e=>d(F).markup=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),u("div",qe,[Be,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(oe),"onUpdate:modelValue":l[14]||(l[14]=e=>c(oe)?oe.value=e:null),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),u("div",ze,[Je,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(F).margin,"onUpdate:modelValue":l[15]||(l[15]=e=>d(F).margin=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),u("div",We,[Ge,r(_,null,{default:i((()=>[r(o,null,{default:i((()=>[r(S,{modelValue:d(F).worker_cost,"onUpdate:modelValue":l[16]||(l[16]=e=>d(F).worker_cost=e),type:"number",name:"workerCost",step:"any",placeholder:"Worker Cost"},null,8,["modelValue"])])),_:1})])),_:1})])])])),_:1})])])),action:i((()=>[r(U,{loading:d(O),type:"submit",color:"primary",icon:D.costItemId?"":"fas fa-plus",raised:""},{default:i((()=>[m(p(D.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","title","onSubmit"])}}}),Qe=S("useProposal",(()=>{const e=a(!0),l=N(),o=H(),t=a("");a("");const s=a([]),n=a([]),i=a({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),r=a([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:r,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await o.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(t){l.error(` ${t}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const l=await o.get(`/api/lead-proposal/${e}/detail/`);i.value=l.data,Q.value=l.data.columns_to_show}catch(l){console.log(l)}},getCompanyProposals:async()=>{try{e.value=!0;const l=await o.get("/api/lead-proposal/");s.value=l.data}catch(a){l.error(` ${a}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{t.value=e;const l=await o.get(`/api/cost/by-proposal/${e}/`);r.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){t.value="",r.value=[]}}})),Xe={class:"modal-form columns is-multiline"},Ye={class:"column is-full"},Ze={class:"field"},el=u("label",{class:"label"},"Send To ",-1),ll={class:"control"},al={class:"column is-full"},ol={class:"field"},tl=u("label",{class:"label"},"Subject ",-1),sl={class:"control"},nl={class:"field column is-full mt-5"},il=u("label",{class:"label"},"Message",-1),rl=u("i",{class:"feather:mail"},null,-1),dl=e({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{},selectedProposalsIds:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const c=e,p=Qe(),_=H(),h=N(),C=a(!1),V=l(),P=window.origin;a(`${P}/proposal-view/?proposal=${c.proposalData?.id}`);const S=()=>{t("update:modalHandler",!1)},x=c.selectedProposalsIds.map((e=>e.id)),j=c.selectedProposalsIds.map((e=>e.proposalAmount)).map(((e,l)=>`<li>Total of proposal ${l+1}:<b> $${e} </b></li>`)).join("<br>"),T=x.map(((e,l)=>`<a href="${P}/proposal-view/?proposal=${e}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal ${l+1}, </a>`)).join("<br>"),O=a({email:p.leadProposalFormData?.jobInfo?.clientInfo?.email?p.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:`Proposal ${p.leadProposalFormData?.jobInfo?.title} `,message:`<p><b>Hi ${p.leadProposalFormData?.jobInfo?.clientInfo?.username?p.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${p.leadProposalFormData?.jobInfo?.clientInfo?.last_name?p.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n\n  <p>We hope this message finds you well.</p>\n\n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing.\n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n\n  <p>\n    Actions required for all proposals, and uou can review the full proposal(s), including the cost breakdown, by clicking the link below: <br />\n    ${T}\n  </p>\n\n  <p><b>Respectively proposal(s) amount are:</b></p>\n  <ul>\n    ${j}\n  </ul>\n\n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience.\n    We are here to assist you.\n  </p>\n\n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n\n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`,link:T[0],columns:["cost_code","title","description","unit_cost"],showClient:!0,proposal_ids:x}),M=async()=>{try{C.value=!0;let e=O.value;e.proposal_ids=JSON.stringify(O.value.proposal_ids),e.columns=JSON.stringify(O.value.columns);await _.post("/api/lead-proposal/send-proposal-template/",e);h.success("Email sent successfully"),S()}catch(e){console.log(e)}finally{C.value=!1}},U=b((()=>y((()=>import("./ckeditor-6a467254.js").then((e=>e.c))),["assets/ckeditor-6a467254.js","assets/index-33506c71.js","assets/index-a879fc9d.css","assets/vue.runtime.esm-bundler-1c1e0ab2.js"]).then((e=>e.default.component)))),A={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return o((async()=>{V.value=await y((()=>import("./ckeditor-4fe1d993.js").then((e=>e.c))),["assets/ckeditor-4fe1d993.js","assets/index-33506c71.js","assets/index-a879fc9d.css"]).then((e=>e.default))})),(e,l)=>{const a=f,o=$;return s(),k("div",null,[r(D,{name:"fade-slow"},{default:i((()=>[r(o,{is:"form",open:c.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:v(M,["prevent"]),onClose:S},{content:i((()=>[u("div",Xe,[u("div",Ye,[u("div",Ze,[el,u("div",ll,[g(u("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>d(O).email=e)},null,512),[[I,d(O).email]])])])]),u("div",al,[u("div",ol,[tl,u("div",sl,[g(u("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>d(O).subject=e)},null,512),[[I,d(O).subject]])])])]),u("div",nl,[il,d(V)?(s(),n(d(U),{key:0,modelValue:d(O).message,"onUpdate:modelValue":l[2]||(l[2]=e=>d(O).message=e),editor:d(V),config:A},null,8,["modelValue","editor"])):w("",!0)])])])),action:i((()=>[r(a,{type:"submit",color:"primary",loading:d(C),raised:""},{default:i((()=>[rl,m(" Send Proposal")])),_:1},8,["loading"])])),cancel:i((()=>[r(a,{color:"light",onClick:S,raised:""},{default:i((()=>[m("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),cl=H();N();const ul=a(0),pl=async e=>{try{ul.value=3;const l=await cl.get(`/api/lead-proposal/${e.id}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`Proposal-${e.title}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)}catch(l){console.error("Error downloading PDF:",l)}finally{ul.value=0}},ml=async e=>{try{ul.value=1;const l=await cl.get(`/api/lead-proposal/${e}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=URL.createObjectURL(a),t=document.createElement("iframe");t.style.display="none",t.src=o,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print(),document.body.removeChild(t)}}catch(l){console.error("Error printing PDF:",l)}finally{ul.value=0}},vl=e=>(j("data-v-a94ebc1f"),e=e(),T(),e),fl={class:"columns is-multiline"},_l=vl((()=>u("div",{class:"column is-9"},[u("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),u("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),bl={class:"column is-12"},yl={class:"invoice-wrapper"},hl={class:"invoice-header"},gl={class:"left"},Il={class:"right"},wl={class:"controls"},kl=[vl((()=>u("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"},null,-1)))],Cl=[vl((()=>u("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"},null,-1)))],Vl=[vl((()=>u("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],Pl={class:"invoice-body"},Sl={class:"invoice-card"},Dl={class:"invoice-section is-flex"},xl=vl((()=>u("div",{class:"meta"},null,-1))),jl={class:"end is-right"},Tl=vl((()=>u("span",null,"PO Box 242",-1))),Ol=vl((()=>u("span",null,"Evergreen, CO 80437-0242",-1))),Ml=vl((()=>u("span",null,"Phone: 720 272-9061",-1))),Ul={class:"invoice-section is-flex"},Al={class:"meta"},Fl={key:0},$l={key:1},El={key:2},Ll={key:3},Hl={class:"end is-left"},Nl={class:"invoice-section"},Rl={class:"responsive-table"},ql=["innerHTML"],Bl={key:1},zl={key:2},Jl={class:"invoice-section is-flex mt-0 pt-0"},Wl={class:"end is-left"},Gl={class:"text-right"},Kl=x('<div class="invoice-section is-flex mt-0 pt-0" data-v-a94ebc1f><div class="footer" data-v-a94ebc1f><div class="footer-meta" data-v-a94ebc1f><p data-v-a94ebc1f>Signature:</p><div data-v-a94ebc1f></div></div><div class="footer-meta" data-v-a94ebc1f><p data-v-a94ebc1f>Date:</p><div data-v-a94ebc1f></div></div><div class="footer-meta" data-v-a94ebc1f><p class="no-wrap" data-v-a94ebc1f>Print Name:</p><div data-v-a94ebc1f></div></div></div></div>',1),Ql=O(e({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const l=e,t=ae(),i=Qe(),c=a(!1),m=a([]),v=a([]),f=a({}),_=()=>{v.value.push(l.proposalData),f.value=l.proposalData,m.value=i.leadProposalFormData.columns_to_show,c.value=!c.value};return o((()=>{})),(e,a)=>{const o=le,m=ee,f=dl;return s(),k("div",fl,[_l,u("div",bl,[u("div",yl,[u("div",hl,[u("div",gl,[u("h3",null," Proposal-ID "+p(d(i).leadProposalFormData?.id.slice(0,8)),1)]),u("div",Il,[u("div",wl,[1==d(ul)?(s(),n(o,{key:0,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(s(),k("a",{key:1,class:"action",onClick:a[0]||(a[0]=e=>d(ml)(d(i).leadProposalFormData?.id))},kl)),3==d(ul)?(s(),n(o,{key:2,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(s(),k("a",{key:3,class:"action",onClick:a[1]||(a[1]=e=>d(pl)(d(i).leadProposalFormData))},Cl)),u("a",{class:"action",onClick:_},Vl)])])]),u("div",Pl,[u("div",Sl,[u("div",Dl,[r(m,{size:"xl",picture:d(t).currentCompany.invoice_header_logo},null,8,["picture"]),xl,u("div",jl,[Tl,Ol,Ml,u("span",null,p(d(t).currentCompany.branding_line),1)])]),u("div",Ul,[u("div",Al,[d(i).leadProposalFormData?.jobInfo?.clientInfo?(s(),k("h3",Fl,p(d(i).leadProposalFormData?.jobInfo?.clientInfo?.username??"N/A")+" "+p(d(i).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1)):(s(),k("h3",$l,p(d(i).leadProposalFormData?.jobInfo?.contractor_info?.username??"N/A")+" "+p(d(i).leadProposalFormData?.jobInfo?.contractor_info?.last_name??""),1)),d(i).leadProposalFormData?.jobInfo?.clientInfo?(s(),k("span",El,p(d(i).leadProposalFormData?.jobInfo?.clientInfo?.email?d(i).leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A"),1)):(s(),k("span",Ll,p(d(i).leadProposalFormData?.jobInfo?.contractor_info?.email?d(i).leadProposalFormData?.jobInfo?.contractor_info?.email:"N/A"),1))]),u("div",Hl,[u("h3",null,p(d(i).leadProposalFormData?.title),1),u("p",null," Job Address: "+p(d(i).leadProposalFormData?.jobInfo?.address??"N/A"),1)])]),u("div",Nl,[u("table",Rl,[u("thead",null,[(s(!0),k(C,null,V(l.columnsToShow,((e,l)=>(s(),k("th",{key:l},p(d(X)[e]),1)))),128))]),u("tbody",null,[(s(!0),k(C,null,V(d(i).proposalCostItems,((e,a)=>(s(),k("tr",{key:e.id},[(s(!0),k(C,null,V(l.columnsToShow,((l,a)=>(s(),k("td",{key:a},["description"===l?(s(),k("div",{key:0,innerHTML:e[d(Y)[l]]},null,8,ql)):(s(),k("span",Bl,p(e[d(Y)[l]]),1)),"cost_code"===l?(s(),k("span",zl,p(e?.cost_code_info?.name),1)):w("",!0)])))),128))])))),128))])])]),u("div",Jl,[u("div",Wl,[u("h3",Gl," Total Price: $"+p(d(i).leadProposalFormData?.proposalAmount),1)])]),Kl])])])]),d(c)?(s(),n(f,{key:0,proposalSenderModal:d(c),selectedProposalsIds:d(v),proposalData:l.proposalData,columnsToShow:l.columnsToShow,"onUpdate:modalHandler":a[2]||(a[2]=e=>{c.value=!1,v.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData","columnsToShow"])):w("",!0)])}}}),[["__scopeId","data-v-a94ebc1f"]]),Xl=e=>(j("data-v-48fb440f"),e=e(),T(),e),Yl={class:"datatable-wrapper mt-0"},Zl={class:"table-container"},ea={class:"table datatable-table is-fullwidth",id:"external-events"},la=Xl((()=>u("th",null,null,-1))),aa=Xl((()=>u("th",null,"Actions",-1))),oa=["data-event","onDragstart","onDrop","onDblclick"],ta={class:"is-relative"},sa=["onClick"],na=["innerHTML"],ia={key:1},ra={key:2},da=["onClick"],ca=[Xl((()=>u("div",{class:"icon"},[u("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),Xl((()=>u("div",{class:"meta"},[u("span",null,"Edit"),u("span",null,"Edit Cost Item")],-1)))],ua=Xl((()=>u("hr",{class:"dropdown-divider"},null,-1))),pa=["onClick"],ma=[Xl((()=>u("div",{class:"icon"},[u("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),Xl((()=>u("div",{class:"meta"},[u("span",null,"Remove"),u("span",null,"Remove from list")],-1)))],va=e({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{},proposalId:{}},setup(e){const l=e,t=H(),c=a(""),m=a(!1),f=Qe(),_=N(),b=a(""),y=a(0),g=a(""),I=a(!1),P=a(!1),S=a({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),D=e=>{e.preventDefault()},x=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},j=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},T=async()=>{try{P.value=!0;await t.delete(`/api/cost/${g.value}/`);M(),S.value.isSweetAlertOpen=!1,_.success("Cost item deleted")}catch(e){console.log(e)}finally{P.value=!1}},O=(e,l=!1)=>{g.value=e.id,I.value=l,b.value=e.proposal,m.value=!m.value},M=()=>{f.getProposalCostItems(b.value)};return h((()=>l.columnsToShow),((e,a)=>{e&&JSON.stringify(e)!==JSON.stringify(a)&&(async()=>{try{l.proposalId&&await t.patch(`/api/lead-proposal/${l.proposalId}/`,{columns_to_show:JSON.stringify(l.columnsToShow)}),f.getProposalDetail(l.proposalId)}catch(e){_.error("Something went wrong, try again")}})()}),{deep:!0}),o((()=>{})),(e,a)=>{const o=te,_=oe,h=Ke;return s(),k("div",Yl,[u("div",Zl,[u("table",ea,[u("thead",null,[la,(s(!0),k(C,null,V(l.columnsToShow,((e,l)=>(s(),k("th",{key:l},p(d(X)[e]),1)))),128)),aa]),u("tbody",null,[d(f).proposalCostItems.length>0?(s(!0),k(C,{key:0},V(d(f).proposalCostItems,((e,a)=>(s(),k("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,c.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=f.proposalCostItems.find((e=>e.id===c.value)),a=f.proposalCostItems.find((l=>l.id===e));if(l&&a){t.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=f.proposalCostItems.indexOf(l),o=f.proposalCostItems.indexOf(a);e>=0&&o>=0&&(f.proposalCostItems.splice(e,1),f.proposalCostItems.splice(o,0,l))}else console.error("Dragged or Dropped Item not found");c.value=null})(e.id),onDragover:D,onDragenter:x,onDragleave:j,onDblclick:l=>O(e,!1),class:"draggable-item events"},[u("td",ta,[u("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","z-index":"99","font-weight":"600"},onClick:l=>(e=>{b.value=e.proposal,y.value=e.index,m.value=!m.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,sa)]),(s(!0),k(C,null,V(l.columnsToShow,((l,a)=>(s(),k("td",{key:a},["description"===l?(s(),k("div",{key:0,innerHTML:e[d(Y)[l]]},null,8,na)):(s(),k("span",ia,p(e[d(Y)[l]]),1)),"cost_code"===l?(s(),k("span",ra,p(e?.cost_code_info?.name),1)):w("",!0)])))),128)),u("td",null,[r(o,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:"",up:"",style:{"z-index":"99"}},{content:i((({close:l})=>[u("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:v((()=>{O(e,!1),l()}),["prevent"])},ca,8,da),ua,u("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:v((()=>{(e=>{g.value=e.id,b.value=e.proposal,S.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},ma,8,pa)])),_:2},1024)])],40,oa)))),128)):w("",!0)])])]),d(S).isSweetAlertOpen?(s(),n(_,{key:0,isSweetAlertOpen:d(S).isSweetAlertOpen,title:d(S).title,subtitle:d(S).subtitle,btntext:d(S).btntext,onConfirm:T,onCancel:()=>d(S).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):w("",!0),d(m)?(s(),n(h,{key:1,costItemModal:d(m),proposalId:d(b),costItemId:d(g),previousItemIndex:d(y),previewCostItems:d(I),"onUpdate:modalHandler":a[0]||(a[0]=e=>{m.value=!1,g.value=""}),"onUpdate:OnSuccess":M},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):w("",!0)])}}}),fa=O(va,[["__scopeId","data-v-48fb440f"]]),_a={class:"columns is-multiline"},ba={class:"column is-12 is-flex space-between"},ya=u("div",null,[u("h1",{class:"title is-4"},"Proposal Worksheet")],-1),ha={key:0,class:"column is-12"},ga={class:"tabs-wrapper column is-12 m-0"},Ia={class:"tabs-inner mt-4"},wa={class:"tabs is-boxed"},ka=[u("span",null,"Worksheet",-1)],Ca=[u("span",null,"Format",-1)],Va=[u("span",null,"Preview",-1)],Pa={key:0,class:"column is-12"},Sa={key:0,class:"column is-12"},Da=u("div",{class:"column is-12",style:{"text-align":"center"}},[u("h1",{class:"title is-4"},"Connect your clients to their projects"),u("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),xa={class:"column is-12"},ja={key:0,class:"column is-12"},Ta=e({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:p}){const _=e,g=H(),I=N(),C=l(),V=Qe(),S=a(!1),D=a(!1),x=a(!1),j=a("worksheet");b((()=>y((()=>import("./ckeditor-6a467254.js").then((e=>e.c))),["assets/ckeditor-6a467254.js","assets/index-33506c71.js","assets/index-a879fc9d.css","assets/vue.runtime.esm-bundler-1c1e0ab2.js"]).then((e=>e.default.component))));const T=async()=>{try{V.getProposalCostItems(_.proposalId)}catch(e){console.log(e)}};return h((()=>Q.value),((e,l)=>{e&&JSON.stringify(e)!==JSON.stringify(l)&&(async()=>{try{_.proposalId&&await g.patch(`/api/lead-proposal/${_.proposalId}/`,{columns_to_show:JSON.stringify(Q.value)}),V.getProposalDetail(_.proposalId)}catch(e){I.error("Something went wrong, try again")}})()}),{deep:!0}),o((async()=>{C.value=await y((()=>import("./ckeditor-4fe1d993.js").then((e=>e.c))),["assets/ckeditor-4fe1d993.js","assets/index-33506c71.js","assets/index-a879fc9d.css"]).then((e=>e.default)),_.proposalId&&(T(),V.getProposalDetail(_.proposalId))})),M((()=>{V.clearProposalId()})),(e,l)=>{const a=f,o=t("Multiselect"),p=L,b=E,y=fa,h=P,g=Ql,I=Ke,C=re;return s(),k("div",null,[u("div",_a,[u("div",ba,[ya,u("div",null,[r(a,{size:"small",light:"",outlined:"",icon:"fas fa-cogs",class:"mr-2",color:d(D)?"danger":"warning",onClick:l[0]||(l[0]=e=>D.value=!d(D))},{default:i((()=>[m("Customize Columns")])),_:1},8,["color"]),r(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"info",onClick:l[1]||(l[1]=e=>x.value=!d(x))},{default:i((()=>[m("Import")])),_:1}),r(a,{size:"small",light:"",outlined:"",color:"primary",onClick:l[2]||(l[2]=e=>S.value=!d(S))},{default:i((()=>[m("Add Item")])),_:1})])]),r(U,{class:"fade-slow",name:"fade-slow"},{default:i((()=>[d(D)?(s(),k("div",ha,[r(b,{label:"Choose what to show to lead",class:"column is-12"},{default:i((({id:e})=>[r(p,null,{default:i((()=>[r(o,{modelValue:d(Q),"onUpdate:modelValue":l[3]||(l[3]=e=>c(Q)?Q.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:d(Z),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):w("",!0)])),_:1}),u("div",ga,[u("div",Ia,[u("div",wa,[u("ul",null,[u("li",{class:A(["worksheet"===d(j)?"is-active":"not-active"])},[u("a",{tabindex:"0",role:"button",onKeydown:l[4]||(l[4]=F(v((e=>j.value="worksheet"),["prevent"]),["space"])),onClick:l[5]||(l[5]=e=>j.value="worksheet")},ka,32)],2),u("li",{class:A(["format"===d(j)?"is-active":"not-active"])},[u("a",{tabindex:"0",role:"button",onKeydown:l[6]||(l[6]=F(v((e=>j.value="format"),["prevent"]),["space"])),onClick:l[7]||(l[7]=e=>j.value="format")},Ca,32)],2),u("li",{class:A(["preview"===d(j)?"is-active":"not-active"])},[u("a",{tabindex:"0",role:"button",onKeydown:l[8]||(l[8]=F(v((e=>j.value="preview"),["prevent"]),["space"])),onClick:l[9]||(l[9]=e=>j.value="preview")},Va,32)],2)])])])]),r(U,{class:"fade-slow",name:"slide-x"},{default:i((()=>["worksheet"===d(j)?(s(),k("div",Pa,[r(y,{columnsToShow:d(Q),proposalId:_.proposalId},null,8,["columnsToShow","proposalId"])])):w("",!0)])),_:1}),r(U,{class:"fade-slow",name:"slide-x"},{default:i((()=>["format"===d(j)?(s(),k("div",Sa,[r(h,{class:"columns is-multiline m-0"},{default:i((()=>[Da,u("div",xa,[r(y,{columnsToShow:d(Q),proposalId:_.proposalId},null,8,["columnsToShow","proposalId"])])])),_:1})])):w("",!0)])),_:1}),r(U,{class:"fade-slow",name:"slide-x"},{default:i((()=>["preview"===d(j)?(s(),k("div",ja,[r(g,{proposalData:_.proposalData,proposalId:_.proposalId,columnsToShow:d(Q)},null,8,["proposalData","proposalId","columnsToShow"])])):w("",!0)])),_:1})]),d(S)?(s(),n(I,{key:0,costItemModal:d(S),proposalId:_.proposalId,"onUpdate:modalHandler":l[10]||(l[10]=e=>S.value=!1),"onUpdate:OnSuccess":T},null,8,["costItemModal","proposalId"])):w("",!0),d(x)?(s(),n(C,{key:1,centeredActionsOpen:d(x),proposalId:_.proposalId,"onUpdate:modalHandler":l[11]||(l[11]=e=>x.value=!1),"onUpdate:OnSuccess":T},null,8,["centeredActionsOpen","proposalId"])):w("",!0)])}}}),Oa=e=>(j("data-v-0317543a"),e=e(),T(),e),Ma={class:"columns is-multiline"},Ua=Oa((()=>u("div",{class:"column is-2"},null,-1))),Aa={class:"column is-8"},Fa=Oa((()=>u("div",{class:"column is-2"},null,-1))),$a=Oa((()=>u("div",{class:"column is-2"},null,-1))),Ea=Oa((()=>u("div",{class:"column is-8"},[u("p",null," All the tasks will be generated and will start from the date you will put. ")],-1))),La=Oa((()=>u("div",{class:"column is-2"},null,-1))),Ha=e({__name:"CreateProposalTasksModal",props:{createProposalTasksModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(e,{emit:l}){const t=e,p=N(),_=H(),b=a(""),y=a(!1),h=()=>{l("update:OnSuccess",null),l("closeModalHandler",!1)},g=async()=>{try{await _.post("/api/lead-proposal/create-tasks/",{start:b.value,proposal:t.proposalId});p.success("Tasks of this proposal are created in calendar successfully."),h()}catch(e){console.log(e),p.error("Something went wrong, please review the cost codes")}};return o((()=>{})),(e,l)=>{const a=z,o=L,p=E,_=f,I=$;return s(),n(I,{is:"form",open:t.createProposalTasksModal,title:"Generate Tasks",size:"small",actions:"center",onSubmit:v(g,["prevent"]),onClose:h},{content:i((()=>[u("div",Ma,[Ua,u("div",Aa,[r(p,{label:"Enter Tasks Starting Date"},{default:i((()=>[r(o,null,{default:i((()=>[r(a,{modelValue:d(b),"onUpdate:modelValue":l[0]||(l[0]=e=>c(b)?b.value=e:null),required:"",name:"startDate",type:"date"},null,8,["modelValue"])])),_:1})])),_:1})]),Fa,$a,Ea,La])])),cancel:i((()=>[r(_,{light:"",onClick:l[1]||(l[1]=e=>h())},{default:i((()=>[m("Cancel")])),_:1})])),action:i((()=>[r(_,{loading:d(y),type:"submit",color:"info",light:"",raised:""},{default:i((()=>[m("Generate")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Na=O(Ha,[["__scopeId","data-v-0317543a"]]);export{Ta as _,dl as a,Na as b,Ke as c,pl as d,Qe as u};
