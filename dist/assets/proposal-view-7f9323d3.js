import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-46b7b901.js";import{_ as l}from"./VAvatar.vue_vue_type_style_index_0_lang-e9763bc9.js";import{e as t,r as s,x as a,Z as o,o as n,B as i,C as r,D as p,T as u,l as c,E as d,F as v,J as m,U as y,V as _,M as f,N as h,O as b}from"./index-bd02fd97.js";import{u as x}from"./useAPI-5821d9f5.js";import{c as g}from"./proposalItems-421c183f.js";import{u as w}from"./useNotyf-a8509ab6.js";import"./userSession-87a2ed4a.js";import"./notyf-cbe6ec1b.js";import"./useThemeColors-951640ed.js";const C={class:"columns is-multiline"},k={class:"column is-12 mt-4"},O={class:"invoice-wrapper"},A={class:"invoice-header"},S={class:"left"},j={class:"right"},T={class:"controls"},$={class:"invoice-body"},q={class:"invoice-card"},P={class:"invoice-section is-flex is-bordered"},I=p("div",{class:"meta"},null,-1),D=p("div",{class:"end"},[p("span",null,"PO Box 242"),p("span",null,"Evergreen, CO 80437-0242"),p("span",null,"Phone: 720 272-9061"),p("span",null,"Premium Trades for Premier Builders")],-1),M=p("div",{class:"invoice-section is-flex is-bordered"},[p("div",{class:"meta"},[p("h3",null,"Client Name"),p("span",null,"Client Phone"),p("span",null,"25724 Independence Trail Evergreen, CO 80439")]),p("div",{class:"end is-left"},[p("h3",null,"Friday Jan 17, 2025"),p("p",null," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quod equidem non reprehendo. ")])],-1),B={key:0,class:"invoice-section"},z={class:"responsive-table"},L=p("br",null,null,-1),N=["innerHTML"],U={class:"invoice-section is-flex mt-0 pt-0"},E={class:"end is-left"},F={class:"text-right"},H=p("p",null,"Mentioned price are final",-1),J=t({__name:"proposal-view",props:{previewModal:{type:Boolean},columnsToShow:{default:!1},proposalId:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(t,{emit:J}){const Y=s(""),Q=w(),V=a(),K=x(),R=["Item","Description","Unit Cost","Qty","Unit","Builder Cost","Markup","Total Price"],Z=s({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),G=o((()=>g.value.reduce(((e,l)=>e+l.price*l.quantity),0))),W=s(!1),X=s({id:"",title:"",approval_deadline:"",internal_notes:null,introductory_text:null,closing_text:null,payment_status:"",type:"",status:"",created_at:"",updated_at:"",job:""}),ee=s([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]),le=e=>{Y.value=e,Z.value={title:`${Y.value.toLocaleUpperCase()} proposal ?`,subtitle:""+("approve"==Y.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site."),btntext:""+("approve"==Y.value?"Approve":"Disapprove"),isSweetAlertOpen:!0}},te=async()=>{try{W.value=!0;await K.patch(`/api/lead-proposal/${V.query.proposal}/`,{status:Y.value});Q.success(`You have ${Y.value} this proposal.`),Z.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{W.value=!1}},se=async()=>{try{const e=await K.get(`api/cost/by-proposal/${V.query.proposal}/`);ee.value=e.data}catch(e){console.log(e)}};return n((()=>{V.query.proposal&&(async()=>{try{W.value=!0;const e=await K.get(`/api/lead-proposal/${V.query.proposal}/`);X.value=e.data,se()}catch(e){console.log(e)}finally{W.value=!1}})()})),(t,s)=>{const a=b,o=l,n=e;return i(),r("div",C,[p("div",k,[p("div",O,[p("div",A,[p("div",S,[p("h3",null,"Proposal "+u(c(V).query.proposal?.slice(0,8)),1)]),p("div",j,[p("div",T,[d(a,{size:"xsmall",onClick:s[0]||(s[0]=e=>le("approve")),outlined:"",color:"primary"},{default:v((()=>[m("Approve")])),_:1}),d(a,{size:"xsmall",onClick:s[1]||(s[1]=e=>le("review")),class:"ml-2",outlined:"",color:"info"},{default:v((()=>[m("Review")])),_:1}),d(a,{onClick:s[2]||(s[2]=e=>le("disapprove")),size:"xsmall",class:"ml-2",outlined:"",color:"danger"},{default:v((()=>[m("Disapprove")])),_:1})])])]),p("div",$,[p("div",q,[p("div",P,[d(o,{size:"xl",picture:"/logos/IbexFavicon.png"}),I,D]),M,c(ee).length?(i(),r("div",B,[p("table",z,[p("thead",null,[(i(),r(y,null,_(R,((e,l)=>p("th",{key:l},u(e),1))),64))]),p("tbody",null,[(i(!0),r(y,null,_(c(ee),((e,l)=>(i(),r("tr",{key:e.id},[p("td",null,[p("span",null,u(e.title),1),L,p("span",null,u(e.cost_code),1)]),p("td",null,[p("span",{innerHTML:e.description},null,8,N)]),p("td",null,[p("span",null," $"+u(e.unit_cost),1)]),p("td",null,[p("span",null,u(e.quantity),1)]),p("td",null,[p("span",null,u(e.unit),1)]),p("td",null,[p("span",null," $"+u(e.builder_cost),1)]),p("td",null,[p("span",null," $"+u(e.markup),1)]),p("td",null,[p("span",null," $"+u(e.total_price),1)])])))),128))])])])):f("",!0),p("div",U,[p("div",E,[p("h3",F,"Total Price: $"+u(c(G)),1),H])])])])])]),c(Z).isSweetAlertOpen?(i(),h(n,{key:0,isSweetAlertOpen:c(Z).isSweetAlertOpen,title:c(Z).title,subtitle:c(Z).subtitle,btntext:c(Z).btntext,onConfirm:te,onCancel:()=>c(Z).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):f("",!0)])}}});export{J as default};
