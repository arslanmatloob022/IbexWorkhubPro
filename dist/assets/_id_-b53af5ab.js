import{e,s as l,x as t,v as a,r as s,b as o,_ as i,o as r,B as n,C as p,D as u,l as d,N as c,F as m,J as _,M as v,E as f,T as y,K as b,W as g,O as w,z as h}from"./index-214b55fa.js";import{u as x,_ as V,b as k}from"./CreateProposalTasksModal-51dc5e6f.js";import{_ as C}from"./SweetAlert.vue_vue_type_style_index_0_lang-36355451.js";import{_ as A}from"./VCollapse.vue_vue_type_style_index_0_lang-77191b77.js";import{_ as j}from"./VTextarea.vue_vue_type_script_setup_true_lang-628a244d.js";import{_ as S}from"./VField.vue_vue_type_script_setup_true_lang-eeb4fb75.js";import{_ as O}from"./VControl-d56190bf.js";import{_ as I}from"./VRadio.vue_vue_type_style_index_0_lang-00bc124e.js";import{_ as T}from"./VMessage.vue_vue_type_style_index_0_lang-1f4b6143.js";import{_ as P}from"./V-Snack.vue_vue_type_style_index_0_lang-993f77e6.js";import{u as D}from"./useAPI-9e9163dc.js";import{u as U}from"./useNotyf-b7b988a5.js";import{a as N}from"./useSupportElement-de79869c.js";import{u as M}from"./userSession-718aaab5.js";import{u as q}from"./viewWrapper-eb2d288e.js";import"./VModal.vue_vue_type_style_index_0_lang-877b4dce.js";import"./VInput.vue_vue_type_script_setup_true_lang-f385347d.js";import"./useVFieldContext-c6ee6046.js";import"./VOption.vue_vue_type_style_index_0_lang-ead27281.js";import"./VAvatar.vue_vue_type_style_index_0_lang-0223a76a.js";import"./costItems-d824ffef.js";import"./VDropdown.vue_vue_type_style_index_0_lang-74709653.js";import"./VIcon.vue_vue_type_script_setup_true_lang-e2fe1a0c.js";import"./useDropdown-b9fce55e.js";import"./VLabel.vue_vue_type_script_setup_true_lang-c2981308.js";import"./notyf-675a02ae.js";import"./useThemeColors-c03a2cad.js";const $={class:"modal-form columns is-multiline"},L={class:"column is-12 is-flex space-between align-items-center"},E={key:0,class:"column is-12"},z={class:"field column is-6 mb-0"},Y=u("label",null,"Title: *",-1),F={class:"control"},H={class:"column is-6"},R={class:"field column is-6"},J=u("label",null,"Approval Deadline *",-1),W={class:"control"},B={class:"field column is-6"},G=u("label",null,"Attachments",-1),K=u("div",{class:"file"},[u("label",{class:"file-label"},[u("input",{class:"file-input",type:"file",name:"resume"}),u("span",{class:"file-cta"},[u("span",{class:"file-icon"},[u("i",{class:"fas fa-cloud-upload-alt"})]),u("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),Q={class:"field column is-12"},X={class:"body-inner-content"},Z={class:"field columns is-multiline mb-0"},ee={class:"field column is-11 mb-0"},le=u("label",{for:"",class:"label"},"Internal Notes",-1),te={class:"field column is-11 mb-0"},ae=u("label",{for:"",class:"label"},"Introductory Text",-1),se={class:"field column is-11 mb-0"},oe=u("label",{for:"",class:"label"},"Closing Text",-1),ie={class:"column is-12"},re=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:h}){const q=e,re=l(),ne=x();M();const pe=U(),ue=D(),de=t(),ce=a();s({});const me=s(!1),_e=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],ve=s({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"});s({title:"",description:"",quantity:0,unit:0,unitCost:0,markup:0,clientPrice:0,costCode:"",costType:"",builderCost:"",margin:0,profit:0,internalNotes:""});const fe=s({title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",is_task_created:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),ye=async()=>{try{const e=await ue.get(`/api/lead-proposal/${de.params.id}/detail/`);fe.value=e.data,ne.getProposalCostItems(de.params.id)}catch(e){console.log(e)}},be=async()=>{try{me.value=!0,fe.value.columns_to_show=JSON.stringify(selectedColumnsToShow.value);const e=N(fe.value,[]);if(q.proposalId||fe.value.id){const l=await ue.patch(`/api/lead-proposal/${q.proposalId?q.proposalId:fe.value.id}/`,e);fe.value=l.data}pe.success("Proposal updated successfully"),ye()}catch(e){pe.error("Something went wrong, try again")}finally{me.value=!1}},ge=s(""),we=s(""),he=s({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),xe=async()=>{try{me.value=!0;await ue.delete(`/api/lead-proposal/${we.value}/`);ve.value.isSweetAlertOpen=!1,pe.success("Proposal delete successfully"),ce.go(-1)}catch(e){pe.error(` ${e}, Proposal`),pe.error("Something went wrong please try later")}finally{me.value=!1}},Ve=async()=>{try{me.value=!0;await ue.patch(`/api/lead-proposal/${de.params.id}/`,{status:ge.value});ye(),pe.success(`You have ${ge.value} this proposal.`),ve.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{me.value=!1}},ke=s(!1),Ce=s("");s("worksheet");const Ae=o((()=>i((()=>import("./ckeditor-9a6c036c.js").then((e=>e.c))),["assets/ckeditor-9a6c036c.js","assets/index-214b55fa.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-a35ad905.js"]).then((e=>e.default.component)))),je={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"};return r((async()=>{re.value=await i((()=>import("./ckeditor-3f1d7417.js").then((e=>e.c))),["assets/ckeditor-3f1d7417.js","assets/index-214b55fa.js","assets/index-ce8747cd.css"]).then((e=>e.default)),(q.proposalId||de.params.id)&&(ye(),ne.getProposalDetail(q.proposalId||de.params.id))})),(e,l)=>{const t=w,a=P,s=T,o=I,i=O,r=S,h=j,x=A,D=V,U=C,N=k;return n(),p("div",$,[u("div",L,[u("div",null,["approved"!=d(fe).status?(n(),c(t,{key:0,onClick:l[0]||(l[0]=e=>{return l="approved",ge.value=l,void(ve.value={title:`${ge.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==ge.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==ge.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var l}),size:"small",class:"mr-2",light:"",outlined:"",color:"info",raised:""},{default:m((()=>[_(" Approved ")])),_:1})):(n(),c(a,{key:1,title:"Approved",white:"",color:"primary",icon:"fas fa-check-circle"})),d(fe).is_task_created?(n(),c(a,{key:2,title:"Calendar Tasks Created ",white:"",class:"ml-2",color:"info",icon:"fas fa-calendar-check"})):v("",!0)]),u("div",null,[d(fe).is_task_created||"approved"==d(fe).status?v("",!0):(n(),c(t,{key:0,onClick:l[1]||(l[1]=e=>{return l=d(de).params.id,Ce.value=l,void(ke.value=!0);var l}),size:"small",class:"mr-2",light:"",outlined:"",color:"success",raised:""},{default:m((()=>[_(" Generate Tasks ")])),_:1})),f(t,{onClick:be,size:"small",class:"mr-2",light:"",outlined:"",color:"primary",raised:""},{default:m((()=>[_(" Update ")])),_:1}),f(t,{size:"small",onClick:l[2]||(l[2]=e=>{return l=d(fe).id,we.value=l,void(he.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),light:"",outlined:"",color:"danger",raised:""},{default:m((()=>[_(" Delete ")])),_:1})])]),d(fe).client_note&&"review"==d(fe).status?(n(),p("div",E,[f(s,{color:"warning"},{default:m((()=>[_(y(d(fe).client_note),1)])),_:1})])):v("",!0),u("div",z,[Y,u("div",F,[b(u("input",{type:"text",name:"firstName","onUpdate:modelValue":l[3]||(l[3]=e=>d(fe).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[g,d(fe).title]])])]),u("div",H,[f(r,{class:"m-0 p-0",label:"Type"},{default:m((()=>[f(i,null,{default:m((()=>[f(o,{modelValue:d(fe).type,"onUpdate:modelValue":l[4]||(l[4]=e=>d(fe).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),f(o,{modelValue:d(fe).type,"onUpdate:modelValue":l[5]||(l[5]=e=>d(fe).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),f(o,{modelValue:d(fe).type,"onUpdate:modelValue":l[6]||(l[6]=e=>d(fe).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",R,[J,u("div",W,[b(u("input",{type:"date",name:"firstName","onUpdate:modelValue":l[7]||(l[7]=e=>d(fe).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[g,d(fe).approval_deadline]])])]),u("div",B,[G,f(r,{grouped:""},{default:m((()=>[f(i,null,{default:m((()=>[K])),_:1})])),_:1})]),u("div",Q,[f(x,{items:_e,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":m((e=>[u("div",X,[u("div",Z,[u("div",ee,[le,f(r,null,{default:m((()=>[f(i,null,{default:m((()=>[f(h,{modelValue:d(fe).internalNotes,"onUpdate:modelValue":l[8]||(l[8]=e=>d(fe).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",te,[ae,d(re)?(n(),c(d(Ae),{key:0,modelValue:d(fe).introductoryText,"onUpdate:modelValue":l[9]||(l[9]=e=>d(fe).introductoryText=e),editor:d(re),config:je},null,8,["modelValue","editor"])):v("",!0)]),u("div",se,[oe,d(re)?(n(),c(d(Ae),{key:0,modelValue:d(fe).closingText,"onUpdate:modelValue":l[10]||(l[10]=e=>d(fe).closingText=e),editor:d(re),config:je},null,8,["modelValue","editor"])):v("",!0)])])])])),_:1})]),u("div",ie,[f(D,{proposalData:d(fe),proposalId:d(fe).id},null,8,["proposalData","proposalId"])]),d(ve).isSweetAlertOpen?(n(),c(U,{key:1,isSweetAlertOpen:d(ve).isSweetAlertOpen,title:d(ve).title,subtitle:d(ve).subtitle,btntext:d(ve).btntext,onConfirm:Ve,onCancel:()=>d(ve).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):v("",!0),d(he).isSweetAlertOpen?(n(),c(U,{key:2,isSweetAlertOpen:d(he).isSweetAlertOpen,title:d(he).title,subtitle:d(he).subtitle,btntext:d(he).btntext,onConfirm:xe,onCancel:()=>d(he).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):v("",!0),d(ke)?(n(),c(N,{key:3,createProposalTasksModal:d(ke),proposalId:d(Ce),onCloseModalHandler:l[11]||(l[11]=e=>ke.value=!1),"onUpdate:OnSuccess":e.getCompanyProposalList},null,8,["createProposalTasksModal","proposalId","onUpdate:OnSuccess"])):v("",!0)])}}}),ne=e({__name:"[id]",setup:e=>(q().setPageTitle("Lead Proposals"),h({title:"Lead Proposals - Ibex"}),(e,l)=>(n(),p("div",null,[f(re)])))});export{ne as default};
