import{_ as e,a,b as l}from"./ProposalViewModal.vue_vue_type_style_index_0_lang-5a12e760.js";import{_ as t}from"./SweetAlert.vue_vue_type_style_index_0_lang-d617e579.js";import{b as s,c as o}from"./CreateProposalTasksModal-29166d92.js";import{_ as i}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-c2cd0065.js";import{_ as r,c as n}from"./VFlexTable.vue_vue_type_style_index_0_lang-12b6857f.js";import{_ as d}from"./VDropdown.vue_vue_type_style_index_0_lang-b11bb0cb.js";import{_ as p}from"./VTag.vue_vue_type_style_index_0_lang-0bbd48d5.js";import{f as u,x as c,y as m,r as v,$ as _,o as y,av as f,C as k,D as h,m as b,F as w,E as g,G as C,L as x,X as P,k as A,K as S,O as I,N as j,V as O,W as L,aS as M,P as T,U as $}from"./index-db92e92b.js";import{_ as V}from"./VControl-f34f1e3a.js";import{_ as D}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-afa14ae4.js";import{_ as U,a as E}from"./search-4-dark-2b5b440c.js";import{u as H}from"./useAPI-b96299b1.js";import{u as N}from"./useNotyf-0657d34f.js";import{f as Y,j as F}from"./useSupportElement-98fc05de.js";import{b as G,c as R,d as z,e as B}from"./estimatesScripts-e8033212.js";const J={key:0},K={key:1},W={class:"flex-toolbar is-reversed is-flex space-between my-4"},X={class:"flex-list-wrapper flex-list-v2"},q={class:"item-name dark-inverted show-text-250"},Q={class:"item-meta"},Z=g("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),ee={class:"item-name dark-inverted"},ae=["onClick"],le=[g("div",{class:"icon"},[g("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),g("div",{class:"meta"},[g("span",null,"Edit"),g("span",null,"Edit Proposal Details")],-1)],te=["onClick"],se=[g("div",{class:"icon"},[g("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),g("div",{class:"meta"},[g("span",null,"Preview"),g("span",null,"Preview proposal detail")],-1)],oe=["onClick"],ie=[g("div",{class:"icon"},[g("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),g("div",{class:"meta"},[g("span",null,"Create Tasks"),g("span",null,"Create tasks in chart ")],-1)],re=g("hr",{class:"dropdown-divider"},null,-1),ne=["onClick"],de=[g("div",{class:"icon"},[g("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),g("div",{class:"meta"},[g("span",null,"Mark Approved"),g("span",null,"Mark Proposal As Approved")],-1)],pe=["onClick"],ue=[g("div",{class:"icon"},[g("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),g("div",{class:"meta"},[g("span",null,"Delete"),g("span",null,"Delete from list")],-1)],ce=g("img",{class:"light-image",src:U,alt:""},null,-1),me=g("img",{class:"dark-image",src:E,alt:""},null,-1),ve=u({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},emits:["updateCompany"],setup(u,{emit:U}){const E=u,ve=c();m();const _e=H(),ye=N(),fe=v(!1),ke=v([]),he=v(!1),be=v(""),we=v(!1),ge=v(!1),Ce=v(""),xe=v("");v(E.activeTab);const Pe=v({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Ae=v({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),Se=async()=>{try{fe.value=!0;await _e.delete(`/api/lead-proposal/${xe.value}/`);ye.success("Proposal delete successfully"),Ve()}catch(e){ye.error(` ${e}, Proposal`),ye.error("Something went wrong please try later")}finally{fe.value=!1,Pe.value.isSweetAlertOpen=!1}},Ie={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},je=_((()=>{if(Ce.value){const e=new RegExp(Ce.value,"i");return ke.value.filter((a=>a.title.match(e)||a.approval_deadline.match(e)))}return ke.value})),Oe=v(!1),Le=v(!1),Me=v(!1),Te=v(""),$e=e=>{ve.push(`/sidebar/dashboard/proposals/${e}`)},Ve=()=>{1==E.allProposal?(async()=>{try{fe.value=!0;const e=await _e.get("/api/lead-proposal/");ke.value=e.data}catch(e){ye.error(` ${e}, Lead`)}finally{fe.value=!1}})():E.leadId&&(async()=>{try{fe.value=!0;const e=await _e.get(`/api/lead-proposal/by-project/${E.leadId}/`);ke.value=e.data}catch(e){ye.error(` ${e}, Lead`)}finally{fe.value=!1}})()};return y((()=>{Ve()})),(u,c)=>{const m=D,v=V,_=T,y=n,H=p,N=d,ve=r,De=i,Ue=s,Ee=e,He=a,Ne=o,Ye=t,Fe=l,Ge=f("tooltip");return k(),h("div",null,[b(fe)?(k(),h("div",J,[w(m)])):(k(),h("div",K,[g("div",W,[w(v,{icon:"feather:search"},{default:C((()=>[x(g("input",{"onUpdate:modelValue":c[0]||(c[0]=e=>A(Ce)?Ce.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[P,b(Ce)]])])),_:1}),g("div",null,[w(_,{color:"primary",onClick:c[1]||(c[1]=e=>he.value=!b(he)),icon:"fas fa-plus"},{default:C((()=>[S("Lead Proposal ")])),_:1}),E.leadId?(k(),I(_,{key:0,color:"warning",class:"ml-2",onClick:c[2]||(c[2]=e=>{ge.value=!0}),icon:"fas fa-cogs"},{default:C((()=>[S("Proposals")])),_:1})):j("",!0)])]),g("div",X,[b(je).length>0&&b(ke).length>0?(k(),I(ve,{key:0,data:b(je),columns:Ie,rounded:""},{body:C((()=>[w(M,{name:"list",tag:"div",class:"flex-list-inner"},{default:C((()=>[(k(!0),h(O,null,L(b(je),(e=>(k(),h("div",{key:e.id,class:"flex-table-item"},[w(y,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[x((k(),h("div",null,[g("span",q,$(e.title),1),g("span",Q,[g("span",null,[Z,S($(b(Y)(e.created_at)),1)])])])),[[Ge,`${e.title}`,void 0,{rounded:!0,light:!0}]])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[w(H,{rounded:"",color:b(G)[e.type]},{default:C((()=>[S($(b(R)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[w(H,{class:"capitalized",rounded:"",color:b(z)[e.status]},{default:C((()=>[S($(b(B)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id),column:{media:!0}},{default:C((()=>[g("div",null,[g("span",ee,$(b(F)(e?.proposalAmount)),1)])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[w(H,{color:"purple",outlined:""},{default:C((()=>[S($(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),w(y,{column:{align:"end"}},{default:C((()=>[w(N,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:C((()=>[g("a",{role:"menuitem",onClick:a=>{return l=e.id,be.value=l,void(he.value=!0);var l},class:"dropdown-item is-media"},le,8,ae),g("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Le.value=l,void(Oe.value=!Oe.value);var l},class:"dropdown-item is-media"},se,8,te),"approved"==e.status?(k(),h("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,be.value=l,void(we.value=!0);var l},class:"dropdown-item is-media"},ie,8,oe)):j("",!0),re,"approved"!=e.status?(k(),h("a",{key:1,role:"menuitem",onClick:a=>(async(e,a)=>{try{await _e.patch(`/api/lead-proposal/${a}/`,{status:e}),ye.success(`You have ${e} this proposal.`),"approved"==e&&U("updateCompany",null),Ve()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},de,8,ne)):j("",!0),g("a",{role:"menuitem",onClick:a=>{return l=e.id,xe.value=l,void(Pe.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},ue,8,pe)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):j("",!0),b(ke).length<1&&0==b(je).length?(k(),I(De,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:C((()=>[ce,me])),_:1})):j("",!0)]),b(we)?(k(),I(Ue,{key:0,createProposalTasksModal:b(we),proposalId:b(be),onCloseModalHandler:c[3]||(c[3]=e=>we.value=!1),"onUpdate:OnSuccess":c[4]||(c[4]=e=>Ve())},null,8,["createProposalTasksModal","proposalId"])):j("",!0),b(he)?(k(),I(Ee,{key:1,leadId:E.leadId,proposalId:b(be),leadProposalModal:b(he),getLeadsList:E.allProposal,"onUpdate:modalHandler":c[5]||(c[5]=()=>{Ve(),he.value=!1}),onClearProposalId:c[6]||(c[6]=e=>be.value="")},null,8,["leadId","proposalId","leadProposalModal","getLeadsList"])):j("",!0),b(Oe)?(k(),I(He,{key:2,"preview-modal":b(Oe),proposalId:b(Le),"onUpdate:modalHandler":c[7]||(c[7]=e=>Oe.value=!1)},null,8,["preview-modal","proposalId"])):j("",!0),b(Me)?(k(),I(Ne,{key:3,costItemModal:b(Me),proposalId:b(Te),"onUpdate:modalHandler":c[8]||(c[8]=e=>Me.value=!1),"onUpdate:OnSuccess":Ve},null,8,["costItemModal","proposalId"])):j("",!0),b(Pe).isSweetAlertOpen?(k(),I(Ye,{key:4,isSweetAlertOpen:b(Pe).isSweetAlertOpen,title:b(Pe).title,subtitle:b(Pe).subtitle,btntext:b(Pe).btntext,onConfirm:Se,onCancel:()=>b(Pe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):j("",!0),b(Ae).isSweetAlertOpen?(k(),I(Ye,{key:5,isSweetAlertOpen:b(Ae).isSweetAlertOpen,title:b(Ae).title,subtitle:b(Ae).subtitle,btntext:b(Ae).btntext,onConfirm:Se,onCancel:()=>b(Ae).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):j("",!0),b(ge)?(k(),I(Fe,{key:6,leadProposalListModal:b(ge),leadID:E.leadId,"group-proposal-modal":b(ge),"onUpdate:modalHandler":c[9]||(c[9]=e=>ge.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):j("",!0)]))])}}});export{ve as _};
