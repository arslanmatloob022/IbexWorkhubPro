import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-4a477fa8.js";import{_ as l}from"./VRadio.vue_vue_type_style_index_0_lang-96c6c8e0.js";import{_ as a}from"./VSwitchBlock.vue_vue_type_style_index_0_lang-e2767a1c.js";import{e as o,r as t,o as u,y as s,H as r,B as n,C as i,A as d,D as m,l as p,z as c,P as _,J as f,K as v,E as y}from"./index-94fd63d9.js";import{_ as V}from"./VIcon.vue_vue_type_script_setup_true_lang-7dc6f338.js";import{_ as g}from"./VAvatar.vue_vue_type_style_index_0_lang-af7450f8.js";import{_ as b}from"./VFilePond.vue_vue_type_script_lang-292bc713.js";import{_ as h}from"./VField.vue_vue_type_script_setup_true_lang-3d88a258.js";import{_ as U}from"./VControl-f48771f4.js";import{_ as w}from"./VInput.vue_vue_type_script_setup_true_lang-f838d1ac.js";import{_ as j}from"./VLabel.vue_vue_type_script_setup_true_lang-8133556e.js";import{u as x}from"./useAPI-908cf8be.js";import{u as k}from"./useNotyf-c83d15ff.js";import{a as I}from"./useSupportElement-8f2f795f.js";const A={class:"modal-form columns is-multiline"},M={class:"column is-6"},P={class:"columns is-multiline"},C={class:"column is-3"},E={key:0,class:"column is-3"},N={class:"column is-12"},R=o({__name:"AddUpdateUser",props:{isModalOpen:{type:Boolean,default:!1},userRole:{default:""},userId:{default:""}},emits:["update:closeModalHandler","update:actionUpdateHandler"],setup(o,{emit:R}){const S=o,z=k(),H=x(),F=t(""),B=t(!1),q=t(!1),D=()=>{R("update:closeModalHandler",!1)},J=t({username:"",email:"",password:"",is_sentMail:!1,status:"",role:"",phoneNumber:"",avatar:""}),L=e=>{const l=e?.target;if(l&&l.files&&l.files.length>0){const e=l.files[0];J.value.avatar=e;const a=new FileReader;a.onload=e=>{F.value=e.target?.result},a.readAsDataURL(e)}else console.error("No file selected")},O=()=>{J.value.avatar=null,F.value=null},$=async()=>{try{q.value=!0;const e=I(J.value,["avatar"]);if(S.userId){await H.patch(`/api/users/${S.userId}/`,e);z.info("User updated successfully")}else{await H.post("/api/users/",e);z.success("User added successfully")}R("update:actionUpdateHandler",null),D()}catch(e){console.error(e)}finally{q.value=!1}},K=t(!1);return u((()=>{S.userId&&(async()=>{try{q.value=!0;const e=await H.get(`/api/users/${S.userId}`);F.value=e.data.avatar?e.data.avatar:"",K.value=e.data.avatar?e.data.avatar:"",J.value=e.data}catch(e){console.error(e)}finally{q.value=!1}})(),J.value.role=S.userRole})),(o,t)=>{const u=j,x=w,k=U,I=h,R=b,z=g,H=V,K=y,W=a,G=l,Q=e;return s(),r(Q,{is:"form",open:S.isModalOpen,title:S.userId?"Update user":"Add user",size:"big",actions:"right",onSubmit:v($,["prevent"]),onClose:D},{content:n((()=>[i("div",A,[i("div",M,[i("div",P,[d(I,{class:"column is-12"},{default:n((()=>[d(u,null,{default:n((()=>[m("Full Name")])),_:1}),d(k,null,{default:n((()=>[d(x,{required:"",modelValue:p(J).username,"onUpdate:modelValue":t[0]||(t[0]=e=>p(J).username=e),type:"text",placeholder:"Enter name"},null,8,["modelValue"])])),_:1})])),_:1}),d(I,{class:"column is-12"},{default:n((()=>[d(u,null,{default:n((()=>[m("Phone")])),_:1}),d(k,null,{default:n((()=>[d(x,{modelValue:p(J).phoneNumber,"onUpdate:modelValue":t[1]||(t[1]=e=>p(J).phoneNumber=e),type:"phone",placeholder:"Enter phone number"},null,8,["modelValue"])])),_:1})])),_:1})])]),i("div",C,[d(I,null,{default:n((()=>[d(u,null,{default:n((()=>[m("Picture")])),_:1}),d(k,null,{default:n((()=>[d(R,{class:"profile-filepond",name:"profile_filepond","chunk-retry-delays":[500,1e3,3e3],"label-idle":"<i class='lnil lnil-cloud-upload'></i>","accepted-file-types":["image/png","image/jpeg","image/gif"],"image-preview-height":180,"image-resize-target-width":180,"image-resize-target-height":180,"image-crop-aspect-ratio":"1:1","style-panel-layout":"compact circle","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom",onChange:L,onRemovefile:O})])),_:1})])),_:1})]),p(F)?(s(),c("div",E,[d(I,null,{default:n((()=>[d(u,null,{default:n((()=>[m("Preview")])),_:1}),p(F)?(s(),r(z,{key:0,picture:p(F),size:"xl",alt:"Avatar Preview"},null,8,["picture"])):_("",!0)])),_:1})])):_("",!0),d(I,{class:"column is-6"},{default:n((()=>[d(u,null,{default:n((()=>[m("Email")])),_:1}),d(k,null,{default:n((()=>[d(x,{required:"",modelValue:p(J).email,"onUpdate:modelValue":t[2]||(t[2]=e=>p(J).email=e),type:"email",placeholder:"Enter mail"},null,8,["modelValue"])])),_:1})])),_:1}),d(I,{class:"column is-6",label:"Password",addons:""},{default:n((()=>[d(k,{expanded:""},{default:n((()=>[d(x,{modelValue:p(J).password,"onUpdate:modelValue":t[3]||(t[3]=e=>p(J).password=e),type:p(B)?"text":"password",class:"input",placeholder:"Enter Password"},null,8,["modelValue","type"])])),_:1}),d(k,null,{default:n((()=>[d(K,{color:"primary",onClick:t[4]||(t[4]=e=>B.value=!p(B))},{default:n((()=>[p(B)?(s(),r(H,{key:0,icon:"lucide:eye-off"})):(s(),r(H,{key:1,icon:"lucide:eye"}))])),_:1})])),_:1})])),_:1}),d(I,{class:"column is-6"},{default:n((()=>[d(k,null,{default:n((()=>[d(W,{modelValue:p(J).is_sentMail,"onUpdate:modelValue":t[5]||(t[5]=e=>p(J).is_sentMail=e),label:"Send email",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1}),d(I,{class:"column is-6"},{default:n((()=>[d(k,null,{default:n((()=>[d(W,{modelValue:p(J).is_active,"onUpdate:modelValue":t[6]||(t[6]=e=>p(J).is_active=e),label:"Active",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1}),i("div",N,[d(I,{label:"User role"},{default:n((()=>[d(k,null,{default:n((()=>[d(G,{modelValue:p(J).role,"onUpdate:modelValue":t[7]||(t[7]=e=>p(J).role=e),value:"manager",label:"Manager",name:"outlined_radio",color:"primary"},null,8,["modelValue"]),d(G,{modelValue:p(J).role,"onUpdate:modelValue":t[8]||(t[8]=e=>p(J).role=e),value:"worker",label:"Worker",name:"outlined_radio",color:"primary"},null,8,["modelValue"]),d(G,{modelValue:p(J).role,"onUpdate:modelValue":t[9]||(t[9]=e=>p(J).role=e),value:"contractor",label:"Contractor",name:"outlined_radio",color:"info"},null,8,["modelValue"]),d(G,{modelValue:p(J).role,"onUpdate:modelValue":t[10]||(t[10]=e=>p(J).role=e),value:"sub-contractor",label:"Sub Contractor",name:"outlined_radio",color:"success"},null,8,["modelValue"]),d(G,{modelValue:p(J).role,"onUpdate:modelValue":t[11]||(t[11]=e=>p(J).role=e),value:"client",label:"Client",name:"outlined_radio",color:"warning"},null,8,["modelValue"])])),_:1})])),_:1})])])])),action:n((()=>[d(K,{loading:p(q),type:"submit",color:"primary",raised:""},{default:n((()=>[m(f(S.userId?"Update":"Add"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{R as _};
