import{_ as e,a,b as l}from"./ProposalViewModal.vue_vue_type_style_index_0_lang-3c2819fc.js";import{_ as t}from"./SweetAlert.vue_vue_type_style_index_0_lang-4634f42f.js";import{b as s,c as o}from"./CreateProposalTasksModal-20869a82.js";import{_ as i}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-a8f2afdf.js";import{_ as n,c as r}from"./VFlexTable.vue_vue_type_style_index_0_lang-a61170c5.js";import{_ as d}from"./VDropdown.vue_vue_type_style_index_0_lang-cd7ea8f4.js";import{_ as p}from"./VTag.vue_vue_type_style_index_0_lang-2154ea11.js";import{f as u,x as c,y as m,r as v,$ as _,o as y,av as f,C as k,D as b,m as h,F as w,E as C,G as g,L as x,X as P,k as A,K as S,O as I,N as O,V as j,W as T,aS as M,P as L,U as $}from"./index-2dec9709.js";import{_ as U}from"./VControl-0b0315de.js";import{_ as V}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-2f21440c.js";import{_ as D,a as E}from"./search-4-dark-2b5b440c.js";import{u as H}from"./useAPI-bacd1021.js";import{u as N}from"./useNotyf-528b9175.js";import{b as F}from"./useSupportElement-5543f980.js";import{b as Y,c as q,d as z,e as B}from"./estimatesScripts-695ce42e.js";const G={key:0},K={key:1},R={class:"flex-toolbar is-reversed is-flex space-between my-4"},W={class:"flex-list-wrapper flex-list-v2"},X={class:"item-name dark-inverted show-text-250"},J={class:"item-meta"},Q=C("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),Z={class:"item-name dark-inverted"},ee={class:"light-text"},ae=["onClick"],le=[C("div",{class:"icon"},[C("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),C("div",{class:"meta"},[C("span",null,"Edit"),C("span",null,"Edit Proposal Details")],-1)],te=["onClick"],se=[C("div",{class:"icon"},[C("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),C("div",{class:"meta"},[C("span",null,"Preview"),C("span",null,"Preview proposal detail")],-1)],oe=["onClick"],ie=[C("div",{class:"icon"},[C("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),C("div",{class:"meta"},[C("span",null,"Create Tasks"),C("span",null,"Create tasks in chart ")],-1)],ne=C("hr",{class:"dropdown-divider"},null,-1),re=["onClick"],de=[C("div",{class:"icon"},[C("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),C("div",{class:"meta"},[C("span",null,"Mark Approved"),C("span",null,"Mark Proposal As Approved")],-1)],pe=["onClick"],ue=[C("div",{class:"icon"},[C("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),C("div",{class:"meta"},[C("span",null,"Delete"),C("span",null,"Delete from list")],-1)],ce=C("img",{class:"light-image",src:D,alt:""},null,-1),me=C("img",{class:"dark-image",src:E,alt:""},null,-1),ve=u({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},emits:["updateCompany"],setup(u,{emit:D}){const E=u,ve=c();m();const _e=H(),ye=N(),fe=v(!1),ke=v([]),be=v(!1),he=v(""),we=v(!1),Ce=v(!1),ge=v(""),xe=v("");v(E.activeTab);const Pe=v({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Ae=v({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),Se=async()=>{try{fe.value=!0;await _e.delete(`/api/lead-proposal/${xe.value}/`);ye.success("Proposal delete successfully"),Ue()}catch(e){ye.error(` ${e}, Proposal`),ye.error("Something went wrong please try later")}finally{fe.value=!1,Pe.value.isSweetAlertOpen=!1}},Ie={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},Oe=_((()=>{if(ge.value){const e=new RegExp(ge.value,"i");return ke.value.filter((a=>a.title.match(e)||a.approval_deadline.match(e)))}return ke.value})),je=v(!1),Te=v(!1),Me=v(!1),Le=v(""),$e=e=>{ve.push(`/sidebar/dashboard/proposals/${e}`)},Ue=()=>{1==E.allProposal?(async()=>{try{fe.value=!0;const e=await _e.get("/api/lead-proposal/");ke.value=e.data}catch(e){ye.error(` ${e}, Lead`)}finally{fe.value=!1}})():E.leadId&&(async()=>{try{fe.value=!0;const e=await _e.get(`/api/lead-proposal/by-project/${E.leadId}/`);ke.value=e.data}catch(e){ye.error(` ${e}, Lead`)}finally{fe.value=!1}})()};return y((()=>{Ue()})),(u,c)=>{const m=V,v=U,_=L,y=r,H=p,N=d,ve=n,Ve=i,De=s,Ee=e,He=a,Ne=o,Fe=t,Ye=l,qe=f("tooltip");return k(),b("div",null,[h(fe)?(k(),b("div",G,[w(m)])):(k(),b("div",K,[C("div",R,[w(v,{icon:"feather:search"},{default:g((()=>[x(C("input",{"onUpdate:modelValue":c[0]||(c[0]=e=>A(ge)?ge.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[P,h(ge)]])])),_:1}),C("div",null,[w(_,{color:"primary",onClick:c[1]||(c[1]=e=>be.value=!h(be)),icon:"fas fa-plus"},{default:g((()=>[S("Lead Proposal ")])),_:1}),E.leadId?(k(),I(_,{key:0,color:"warning",class:"ml-2",onClick:c[2]||(c[2]=e=>{Ce.value=!0}),icon:"fas fa-cogs"},{default:g((()=>[S("Proposals")])),_:1})):O("",!0)])]),C("div",W,[h(Oe).length>0&&h(ke).length>0?(k(),I(ve,{key:0,data:h(Oe),columns:Ie,rounded:""},{body:g((()=>[w(M,{name:"list",tag:"div",class:"flex-list-inner"},{default:g((()=>[(k(!0),b(j,null,T(h(Oe),(e=>(k(),b("div",{key:e.id,class:"flex-table-item"},[w(y,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>$e(e.id)},{default:g((()=>[x((k(),b("div",null,[C("span",X,$(e.title),1),C("span",J,[C("span",null,[Q,S($(h(F)(e.created_at)),1)])])])),[[qe,`${e.title}`,void 0,{rounded:!0,light:!0}]])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:g((()=>[w(H,{rounded:"",color:h(Y)[e.type]},{default:g((()=>[S($(h(q)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:g((()=>[w(H,{class:"capitalized",rounded:"",color:h(z)[e.status]},{default:g((()=>[S($(h(B)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id),column:{media:!0}},{default:g((()=>[C("div",null,[C("span",Z,"$"+$(e.proposalAmount),1),C("span",ee,$(e.payment_status),1)])])),_:2},1032,["onClick"]),w(y,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:g((()=>[w(H,{color:"purple",outlined:""},{default:g((()=>[S($(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),w(y,{column:{align:"end"}},{default:g((()=>[w(N,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:g((()=>[C("a",{role:"menuitem",onClick:a=>{return l=e.id,he.value=l,void(be.value=!0);var l},class:"dropdown-item is-media"},le,8,ae),C("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Te.value=l,void(je.value=!je.value);var l},class:"dropdown-item is-media"},se,8,te),"approved"==e.status?(k(),b("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,he.value=l,void(we.value=!0);var l},class:"dropdown-item is-media"},ie,8,oe)):O("",!0),ne,"approved"!=e.status?(k(),b("a",{key:1,role:"menuitem",onClick:a=>(async(e,a)=>{try{await _e.patch(`/api/lead-proposal/${a}/`,{status:e}),ye.success(`You have ${e} this proposal.`),"approved"==e&&D("updateCompany",null),Ue()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},de,8,re)):O("",!0),C("a",{role:"menuitem",onClick:a=>{return l=e.id,xe.value=l,void(Pe.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},ue,8,pe)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):O("",!0),h(ke).length<1&&0==h(Oe).length?(k(),I(Ve,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:g((()=>[ce,me])),_:1})):O("",!0)]),h(we)?(k(),I(De,{key:0,createProposalTasksModal:h(we),proposalId:h(he),onCloseModalHandler:c[3]||(c[3]=e=>we.value=!1),"onUpdate:OnSuccess":Ue},null,8,["createProposalTasksModal","proposalId"])):O("",!0),h(be)?(k(),I(Ee,{key:1,leadId:E.leadId,proposalId:h(he),leadProposalModal:h(be),"onUpdate:modalHandler":c[4]||(c[4]=e=>be.value=!1),"onUpdate:OnSuccess":Ue,onClearProposalId:c[5]||(c[5]=e=>he.value="")},null,8,["leadId","proposalId","leadProposalModal"])):O("",!0),h(je)?(k(),I(He,{key:2,"preview-modal":h(je),proposalId:h(Te),"onUpdate:modalHandler":c[6]||(c[6]=e=>je.value=!1)},null,8,["preview-modal","proposalId"])):O("",!0),h(Me)?(k(),I(Ne,{key:3,costItemModal:h(Me),proposalId:h(Le),"onUpdate:modalHandler":c[7]||(c[7]=e=>Me.value=!1),"onUpdate:OnSuccess":Ue},null,8,["costItemModal","proposalId"])):O("",!0),h(Pe).isSweetAlertOpen?(k(),I(Fe,{key:4,isSweetAlertOpen:h(Pe).isSweetAlertOpen,title:h(Pe).title,subtitle:h(Pe).subtitle,btntext:h(Pe).btntext,onConfirm:Se,onCancel:()=>h(Pe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):O("",!0),h(Ae).isSweetAlertOpen?(k(),I(Fe,{key:5,isSweetAlertOpen:h(Ae).isSweetAlertOpen,title:h(Ae).title,subtitle:h(Ae).subtitle,btntext:h(Ae).btntext,onConfirm:Se,onCancel:()=>h(Ae).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):O("",!0),h(Ce)?(k(),I(Ye,{key:6,leadProposalListModal:h(Ce),leadID:E.leadId,"group-proposal-modal":h(Ce),"onUpdate:modalHandler":c[8]||(c[8]=e=>Ce.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):O("",!0)]))])}}});export{ve as _};
