import{X as t,Y as e,Z as i,$ as s,a0 as n,a1 as r,a2 as o,a3 as l,a4 as a,a5 as h,a6 as c,a7 as d,a8 as g,a9 as u,aa as p,ab as v,ac as E,ad as m,ae as S,af as f,ag as D,ah as w,ai as y,aj as T,ak as b,al as M,am as R,an as C,ao as L,ap as P,aq as I,ar as j,as as x,at as H,au as A,av as Y,aw as X,ax as N,ay as V,az as U,aA as _,aB as O,aC as W,aD as q,aE as z,aF as F}from"./index-94ad6ab7.js";R.touchMouseIgnoreWait=500;let k=0,G=0,B=!1;class Z{constructor(t){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&function(t){return 0===t.button&&!t.ctrlKey}(t)&&this.tryStart(t)){let e=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",e),this.initScrollWatch(e),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let e=this.createEventFromMouse(t);this.recordCoords(e),this.emitter.trigger("pointermove",e)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let e=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",e),this.initScrollWatch(e);let i=t.target;this.shouldIgnoreMove||i.addEventListener("touchmove",this.handleTouchMove),i.addEventListener("touchend",this.handleTouchEnd),i.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let e=this.createEventFromTouch(t);this.recordCoords(e),this.emitter.trigger("pointermove",e)},this.handleTouchEnd=t=>{if(this.isDragging){let e=t.target;e.removeEventListener("touchmove",this.handleTouchMove),e.removeEventListener("touchend",this.handleTouchEnd),e.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,k+=1,setTimeout((()=>{k-=1}),R.touchMouseIgnoreWait)}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let e=window.scrollX-this.prevScrollX+this.prevPageX,i=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:e,pageY:i,deltaX:e-this.origPageX,deltaY:i-this.origPageY})}},this.containerEl=t,this.emitter=new C,t.addEventListener("mousedown",this.handleMouseDown),t.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),G+=1,1===G&&window.addEventListener("touchmove",Q,{passive:!1})}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),G-=1,G||window.removeEventListener("touchmove",Q,{passive:!1})}tryStart(t){let e=this.querySubjectEl(t),i=t.target;return!(!e||this.handleSelector&&!p(i,this.handleSelector))&&(this.subjectEl=e,this.isDragging=!0,this.wasTouchScroll=!1,!0)}cleanup(){B=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(t){return this.selector?p(t.target,this.selector):this.containerEl}shouldIgnoreMouse(){return k||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(B=!0)}initScrollWatch(t){this.shouldWatchScroll&&(this.recordCoords(t),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(t){this.shouldWatchScroll&&(this.prevPageX=t.pageX,this.prevPageY=t.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(t,e){let i=0,s=0;return e?(this.origPageX=t.pageX,this.origPageY=t.pageY):(i=t.pageX-this.origPageX,s=t.pageY-this.origPageY),{origEvent:t,isTouch:!1,subjectEl:this.subjectEl,pageX:t.pageX,pageY:t.pageY,deltaX:i,deltaY:s}}createEventFromTouch(t,e){let i,s,n=t.touches,r=0,o=0;return n&&n.length?(i=n[0].pageX,s=n[0].pageY):(i=t.pageX,s=t.pageY),e?(this.origPageX=i,this.origPageY=s):(r=i-this.origPageX,o=s-this.origPageY),{origEvent:t,isTouch:!0,subjectEl:this.subjectEl,pageX:i,pageY:s,deltaX:r,deltaY:o}}}function Q(t){B&&t.preventDefault()}class K{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(t,e,i){this.sourceEl=t,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=e-window.scrollX,this.origScreenY=i-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(t,e){this.deltaX=t-window.scrollX-this.origScreenX,this.deltaY=e-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(t){t?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=t,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=t)}stop(t,e){let i=()=>{this.cleanup(),e()};t&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(i,this.revertDuration):setTimeout(i,0)}doRevertAnimation(t,e){let i=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();i.style.transition="top "+e+"ms,left "+e+"ms",L(i,{left:s.left,top:s.top}),P(i,(()=>{i.style.transition="",t()}))}cleanup(){this.mirrorEl&&(I(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&L(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let t=this.sourceElRect,e=this.mirrorEl;return e||(e=this.mirrorEl=this.sourceEl.cloneNode(!0),e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.pointerEvents="none",e.classList.add("fc-event-dragging"),L(e,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:t.right-t.left,height:t.bottom-t.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(e)),e}}class $ extends q{constructor(t,e){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=t,this.doesListening=e,this.scrollTop=this.origScrollTop=t.getScrollTop(),this.scrollLeft=this.origScrollLeft=t.getScrollLeft(),this.scrollWidth=t.getScrollWidth(),this.scrollHeight=t.getScrollHeight(),this.clientWidth=t.getClientWidth(),this.clientHeight=t.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(t){this.scrollController.setScrollTop(t),this.doesListening||(this.scrollTop=Math.max(Math.min(t,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(t){this.scrollController.setScrollLeft(t),this.doesListening||(this.scrollLeft=Math.max(Math.min(t,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}}class J extends ${constructor(t,e){super(new _(t),e)}getEventTarget(){return this.scrollController.el}computeClientRect(){return O(this.scrollController.el)}}class tt extends ${constructor(t){super(new W,t)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}}const et="function"==typeof performance?performance.now:Date.now;class it{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let t=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(t){let e=et();this.handleSide(t,(e-this.msSinceRequest)/1e3),this.requestAnimation(e)}else this.isAnimating=!1}}}start(t,e,i){this.isEnabled&&(this.scrollCaches=this.buildCaches(i),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(t,e))}handleMove(t,e){if(this.isEnabled){let i=t-window.scrollX,s=e-window.scrollY,n=null===this.pointerScreenY?0:s-this.pointerScreenY,r=null===this.pointerScreenX?0:i-this.pointerScreenX;n<0?this.everMovedUp=!0:n>0&&(this.everMovedDown=!0),r<0?this.everMovedLeft=!0:r>0&&(this.everMovedRight=!0),this.pointerScreenX=i,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(et()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let t of this.scrollCaches)t.destroy();this.scrollCaches=null}}requestAnimation(t){this.msSinceRequest=t,requestAnimationFrame(this.animate)}handleSide(t,e){let{scrollCache:i}=t,{edgeThreshold:s}=this,n=s-t.distance,r=n*n/(s*s)*this.maxVelocity*e,o=1;switch(t.name){case"left":o=-1;case"right":i.setScrollLeft(i.getScrollLeft()+r*o);break;case"top":o=-1;case"bottom":i.setScrollTop(i.getScrollTop()+r*o)}}computeBestEdge(t,e){let{edgeThreshold:i}=this,s=null,n=this.scrollCaches||[];for(let r of n){let n=r.clientRect,o=t-n.left,l=n.right-t,a=e-n.top,h=n.bottom-e;o>=0&&l>=0&&a>=0&&h>=0&&(a<=i&&this.everMovedUp&&r.canScrollUp()&&(!s||s.distance>a)&&(s={scrollCache:r,name:"top",distance:a}),h<=i&&this.everMovedDown&&r.canScrollDown()&&(!s||s.distance>h)&&(s={scrollCache:r,name:"bottom",distance:h}),o<=i&&this.everMovedLeft&&r.canScrollLeft()&&(!s||s.distance>o)&&(s={scrollCache:r,name:"left",distance:o}),l<=i&&this.everMovedRight&&r.canScrollRight()&&(!s||s.distance>l)&&(s={scrollCache:r,name:"right",distance:l}))}return s}buildCaches(t){return this.queryScrollEls(t).map((t=>t===window?new tt(!1):new J(t,!1)))}queryScrollEls(t){let e=[];for(let i of this.scrollQuery)"object"==typeof i?e.push(i):e.push(...Array.prototype.slice.call(t.getRootNode().querySelectorAll(i)));return e}}class st extends e{constructor(t,e){super(t),this.containerEl=t,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=t=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,i(document.body),s(document.body),t.isTouch||t.origEvent.preventDefault(),this.emitter.trigger("pointerdown",t),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(t.subjectEl,t.pageX,t.pageY),this.startDelay(t),this.minDistance||this.handleDistanceSurpassed(t)))},this.onPointerMove=t=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",t),!this.isDistanceSurpassed){let e,i=this.minDistance,{deltaX:s,deltaY:n}=t;e=s*s+n*n,e>=i*i&&this.handleDistanceSurpassed(t)}this.isDragging&&("scroll"!==t.origEvent.type&&(this.mirror.handleMove(t.pageX,t.pageY),this.autoScroller.handleMove(t.pageX,t.pageY)),this.emitter.trigger("dragmove",t))}},this.onPointerUp=t=>{this.isInteracting&&(this.isInteracting=!1,n(document.body),r(document.body),this.emitter.trigger("pointerup",t),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(t)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let o=this.pointer=new Z(t);o.emitter.on("pointerdown",this.onPointerDown),o.emitter.on("pointermove",this.onPointerMove),o.emitter.on("pointerup",this.onPointerUp),e&&(o.selector=e),this.mirror=new K,this.autoScroller=new it}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(t){"number"==typeof this.delay?this.delayTimeoutId=setTimeout((()=>{this.delayTimeoutId=null,this.handleDelayEnd(t)}),this.delay):this.handleDelayEnd(t)}handleDelayEnd(t){this.isDelayEnded=!0,this.tryStartDrag(t)}handleDistanceSurpassed(t){this.isDistanceSurpassed=!0,this.tryStartDrag(t)}tryStartDrag(t){this.isDelayEnded&&this.isDistanceSurpassed&&(this.pointer.wasTouchScroll&&!this.touchScrollAllowed||(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(t.pageX,t.pageY,this.containerEl),this.emitter.trigger("dragstart",t),!1===this.touchScrollAllowed&&this.pointer.cancelTouchScroll()))}tryStopDrag(t){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,t))}stopDrag(t){this.isDragging=!1,this.emitter.trigger("dragend",t)}setIgnoreMove(t){this.pointer.shouldIgnoreMove=t}setMirrorIsVisible(t){this.mirror.setIsVisible(t)}setMirrorNeedsRevert(t){this.mirrorNeedsRevert=t}setAutoScrollEnabled(t){this.autoScroller.isEnabled=t}}class nt{constructor(t){this.el=t,this.origRect=j(t),this.scrollCaches=z(t).map((t=>new J(t,!0)))}destroy(){for(let t of this.scrollCaches)t.destroy()}computeLeft(){let t=this.origRect.left;for(let e of this.scrollCaches)t+=e.origScrollLeft-e.getScrollLeft();return t}computeTop(){let t=this.origRect.top;for(let e of this.scrollCaches)t+=e.origScrollTop-e.getScrollTop();return t}isWithinClipping(t,e){let i={left:t,top:e};for(let s of this.scrollCaches)if(!rt(s.getEventTarget())&&!F(i,s.clientRect))return!1;return!0}}function rt(t){let e=t.tagName;return"HTML"===e||"BODY"===e}class ot{constructor(t,e){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=t=>{let{dragging:e}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(t),this.initialHit||!this.requireInitial?(e.setIgnoreMove(!1),this.emitter.trigger("pointerdown",t)):e.setIgnoreMove(!0)},this.handleDragStart=t=>{this.emitter.trigger("dragstart",t),this.handleMove(t,!0)},this.handleDragMove=t=>{this.emitter.trigger("dragmove",t),this.handleMove(t)},this.handlePointerUp=t=>{this.releaseHits(),this.emitter.trigger("pointerup",t)},this.handleDragEnd=t=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,t),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",t)},this.droppableStore=e,t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragstart",this.handleDragStart),t.emitter.on("dragmove",this.handleDragMove),t.emitter.on("pointerup",this.handlePointerUp),t.emitter.on("dragend",this.handleDragEnd),this.dragging=t,this.emitter=new C}processFirstCoord(t){let e,i={left:t.pageX,top:t.pageY},s=i,n=t.subjectEl;n instanceof HTMLElement&&(e=j(n),s=x(s,e));let r=this.initialHit=this.queryHitForOffset(s.left,s.top);if(r){if(this.useSubjectCenter&&e){let t=H(e,r.rect);t&&(s=A(t))}this.coordAdjust=Y(s,i)}else this.coordAdjust={left:0,top:0}}handleMove(t,e){let i=this.queryHitForOffset(t.pageX+this.coordAdjust.left,t.pageY+this.coordAdjust.top);!e&&lt(this.movingHit,i)||(this.movingHit=i,this.emitter.trigger("hitupdate",i,!1,t))}prepareHits(){this.offsetTrackers=X(this.droppableStore,(t=>(t.component.prepareHits(),new nt(t.el))))}releaseHits(){let{offsetTrackers:t}=this;for(let e in t)t[e].destroy();this.offsetTrackers={}}queryHitForOffset(t,e){let{droppableStore:i,offsetTrackers:s}=this,n=null;for(let r in i){let o=i[r].component,l=s[r];if(l&&l.isWithinClipping(t,e)){let i=l.computeLeft(),s=l.computeTop(),a=t-i,h=e-s,{origRect:c}=l,d=c.right-c.left,g=c.bottom-c.top;if(a>=0&&a<d&&h>=0&&h<g){let t=o.queryHit(a,h,d,g);t&&N(t.dateProfile.activeRange,t.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(a+i-window.scrollX,h+s-window.scrollY)))&&(!n||t.layer>n.layer)&&(t.componentId=r,t.context=o.context,t.rect.left+=i,t.rect.right+=i,t.rect.top+=s,t.rect.bottom+=s,n=t)}}}return n}}function lt(t,e){return!t&&!e||Boolean(t)===Boolean(e)&&V(t.dateSpan,e.dateSpan)}function at(t,e){let i={};for(let r of e.pluginHooks.datePointTransforms)Object.assign(i,r(t,e));var s,n;return Object.assign(i,(s=t,{date:(n=e.dateEnv).toDate(s.range.start),dateStr:n.formatIso(s.range.start,{omitTime:s.allDay}),allDay:s.allDay})),i}class ht extends o{constructor(t){super(t),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=t=>{let e=t.origEvent.target,{component:i,dragging:s}=this,{mirror:n}=s,{options:r}=i.context,o=i.context;this.subjectEl=t.subjectEl;let l=this.subjectSeg=g(t.subjectEl),a=(this.eventRange=l.eventRange).instance.instanceId;this.relevantEvents=u(o.getCurrentData().eventStore,a),s.minDistance=t.isTouch?0:r.eventDragMinDistance,s.delay=t.isTouch&&a!==i.props.eventSelection?function(t){let{options:e}=t.context,i=e.eventLongPressDelay;null==i&&(i=e.longPressDelay);return i}(i):null,r.fixedMirrorParent?n.parentNode=r.fixedMirrorParent:n.parentNode=p(e,".fc"),n.revertDuration=r.dragRevertDuration;let h=i.isValidSegDownEl(e)&&!p(e,".fc-event-resizer");s.setIgnoreMove(!h),this.isDragging=h&&t.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=t=>{let e=this.component.context,i=this.eventRange,s=i.instance.instanceId;t.isTouch?s!==this.component.props.eventSelection&&e.dispatch({type:"SELECT_EVENT",eventInstanceId:s}):e.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(e.calendarApi.unselect(t),e.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new v(e,i.def,i.instance),jsEvent:t.origEvent,view:e.viewApi}))},this.handleHitUpdate=(t,e)=>{if(!this.isDragging)return;let i=this.relevantEvents,s=this.hitDragging.initialHit,n=this.component.context,r=null,o=null,l=null,a=!1,d={affectedEvents:i,mutatedEvents:S(),isEvent:!0};if(t){r=t.context;let e=r.options;n===r||e.editable&&e.droppable?(o=function(t,e,i,s){let n=t.dateSpan,r=e.dateSpan,o=n.range.start,l=r.range.start,a={};n.allDay!==r.allDay&&(a.allDay=r.allDay,a.hasEnd=e.context.options.allDayMaintainDuration,o=r.allDay?w(i):i);let h=y(o,l,t.context.dateEnv,t.componentId===e.componentId?t.largeUnit:null);h.milliseconds&&(a.allDay=!1);let c={datesDelta:h,standardProps:a};for(let d of s)d(c,t,e);return c}(s,t,this.eventRange.instance.range.start,r.getCurrentData().pluginHooks.eventDragMutationMassagers),o&&(l=E(i,r.getCurrentData().eventUiBases,o,r),d.mutatedEvents=l,m(d,t.dateProfile,r)||(a=!0,o=null,l=null,d.mutatedEvents=S()))):r=null}this.displayDrag(r,d),a?c():h(),e||(n===r&&lt(s,t)&&(o=null),this.dragging.setMirrorNeedsRevert(!o),this.dragging.setMirrorIsVisible(!t||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=r,this.validMutation=o,this.mutatedRelevantEvents=l)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=t=>{if(this.isDragging){let e=this.component.context,i=e.viewApi,{receivingContext:s,validMutation:n}=this,r=this.eventRange.def,o=this.eventRange.instance,l=new v(e,r,o),a=this.relevantEvents,h=this.mutatedRelevantEvents,{finalHit:c}=this.hitDragging;if(this.clearDrag(),e.emitter.trigger("eventDragStop",{el:this.subjectEl,event:l,jsEvent:t.origEvent,view:i}),n){if(s===e){let s=new v(e,h.defs[r.defId],o?h.instances[o.instanceId]:null);e.dispatch({type:"MERGE_EVENTS",eventStore:h});let c={oldEvent:l,event:s,relatedEvents:f(h,e,o),revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:a})}},d={};for(let t of e.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(d,t(n,e));e.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},c),d),{el:t.subjectEl,delta:n.datesDelta,jsEvent:t.origEvent,view:i})),e.emitter.trigger("eventChange",c)}else if(s){let n={event:l,relatedEvents:f(a,e,o),revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:a})}};e.emitter.trigger("eventLeave",Object.assign(Object.assign({},n),{draggedEl:t.subjectEl,view:i})),e.dispatch({type:"REMOVE_EVENTS",eventStore:a}),e.emitter.trigger("eventRemove",n);let d=h.defs[r.defId],g=h.instances[o.instanceId],u=new v(s,d,g);s.dispatch({type:"MERGE_EVENTS",eventStore:h});let p={event:u,relatedEvents:f(h,s,g),revert(){s.dispatch({type:"REMOVE_EVENTS",eventStore:h})}};s.emitter.trigger("eventAdd",p),t.isTouch&&s.dispatch({type:"SELECT_EVENT",eventInstanceId:o.instanceId}),s.emitter.trigger("drop",Object.assign(Object.assign({},at(c.dateSpan,s)),{draggedEl:t.subjectEl,jsEvent:t.origEvent,view:c.context.viewApi})),s.emitter.trigger("eventReceive",Object.assign(Object.assign({},p),{draggedEl:t.subjectEl,view:c.context.viewApi}))}}else e.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:e}=this,{options:i}=e.context,s=this.dragging=new st(t.el);s.pointer.selector=ht.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=i.dragScroll;let n=this.hitDragging=new ot(this.dragging,D);n.useSubjectCenter=t.useEventCenter,n.emitter.on("pointerdown",this.handlePointerDown),n.emitter.on("dragstart",this.handleDragStart),n.emitter.on("hitupdate",this.handleHitUpdate),n.emitter.on("pointerup",this.handlePointerUp),n.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(t,e){let i=this.component.context,s=this.receivingContext;s&&s!==t&&(s===i?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:e.affectedEvents,mutatedEvents:S(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),t&&t.dispatch({type:"SET_EVENT_DRAG",state:e})}clearDrag(){let t=this.component.context,{receivingContext:e}=this;e&&e.dispatch({type:"UNSET_EVENT_DRAG"}),t!==e&&t.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}}ht.SELECTOR=".fc-event-draggable, .fc-event-resizable";const ct={fixedMirrorParent:M},dt={dateClick:M,eventDragStart:M,eventDragStop:M,eventDrop:M,eventResizeStart:M,eventResizeStop:M,eventResize:M,drop:M,eventReceive:M,eventLeave:M};R.dataAttrPrefix="";var gt=t({name:"@fullcalendar/interaction",componentInteractions:[class extends o{constructor(t){super(t),this.handlePointerDown=t=>{let{dragging:e}=this,i=t.origEvent.target;e.setIgnoreMove(!this.component.isValidDateDownEl(i))},this.handleDragEnd=t=>{let{component:e}=this,{pointer:i}=this.dragging;if(!i.wasTouchScroll){let{initialHit:i,finalHit:s}=this.hitDragging;if(i&&s&&lt(i,s)){let{context:s}=e,n=Object.assign(Object.assign({},at(i.dateSpan,s)),{dayEl:i.dayEl,jsEvent:t.origEvent,view:s.viewApi||s.calendarApi.view});s.emitter.trigger("dateClick",n)}}},this.dragging=new st(t.el),this.dragging.autoScroller.isEnabled=!1;let e=this.hitDragging=new ot(this.dragging,l(t));e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},class extends o{constructor(t){super(t),this.dragSelection=null,this.handlePointerDown=t=>{let{component:e,dragging:i}=this,{options:s}=e.context,n=s.selectable&&e.isValidDateDownEl(t.origEvent.target);i.setIgnoreMove(!n),i.delay=t.isTouch?function(t){let{options:e}=t.context,i=e.selectLongPressDelay;null==i&&(i=e.longPressDelay);return i}(e):null},this.handleDragStart=t=>{this.component.context.calendarApi.unselect(t)},this.handleHitUpdate=(t,e)=>{let{context:i}=this.component,s=null,n=!1;if(t){let e=this.hitDragging.initialHit;t.componentId===e.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(e,t)||(s=function(t,e,i){let s=t.dateSpan,n=e.dateSpan,r=[s.range.start,s.range.end,n.range.start,n.range.end];r.sort(U);let o={};for(let l of i){let i=l(t,e);if(!1===i)return null;i&&Object.assign(o,i)}return o.range={start:r[0],end:r[3]},o.allDay=s.allDay,o}(e,t,i.pluginHooks.dateSelectionTransformers)),s&&a(s,t.dateProfile,i)||(n=!0,s=null)}s?i.dispatch({type:"SELECT_DATES",selection:s}):e||i.dispatch({type:"UNSELECT_DATES"}),n?c():h(),e||(this.dragSelection=s)},this.handlePointerUp=t=>{this.dragSelection&&(d(this.dragSelection,t,this.component.context),this.dragSelection=null)};let{component:e}=t,{options:i}=e.context,s=this.dragging=new st(t.el);s.touchScrollAllowed=!1,s.minDistance=i.selectMinDistance||0,s.autoScroller.isEnabled=i.dragScroll;let n=this.hitDragging=new ot(this.dragging,l(t));n.emitter.on("pointerdown",this.handlePointerDown),n.emitter.on("dragstart",this.handleDragStart),n.emitter.on("hitupdate",this.handleHitUpdate),n.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}},ht,class extends o{constructor(t){super(t),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=t=>{let{component:e}=this,i=this.querySegEl(t),s=g(i),n=this.eventRange=s.eventRange;this.dragging.minDistance=e.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(t.origEvent.target)||t.isTouch&&this.component.props.eventSelection!==n.instance.instanceId)},this.handleDragStart=t=>{let{context:e}=this.component,i=this.eventRange;this.relevantEvents=u(e.getCurrentData().eventStore,this.eventRange.instance.instanceId);let s=this.querySegEl(t);this.draggingSegEl=s,this.draggingSeg=g(s),e.calendarApi.unselect(),e.emitter.trigger("eventResizeStart",{el:s,event:new v(e,i.def,i.instance),jsEvent:t.origEvent,view:e.viewApi})},this.handleHitUpdate=(t,e,i)=>{let{context:s}=this.component,n=this.relevantEvents,r=this.hitDragging.initialHit,o=this.eventRange.instance,l=null,a=null,d=!1,g={affectedEvents:n,mutatedEvents:S(),isEvent:!0};if(t){t.componentId===r.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(r,t)||(l=function(t,e,i,s){let n=t.context.dateEnv,r=t.dateSpan.range.start,o=e.dateSpan.range.start,l=y(r,o,n,t.largeUnit);if(i){if(n.add(s.start,l)<s.end)return{startDelta:l}}else if(n.add(s.end,l)>s.start)return{endDelta:l};return null}(r,t,i.subjectEl.classList.contains("fc-event-resizer-start"),o.range))}l&&(a=E(n,s.getCurrentData().eventUiBases,l,s),g.mutatedEvents=a,m(g,t.dateProfile,s)||(d=!0,l=null,a=null,g.mutatedEvents=null)),a?s.dispatch({type:"SET_EVENT_RESIZE",state:g}):s.dispatch({type:"UNSET_EVENT_RESIZE"}),d?c():h(),e||(l&&lt(r,t)&&(l=null),this.validMutation=l,this.mutatedRelevantEvents=a)},this.handleDragEnd=t=>{let{context:e}=this.component,i=this.eventRange.def,s=this.eventRange.instance,n=new v(e,i,s),r=this.relevantEvents,o=this.mutatedRelevantEvents;if(e.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:n,jsEvent:t.origEvent,view:e.viewApi}),this.validMutation){let l=new v(e,o.defs[i.defId],s?o.instances[s.instanceId]:null);e.dispatch({type:"MERGE_EVENTS",eventStore:o});let a={oldEvent:n,event:l,relatedEvents:f(o,e,s),revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:r})}};e.emitter.trigger("eventResize",Object.assign(Object.assign({},a),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||T(0),endDelta:this.validMutation.endDelta||T(0),jsEvent:t.origEvent,view:e.viewApi})),e.emitter.trigger("eventChange",a)}else e.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:e}=t,i=this.dragging=new st(t.el);i.pointer.selector=".fc-event-resizer",i.touchScrollAllowed=!1,i.autoScroller.isEnabled=e.context.options.dragScroll;let s=this.hitDragging=new ot(this.dragging,l(t));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(t){return p(t.subjectEl,".fc-event")}}],calendarInteractions:[class{constructor(t){this.context=t,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=t=>{t.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=t=>{let e=this.context.options.unselectCancel,i=b(t.origEvent);this.matchesCancel=!!p(i,e),this.matchesEvent=!!p(i,ht.SELECTOR)},this.onDocumentPointerUp=t=>{let{context:e}=this,{documentPointer:i}=this,s=e.getCurrentData();if(!i.wasTouchScroll){if(s.dateSelection&&!this.isRecentPointerDateSelect){let i=e.options.unselectAuto;!i||i&&this.matchesCancel||e.calendarApi.unselect(t)}s.eventSelection&&!this.matchesEvent&&e.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let e=this.documentPointer=new Z(document);e.shouldIgnoreMove=!0,e.shouldWatchScroll=!1,e.emitter.on("pointerdown",this.onDocumentPointerDown),e.emitter.on("pointerup",this.onDocumentPointerUp),t.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}}],elementDraggingImpl:st,optionRefiners:ct,listenerRefiners:dt});export{gt as i};
