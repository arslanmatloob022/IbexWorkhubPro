import{f as e,r as l,o as a,C as t,O as s,G as o,F as i,K as r,J as n,P as p,S as d,s as u,y as c,x as m,e as _,_ as v,D as f,E as y,m as b,N as g,U as w,L as h,X as x,V,A as k}from"./index-862c6910.js";import{_ as C}from"./VModal.vue_vue_type_style_index_0_lang-90e78871.js";import{_ as S}from"./VField.vue_vue_type_script_setup_true_lang-569c5b4c.js";import{_ as I}from"./VControl-71abbcf8.js";import{_ as j}from"./VInput.vue_vue_type_script_setup_true_lang-af466cbf.js";import{u as T}from"./useAPI-cbabe7a5.js";import{u as A}from"./useNotyf-294077b6.js";import{u as O,_ as P,b as D,a as U,d as M}from"./CreateProposalTasksModal-ee3c748a.js";import{_ as N}from"./SweetAlert.vue_vue_type_style_index_0_lang-40a3ecda.js";import{_ as q}from"./VCollapse.vue_vue_type_style_index_0_lang-8bd0015a.js";import{_ as E}from"./VTextarea.vue_vue_type_script_setup_true_lang-6f8d3231.js";import{_ as H}from"./VRadio.vue_vue_type_style_index_0_lang-2264ad39.js";import{_ as L}from"./VMessage.vue_vue_type_style_index_0_lang-7cd2cd33.js";import{_ as $}from"./VDropdown.vue_vue_type_style_index_0_lang-b8ecc990.js";import{_ as F}from"./V-Snack.vue_vue_type_style_index_0_lang-90f84f37.js";import{a as z}from"./useSupportElement-dfe70baf.js";import{s as R}from"./costItems-b0b352f6.js";import{u as Y}from"./useDropdown-679a9ec7.js";import{u as G}from"./viewWrapper-4c674836.js";import"./VLabel.vue_vue_type_script_setup_true_lang-c4cc1925.js";import"./useVFieldContext-639de257.js";import"./notyf-998c25d4.js";import"./useThemeColors-0f4761e3.js";import"./VCheckbox.vue_vue_type_style_index_0_lang-8306bf74.js";import"./VOption.vue_vue_type_style_index_0_lang-84a60b47.js";import"./estimatesScripts-815abb30.js";import"./VAvatar.vue_vue_type_style_index_0_lang-ef53f4a7.js";import"./VIconButton-c29a530a.js";import"./company-b681a604.js";import"./VIcon.vue_vue_type_script_setup_true_lang-95477f97.js";const B=d(e({__name:"CreateTemplateModal",props:{openCreateTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const u=e,c=T(),m=A();l([]);const _=l(null);l(!1);const v=l(""),f=()=>{d("update:modalHandler",!1)},y=async()=>{console.log(_);try{await c.post(`/api/lead-proposal/${u.proposalId}/create-template/`,{title:v.value});m.success("Template Create successfully!"),f()}catch(e){console.error("Error importing template:",e),m.error("Something went wrong, try again")}};return a((()=>{})),(e,l)=>{const a=j,d=I,c=S,m=p,_=C;return t(),s(_,{open:u.openCreateTemplate,size:"small",is:"form",title:"Create Template",actions:"right",onSubmit:n(y,["prevent"]),onClose:f},{content:o((()=>[i(c,{label:"Enter title to identify your saved template"},{default:o((()=>[i(d,null,{default:o((()=>[i(a,{required:"",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),type:"text",placeholder:" Template Title"},null,8,["modelValue"])])),_:1})])),_:1})])),action:o((()=>[i(m,{color:"primary",type:"submit",raised:""},{default:o((()=>[r("Confirm")])),_:1})])),cancel:o((()=>[i(m,{color:"primary",style:{display:"none"},raised:""},{default:o((()=>[r("Close")])),_:1})])),_:1},8,["open","onSubmit"])}}}),[["__scopeId","data-v-3fb59420"]]),J={class:"modal-form columns is-multiline"},K={class:"column is-12 is-flex space-between align-items-center card mx-3"},X={class:"is-flex"},W=y("i",{class:"fas fa-check"},null,-1),Q=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-copy"})],-1),y("div",{class:"meta"},[y("span",null,"Create Template"),y("span",null,"Save as template for next use ")],-1)],Z=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-envelope"})],-1),y("div",{class:"meta"},[y("span",null,"Send Email"),y("span",null,"Send proposal email to the client ")],-1)],ee=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-cloud-download"})],-1),y("div",{class:"meta"},[y("span",null,"Download"),y("span",null,"Download proposal as pdf ")],-1)],le=y("hr",{class:"dropdown-divider"},null,-1),ae=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-trash"})],-1),y("div",{class:"meta"},[y("span",null,"Delete "),y("span",null,"Delete proposal permanently ")],-1)],te={key:0,class:"column is-12"},se={class:"field column is-6 mb-0"},oe=y("label",null,"Title: *",-1),ie={class:"control"},re={class:"column is-6"},ne={class:"field column is-6"},pe=y("label",null,"Approval Deadline *",-1),de={class:"control"},ue={class:"field column is-6"},ce=y("label",null,"Attachments",-1),me=y("div",{class:"file"},[y("label",{class:"file-label"},[y("input",{class:"file-input",type:"file",name:"resume"}),y("span",{class:"file-cta"},[y("span",{class:"file-icon"},[y("i",{class:"fas fa-cloud-upload-alt"})]),y("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),_e={class:"field column is-12"},ve={class:"body-inner-content"},fe={class:"field columns is-multiline mb-0"},ye={class:"field column is-11 mb-0"},be=y("label",{for:"",class:"label"},"Internal Notes",-1),ge={class:"field column is-11 mb-0"},we=y("label",{for:"",class:"label"},"Introductory Text",-1),he={class:"field column is-11 mb-0"},xe=y("label",{for:"",class:"label"},"Closing Text",-1),Ve={class:"column is-12"},ke=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:n}){const d=e,k=l();Y(k);const C=u(),j=O(),G=A(),ke=T(),Ce=c(),Se=m(),Ie=l(!1),je=l(""),Te=l(""),Ae=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Oe=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],Pe=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),De=l({id:"",title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",is_task_created:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),Ue=async()=>{try{const e=await ke.get(`/api/lead-proposal/${Ce.params.id}/detail/`);De.value=e.data,j.getProposalCostItems(Ce.params.id)}catch(e){console.log(e)}},Me=async()=>{try{Ie.value=!0,De.value.columns_to_show=JSON.stringify(R.value);const e=z(De.value,[]);if(d.proposalId||De.value.id){const l=await ke.patch(`/api/lead-proposal/${d.proposalId?d.proposalId:De.value.id}/`,e);De.value=l.data}G.success("Proposal updated successfully"),Ue()}catch(e){G.error("Something went wrong, try again")}finally{Ie.value=!1}},Ne=async()=>{try{Ie.value=!0;await ke.delete(`/api/lead-proposal/${Te.value}/`);Pe.value.isSweetAlertOpen=!1,G.success("Proposal delete successfully"),Se.go(-1)}catch(e){G.error(` ${e}, Proposal`),G.error("Something went wrong please try later")}finally{Ie.value=!1}},qe=async()=>{try{Ie.value=!0;await ke.patch(`/api/lead-proposal/${Ce.params.id}/`,{status:je.value});Ue(),G.success(`You have ${je.value} this proposal.`),Pe.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{Ie.value=!1}},Ee=l(!1),He=l("");l("worksheet");const Le=_((()=>v((()=>import("./ckeditor-66818352.js").then((e=>e.c))),["assets/ckeditor-66818352.js","assets/index-862c6910.js","assets/index-232429df.css","assets/vue.runtime.esm-bundler-275f4424.js"]).then((e=>e.default.component)))),$e={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},Fe=l(!1),ze=l([]),Re=l({}),Ye=l(!1),Ge=()=>{Re.value=j.leadProposalFormData,ze.value.push(j.leadProposalFormData),Ye.value=!Ye.value};return a((async()=>{C.value=await v((()=>import("./ckeditor-fdf4fbeb.js").then((e=>e.c))),["assets/ckeditor-fdf4fbeb.js","assets/index-862c6910.js","assets/index-232429df.css"]).then((e=>e.default)),(d.proposalId||Ce.params.id)&&(Ue(),j.getProposalDetail(d.proposalId||Ce.params.id))})),(e,l)=>{const a=F,n=p,u=$,c=L,m=H,_=I,v=S,k=E,j=q,T=P,A=N,O=D,z=U,R=B;return t(),f(V,null,[y("div",J,[y("div",K,[y("div",X,[b(De).is_task_created?(t(),s(a,{key:0,title:"Calendar Tasks Created ",white:"",class:"ml-2",color:"info",icon:"fas fa-calendar-check"})):g("",!0),"approved"!=b(De).status?(t(),s(n,{key:1,onClick:l[0]||(l[0]=e=>{return l="approved",je.value=l,void(Pe.value={title:`${je.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==je.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==je.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var l}),size:"small",class:"ml-2",light:"",outlined:"",color:"info",raised:""},{default:o((()=>[W,r(" Mark Approved ")])),_:1})):(t(),s(n,{key:2,light:"",size:"small",color:"primary",class:"ml-1 mt-1",icon:"fas fa-check-circle"},{default:o((()=>[r(" Approved ")])),_:1}))]),y("div",null,[b(De).is_task_created||"approved"!=b(De).status?g("",!0):(t(),s(n,{key:0,size:"small",class:"mr-2",light:"",outlined:"",color:"success",raised:"",onClick:l[1]||(l[1]=e=>{return l=b(Ce).params.id,He.value=l,void(Ee.value=!0);var l})},{default:o((()=>[r(" Generate Tasks ")])),_:1})),i(n,{onClick:Me,size:"small",class:"mr-2",light:"",outlined:"",color:"primary",raised:""},{default:o((()=>[r(" Update ")])),_:1}),i(u,{spaced:"",right:"",icon:"lucide:more-vertical"},{content:o((()=>[y("a",{onClick:l[2]||(l[2]=e=>Fe.value=!b(Fe)),class:"dropdown-item is-media"},Q),y("a",{onClick:Ge,class:"dropdown-item is-media"},Z),y("a",{onClick:l[3]||(l[3]=e=>b(M)(b(De))),class:"dropdown-item is-media"},ee),le,y("a",{onClick:l[4]||(l[4]=e=>{return l=b(De).id,Te.value=l,void(Ae.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),class:"dropdown-item is-media"},ae)])),_:1})])]),b(De).client_note&&"review"==b(De).status?(t(),f("div",te,[i(c,{color:"warning"},{default:o((()=>[r(w(b(De).client_note),1)])),_:1})])):g("",!0),y("div",se,[oe,y("div",ie,[h(y("input",{type:"text",name:"firstName","onUpdate:modelValue":l[5]||(l[5]=e=>b(De).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[x,b(De).title]])])]),y("div",re,[i(v,{class:"m-0 p-0",label:"Type"},{default:o((()=>[i(_,null,{default:o((()=>[i(m,{modelValue:b(De).type,"onUpdate:modelValue":l[6]||(l[6]=e=>b(De).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),i(m,{modelValue:b(De).type,"onUpdate:modelValue":l[7]||(l[7]=e=>b(De).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),i(m,{modelValue:b(De).type,"onUpdate:modelValue":l[8]||(l[8]=e=>b(De).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",ne,[pe,y("div",de,[h(y("input",{type:"date",name:"firstName","onUpdate:modelValue":l[9]||(l[9]=e=>b(De).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[x,b(De).approval_deadline]])])]),y("div",ue,[ce,i(v,{grouped:""},{default:o((()=>[i(_,null,{default:o((()=>[me])),_:1})])),_:1})]),y("div",_e,[i(j,{items:Oe,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":o((e=>[y("div",ve,[y("div",fe,[y("div",ye,[be,i(v,null,{default:o((()=>[i(_,null,{default:o((()=>[i(k,{modelValue:b(De).internalNotes,"onUpdate:modelValue":l[10]||(l[10]=e=>b(De).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",ge,[we,b(C)?(t(),s(b(Le),{key:0,modelValue:b(De).introductoryText,"onUpdate:modelValue":l[11]||(l[11]=e=>b(De).introductoryText=e),editor:b(C),config:$e},null,8,["modelValue","editor"])):g("",!0)]),y("div",he,[xe,b(C)?(t(),s(b(Le),{key:0,modelValue:b(De).closingText,"onUpdate:modelValue":l[12]||(l[12]=e=>b(De).closingText=e),editor:b(C),config:$e},null,8,["modelValue","editor"])):g("",!0)])])])])),_:1})]),y("div",Ve,[i(T,{proposalData:b(De),proposalId:b(De).id},null,8,["proposalData","proposalId"])]),b(Pe).isSweetAlertOpen?(t(),s(A,{key:1,isSweetAlertOpen:b(Pe).isSweetAlertOpen,title:b(Pe).title,subtitle:b(Pe).subtitle,btntext:b(Pe).btntext,onConfirm:qe,onCancel:()=>b(Pe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):g("",!0),b(Ae).isSweetAlertOpen?(t(),s(A,{key:2,isSweetAlertOpen:b(Ae).isSweetAlertOpen,title:b(Ae).title,subtitle:b(Ae).subtitle,btntext:b(Ae).btntext,onConfirm:Ne,onCancel:()=>b(Ae).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):g("",!0),b(Ee)?(t(),s(O,{key:3,createProposalTasksModal:b(Ee),proposalId:b(He),onCloseModalHandler:l[13]||(l[13]=e=>Ee.value=!1),"onUpdate:OnSuccess":l[14]||(l[14]=()=>{})},null,8,["createProposalTasksModal","proposalId"])):g("",!0),b(Ye)?(t(),s(z,{key:4,proposalSenderModal:b(Ye),selectedProposalsIds:b(ze),proposalData:b(Re),"onUpdate:modalHandler":l[15]||(l[15]=e=>{Ye.value=!1,ze.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData"])):g("",!0)]),b(Fe)?(t(),s(R,{key:0,proposalId:b(Ce).params.id,openCreateTemplate:b(Fe),"onUpdate:OnSuccess":l[16]||(l[16]=()=>{(d.proposalId||b(Ce).params.id)&&Ue()}),"onUpdate:modalHandler":l[17]||(l[17]=e=>Fe.value=!1)},null,8,["proposalId","openCreateTemplate"])):g("",!0)],64)}}}),Ce=e({__name:"[id]",setup:e=>(G().setPageTitle("Lead Proposals"),k({title:"Lead Proposals - Ibex"}),(e,l)=>(t(),f("div",null,[i(ke)])))});export{Ce as default};
