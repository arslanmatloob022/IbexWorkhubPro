import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-2bee2677.js";import{e as l,r as t,o as s,B as o,N as a,F as i,D as n,E as r,l as p,j as u,J as c,I as d,O as v,x as m,C as _,T as y,U as f,V as w,M as b}from"./index-70af507c.js";import{_ as h}from"./VField.vue_vue_type_script_setup_true_lang-f9f54325.js";import{_ as g}from"./VControl-a243656f.js";import{_ as x}from"./VTextarea.vue_vue_type_script_setup_true_lang-e812f757.js";import{u as C}from"./useNotyf-98b938b1.js";import{u as j}from"./useAPI-7526ffb5.js";import{_ as S}from"./SweetAlert.vue_vue_type_style_index_0_lang-d291204b.js";import{_ as k}from"./VAvatar.vue_vue_type_style_index_0_lang-f1d074f0.js";import{g as A,a as O}from"./costItems-db4736e1.js";import"./VLabel.vue_vue_type_script_setup_true_lang-cbf449a1.js";import"./useVFieldContext-cbf89cef.js";import"./notyf-09d30f13.js";import"./useThemeColors-7b5c93a7.js";import"./userSession-2550218b.js";const I={class:"columns is-multiline"},M={class:"column is-12"},T=l({__name:"ProposalReviewModal",props:{proposalReviewModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(l,{emit:m}){const _=l,y=C(),f=j(),w=t(""),b=t(!1),S=()=>{m("closeModalHandler",!1)},k=async()=>{try{b.value=!0;await f.patch(`/api/lead-proposal/${_.proposalId}/`,{client_note:w.value,status:"review"});y.success("Your review submitted on proposal."),S(),m("update:OnSuccess",null)}catch(e){console.log(e)}finally{b.value=!1}};return s((()=>{})),(l,t)=>{const s=x,m=g,y=h,f=v,C=e;return o(),a(C,{is:"form",open:_.proposalReviewModal,title:"Review Proposal",size:"small",actions:"center",onSubmit:d(k,["prevent"]),onClose:S},{content:i((()=>[n("div",I,[n("div",M,[r(y,{label:"Enter Review Notes"},{default:i((()=>[r(m,null,{default:i((()=>[r(s,{modelValue:p(w),"onUpdate:modelValue":t[0]||(t[0]=e=>u(w)?w.value=e:null),rows:"4",placeholder:"Enter Notes"},null,8,["modelValue"])])),_:1})])),_:1})])])])),cancel:i((()=>[r(f,{light:"",onClick:t[1]||(t[1]=e=>S())},{default:i((()=>[c("Cancel")])),_:1})])),action:i((()=>[r(f,{loading:p(b),type:"submit",color:"info",raised:""},{default:i((()=>[c("Submit Review")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),V={class:"columns is-multiline"},P={class:"column is-12 mt-4"},R={class:"invoice-wrapper"},N={class:"invoice-header"},$={class:"left"},q={class:"right"},H={class:"controls"},z={class:"invoice-body"},B={class:"invoice-card"},D={class:"invoice-section is-flex is-bordered"},E=n("div",{class:"meta"},null,-1),U=n("div",{class:"end"},[n("span",null,"PO Box 242"),n("span",null,"Evergreen, CO 80437-0242"),n("span",null,"Phone: 720 272-9061"),n("span",null,"Premium Trades for Premier Builders")],-1),Y={class:"invoice-section is-flex is-bordered"},F=n("div",{class:"meta"},[n("h3",null,"Client Name"),n("span",null,"Client Phone"),n("span",null,"25724 Independence Trail Evergreen, CO 80439")],-1),L={class:"end is-left"},J={key:0,class:"invoice-section"},W={class:"responsive-table"},G=["innerHTML"],K={key:1},Q={class:"invoice-section is-flex mt-0 pt-0"},X={class:"end is-left"},Z={class:"text-right"},ee=l({__name:"proposal-view",props:{previewModal:{type:Boolean},columnsToShow:{default:!1},proposalId:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:l}){const u=t(""),d=C(),h=m(),g=j(),x=t({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),I=t(!1),M=t(!1),ee=t({id:"",title:"",approval_deadline:"",internal_notes:null,introductory_text:null,closing_text:null,columns_to_show:[],payment_status:"",type:"",status:"",created_at:"",updated_at:"",job:""}),le=t([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]),te=e=>{u.value=e,x.value={title:`${u.value.toLocaleUpperCase()} proposal ?`,subtitle:""+("approve"==u.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site."),btntext:""+("approve"==u.value?"Approve":"Disapprove"),isSweetAlertOpen:!0}},se=async()=>{try{M.value=!0;await g.patch(`/api/lead-proposal/${h.query.proposal}/`,{status:u.value});d.success(`You have ${u.value} this proposal.`),x.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{M.value=!1}},oe=async()=>{try{const e=await g.get(`api/cost/by-proposal/${h.query.proposal}/`);le.value=e.data}catch(e){console.log(e)}};return s((()=>{h.query.proposal&&(async()=>{try{M.value=!0;const e=await g.get(`/api/lead-proposal/${h.query.proposal}/detail/`);ee.value=e.data,oe()}catch(e){console.log(e)}finally{M.value=!1}})()})),(e,l)=>{const t=v,s=k,u=S,d=T;return o(),_("div",V,[n("div",P,[n("div",R,[n("div",N,[n("div",$,[n("h3",null,"Proposal "+y(p(h).query.proposal?.slice(0,8)),1)]),n("div",q,[n("div",H,[r(t,{size:"xsmall",onClick:l[0]||(l[0]=e=>te("approve")),outlined:"",color:"primary"},{default:i((()=>[c("Approve")])),_:1}),r(t,{size:"xsmall",onClick:l[1]||(l[1]=e=>I.value=!p(I)),class:"ml-2",outlined:"",color:"info"},{default:i((()=>[c("Review")])),_:1}),r(t,{onClick:l[2]||(l[2]=e=>te("disapprove")),size:"xsmall",class:"ml-2",outlined:"",color:"danger"},{default:i((()=>[c("Disapprove")])),_:1})])])]),n("div",z,[n("div",B,[n("div",D,[r(s,{size:"xl",picture:"/logos/IbexFavicon.png"}),E,U]),n("div",Y,[F,n("div",L,[n("h3",null,"Job: "+y(p(ee).jobInfo?.title??"N/A"),1),n("p",null,"Address: "+y(p(ee).jobInfo?.address??"N/A"),1)])]),p(le).length?(o(),_("div",J,[n("table",W,[n("thead",null,[(o(!0),_(f,null,w(p(ee).columns_to_show,((e,l)=>(o(),_("th",{key:l},y(p(A)[e]),1)))),128))]),n("tbody",null,[(o(!0),_(f,null,w(p(le),((e,l)=>(o(),_("tr",{key:e.id},[(o(!0),_(f,null,w(p(ee).columns_to_show,((l,t)=>(o(),_("td",{key:t},["Description"===l?(o(),_("div",{key:0,innerHTML:e[p(O)[l]]},null,8,G)):(o(),_("span",K,y(e[p(O)[l]]),1))])))),128))])))),128))])])])):b("",!0),n("div",Q,[n("div",X,[n("h3",Z," Total Price: $"+y(p(ee).proposalAmount??0),1)])])])])])]),p(x).isSweetAlertOpen?(o(),a(u,{key:0,isSweetAlertOpen:p(x).isSweetAlertOpen,title:p(x).title,subtitle:p(x).subtitle,btntext:p(x).btntext,onConfirm:se,onCancel:()=>p(x).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),p(I)?(o(),a(d,{key:1,proposalReviewModal:p(I),proposalId:p(h).query.proposal,onCloseModalHandler:l[3]||(l[3]=e=>I.value=!1),"onUpdate:OnSuccess":l[4]||(l[4]=()=>{})},null,8,["proposalReviewModal","proposalId"])):b("",!0)])}}});export{ee as default};
