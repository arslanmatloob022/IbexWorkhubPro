import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-aa7b2f49.js";import{f as a,r as l,av as t,C as s,O as o,G as u,E as d,K as n,U as i,m as r,D as c,V as p,W as m,L as v,N as f,F as _,P as y,w as k,o as g,B as h,k as V,J as D}from"./index-e765c558.js";import{d as b,a as w}from"./useSupportElement-cdbf1490.js";import{_ as S}from"./VTextarea.vue_vue_type_script_setup_true_lang-0b53b5ef.js";import{_ as C,a as x}from"./VOption.vue_vue_type_style_index_0_lang-293a6ea2.js";import{_ as U}from"./VField.vue_vue_type_script_setup_true_lang-f163a2a8.js";import{_ as j}from"./VControl-920718a5.js";import{_ as I}from"./VInput.vue_vue_type_script_setup_true_lang-9f1677fe.js";import{_ as T}from"./VLabel.vue_vue_type_script_setup_true_lang-fee61721.js";import{u as L}from"./useAPI-5fce6564.js";import{u as O}from"./useNotyf-28a154f6.js";import{C as q}from"./estimatesScripts-cdb6fb79.js";const N={class:"heatmap-wrapper"},$={class:"heatmap-title"},A={class:"title-meta"},M={class:"primary-text"},H={class:"primary-text"},E={class:"heatmap-inner"},B={class:"heatmap-row"},F={class:"heatmap-row-label"},Q={class:"heatmap-row-content"},z={style:{position:"absolute","font-weight":"bold",top:"1px",right:"1px",color:"var(--primary)"}},G={key:0,class:"fas fa-exclamation-triangle text-warning warning-text","aria-hidden":"true"},J=a({__name:"WorkerTasksConflicts",props:{conflictsDetailModal:{type:Boolean},conflictData:{},startDate:{},endDate:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:k}){const g=a;l("info");const h=()=>{k("update:modalHandler",!0)};return(a,l)=>{const k=y,V=e,D=t("tooltip");return g.conflictsDetailModal?(s(),o(V,{key:0,open:g.conflictsDetailModal,title:"Conflicts Details",actions:"right",size:"big",onClose:h},{content:u((()=>[d("div",N,[d("div",$,[d("div",A,[d("p",null,[n(" Tasks found within given date range: "),d("span",M,i(r(b)(g.startDate)),1),n(" to "),d("span",H,i(r(b)(g.endDate)),1),n(". ")])])]),d("div",E,[(s(!0),c(p,null,m(g.conflictData?.map,(e=>(s(),c("div",B,[d("div",F,[d("span",null,i(e.month),1)]),d("div",Q,[(s(!0),c(p,null,m(e.dates,(a=>{return v((s(),c("div",{key:e.date,class:"heatmap-row-item is-relative"},[d("span",z,i(a.date.slice(8,10)),1),a.count?(s(),c("i",G)):f("",!0)])),[[D,(l=a.tasks,l&&0!==l.length?l.map((e=>e.title)).join("; "):"No tasks available"),void 0,{rounded:!0}]]);var l})),128))])])))),256))])])])),action:u((()=>[_(k,{style:{display:"none"},color:"primary",raised:""},{default:u((()=>[n(" Confirm ")])),_:1})])),cancel:u((()=>[_(k,{onClick:h,raised:""},{default:u((()=>[n(" Close ")])),_:1})])),_:1},8,["open"])):f("",!0)}}}),P={class:"modal-form columns is-multiline"},W={class:"field column is-6 mb-0"},K={class:"field column is-6 mb-0"},R=d("label",null,"Status ",-1),X={class:"field column is-6 mb-0"},Y={class:"field column is-6"},Z=d("label",null,"New Cost Code List *",-1),ee={class:"field column is-3 mb-0"},ae={class:"field column is-3 mb-0"},le={class:"field column is-3 mb-0"},te={class:"field column is-3 mb-0"},se={class:"field column is-6 mb-0"},oe=d("label",null,"Select workers * ",-1),ue=d("i",{class:"fas fa-exclamation-triangle ml-2","aria-hidden":"true"},null,-1),de={class:"field column is-6 mb-0"},ne=d("label",null,"Select Subcontractor * ",-1),ie={class:"field column is-6 mb-0"},re={class:"field column is-6 mb-0"},ce=a({__name:"UpdateTask",props:{isOpen:{type:Boolean,default:!1},taskIdSelected:{default:""},projectID:{default:""},endDate:{default:""},startDate:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:t}){const v=a,b=O(),N=L(),$=l([]),A=l([]),M=l(!1),H=l(!1);let E=l([]);l([]),l([]),l();const B=l({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",supplier:"",unit:"",costCode:"",color:"",project:"",priority:"",internalNotes:"",workers:[]});k(E.value,(()=>{console.log("data type",E)}));const F=async()=>{try{M.value=!0,B.value.workers=E.value;let e=w(B.value,["workers"]);v.taskIdSelected?(e.append("schedule_mode","false"),await N.patch(`/api/task/${B.value.id}/`,e),b.success("Task updated successfully"),t("update:OnSuccess",null)):(e.append("schedule_mode","false"),e.append("project",`${v.projectID}`),await N.post("/api/task/",e),t("update:OnSuccess",null),b.success("Task added successfully")),fe()}catch(e){console.log(e)}finally{M.value=!1}},Q=async()=>{try{H.value=!0;const e=await N.delete(`/api/task/${v.taskIdSelected}/`);console.log(e),b.error("Task deleted successfully"),fe(),t("update:OnSuccess",null)}catch(e){console.log(e)}finally{H.value=!1}},z=l({found_tasks:!1,map:[{month:"April 2025",found_task:!1,dates:[{date:"2025-04-15",count:0,tasks:[]}]}]}),G=l(!1),ce=async()=>{try{const e=await N.get(`/api/task/worker-wise-date-map/${E.value}/?start_date=${B.value.startDate}&end_date=${B.value.endDate}`);z.value=e.data}catch(e){console.log(e)}};k((()=>E.value),(()=>{ce()})),k((()=>B.value.endDate),(()=>{ce()}));const pe=l(!1),me=l([]),ve=l([]),fe=()=>{t("update:modalHandler",!1),console.log("modal closed")};return g((()=>{v.taskIdSelected&&(async()=>{try{M.value=!0;const e=await N.get(`/api/task/${v.taskIdSelected?v.taskIdSelected:""}/`);B.value=e.data,E.value=e.data.workers.map((e=>e.id))}catch(e){console.log(e)}finally{M.value=!1}})(),(async()=>{try{pe.value=!0;const e=await N.get("/api/cost-code/");me.value=e.data,ve.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{pe.value=!1}})(),(async()=>{try{M.value=!0;const e=await N.get("/api/users/by-role-option/worker/",{});$.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{M.value=!1}})(),(async()=>{try{M.value=!0;const e=await N.get("/api/users/by-role-option/supplier/",{});A.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{M.value=!1}})(),v.startDate&&(B.value.startDate=v.startDate,B.value.endDate=v.endDate)})),(a,l)=>{const t=T,k=I,g=j,b=U,w=C,L=x,O=h("Multiselect"),N=S,ce=J,pe=y,me=e;return s(),o(me,{is:"form",open:v.isOpen,title:v.taskIdSelected?"Update Task":"Add Task",size:"big",actions:"right",onSubmit:D(F,["prevent"]),onClose:fe},{content:u((()=>[d("div",P,[d("div",W,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("Title: *")])),_:1}),_(g,null,{default:u((()=>[_(k,{required:"",modelValue:B.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>B.value.title=e),type:"text",placeholder:M.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),d("div",K,[R,_(b,null,{default:u((()=>[_(g,null,{default:u((()=>[_(L,{modelValue:B.value.status,"onUpdate:modelValue":l[1]||(l[1]=e=>B.value.status=e),name:"status",class:"is-rounded"},{default:u((()=>[_(w,{value:""},{default:u((()=>[n("Select Status")])),_:1}),(s(!0),c(p,null,m(r(q),(e=>(s(),o(w,{key:e.value,value:e.value},{default:u((()=>[n(i(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),d("div",X,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("Cost Code: *")])),_:1}),_(g,null,{default:u((()=>[_(k,{required:"",type:"text",placeholder:M.value?"Loading...":"Cost code",modelValue:B.value.costCode,"onUpdate:modelValue":l[2]||(l[2]=e=>B.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",Y,[Z,_(b,null,{default:u((({id:e})=>[_(g,null,{default:u((()=>[_(O,{required:"",modelValue:B.value.costCode,"onUpdate:modelValue":l[3]||(l[3]=e=>B.value.costCode=e),attrs:{id:e},searchable:!0,options:ve.value,placeholder:"Select a cost code"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",ee,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("Quantity")])),_:1}),_(g,null,{default:u((()=>[_(k,{type:"text",placeholder:M.value?"Loading...":"Quantity",modelValue:B.value.quantity,"onUpdate:modelValue":l[4]||(l[4]=e=>B.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",ae,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("Unit")])),_:1}),_(g,null,{default:u((()=>[_(k,{type:"text",placeholder:M.value?"Loading...":"Unit",modelValue:B.value.unit,"onUpdate:modelValue":l[5]||(l[5]=e=>B.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",le,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("Start Date")])),_:1}),_(g,null,{default:u((()=>[_(k,{type:"date",placeholder:M.value?"Loading...":"Start date",modelValue:B.value.startDate,"onUpdate:modelValue":l[6]||(l[6]=e=>B.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",te,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("End Date")])),_:1}),_(g,null,{default:u((()=>[_(k,{type:"date",placeholder:M.value?"Loading...":"End date",modelValue:B.value.endDate,"onUpdate:modelValue":l[7]||(l[7]=e=>B.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",se,[oe,z.value.found_tasks?(s(),c("span",{key:0,onClick:l[8]||(l[8]=e=>G.value=!0),class:"warning-text cu-pointer"},[n(" Found Tasks Conflicts "),ue])):f("",!0),_(b,null,{default:u((({id:e})=>[_(g,null,{default:u((()=>[_(O,{modelValue:r(E),"onUpdate:modelValue":l[9]||(l[9]=e=>V(E)?E.value=e:E=e),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:$.value,placeholder:"Add workers"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",de,[ne,_(b,null,{default:u((({id:e})=>[_(g,null,{default:u((()=>[_(O,{modelValue:B.value.supplier,"onUpdate:modelValue":l[10]||(l[10]=e=>B.value.supplier=e),required:!r(E),attrs:{id:e},searchable:!0,"create-tag":!0,options:A.value,placeholder:"Add sub-contractor"},null,8,["modelValue","required","attrs","options"])])),_:2},1024)])),_:1})]),d("div",ie,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("Description")])),_:1}),_(g,null,{default:u((()=>[_(N,{type:"text",rows:"3",placeholder:M.value?"Loading...":"Description",modelValue:B.value.description,"onUpdate:modelValue":l[11]||(l[11]=e=>B.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",re,[_(b,null,{default:u((()=>[_(t,null,{default:u((()=>[n("Internal Notes")])),_:1}),_(g,null,{default:u((()=>[_(N,{type:"text",rows:"3",placeholder:M.value?"Loading...":"Internal notes",modelValue:B.value.internalNotes,"onUpdate:modelValue":l[12]||(l[12]=e=>B.value.internalNotes=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),G.value?(s(),o(ce,{key:0,"conflicts-detail-modal":G.value,"conflict-data":z.value,startDate:B.value.startDate,endDate:B.value.endDate,"onUpdate:modalHandler":l[13]||(l[13]=e=>G.value=!1)},null,8,["conflicts-detail-modal","conflict-data","startDate","endDate"])):f("",!0)])])),action:u((()=>[v.taskIdSelected?(s(),o(pe,{key:0,onClick:Q,class:"is-left",color:"danger",loading:H.value,raised:""},{default:u((()=>[n("Delete")])),_:1},8,["loading"])):f("",!0),_(pe,{type:"submit",loading:M.value,color:"primary",raised:""},{default:u((()=>[n(i(v.taskIdSelected?"Update Task":"Add Task"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{ce as _};
