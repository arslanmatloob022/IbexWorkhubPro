import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-ce475c66.js";import{_ as t}from"./UpdateTask.vue_vue_type_script_setup_true_lang-d6590534.js";import{_ as a}from"./VModal.vue_vue_type_style_index_0_lang-af9a4f1e.js";import{e as r,B as l,N as s,F as n,E as o,J as i,M as d,O as c,r as u,w as p,o as m,C as v,D as y,I as g,l as f,j as k,H as w,T as h,U as _,V as b,ak as x,P as j,Q as C,R as S}from"./index-86fab056.js";import{_ as D}from"./WorkerCalendar.vue_vue_type_style_index_0_lang-1b929e36.js";import{_ as I}from"./VDropdown.vue_vue_type_style_index_0_lang-e119356d.js";import{_ as T}from"./VField.vue_vue_type_script_setup_true_lang-4ef37df6.js";import{_ as A}from"./VControl-8c562cb9.js";import{_ as M}from"./VInput.vue_vue_type_script_setup_true_lang-b6eaa0a3.js";import{F as O}from"./FullCalendar-e727d385.js";import{i as P}from"./index-55eb4335.js";import{i as H}from"./index-37e62c97.js";import{u as U}from"./userSession-09643431.js";import{u as V}from"./useNotyf-9dd7962f.js";import{u as W}from"./useAPI-d883ee88.js";const F=r({__name:"WorkersTaskCalendarModal",props:{workerTasksModal:{type:Boolean},workerId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const r=e,u=()=>{t("update:modalHandler",!0)};return(e,t)=>{const p=D,m=c,v=a;return r.workerTasksModal?(l(),s(v,{key:0,open:r.workerTasksModal,title:"Task Info",actions:"right",size:"xl",onClose:u},{content:n((()=>[o(p,{workerId:r.workerId},null,8,["workerId"])])),action:n((()=>[o(m,{style:{display:"none"},color:"primary",raised:""},{default:n((()=>[i(" Confirm ")])),_:1})])),cancel:n((()=>[o(m,{onClick:u,raised:""},{default:n((()=>[i(" Close ")])),_:1})])),_:1},8,["open"])):d("",!0)}}}),Y=e=>(j("data-v-22ff5f23"),e=e(),C(),e),L=["onSubmit"],E={class:"datatable-toolbar"},z={key:0,class:"rota-loader"},N=[Y((()=>y("div",{class:"icon"},[y("i",{class:"lnil lnil-menu","aria-hidden":"true"})],-1))),Y((()=>y("div",{class:"meta"},[y("span",null,"All"),y("span",null,"All projects owned by company")],-1)))],R=[Y((()=>y("div",{class:"icon"},[y("i",{class:"lnil lnil-play","aria-hidden":"true"})],-1))),Y((()=>y("div",{class:"meta"},[y("span",null,"Active"),y("span",null,"Projects that are in progress")],-1)))],$=[Y((()=>y("div",{class:"icon"},[y("i",{class:"lnil lnil-alarm-clock","aria-hidden":"true"})],-1))),Y((()=>y("div",{class:"meta"},[y("span",null,"Pending"),y("span",null,"Projects listed but not started")],-1)))],B=Y((()=>y("hr",{class:"dropdown-divider"},null,-1))),J=[Y((()=>y("div",{class:"icon"},[y("i",{class:"lnil lnil-round-box-check","aria-hidden":"true"})],-1))),Y((()=>y("div",{class:"meta"},[y("span",null,"Completed"),y("span",null,"Projects that are done")],-1)))],K={style:{height:"100%",position:"relative"}},Q={key:0,style:{"font-weight":"500","margin-bottom":"0px",color:"black"}},q={key:1,style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},G=["onClick"],X={key:0,class:"avatars"},Z=["src","onClick","title","data-bs-original-title"],ee=["onClick","data-bs-original-title","title"],te=["data-bs-original-title","title"],ae={key:1,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},re=S(r({__name:"ProjectManagerCalendar",setup(a){const r=W(),i=u(null),c=U(),j=V(),C=u(!1);u(!1);const S=u("all"),D=u(""),Y=u([]),re=u([]),le=u([]),se=u(0),ne=u(""),oe=u(""),ie=u(""),de=u(""),ce=u(!0),ue=u(!1),pe=u(""),me=u(!1),ve=u({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),ye=u({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),ge=u({plugins:[P,H],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineYear",initialDate:(new Date).toISOString().split("T")[0],height:"auto",themeSystem:"cerulean",resourceAreaWidth:"20%",slotMinHeight:20,resourcesInitiallyExpanded:!1,selectable:!0,dragScroll:!0,nowIndicator:!0,eventOrder:"start",resourceOrder:"start",headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},buttonText:{resourceTimelineWeek:"Week",resourceTimelineMonth:"Month",resourceTimelineYear:"Year"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}},resourceTimelineYear:{type:"resourceTimeline",duration:{month:12},titleFormat:{year:"numeric"},title:"Year",slotLabelFormat:[{month:"short"},{day:"numeric"},{weekday:"short"}],slotMinWidth:30,dayMinWidth:30,slotMinHeight:28,dayMinHeight:26}},dayCellDidMount:function(e){const t=e.date.getDay();0!==t&&6!==t||e.el.classList.add("fc-day-sat","fc-day-sun")},resourceAreaHeaderContent:"Projects",resources:[],events:[],eventDrop:e=>{fe(e),e.revert()},eventResize:e=>{fe(e)},select:e=>{"contractor"!==c.user.role&&("manager"!==c.user.role||e.resource.extendedProps.managers.includes(c.user.id))&&(console.log("start date",e.startStr),pe.value=0,se.value=e.resource.extendedProps.project,oe.value=e.startStr,ie.value=e.endStr,ue.value=!0)}}),fe=e=>{if("contractor"===c.user.role)return void e.revert();if("manager"===c.user.role&&!e.event.extendedProps.managers.includes(c.user.id))return e.revert(),void j.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);e.event.id==e.event._def.publicId?ye.value={title:"Confirm Update",subtitle:`Are you sure you want to update the project "${e.event.title}" date from ${t} to ${a}?`,btntext:"Confirm",isSweetAlertOpen:!0,onConfirm:()=>{he(e.event.id,t,a),ye.value.isSweetAlertOpen=!1},onCancel:()=>{ye.value.isSweetAlertOpen=!1,e.revert()}}:e.revert()},ke=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},we=e=>{window.location.hash="",me.value=!0,de.value=e.id,ne.value=e.username,window.location.hash="workerCalendar"},he=async(e,t,a)=>{try{await r.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),j.success("Task updated successfully"),await je(),await Ce(),be()}catch(l){j.error("Something went wrong"),console.log(l)}},_e=e=>{const t=le.value.find((t=>t.id===e));return t?t.managers:[]},be=()=>{const e=le.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color})));const t=[...Y.value.map((e=>({id:e.id,resourceId:e.id,project:e.project,start:e.startDate,end:ke(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:ve[e.status],managers:_e(e.project)}))),...e].sort(((e,t)=>new Date(e.start)-new Date(t.start))),a=le.value.map((e=>{const t=Y.value.filter((t=>t.project===e.id)).map((e=>({id:e.id,title:e.title,project:e.project,initiallyExpanded:!0})));return{id:e.id,title:e.title,eventBackgroundColor:e.color,project:e.id,initiallyExpanded:!0,children:t}}));ge.value.resources=a,ge.value.events=t},xe=()=>{if("all"!==S.value){let e=le.value.filter((e=>e.status===S.value));re.value=e}else re.value=le.value;D.value&&(re.value=le.value.filter((e=>e.title.toLowerCase().includes(D.value.toLowerCase())))),ge.value.resources=re.value},je=async()=>{try{C.value=!0,console.log("inside all projects func");let e=(await r.get("/api/project/projects/",{})).data;le.value=e,re.value=e}catch(e){console.error(e),le.value=[],re.value=[]}finally{C.value=!1}},Ce=async()=>{try{C.value=!0;let e=(await r.get("/api/task/",{})).data.map((e=>({...e,workers:e.workers.map((e=>({...e,picture:e.avatar||"default-avatar.png",initials:e.username?e.username.slice(0,2).toUpperCase():"N/A"})))})));Y.value=e,console.log("new",Y.value)}catch(e){console.error("Error fetching tasks:",e),Y.value=[]}finally{C.value=!1}};p(S,((e,t)=>{xe()}));const Se=async()=>{C.value=!0,await Promise.all([je(),Ce()]),await be(),C.value=!1};return m((async()=>{await Se(),ce.value=!0})),(a,r)=>{const u=M,p=A,m=T,P=I,H=x,U=F,V=t,W=e;return l(),v(_,null,[y("div",null,[y("form",{onSubmit:g(xe,["prevent"])},[y("div",E,[o(m,{elevated:""},{default:n((()=>[o(p,{icon:"fas fa-search"},{default:n((()=>[o(u,{type:"text",placeholder:"Search projects...",modelValue:f(D),"onUpdate:modelValue":r[0]||(r[0]=e=>k(D)?D.value=e:null),onInput:r[1]||(r[1]=e=>xe()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),f(C)?(l(),v("div",z)):d("",!0),o(H,null,{default:n((()=>[o(P,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:n((()=>[y("a",{onClick:r[2]||(r[2]=()=>{xe(),S.value="all"}),class:w(["dropdown-item is-media","all"==f(S)?"is-active":""])},N,2),y("a",{href:"#",onClick:r[3]||(r[3]=()=>{xe(),S.value="active"}),class:w(["active"==f(S)?"is-active":"","dropdown-item is-media"])},R,2),y("a",{onClick:r[4]||(r[4]=()=>{xe(),S.value="pending"}),class:w(["pending"==f(S)?"is-active":"","dropdown-item is-media"])},$,2),B,y("a",{onClick:r[5]||(r[5]=()=>{xe(),S.value="completed"}),class:w(["completed"==f(S)?"is-active":"","dropdown-item is-media"])},J,2)])),_:1})])),_:1})])],40,L),o(f(O),{options:f(ge),ref_key:"calendarRef",ref:i},{eventContent:n((e=>[y("div",K,["background"==e.event?.display?(l(),v("p",Q," Job: "+h(e.event.title),1)):(l(),v("div",q,[y("p",{onClick:t=>{return a=e,console.log(a.event),void("contractor"!==c.user.role&&("manager"!==c.user.role||a.event.extendedProps.managers.includes(c.user.id)?(oe.value="",se.value=0,pe.value=a.event.id,ue.value=!0):j.error("You can modify the task only for the projects for which you are a manager")));var a},style:{"font-weight":"500","margin-bottom":"0px","padding-left":"1px","padding-right":"1px","z-index":"99","text-shadow":"2px 2px 2px black"}},[(l(!0),v(_,null,b(e.event.extendedProps?.workers,(e=>(l(),v("span",{key:e.id},h(e.username)+", ",1)))),128))],8,G),e.event.extendedProps?.workers?.length?(l(),v("div",X,[(l(!0),v(_,null,b(e.event.extendedProps?.workers,(t=>(l(),v("div",{class:"avatars__item",key:t.id},[t.avatar?(l(),v("img",{key:0,src:t.avatar,onClick:e=>we(t),title:t.username,"data-bs-original-title":t.username?t.username.slice(0,2).toUpperCase():"Hi"},null,8,Z)):d("",!0),0==e.event.extendedProps?.workers?.length?(l(),v("div",{key:1,onClick:e=>we(t),"data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[y("h6",{class:"mb-0",style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username},h(t.username?t.username.slice(0,2):"AA"),9,te)],8,ee)):d("",!0),y("p",null,h(t.username),1)])))),128))])):d("",!0),e.event.extendedProps?.workers?.length||"background"==e.event?.display?d("",!0):(l(),v("p",ae," No worker is assigned yet "))]))])])),_:1},8,["options"]),f(me)?(l(),s(U,{key:0,workerTasksModal:f(me),workerId:f(de),"onUpdate:modalHandler":r[6]||(r[6]=e=>me.value=!f(me))},null,8,["workerTasksModal","workerId"])):d("",!0),f(ue)?(l(),s(V,{key:1,isOpen:f(ue),taskIdSelected:f(pe),projectID:f(se),startDate:f(oe),endDate:f(ie),"onUpdate:OnSuccess":Se,"onUpdate:modalHandler":r[7]||(r[7]=()=>{ue.value=!1,console.log("Falling in main")})},null,8,["isOpen","taskIdSelected","projectID","startDate","endDate"])):d("",!0)]),f(ye).isSweetAlertOpen?(l(),s(W,{key:0,isSweetAlertOpen:f(ye).isSweetAlertOpen,title:f(ye).title,loading:!1,subtitle:f(ye).subtitle,btntext:f(ye).btntext,onConfirm:f(ye).onConfirm,onCancel:f(ye).onCancel},null,8,["isSweetAlertOpen","title","subtitle","btntext","onConfirm","onCancel"])):d("",!0)],64)}}}),[["__scopeId","data-v-22ff5f23"]]);export{re as _};
