import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-c93f6d7f.js";import{_ as t}from"./UpdateTask.vue_vue_type_script_setup_true_lang-92526bb6.js";import{_ as a}from"./VAvatar.vue_vue_type_style_index_0_lang-04b2a1a6.js";import{e as r,r as l,w as s,o as n,A as i,B as o,C as d,D as c,I as u,E as p,F as v,l as m,j as g,M as y,H as f,T as h,U as w,V as _,N as b,ak as k,P as x,Q as j,R as D}from"./index-240e3878.js";import{_ as C}from"./VDropdown.vue_vue_type_style_index_0_lang-4da394f7.js";import{_ as S}from"./VField.vue_vue_type_script_setup_true_lang-ced660cf.js";import{_ as A}from"./VControl-8c8224f2.js";import{_ as P}from"./VInput.vue_vue_type_script_setup_true_lang-fc468275.js";import{F as I}from"./FullCalendar-5da8dc68.js";import{i as O}from"./index-55eb4335.js";import{i as T}from"./index-37e62c97.js";import{u as H}from"./userSession-bdc7ada1.js";import{u as V}from"./useNotyf-f1f05451.js";import{u as M}from"./useAPI-019d2f30.js";const N=e=>(x("data-v-c59e1c1c"),e=e(),j(),e),F=["onSubmit"],U={class:"datatable-toolbar"},E={key:0,class:"rota-loader"},W=[N((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-menu","aria-hidden":"true"})],-1))),N((()=>c("div",{class:"meta"},[c("span",null,"All"),c("span",null,"All projects owned by company")],-1)))],$=[N((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-play","aria-hidden":"true"})],-1))),N((()=>c("div",{class:"meta"},[c("span",null,"Active"),c("span",null,"Projects that are in progress")],-1)))],L=[N((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-alarm-clock","aria-hidden":"true"})],-1))),N((()=>c("div",{class:"meta"},[c("span",null,"Pending"),c("span",null,"Projects listed but not started")],-1)))],R=N((()=>c("hr",{class:"dropdown-divider"},null,-1))),Y=[N((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-round-box-check","aria-hidden":"true"})],-1))),N((()=>c("div",{class:"meta"},[c("span",null,"Completed"),c("span",null,"Projects that are done")],-1)))],z={style:{height:"100%",position:"relative"}},B={key:0,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px",color:"black"}},J=["onClick"],Z={style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px","padding-right":"10px","z-index":"99","text-shadow":"2px 2px 2px black"}},K={key:0,class:"avatars"},Q=["src","onClick","title","data-bs-original-title"],q={class:"v-popover-content is-text"},G={class:"popover-head"},X={class:"dark-inverted"},ee={class:"popover-body"},te=["onClick","data-bs-original-title","title"],ae=["data-bs-original-title","title"],re={key:1,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},le=D(r({__name:"ProjectManagerCalendar",setup(r){const x=M(),j=l(null),D=H(),N=V(),le=l(!1);l(!1);const se=l("all"),ne=l(""),ie=l([]),oe=l([]),de=l([]),ce=l(0),ue=l(""),pe=l(""),ve=l(""),me=l(0),ge=l(!0),ye=l(!1),fe=l(""),he=l({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),we=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),_e=l({plugins:[O,T],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineMonth",height:"auto",themeSystem:"cerulean",resourceAreaWidth:"20%",slotMinHeight:20,resourcesInitiallyExpanded:!1,selectable:!0,dragScroll:!0,eventOrder:"start",resourceOrder:"start",headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}},resourceTimelineYear:{slotMinWidth:35,dayMinWidth:30,slotMinHeight:35,dayMinHeight:30}},resourceAreaHeaderContent:"Projects",resources:[],events:[],eventDrop:e=>{be(e),e.revert()},eventResize:e=>{be(e)},select:e=>{"contractor"!==D.user.role&&("manager"!==D.user.role||e.resource.extendedProps.managers.includes(D.user.id))&&(console.log("start date",e.startStr),fe.value=0,ce.value=e.resource.extendedProps.project,pe.value=e.startStr,ve.value=e.endStr,ye.value=!0)}}),be=e=>{if("contractor"===D.user.role)return void e.revert();if("manager"===D.user.role&&!e.event.extendedProps.managers.includes(D.user.id))return e.revert(),void N.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);e.event.id==e.event._def.publicId?we.value={title:"Confirm Update",subtitle:`Are you sure you want to update the project "${e.event.title}" date from ${t} to ${a}?`,btntext:"Confirm",isSweetAlertOpen:!0,onConfirm:()=>{je(e.event.id,t,a),we.value.isSweetAlertOpen=!1},onCancel:()=>{we.value.isSweetAlertOpen=!1,e.revert()}}:e.revert()},ke=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},xe=e=>{window.location.hash="",me.value=e.id,ue.value=e.username,window.location.hash="workerCalendar"},je=async(e,t,a)=>{try{await x.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),N.success("Task updated successfully"),await Ae(),await Pe(),Ce()}catch(r){N.error("Something went wrong"),console.log(r)}},De=e=>{const t=de.value.find((t=>t.id===e));return t?t.managers:[]},Ce=()=>{const e=de.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color})));const t=[...ie.value.map((e=>({id:e.id,resourceId:e.id,project:e.project,start:e.startDate,end:ke(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:he[e.status],managers:De(e.project)}))),...e].sort(((e,t)=>new Date(e.start)-new Date(t.start))),a=de.value.map((e=>{const t=ie.value.filter((t=>t.project===e.id)).map((e=>({id:e.id,title:e.title,project:e.project,initiallyExpanded:!0})));return{id:e.id,title:e.title,eventBackgroundColor:e.color,project:e.id,initiallyExpanded:!0,children:t}}));_e.value.resources=a,_e.value.events=t},Se=()=>{if("all"!==se.value){let e=de.value.filter((e=>e.status===se.value));oe.value=e}else oe.value=de.value;ne.value&&(oe.value=de.value.filter((e=>e.title.toLowerCase().includes(ne.value.toLowerCase())))),_e.value.resources=oe.value},Ae=async()=>{try{le.value=!0,console.log("inside all projects func");let e=(await x.get("/api/project/projects/",{})).data.filter((e=>e.startDate&&!isNaN(new Date(e.startDate)))).sort(((e,t)=>new Date(e.startDate)-new Date(t.startDate)));de.value=e,oe.value=e}catch(e){console.error(e),de.value=[],oe.value=[]}finally{le.value=!1}},Pe=async()=>{try{le.value=!0;let e=(await x.get("/api/task/",{})).data.filter((e=>e.startDate&&!isNaN(new Date(e.startDate)))).sort(((e,t)=>new Date(e.startDate)-new Date(t.startDate)));ie.value=e}catch(e){console.error("Error fetching tasks:",e),ie.value=[]}finally{le.value=!1}};s(se,((e,t)=>{Se()}));const Ie=async()=>{await Promise.all([Ae(),Pe()]),await Ce()};return n((async()=>{await Ie(),ge.value=!0})),(r,l)=>{const s=P,n=A,x=S,O=C,T=k,H=a,V=i("Tippy"),M=t,ie=e;return o(),d(w,null,[c("div",null,[c("form",{onSubmit:u(Se,["prevent"])},[c("div",U,[p(x,{elevated:""},{default:v((()=>[p(n,{icon:"fas fa-search"},{default:v((()=>[p(s,{type:"text",placeholder:"Search projects...",modelValue:m(ne),"onUpdate:modelValue":l[0]||(l[0]=e=>g(ne)?ne.value=e:null),onInput:l[1]||(l[1]=e=>Se()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),m(le)?(o(),d("div",E)):y("",!0),p(T,null,{default:v((()=>[p(O,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:v((()=>[c("a",{onClick:l[2]||(l[2]=()=>{Se(),se.value="all"}),class:f(["dropdown-item is-media","all"==m(se)?"is-active":""])},W,2),c("a",{href:"#",onClick:l[3]||(l[3]=()=>{Se(),se.value="active"}),class:f(["active"==m(se)?"is-active":"","dropdown-item is-media"])},$,2),c("a",{onClick:l[4]||(l[4]=()=>{Se(),se.value="pending"}),class:f(["pending"==m(se)?"is-active":"","dropdown-item is-media"])},L,2),R,c("a",{onClick:l[5]||(l[5]=()=>{Se(),se.value="completed"}),class:f(["completed"==m(se)?"is-active":"","dropdown-item is-media"])},Y,2)])),_:1})])),_:1})])],40,F),p(m(I),{options:m(_e),ref_key:"calendarRef",ref:j},{eventContent:v((e=>[c("div",z,["background"==e.event?.display?(o(),d("p",B," Job: "+h(e.event.title),1)):(o(),d("div",{key:1,onClick:t=>{return a=e,console.log(a.event),void("contractor"!==D.user.role&&("manager"!==D.user.role||a.event.extendedProps.managers.includes(D.user.id)?(pe.value="",ce.value=0,fe.value=a.event.id,ye.value=!0):N.error("You can modify the task only for the projects for which you are a manager")));var a},style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},[c("p",Z,[(o(!0),d(w,null,_(e.event.extendedProps?.workers,(e=>(o(),d("span",{key:e.id},h(e.username)+", ",1)))),128))]),e.event.extendedProps?.workers?.length?(o(),d("div",K,[(o(!0),d(w,null,_(e.event.extendedProps.workers,(t=>(o(),d("div",{class:"avatars__item",key:t.id},[p(V,null,{content:v((()=>[c("div",q,[c("div",G,[p(H,{picture:t.avatar,size:"small"},null,8,["picture"]),c("h4",X,h(t.username?t.username:""),1)]),c("div",ee,[c("p",null,h(e.event?.title),1)])])])),default:v((()=>[t.avatar?(o(),d("img",{key:0,src:t.avatar,alt:"",onClick:e=>xe(t),title:t.username,"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi"},null,8,Q)):y("",!0)])),_:2},1024),0==e.event.extendedProps?.workers?.length?(o(),d("div",{key:0,onClick:e=>xe(t),"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[c("h6",{class:"mb-0",style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username},h(t.username?t.username.slice(0,2):"AA"),9,ae)],8,te)):y("",!0),c("p",null,h(t.username),1)])))),128))])):y("",!0),e.event.extendedProps?.workers?.length||"background"==e.event?.display?y("",!0):(o(),d("p",re," No worker is assigned yet "))],8,J))])])),_:1},8,["options"]),m(ye)?(o(),b(M,{key:0,isOpen:m(ye),taskIdSelected:m(fe),projectID:m(ce),startDate:m(pe),endDate:m(ve),"onUpdate:OnSuccess":Ie,"onUpdate:modalHandler":l[6]||(l[6]=()=>{ye.value=!1,console.log("Falling in main")})},null,8,["isOpen","taskIdSelected","projectID","startDate","endDate"])):y("",!0)]),m(we).isSweetAlertOpen?(o(),b(ie,{key:0,isSweetAlertOpen:m(we).isSweetAlertOpen,title:m(we).title,loading:!1,subtitle:m(we).subtitle,btntext:m(we).btntext,onConfirm:m(we).onConfirm,onCancel:m(we).onCancel},null,8,["isSweetAlertOpen","title","subtitle","btntext","onConfirm","onCancel"])):y("",!0)],64)}}}),[["__scopeId","data-v-c59e1c1c"]]);export{le as _};
