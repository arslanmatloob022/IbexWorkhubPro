import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-4619ed61.js";import{e as s,r as o,o as a,B as t,N as l,F as i,D as n,E as r,l as u,j as p,J as c,I as d,O as v,v as m,C as _,T as y,G as f,x as h,U as g,V as w,M as b}from"./index-6ec76f2c.js";import{_ as k}from"./VField.vue_vue_type_script_setup_true_lang-12cdb0f5.js";import{_ as x}from"./VControl-cd7a06dd.js";import{_ as j}from"./VTextarea.vue_vue_type_script_setup_true_lang-0ddcd2a4.js";import{u as I}from"./useNotyf-f5a64182.js";import{u as A}from"./useAPI-75ddec04.js";import{_ as C}from"./SweetAlert.vue_vue_type_style_index_0_lang-d2e67747.js";import{_ as S}from"./VAvatar.vue_vue_type_style_index_0_lang-8252aa84.js";import{s as O}from"./sleep-fd7a5d8b.js";import{g as M}from"./costItems-cc57c928.js";import"./VLabel.vue_vue_type_script_setup_true_lang-890769c0.js";import"./useVFieldContext-9f8928d8.js";import"./notyf-0decad19.js";import"./useThemeColors-610dce37.js";import"./userSession-d90803bf.js";const N={class:"columns is-multiline"},T={class:"column is-12"},V=s({__name:"ProposalReviewModal",props:{proposalReviewModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(s,{emit:m}){const _=s,y=I(),f=A(),h=o(""),g=o(!1),w=()=>{m("closeModalHandler",!1)},b=async()=>{try{g.value=!0;await f.patch(`/api/lead-proposal/${_.proposalId}/`,{client_note:h.value,status:"review"});y.success("Your review submitted on proposal."),w(),m("update:OnSuccess",null)}catch(e){console.log(e)}finally{g.value=!1}};return a((()=>{})),(s,o)=>{const a=j,m=x,y=k,f=v,I=e;return t(),l(I,{is:"form",open:_.proposalReviewModal,title:"Review Proposal",size:"small",actions:"center",onSubmit:d(b,["prevent"]),onClose:w},{content:i((()=>[n("div",N,[n("div",T,[r(y,{label:"Enter Review Notes"},{default:i((()=>[r(m,null,{default:i((()=>[r(a,{modelValue:u(h),"onUpdate:modelValue":o[0]||(o[0]=e=>p(h)?h.value=e:null),rows:"4",placeholder:"Enter Notes"},null,8,["modelValue"])])),_:1})])),_:1})])])])),cancel:i((()=>[r(f,{light:"",onClick:o[1]||(o[1]=e=>w())},{default:i((()=>[c("Cancel")])),_:1})])),action:i((()=>[r(f,{loading:u(g),type:"submit",color:"info",raised:""},{default:i((()=>[c("Submit Review")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),P={class:"action-page-wrapper action-page-v1"},q={class:"wrapper-inner"},B={class:"action-box"},R={class:"box-content"},$={class:"dark-inverted"},Y={class:"is-dark-primary"},z={class:"sender-message is-dark-card-bordered is-dark-bg-4"},D=n("h4",{class:"dark-inverted"},"Message",-1),H={class:"dark-inverted"},E={class:"buttons"},U=s({__name:"ClientProposalsActionsMessage",props:{actions:{},message:{}},setup(e){const s=e,a=I(),l=m(),p=o(!1),h=()=>{window.location.href="https://www.google.com"},g=async()=>{p.value=!0,a.success("Thanks for your precious time!"),await O(),l.push("https://ibexbuilderstudios.com/"),p.value=!1};return(e,o)=>{const a=S,l=v;return t(),_("div",P,[n("div",q,[n("div",B,[n("div",R,[r(a,{size:"big",picture:"/logos/IBEXDark.png"}),n("h3",$,[n("span",Y,y(s.actions??"No Action"),1)]),n("div",z,[D,n("p",H,y(s.message??"No Message"),1)]),n("div",E,[r(l,{"dark-outlined":"",onClick:h},{default:i((()=>[c(" Close ")])),_:1}),r(l,{color:"primary",loading:u(p),raised:"",tabindex:"0",onKeydown:f(d(g,["prevent"]),["space"]),onClick:g},{default:i((()=>[c(" Visit Ibex Builders ")])),_:1},8,["loading","onKeydown"])])])])])])}}}),F={class:"columns is-multiline"},L={class:"column is-12 mt-4"},J={class:"invoice-wrapper"},W={class:"invoice-header"},K={class:"left"},G={class:"right"},X={class:"controls"},Q={key:0},Z={key:1,class:"invoice-body"},ee={class:"invoice-card"},se={class:"invoice-section is-flex is-bordered"},oe=n("div",{class:"meta"},null,-1),ae=n("div",{class:"end"},[n("span",null,"PO Box 242"),n("span",null,"Evergreen, CO 80437-0242"),n("span",null,"Phone: 720 272-9061"),n("span",null,"Premium Trades for Premier Builders")],-1),te={class:"invoice-section is-flex is-bordered"},le={key:0,class:"meta"},ie={key:1,class:"meta"},ne={class:"end is-left"},re={key:0,class:"invoice-section"},ue={class:"responsive-table"},pe=["innerHTML"],ce={key:1},de={key:2},ve={class:"invoice-section is-flex mt-0 pt-0"},me={class:"end is-left"},_e={class:"text-right"},ye=s({__name:"proposal-view",emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:s}){const p=o(""),d=I(),m=h(),f=A(),k=o(""),x=o(""),j=o(!1),O=o(!1),N=o({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),T=o({id:"",title:"",approval_deadline:"",internal_notes:null,introductory_text:null,closing_text:null,columns_to_show:[],payment_status:"",type:"",status:"",created_at:"",updated_at:"",job:""}),P=o([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]),q=o({review:{short:"Thank you for submitting your review.",full:"Your request for a review has been received. Our team at Ibex Builders Studios will carefully assess the proposal and make any necessary adjustments to align with your expectations. Weâ€™ll get back to you shortly with an updated version."},disapprove:{short:"Thank you for your feedback.",full:"We appreciate your time in reviewing our proposal. If there are any concerns or adjustments needed, please let us know. Ibex Builders Studios is happy to revise and accommodate your requirements."},approved:{short:"Thank you for approving the proposal!",full:"Your approval confirms the agreed cost items and expenditures. Our team at Ibex Builders Studios will now proceed with the next steps to ensure a smooth and efficient construction process."}}),B=o(""),R=async()=>{try{O.value=!0;const e=await f.get(`/api/lead-proposal/${m.query.proposal}/detail/`);z(),T.value=e.data,B.value=e.data.status;let s=q.value[e.data.status];k.value=s.short,x.value=s.full}catch(e){console.log(e)}finally{O.value=!1}},$=e=>{p.value=e,N.value={title:`${p.value.toLocaleUpperCase()} proposal ?`,subtitle:""+("approved"==p.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site."),btntext:""+("approved"==p.value?"Approve":"Disapprove"),isSweetAlertOpen:!0}},Y=async()=>{try{O.value=!0;await f.patch(`/api/lead-proposal/${m.query.proposal}/`,{status:p.value});R(),d.success(`You have ${p.value} this proposal.`),N.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{O.value=!1}},z=async()=>{try{const e=await f.get(`api/cost/by-proposal/${m.query.proposal}/`);P.value=e.data}catch(e){console.log(e)}};return a((()=>{m.query.proposal&&R()})),(e,s)=>{const o=v,a=U,p=S,d=C,f=V;return t(),_("div",F,[n("div",L,[n("div",J,[n("div",W,[n("div",K,[n("h3",null,"Proposal "+y(u(m).query.proposal?.slice(0,8)),1)]),n("div",G,[n("div",X,[r(o,{size:"xsmall",onClick:s[0]||(s[0]=e=>$("approved")),outlined:"",color:"primary"},{default:i((()=>[c("Approve")])),_:1}),r(o,{size:"xsmall",onClick:s[1]||(s[1]=e=>j.value=!u(j)),class:"ml-2",outlined:"",color:"info"},{default:i((()=>[c("Review")])),_:1}),r(o,{onClick:s[2]||(s[2]=e=>$("disapprove")),size:"xsmall",class:"ml-2",outlined:"",color:"danger"},{default:i((()=>[c("Disapprove")])),_:1})])])]),"pending"!=u(B)?(t(),_("div",Q,[r(a,{actions:u(k),message:u(x)},null,8,["actions","message"])])):(t(),_("div",Z,[n("div",ee,[n("div",se,[r(p,{size:"xl",picture:"/logos/IbexFavicon.png"}),oe,ae]),n("div",te,[u(T)?.jobInfo?.clientInfo?(t(),_("div",le,[n("h3",null,y(u(T)?.jobInfo?.clientInfo?.username??"N/A"),1),n("span",null,y(u(T)?.jobInfo?.clientInfo?.email??"N/A"),1)])):(t(),_("div",ie,[n("h3",null,y(u(T)?.jobInfo?.contractor_info?.username??"N/A"),1),n("span",null,y(u(T)?.jobInfo?.contractor_info?.email??"N/A"),1)])),n("div",ne,[n("h3",null,"Job: "+y(u(T).jobInfo?.title??"N/A"),1),n("p",null,"Address: "+y(u(T).jobInfo?.address??"N/A"),1)])]),u(P).length?(t(),_("div",re,[n("table",ue,[n("thead",null,[(t(!0),_(g,null,w(u(T).columns_to_show,((e,s)=>(t(),_("th",{key:s},y(e),1)))),128))]),n("tbody",null,[(t(!0),_(g,null,w(u(P),((e,s)=>(t(),_("tr",{key:e.id},[(t(!0),_(g,null,w(u(T).columns_to_show,((s,o)=>(t(),_("td",{key:o},["Description"===s?(t(),_("div",{key:0,innerHTML:e[u(M)[o]]},null,8,pe)):(t(),_("span",ce,y(e[u(M)[o]]),1)),"Cost Code"===s?(t(),_("span",de,y(e?.cost_code_info?.name),1)):b("",!0)])))),128))])))),128))])])])):b("",!0),n("div",ve,[n("div",me,[n("h3",_e," Total Price: $"+y(u(T).proposalAmount??0),1)])])])]))])]),u(N).isSweetAlertOpen?(t(),l(d,{key:0,isSweetAlertOpen:u(N).isSweetAlertOpen,title:u(N).title,subtitle:u(N).subtitle,btntext:u(N).btntext,onConfirm:Y,onCancel:()=>u(N).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),u(j)?(t(),l(f,{key:1,proposalReviewModal:u(j),proposalId:u(m).query.proposal,onCloseModalHandler:s[3]||(s[3]=e=>j.value=!1),"onUpdate:OnSuccess":R},null,8,["proposalReviewModal","proposalId"])):b("",!0)])}}});export{ye as default};
