import{_ as e,a,b as l}from"./ProposalViewModal.vue_vue_type_style_index_0_lang-8692c692.js";import{_ as t}from"./SweetAlert.vue_vue_type_style_index_0_lang-d2e67747.js";import{b as s,c as o}from"./CreateProposalTasksModal-da0d1627.js";import{_ as i}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-c7a10a0b.js";import{_ as r}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-cc0e0f70.js";import{_ as n,c as d}from"./VFlexTable.vue_vue_type_style_index_0_lang-2e756945.js";import{_ as p}from"./VDropdown.vue_vue_type_style_index_0_lang-32355ab6.js";import{_ as u}from"./VTag.vue_vue_type_style_index_0_lang-a4c61571.js";import{_ as c}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-dbf0ab88.js";import{e as m,v,x as _,r as f,Z as y,o as g,au as k,B as h,C as w,D as b,E as C,F as x,K as P,W as A,l as S,j as I,J as O,N as j,M,U as T,V as U,aR as V,O as $,T as D}from"./index-6ec76f2c.js";import{_ as L}from"./VControl-cd7a06dd.js";import{_ as H,a as E}from"./search-4-dark-2b5b440c.js";import{u as F}from"./useAPI-75ddec04.js";import{u as R}from"./useNotyf-f5a64182.js";import{f as N}from"./useSupportElement-51074a9f.js";const z={onHold:"warning",open:"info",sold:"success",lost:"danger"},B={onHold:"On Hold",open:"Open",sold:"Sold",lost:"Lost"},J={pending:"info",approved:"success",approve:"success",review:"warning",disapprove:"danger"},W={pending:"Pending",approved:"Approved",approve:"Approved",review:"Require Review",disapprove:"Disapproved"},Y={proposal:"primary",change_order:"warning",draft:"light"},q={proposal:"Proposal",change_order:"Change Order",draft:"Draft"},K=[{value:"call",label:"Phone Call"},{value:"email",label:"Email"},{value:"followup",label:"Follow Up"},{value:"visit",label:"Site Visit"},{value:"form",label:"Website Form"}],Z={class:"flex-toolbar is-reversed is-flex space-between my-4"},G={key:0},Q={key:1,class:"flex-list-wrapper flex-list-v2"},X={class:"item-name dark-inverted show-text-250"},ee={class:"item-meta"},ae=b("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),le={class:"item-name dark-inverted"},te={class:"light-text"},se=["onClick"],oe=[b("div",{class:"icon"},[b("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),b("div",{class:"meta"},[b("span",null,"Edit"),b("span",null,"Edit Proposal Details")],-1)],ie=["onClick"],re=[b("div",{class:"icon"},[b("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),b("div",{class:"meta"},[b("span",null,"Preview"),b("span",null,"Preview proposal detail")],-1)],ne=["onClick"],de=[b("div",{class:"icon"},[b("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),b("div",{class:"meta"},[b("span",null,"Create Tasks"),b("span",null,"Create tasks in chart ")],-1)],pe=b("hr",{class:"dropdown-divider"},null,-1),ue=["onClick"],ce=[b("div",{class:"icon"},[b("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),b("div",{class:"meta"},[b("span",null,"Mark Approved"),b("span",null,"Mark Proposal As Approved")],-1)],me=["onClick"],ve=[b("div",{class:"icon"},[b("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),b("div",{class:"meta"},[b("span",null,"Delete"),b("span",null,"Delete from list")],-1)],_e=b("img",{class:"light-image",src:H,alt:""},null,-1),fe=b("img",{class:"dark-image",src:E,alt:""},null,-1),ye=m({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},emits:["updateCompany"],setup(m,{emit:H}){const E=m,z=v();_();const B=F(),K=R(),ye=f(!1),ge=f([]),ke=f(!1),he=f(""),we=f(!1),be=f(!1),Ce=f(""),xe=f("");f(E.activeTab);const Pe=f({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Ae=f({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),Se=async()=>{try{ye.value=!0;await B.delete(`/api/lead-proposal/${xe.value}/`);K.success("Proposal delete successfully"),$e()}catch(e){K.error(` ${e}, Proposal`),K.error("Something went wrong please try later")}finally{ye.value=!1,Pe.value.isSweetAlertOpen=!1}},Ie={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},Oe=y((()=>{if(Ce.value){const e=new RegExp(Ce.value,"i");return ge.value.filter((a=>a.title.match(e)||a.approval_deadline.match(e)))}return ge.value})),je=f(!1),Me=f(!1),Te=f(!1),Ue=f(""),Ve=e=>{z.push(`/sidebar/dashboard/proposals/${e}`)},$e=()=>{1==E.allProposal?(async()=>{try{ye.value=!0;const e=await B.get("/api/lead-proposal/");ge.value=e.data}catch(e){K.error(` ${e}, Lead`)}finally{ye.value=!1}})():E.leadId&&(async()=>{try{ye.value=!0;const e=await B.get(`/api/lead-proposal/by-project/${E.leadId}/`);ge.value=e.data}catch(e){K.error(` ${e}, Lead`)}finally{ye.value=!1}})()};return g((()=>{$e()})),(m,v)=>{const _=L,f=$,y=c,g=d,F=u,R=p,z=n,De=r,Le=i,He=s,Ee=e,Fe=a,Re=o,Ne=t,ze=l,Be=k("tooltip");return h(),w("div",null,[b("div",Z,[C(_,{icon:"feather:search"},{default:x((()=>[P(b("input",{"onUpdate:modelValue":v[0]||(v[0]=e=>I(Ce)?Ce.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[A,S(Ce)]])])),_:1}),b("div",null,[C(f,{color:"primary",onClick:v[1]||(v[1]=e=>ke.value=!S(ke)),icon:"fas fa-plus"},{default:x((()=>[O("Lead Proposal ")])),_:1}),E.leadId?(h(),j(f,{key:0,color:"warning",class:"ml-2",onClick:v[2]||(v[2]=e=>{be.value=!0}),icon:"fas fa-cogs"},{default:x((()=>[O("Proposals")])),_:1})):M("",!0)])]),S(ye)?(h(),w("div",G,[C(y)])):(h(),w("div",Q,[S(Oe).length>0&&S(ge).length>0?(h(),j(z,{key:0,data:S(Oe),columns:Ie,rounded:""},{body:x((()=>[C(V,{name:"list",tag:"div",class:"flex-list-inner"},{default:x((()=>[(h(!0),w(T,null,U(S(Oe),(e=>(h(),w("div",{key:e.id,class:"flex-table-item"},[C(g,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>Ve(e.id)},{default:x((()=>[P((h(),w("div",null,[b("span",X,D(e.title),1),b("span",ee,[b("span",null,[ae,O(D(S(N)(e.created_at)),1)])])])),[[Be,`${e.title}`,void 0,{rounded:!0,light:!0}]])])),_:2},1032,["onClick"]),C(g,{class:"cu-pointer",onClick:a=>Ve(e.id)},{default:x((()=>[C(F,{rounded:"",color:S(Y)[e.type]},{default:x((()=>[O(D(S(q)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),C(g,{class:"cu-pointer",onClick:a=>Ve(e.id)},{default:x((()=>[C(F,{class:"capitalized",rounded:"",color:S(J)[e.status]},{default:x((()=>[O(D(S(W)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),C(g,{class:"cu-pointer",onClick:a=>Ve(e.id),column:{media:!0}},{default:x((()=>[b("div",null,[b("span",le,"$"+D(e.proposalAmount),1),b("span",te,D(e.payment_status),1)])])),_:2},1032,["onClick"]),C(g,{class:"cu-pointer",onClick:a=>Ve(e.id)},{default:x((()=>[C(F,{color:"purple",outlined:""},{default:x((()=>[O(D(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),C(g,{column:{align:"end"}},{default:x((()=>[C(R,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:x((()=>[b("a",{role:"menuitem",onClick:a=>{return l=e.id,he.value=l,void(ke.value=!0);var l},class:"dropdown-item is-media"},oe,8,se),b("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Me.value=l,void(je.value=!je.value);var l},class:"dropdown-item is-media"},re,8,ie),"approved"==e.status?(h(),w("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,he.value=l,void(we.value=!0);var l},class:"dropdown-item is-media"},de,8,ne)):M("",!0),pe,"approved"!=e.status?(h(),w("a",{key:1,role:"menuitem",onClick:a=>(async(e,a)=>{try{await B.patch(`/api/lead-proposal/${a}/`,{status:e}),K.success(`You have ${e} this proposal.`),"approved"==e&&H("updateCompany",null),$e()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},ce,8,ue)):M("",!0),b("a",{role:"menuitem",onClick:a=>{return l=e.id,xe.value=l,void(Pe.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},ve,8,me)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):M("",!0),S(ge).length<1&&0==S(Oe).length?(h(),j(De,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:x((()=>[_e,fe])),_:1})):M("",!0),S(Oe).length>5?(h(),j(Le,{key:2,"item-per-page":10,"total-items":873,"current-page":42,"max-links-displayed":7})):M("",!0)])),S(we)?(h(),j(He,{key:2,createProposalTasksModal:S(we),proposalId:S(he),onCloseModalHandler:v[3]||(v[3]=e=>we.value=!1),"onUpdate:OnSuccess":$e},null,8,["createProposalTasksModal","proposalId"])):M("",!0),S(ke)?(h(),j(Ee,{key:3,leadId:E.leadId,proposalId:S(he),leadProposalModal:S(ke),"onUpdate:modalHandler":v[4]||(v[4]=e=>ke.value=!1),"onUpdate:OnSuccess":$e,onClearProposalId:v[5]||(v[5]=e=>he.value="")},null,8,["leadId","proposalId","leadProposalModal"])):M("",!0),S(je)?(h(),j(Fe,{key:4,"preview-modal":S(je),proposalId:S(Me),"onUpdate:modalHandler":v[6]||(v[6]=e=>je.value=!1)},null,8,["preview-modal","proposalId"])):M("",!0),S(Te)?(h(),j(Re,{key:5,costItemModal:S(Te),proposalId:S(Ue),"onUpdate:modalHandler":v[7]||(v[7]=e=>Te.value=!1),"onUpdate:OnSuccess":$e},null,8,["costItemModal","proposalId"])):M("",!0),S(Pe).isSweetAlertOpen?(h(),j(Ne,{key:6,isSweetAlertOpen:S(Pe).isSweetAlertOpen,title:S(Pe).title,subtitle:S(Pe).subtitle,btntext:S(Pe).btntext,onConfirm:Se,onCancel:()=>S(Pe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):M("",!0),S(Ae).isSweetAlertOpen?(h(),j(Ne,{key:7,isSweetAlertOpen:S(Ae).isSweetAlertOpen,title:S(Ae).title,subtitle:S(Ae).subtitle,btntext:S(Ae).btntext,onConfirm:Se,onCancel:()=>S(Ae).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):M("",!0),S(be)?(h(),j(ze,{key:8,leadProposalListModal:S(be),leadID:E.leadId,"group-proposal-modal":S(be),"onUpdate:modalHandler":v[8]||(v[8]=e=>be.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):M("",!0)])}}});export{ye as _,K as a,B as b,z as g};
