import{e,s as l,r as a,Z as o,b as t,_ as s,o as n,A as i,B as r,N as d,F as u,D as c,E as p,K as m,W as _,l as v,C as f,V as b,U as h,J as y,M as I,j as g,T as w,I as k,O as C,a4 as P,a6 as V,a0 as D,X as x,P as S,Q as T,R as j,i as O,aR as M,H as A,G as U}from"./index-e91e92d7.js";import{_ as F}from"./VModal.vue_vue_type_style_index_0_lang-44bb6e31.js";import{_ as E}from"./VTextarea.vue_vue_type_script_setup_true_lang-aa2cf45c.js";import{_ as L}from"./VInput.vue_vue_type_script_setup_true_lang-ee019233.js";import{_ as $}from"./VField.vue_vue_type_script_setup_true_lang-b8c15d08.js";import{_ as H}from"./VControl-2479606f.js";import{a as R,_ as q}from"./VOption.vue_vue_type_style_index_0_lang-148fa7fa.js";import{u as B}from"./useAPI-ced16a91.js";import{u as N}from"./useNotyf-e356c569.js";import{a as z}from"./useSupportElement-baa88239.js";import{u as W}from"./userSession-c7ee6e07.js";import{_ as J}from"./VAvatar.vue_vue_type_style_index_0_lang-0a8989f6.js";import{g as G,a as K,s as Q,c as X}from"./costItems-3299b034.js";import{_ as Y}from"./SweetAlert.vue_vue_type_style_index_0_lang-ff68e096.js";import{_ as Z}from"./VDropdown.vue_vue_type_style_index_0_lang-4a0355c2.js";const ee={class:"modal-form columns is-multiline"},le={class:"columns is-multiline"},ae={class:"field column is-12 mb-0"},oe=c("label",null,"Title: ",-1),te={class:"control"},se=["disabled"],ne={class:"field column is-6"},ie=c("label",{for:""},"Cost Type",-1),re={class:"field column is-3"},de=c("label",{for:""},"Catalog",-1),ue={class:"field column is-3"},ce=c("label",{for:""},"Mark As",-1),pe={class:"field column is-6"},me=c("label",null,"Cost Code *",-1),_e={class:"field column is-6"},ve=c("label",{for:""},"Group Cost",-1),fe={class:"field column is-12 mb-0"},be=c("label",{for:"",class:"label"},"Description",-1),he={class:"field column is-12 mb-0"},ye=c("label",{for:"",class:"label"},"Internal Notes",-1),Ie={class:"columns is-multiline"},ge={class:"field column is-6"},we=c("label",null,"Unit Cost",-1),ke={class:"field column is-6"},Ce=c("label",null,"Quantity",-1),Pe={class:"field column is-6"},Ve=c("label",null,"Unit",-1),De={class:"field column is-6"},xe=c("label",null,"Builder Cost",-1),Se={class:"field column is-6"},Te=c("label",null,"Markup (%)",-1),je={class:"field column is-6"},Oe=c("label",null,"Client Price",-1),Me={class:"field column is-6"},Ae=c("label",null,"Margin (%)",-1),Ue=e({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:V}){const D=e,x=l();W();const S=N(),T=B(),j=a(!1);a([]),a([]);const O=a({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,group:"",proposal:D.proposalId}),M=a([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]),A=a([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]);a([{value:"Tiling",label:"Tiling"},{value:"Material",label:"Material"},{value:"Paint",label:"Paint"},{value:"Carpenter",label:"Carpenter"}]);const U=a([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]);a([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const J=async()=>{try{j.value=!0;const e=z(O.value,[]);if(D.costItemId){await T.patch(`/api/cost/${D.costItemId}/`,e)}else{await T.post("/api/cost/",e)}G(),K(),S.success("Item added successfully.")}catch(e){S.error(` ${e}, New Worker`)}finally{j.value=!1}},G=()=>{V("update:modalHandler",!1)},K=()=>{V("update:OnSuccess",null)};a(0),a(0);const Q=o((()=>O.value.unit_cost*O.value.quantity));a(0),a(0);const X=o((()=>O.value.markup>0?Q.value+Q.value*O.value.markup/100:O.value.margin>0?Q.value/(1-O.value.margin/100):Q.value));o((()=>(X.value-Q.value)/Q.value*100)),o((()=>(X.value-Q.value)/X.value*100));const Y=t((()=>s((()=>import("./ckeditor-d19482ea.js").then((e=>e.c))),["assets/ckeditor-d19482ea.js","assets/index-e91e92d7.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-232cb55d.js"]).then((e=>e.default.component)))),Z={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},Ue=a(!1),Fe=a(!1);return n((async()=>{x.value=await s((()=>import("./ckeditor-66a8143e.js").then((e=>e.c))),["assets/ckeditor-66a8143e.js","assets/index-e91e92d7.js","assets/index-ce8747cd.css"]).then((e=>e.default)),D.previousItemIndex&&(O.value.previousItemIndex=D.previousItemIndex),D.costItemId&&(async()=>{try{Ue.value=!0;const e=await T.get(`/api/cost/${D.costItemId}/`);O.value=e.data}catch(e){console.log(e)}finally{Ue.value=!1}})(),(async()=>{try{Fe.value=!0;const e=await T.get("/api/cost-code/");A.value=e.data.map((e=>({value:e.id,label:e.name})))}catch(e){console.log(e)}finally{Fe.value=!1}})()})),(e,l)=>{const a=q,o=R,t=H,s=$,n=C,V=i("Multiselect"),S=L,T=E,B=P,N=F;return r(),d(N,{is:"form",open:D.costItemModal,title:"Cost Item ",size:"xl",actions:"right",onSubmit:k(J,["prevent"]),onClose:G},{content:u((()=>[c("div",ee,[p(B,{class:"column is-12"},{default:u((()=>[c("div",le,[c("div",ae,[oe,c("div",te,[m(c("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>v(O).title=e),required:"",disabled:D.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,se),[[_,v(O).title]])])]),c("div",ne,[ie,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(o,{modelValue:v(O).cost_type,"onUpdate:modelValue":l[1]||(l[1]=e=>v(O).cost_type=e),disabled:D.previewCostItems},{default:u((()=>[(r(!0),f(h,null,b(v(M),((e,l)=>(r(),d(a,{value:e.value},{default:u((()=>[y(w(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",re,[de,c("div",null,[p(n,{color:"info",light:"",raised:"",size:"small"},{default:u((()=>[y("Add in Catalog")])),_:1})])]),c("div",ue,[ce,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(o,{modelValue:v(O).mark_as,"onUpdate:modelValue":l[2]||(l[2]=e=>v(O).mark_as=e),disabled:D.previewCostItems},{default:u((()=>[(r(!0),f(h,null,b(v(U),((e,l)=>(r(),d(a,{value:e.value},{default:u((()=>[y(w(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",pe,[me,p(s,null,{default:u((({id:e})=>[p(t,null,{default:u((()=>[p(V,{required:"",modelValue:v(O).cost_code,"onUpdate:modelValue":l[3]||(l[3]=e=>v(O).cost_code=e),disabled:D.previewCostItems,attrs:{id:e},searchable:!0,options:v(A),placeholder:"Select a cost code"},null,8,["modelValue","disabled","attrs","options"])])),_:2},1024)])),_:1})]),c("div",_e,[ve,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(O).group,"onUpdate:modelValue":l[4]||(l[4]=e=>v(O).group=e),name:"gcost",placeholder:"Group Cost"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",fe,[be,v(x)?(r(),d(v(Y),{key:0,disabled:D.previewCostItems,modelValue:v(O).description,"onUpdate:modelValue":l[5]||(l[5]=e=>v(O).description=e),editor:v(x),config:Z},null,8,["disabled","modelValue","editor"])):I("",!0)]),c("div",he,[ye,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(T,{modelValue:v(O).internal_notes,"onUpdate:modelValue":l[6]||(l[6]=e=>v(O).internal_notes=e),disabled:D.previewCostItems,rows:"4",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),p(B,{class:"column is-12 mt-3"},{default:u((()=>[c("div",Ie,[c("div",ge,[we,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(O).unit_cost,"onUpdate:modelValue":l[7]||(l[7]=e=>v(O).unit_cost=e),disabled:D.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",ke,[Ce,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(O).quantity,"onUpdate:modelValue":l[8]||(l[8]=e=>v(O).quantity=e),disabled:D.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Pe,[Ve,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(O).unit,"onUpdate:modelValue":l[9]||(l[9]=e=>v(O).unit=e),disabled:D.previewCostItems,type:"text",name:"unit",placeholder:"Unit"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",De,[xe,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(Q),"onUpdate:modelValue":l[10]||(l[10]=e=>g(Q)?Q.value=e:null),disabled:D.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Se,[Te,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(O).markup,"onUpdate:modelValue":l[11]||(l[11]=e=>v(O).markup=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",je,[Oe,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(X),"onUpdate:modelValue":l[12]||(l[12]=e=>g(X)?X.value=e:null),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Me,[Ae,p(s,null,{default:u((()=>[p(t,null,{default:u((()=>[p(S,{modelValue:v(O).margin,"onUpdate:modelValue":l[13]||(l[13]=e=>v(O).margin=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1})])])),action:u((()=>[p(n,{loading:v(j),type:"submit",color:"primary",icon:D.costItemId?"":"fas fa-plus",raised:""},{default:u((()=>[y(w(D.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","onSubmit"])}}}),Fe=V("useProposal",(()=>{const e=a(!0),l=N(),o=B(),t=a("");a("");const s=a([]),n=a([]),i=a({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),r=a([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:r,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await o.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(t){l.error(` ${t}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const l=await o.get(`/api/lead-proposal/${e}/detail/`);i.value=l.data}catch(l){console.log(l)}},getCompanyProposals:async()=>{try{e.value=!0;const l=await o.get("/api/lead-proposal/");s.value=l.data}catch(a){l.error(` ${a}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{t.value=e;const l=await o.get(`/api/cost/by-proposal/${e}/`);r.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){t.value="",r.value=[]}}})),Ee={class:"modal-form columns is-multiline"},Le={class:"column is-full"},$e={class:"field"},He=c("label",{class:"label"},"Send To ",-1),Re={class:"control"},qe={class:"column is-full"},Be={class:"field"},Ne=c("label",{class:"label"},"Subject ",-1),ze={class:"control"},We={class:"field column is-full mt-5"},Je=c("label",{class:"label"},"Message",-1),Ge=c("i",{class:"feather:mail"},null,-1),Ke=e({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{},selectedProposalsIds:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:o}){const i=e,b=Fe(),h=B(),g=N(),w=a(!1),P=l(),V=window.origin;a(`${V}/proposal-view/?proposal=${i.proposalData?.id}`);const x=()=>{o("update:modalHandler",!1)},S=i.selectedProposalsIds.map((e=>e.id)),T=i.selectedProposalsIds.map((e=>e.proposalAmount)).map(((e,l)=>`<li>Total of proposal ${l+1}:<b> $${e} </b></li>`)).join("<br>"),j=S.map(((e,l)=>`<a href="${V}/proposal-view/?proposal=${e}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal ${l+1}, </a>`)).join("<br>"),O=a({email:b.leadProposalFormData?.jobInfo?.clientInfo?.email?b.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:`Proposal ${b.leadProposalFormData?.jobInfo?.title} `,message:`<p><b>Hi ${b.leadProposalFormData?.jobInfo?.clientInfo?.username?b.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${b.leadProposalFormData?.jobInfo?.clientInfo?.last_name?b.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n\n  <p>We hope this message finds you well.</p>\n\n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing.\n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n\n  <p>\n    Actions required for all proposals, and uou can review the full proposal(s), including the cost breakdown, by clicking the link below: <br />\n    ${j}\n  </p>\n\n  <p><b>Respectively proposal(s) amount are:</b></p>\n  <ul>\n    ${T}\n  </ul>\n\n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience.\n    We are here to assist you.\n  </p>\n\n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n\n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`,link:j[0],columns:["cost_code","title","description","unit_cost"],showClient:!0,proposal_ids:S}),M=async()=>{try{w.value=!0;let e=O.value;e.proposal_ids=JSON.stringify(O.value.proposal_ids),e.columns=JSON.stringify(O.value.columns);await h.post("/api/lead-proposal/send-proposal-template/",e);g.success("Email sent successfully"),x()}catch(e){console.log(e)}finally{w.value=!1}},A=t((()=>s((()=>import("./ckeditor-d19482ea.js").then((e=>e.c))),["assets/ckeditor-d19482ea.js","assets/index-e91e92d7.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-232cb55d.js"]).then((e=>e.default.component)))),U={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return n((async()=>{P.value=await s((()=>import("./ckeditor-66a8143e.js").then((e=>e.c))),["assets/ckeditor-66a8143e.js","assets/index-e91e92d7.js","assets/index-ce8747cd.css"]).then((e=>e.default))})),(e,l)=>{const a=C,o=F;return r(),f("div",null,[p(D,{name:"fade-slow"},{default:u((()=>[p(o,{is:"form",open:i.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:k(M,["prevent"]),onClose:x},{content:u((()=>[c("div",Ee,[c("div",Le,[c("div",$e,[He,c("div",Re,[m(c("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>v(O).email=e)},null,512),[[_,v(O).email]])])])]),c("div",qe,[c("div",Be,[Ne,c("div",ze,[m(c("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>v(O).subject=e)},null,512),[[_,v(O).subject]])])])]),c("div",We,[Je,v(P)?(r(),d(v(A),{key:0,modelValue:v(O).message,"onUpdate:modelValue":l[2]||(l[2]=e=>v(O).message=e),editor:v(P),config:U},null,8,["modelValue","editor"])):I("",!0)])])])),action:u((()=>[p(a,{type:"submit",color:"primary",loading:v(w),raised:""},{default:u((()=>[Ge,y(" Send Proposal")])),_:1},8,["loading"])])),cancel:u((()=>[p(a,{color:"light",onClick:x,raised:""},{default:u((()=>[y("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),Qe=B();N();const Xe=async e=>{try{const l=await Qe.get(`/api/lead-proposal/${e.id}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`Proposal-${e.title}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)}catch(l){console.error("Error downloading PDF:",l)}},Ye=async e=>{try{const l=await Qe.get(`/api/lead-proposal/${e}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=URL.createObjectURL(a),t=document.createElement("iframe");t.style.display="none",t.src=o,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print(),document.body.removeChild(t)}}catch(l){console.error("Error printing PDF:",l)}},Ze=e=>(S("data-v-402cf1e2"),e=e(),T(),e),el={class:"columns is-multiline"},ll=Ze((()=>c("div",{class:"column is-9"},[c("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),c("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),al={class:"column is-12"},ol={class:"invoice-wrapper"},tl={class:"invoice-header"},sl={class:"left"},nl={class:"right"},il={class:"controls"},rl=[Ze((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"},null,-1)))],dl=[Ze((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"},null,-1)))],ul=[Ze((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],cl={class:"invoice-body"},pl={class:"invoice-card"},ml={class:"invoice-section is-flex is-bordered"},_l=Ze((()=>c("div",{class:"meta"},null,-1))),vl=Ze((()=>c("div",{class:"end is-right"},[c("span",null,"PO Box 242"),c("span",null,"Evergreen, CO 80437-0242"),c("span",null,"Phone: 720 272-9061"),c("span",null,"Premium Trades for Premier Builders")],-1))),fl={class:"invoice-section is-flex is-bordered"},bl={class:"meta"},hl={class:"end is-left"},yl={class:"invoice-section"},Il={class:"responsive-table"},gl=["innerHTML"],wl={key:1},kl={key:2},Cl={class:"invoice-section is-flex mt-0 pt-0"},Pl={class:"end is-left"},Vl={class:"text-right"},Dl=x('<div class="invoice-section is-flex mt-0 pt-0" data-v-402cf1e2><div class="footer" data-v-402cf1e2><div class="footer-meta" data-v-402cf1e2><p data-v-402cf1e2>Signature:</p><div data-v-402cf1e2> ___________________________________________________________________________________ </div></div><div class="footer-meta" data-v-402cf1e2><p data-v-402cf1e2>Date:</p><div data-v-402cf1e2> ___________________________________________________________________________________ </div></div><div class="footer-meta" data-v-402cf1e2><p class="no-wrap" data-v-402cf1e2>Print Name:</p><div data-v-402cf1e2> ___________________________________________________________________________________ </div></div></div></div>',1),xl=j(e({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const l=e,o=Fe(),t=a(!1),s=a([]),i=a([]),u=a({}),m=()=>{i.value.push(l.proposalData.id),u.value=l.proposalData,s.value=o.leadProposalFormData.columns_to_show,t.value=!t.value};return n((()=>{})),(e,a)=>{const s=J,n=Ke;return r(),f("div",el,[ll,c("div",al,[c("div",ol,[c("div",tl,[c("div",sl,[c("h3",null," Proposal-ID "+w(v(o).leadProposalFormData?.id.slice(0,8)),1)]),c("div",nl,[c("div",il,[c("a",{class:"action",onClick:a[0]||(a[0]=e=>v(Ye)(v(o).leadProposalFormData?.id))},rl),c("a",{class:"action",onClick:a[1]||(a[1]=e=>v(Xe)(v(o).leadProposalFormData))},dl),c("a",{class:"action",onClick:m},ul)])])]),c("div",cl,[c("div",pl,[c("div",ml,[p(s,{size:"xl",picture:"/logos/IbexFavicon.png"}),_l,vl]),c("div",fl,[c("div",bl,[c("h3",null,w(v(o).leadProposalFormData?.jobInfo?.clientInfo?.username??"N/A")+" "+w(v(o).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1),c("span",null,w(v(o).leadProposalFormData?.jobInfo?.clientInfo?.email?v(o).leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A"),1)]),c("div",hl,[c("h3",null,w(v(o).leadProposalFormData?.title),1),c("p",null," Job Address: "+w(v(o).leadProposalFormData?.jobInfo?.address??"N/A"),1)])]),c("div",yl,[c("table",Il,[c("thead",null,[(r(!0),f(h,null,b(v(o).leadProposalFormData.columns_to_show,((e,l)=>(r(),f("th",{key:l},w(e),1)))),128))]),c("tbody",null,[(r(!0),f(h,null,b(v(o).proposalCostItems,((e,l)=>(r(),f("tr",{key:e.id},[(r(!0),f(h,null,b(v(o).leadProposalFormData.columns_to_show,((l,a)=>(r(),f("td",{key:a},["Description"===l?(r(),f("div",{key:0,innerHTML:e[v(G)[a]]},null,8,gl)):(r(),f("span",wl,w(e[v(G)[a]]),1)),"Cost Code"===l?(r(),f("span",kl,w(e?.cost_code_info?.name),1)):I("",!0)])))),128))])))),128))])])]),c("div",Cl,[c("div",Pl,[c("h3",Vl," Total Price: $"+w(v(o).leadProposalFormData?.proposalAmount),1)])]),Dl])])])]),v(t)?(r(),d(n,{key:0,proposalSenderModal:v(t),selectedProposalsIds:v(i),proposalData:l.proposalData,columnsToShow:l.columnsToShow,"onUpdate:modalHandler":a[2]||(a[2]=e=>t.value=!1)},null,8,["proposalSenderModal","selectedProposalsIds","proposalData","columnsToShow"])):I("",!0)])}}}),[["__scopeId","data-v-402cf1e2"]]),Sl=e=>(S("data-v-9e0afe25"),e=e(),T(),e),Tl={class:"datatable-wrapper mt-0"},jl={class:"table-container"},Ol={class:"table datatable-table is-fullwidth",id:"external-events"},Ml=Sl((()=>c("th",null,"Item#",-1))),Al=Sl((()=>c("th",null,"Actions",-1))),Ul=["data-event","onDragstart","onDrop"],Fl={class:"is-relative"},El=["onClick"],Ll=Sl((()=>c("i",{style:{cursor:"grab"},class:"lnir lnir-sort","aria-hidden":"true"},null,-1))),$l=["innerHTML"],Hl={key:1},Rl={key:2},ql=["onClick"],Bl=[Sl((()=>c("div",{class:"icon"},[c("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1))),Sl((()=>c("div",{class:"meta"},[c("span",null,"View"),c("span",null,"View user details")],-1)))],Nl=["onClick"],zl=[Sl((()=>c("div",{class:"icon"},[c("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),Sl((()=>c("div",{class:"meta"},[c("span",null,"Edit"),c("span",null,"Edit Cost Item")],-1)))],Wl=Sl((()=>c("hr",{class:"dropdown-divider"},null,-1))),Jl=["onClick"],Gl=[Sl((()=>c("div",{class:"icon"},[c("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),Sl((()=>c("div",{class:"meta"},[c("span",null,"Remove"),c("span",null,"Remove from list")],-1)))],Kl=e({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{}},setup(e){const l=e,o=Fe(),t=N(),s=a({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),i=B(),m=a(""),_=a(!1);a([]);const g=e=>{e.preventDefault()},C=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},P=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},V=a(""),D=a(0),x=a(""),S=a(!1),T=a(!1),j=async()=>{try{T.value=!0;await i.delete(`/api/cost/${x.value}/`);M(),s.value.isSweetAlertOpen=!1,t.success("Cost item deleted")}catch(e){console.log(e)}finally{T.value=!1}},O=(e,l=!1)=>{x.value=e.id,S.value=l,V.value=e.proposal,_.value=!_.value},M=()=>{o.getProposalCostItems(V.value)};return n((()=>{})),(e,a)=>{const t=Z,n=Y,T=Ue;return r(),f("div",Tl,[c("div",jl,[c("table",Ol,[c("thead",null,[Ml,(r(!0),f(h,null,b(l.columnsToShow,((e,l)=>(r(),f("th",{key:l},w(v(K)[e]),1)))),128)),Al]),c("tbody",null,[v(o).proposalCostItems.length>0?(r(!0),f(h,{key:0},b(v(o).proposalCostItems,((e,a)=>(r(),f("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,m.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=o.proposalCostItems.find((e=>e.id===m.value)),a=o.proposalCostItems.find((l=>l.id===e));if(l&&a){i.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=o.proposalCostItems.indexOf(l),t=o.proposalCostItems.indexOf(a);e>=0&&t>=0&&(o.proposalCostItems.splice(e,1),o.proposalCostItems.splice(t,0,l))}else console.error("Dragged or Dropped Item not found");m.value=null})(e.id),onDragover:g,onDragenter:C,onDragleave:P,class:"draggable-item events"},[c("td",Fl,[c("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","font-weight":"600"},onClick:l=>(e=>{V.value=e.proposal,D.value=e.index,_.value=!_.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,El),Ll,y(" "+w(a+1),1)]),(r(!0),f(h,null,b(l.columnsToShow,((l,a)=>(r(),f("td",{key:a},["description"===l?(r(),f("div",{key:0,innerHTML:e[v(G)[l]]},null,8,$l)):(r(),f("span",Hl,w(e[v(G)[l]]),1)),"cost_code"===l?(r(),f("span",Rl,w(e?.cost_code_info?.name),1)):I("",!0)])))),128)),c("td",null,[p(t,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:""},{content:u((({close:l})=>[c("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:k((()=>{O(e,!0),l()}),["prevent"])},Bl,8,ql),c("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:k((()=>{O(e,!1),l()}),["prevent"])},zl,8,Nl),Wl,c("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:k((()=>{(e=>{x.value=e.id,V.value=e.proposal,s.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},Gl,8,Jl)])),_:2},1024)])],40,Ul)))),128)):I("",!0)])])]),v(s).isSweetAlertOpen?(r(),d(n,{key:0,isSweetAlertOpen:v(s).isSweetAlertOpen,title:v(s).title,subtitle:v(s).subtitle,btntext:v(s).btntext,onConfirm:j,onCancel:()=>v(s).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):I("",!0),v(_)?(r(),d(T,{key:1,costItemModal:v(_),proposalId:v(V),costItemId:v(x),previousItemIndex:v(D),previewCostItems:v(S),"onUpdate:modalHandler":a[0]||(a[0]=e=>_.value=!1),"onUpdate:OnSuccess":M},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):I("",!0)])}}}),Ql=j(Kl,[["__scopeId","data-v-9e0afe25"]]),Xl={class:"columns is-multiline"},Yl={class:"column is-12 is-flex space-between"},Zl=c("div",null,[c("h1",{class:"title is-4"},"Proposal Worksheet")],-1),ea={key:0,class:"column is-12"},la={class:"tabs-wrapper column is-12 m-0"},aa={class:"tabs-inner mt-4"},oa={class:"tabs is-boxed"},ta=[c("span",null,"Worksheet",-1)],sa=[c("span",null,"Format",-1)],na=[c("span",null,"Preview",-1)],ia={key:0,class:"column is-12"},ra={key:0,class:"column is-12"},da={class:"columns is-multiline"},ua=c("div",{class:"column is-12",style:{"text-align":"center"}},[c("h1",{class:"title is-4"},"Connect your clients to their projects"),c("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),ca={class:"column is-12"},pa={key:0,class:"column is-12"},ma=e({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:o}){const m=e,_=l(),b=Fe(),h=a(!1),w=a(!1),V=a("worksheet");t((()=>s((()=>import("./ckeditor-d19482ea.js").then((e=>e.c))),["assets/ckeditor-d19482ea.js","assets/index-e91e92d7.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-232cb55d.js"]).then((e=>e.default.component))));const D=async()=>{try{b.getProposalCostItems(m.proposalId)}catch(e){console.log(e)}};return n((async()=>{_.value=await s((()=>import("./ckeditor-66a8143e.js").then((e=>e.c))),["assets/ckeditor-66a8143e.js","assets/index-e91e92d7.js","assets/index-ce8747cd.css"]).then((e=>e.default)),m.proposalId&&(D(),b.getProposalDetail(m.proposalId))})),O((()=>{b.clearProposalId()})),(e,l)=>{const a=C,o=i("Multiselect"),t=H,s=$,n=Ql,_=P,b=xl,x=Ue;return r(),f("div",null,[c("div",Xl,[c("div",Yl,[Zl,c("div",null,[p(a,{size:"small",light:"",outlined:"",icon:"fas fa-cog",class:"mr-2",color:v(w)?"danger":"success",onClick:l[0]||(l[0]=e=>w.value=!v(w))},{default:u((()=>[y("Table")])),_:1},8,["color"]),p(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"info",onClick:l[1]||(l[1]=e=>h.value=!v(h))},{default:u((()=>[y("Import")])),_:1}),p(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"primary",onClick:l[2]||(l[2]=e=>h.value=!v(h))},{default:u((()=>[y("Add From")])),_:1}),p(a,{size:"small",light:"",outlined:"",color:"warning",onClick:l[3]||(l[3]=e=>h.value=!v(h))},{default:u((()=>[y("Add Item")])),_:1})])]),p(M,{class:"fade-slow",name:"fade-slow"},{default:u((()=>[v(w)?(r(),f("div",ea,[p(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[p(t,null,{default:u((()=>[p(o,{modelValue:v(Q),"onUpdate:modelValue":l[4]||(l[4]=e=>g(Q)?Q.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:v(X),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):I("",!0)])),_:1}),c("div",la,[c("div",aa,[c("div",oa,[c("ul",null,[c("li",{class:A(["worksheet"===v(V)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[5]||(l[5]=U(k((e=>V.value="worksheet"),["prevent"]),["space"])),onClick:l[6]||(l[6]=e=>V.value="worksheet")},ta,32)],2),c("li",{class:A(["format"===v(V)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[7]||(l[7]=U(k((e=>V.value="format"),["prevent"]),["space"])),onClick:l[8]||(l[8]=e=>V.value="format")},sa,32)],2),c("li",{class:A(["preview"===v(V)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[9]||(l[9]=U(k((e=>V.value="preview"),["prevent"]),["space"])),onClick:l[10]||(l[10]=e=>V.value="preview")},na,32)],2)])])])]),p(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["worksheet"===v(V)?(r(),f("div",ia,[p(n,{columnsToShow:v(Q),proposalId:m.proposalId},null,8,["columnsToShow","proposalId"])])):I("",!0)])),_:1}),p(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["format"===v(V)?(r(),f("div",ra,[c("div",da,[p(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[p(t,null,{default:u((()=>[p(o,{modelValue:v(Q),"onUpdate:modelValue":l[11]||(l[11]=e=>g(Q)?Q.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:v(X),placeholder:"Add tags"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),p(_,{class:"columns is-multiline m-0"},{default:u((()=>[ua,c("div",ca,[p(n,{columnsToShow:v(Q)},null,8,["columnsToShow"])])])),_:1})])):I("",!0)])),_:1}),p(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["preview"===v(V)?(r(),f("div",pa,[p(b,{proposalData:m.proposalData,columnsToShow:v(Q)},null,8,["proposalData","columnsToShow"])])):I("",!0)])),_:1})]),v(h)?(r(),d(x,{key:0,costItemModal:v(h),proposalId:m.proposalId,"onUpdate:modalHandler":l[12]||(l[12]=e=>h.value=!1),"onUpdate:OnSuccess":D},null,8,["costItemModal","proposalId"])):I("",!0)])}}}),_a=e=>(S("data-v-0317543a"),e=e(),T(),e),va={class:"columns is-multiline"},fa=_a((()=>c("div",{class:"column is-2"},null,-1))),ba={class:"column is-8"},ha=_a((()=>c("div",{class:"column is-2"},null,-1))),ya=_a((()=>c("div",{class:"column is-2"},null,-1))),Ia=_a((()=>c("div",{class:"column is-8"},[c("p",null," All the tasks will be generated and will start from the date you will put. ")],-1))),ga=_a((()=>c("div",{class:"column is-2"},null,-1))),wa=e({__name:"CreateProposalTasksModal",props:{createProposalTasksModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(e,{emit:l}){const o=e,t=N(),s=B(),i=a(""),m=a(!1),_=()=>{l("update:OnSuccess",null),l("closeModalHandler",!1)},f=async()=>{try{await s.post("/api/lead-proposal/create-tasks/",{start:i.value,proposal:o.proposalId});t.success("Tasks of this proposal are created in calendar successfully."),_()}catch(e){console.log(e),t.error("Something went wrong, please review the cost codes")}};return n((()=>{})),(e,l)=>{const a=L,t=H,s=$,n=C,b=F;return r(),d(b,{is:"form",open:o.createProposalTasksModal,title:"Generate Tasks",size:"small",actions:"center",onSubmit:k(f,["prevent"]),onClose:_},{content:u((()=>[c("div",va,[fa,c("div",ba,[p(s,{label:"Enter Tasks Starting Date"},{default:u((()=>[p(t,null,{default:u((()=>[p(a,{modelValue:v(i),"onUpdate:modelValue":l[0]||(l[0]=e=>g(i)?i.value=e:null),required:"",name:"startDate",type:"date"},null,8,["modelValue"])])),_:1})])),_:1})]),ha,ya,Ia,ga])])),cancel:u((()=>[p(n,{light:"",onClick:l[1]||(l[1]=e=>_())},{default:u((()=>[y("Cancel")])),_:1})])),action:u((()=>[p(n,{loading:v(m),type:"submit",color:"info",light:"",raised:""},{default:u((()=>[y("Generate")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),ka=j(wa,[["__scopeId","data-v-0317543a"]]);export{ma as _,Ke as a,ka as b,Ue as c,Fe as u};
