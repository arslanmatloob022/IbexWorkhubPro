import{e,r as l,o as a,B as t,N as s,F as o,E as r,J as i,I as n,O as p,R as d,s as u,x as c,v as m,b as _,_ as v,C as f,D as y,l as g,M as b,G as h,T as w,K as x,W as k,U as V,z as C}from"./index-e7dfe9a4.js";import{_ as I}from"./VModal.vue_vue_type_style_index_0_lang-417ace5b.js";import{_ as S}from"./VField.vue_vue_type_script_setup_true_lang-687923b6.js";import{_ as T}from"./VControl-481683c7.js";import{_ as j}from"./VInput.vue_vue_type_script_setup_true_lang-6ddab63d.js";import{u as A}from"./useAPI-91510d39.js";import{u as O}from"./useNotyf-987b3464.js";import{u as P,_ as D,b as U,a as M,k as z}from"./CreateProposalTasksModal-04d179f2.js";import{_ as N}from"./SweetAlert.vue_vue_type_style_index_0_lang-7ea203fc.js";import{_ as q}from"./VCollapse.vue_vue_type_style_index_0_lang-5a8249c0.js";import{_ as E}from"./VTextarea.vue_vue_type_script_setup_true_lang-35eabc19.js";import{_ as $}from"./VRadio.vue_vue_type_style_index_0_lang-0d806d2e.js";import{_ as H}from"./VMessage.vue_vue_type_style_index_0_lang-db207ffd.js";import{_ as F}from"./V-Snack.vue_vue_type_style_index_0_lang-974ba9c9.js";import{a as L}from"./useSupportElement-6aaafdea.js";import{s as R}from"./costItems-f71f117e.js";import{u as Y}from"./useDropdown-9b86a7ec.js";import{u as B}from"./viewWrapper-ad348552.js";import"./VLabel.vue_vue_type_script_setup_true_lang-771cf1a5.js";import"./useVFieldContext-dbc06bde.js";import"./userSession-a8987e04.js";import"./notyf-79dfe734.js";import"./useThemeColors-a807ce5c.js";import"./VCheckbox.vue_vue_type_style_index_0_lang-e74e77d7.js";import"./VOption.vue_vue_type_style_index_0_lang-ecc7ba73.js";import"./VAvatar.vue_vue_type_style_index_0_lang-0dd05b73.js";import"./VIconButton-693920a7.js";import"./VDropdown.vue_vue_type_style_index_0_lang-dccc85ca.js";import"./VIcon.vue_vue_type_script_setup_true_lang-578186d3.js";const J=d(e({__name:"CreateTemplateModal",props:{openCreateTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const u=e,c=A(),m=O();l([]);const _=l(null);l(!1);const v=l(""),f=()=>{d("update:modalHandler",!1)},y=async()=>{console.log(_);try{await c.post(`/api/lead-proposal/${u.proposalId}/create-template/`,{title:v.value});m.success("Template Create successfully!"),f()}catch(e){console.error("Error importing template:",e),m.error("Something went wrong, try again")}};return a((()=>{})),(e,l)=>{const a=j,d=T,c=S,m=p,_=I;return t(),s(_,{open:u.openCreateTemplate,size:"small",is:"form",title:"Create Template",actions:"right",onSubmit:n(y,["prevent"]),onClose:f},{content:o((()=>[r(c,{label:"Enter title to identify your saved template"},{default:o((()=>[r(d,null,{default:o((()=>[r(a,{required:"",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),type:"text",placeholder:" Template Title"},null,8,["modelValue"])])),_:1})])),_:1})])),action:o((()=>[r(m,{color:"primary",type:"submit",raised:""},{default:o((()=>[i("Confirm")])),_:1})])),cancel:o((()=>[r(m,{color:"primary",style:{display:"none"},raised:""},{default:o((()=>[i("Close")])),_:1})])),_:1},8,["open","onSubmit"])}}}),[["__scopeId","data-v-3fb59420"]]),W={class:"modal-form columns is-multiline"},G={class:"column is-12 is-flex align-items-center",style:{"justify-content":"end"}},K={class:"is-flex",style:{gap:"43px"}},Q=y("i",{class:"fas fa-"},null,-1),X={class:"toolbar-notifications is-hidden-mobile"},Z={class:"dropdown-menu",role:"menu",style:{"min-width":"260px"}},ee={class:"dropdown-content p-4"},le={class:"columns is-multiline"},ae={class:"column is-6 pl-3 pr-3 pb-2 pt-2"},te=y("i",{class:"fas fa-plus"},null,-1),se={class:"column is-6 pl-3 pr-0 pb-2 pt-2"},oe={class:"column is-6 p-0 pl-3 pb-2"},re=y("i",{class:"fas fa-envelope mr-1"},null,-1),ie={class:"column is-6 p-0 pl-3 pb-2 pr-0"},ne=y("i",{class:"fas fa-check"},null,-1),pe={class:"column is-6 p-0"},de={key:0,class:"column is-12"},ue={class:"field column is-6 mb-0"},ce=y("label",null,"Title: *",-1),me={class:"control"},_e={class:"column is-6"},ve={class:"field column is-6"},fe=y("label",null,"Approval Deadline *",-1),ye={class:"control"},ge={class:"field column is-6"},be=y("label",null,"Attachments",-1),he=y("div",{class:"file"},[y("label",{class:"file-label"},[y("input",{class:"file-input",type:"file",name:"resume"}),y("span",{class:"file-cta"},[y("span",{class:"file-icon"},[y("i",{class:"fas fa-cloud-upload-alt"})]),y("span",{class:"file-label"}," Choose a file… ")])])],-1),we={class:"field column is-12"},xe={class:"body-inner-content"},ke={class:"field columns is-multiline mb-0"},Ve={class:"field column is-11 mb-0"},Ce=y("label",{for:"",class:"label"},"Internal Notes",-1),Ie={class:"field column is-11 mb-0"},Se=y("label",{for:"",class:"label"},"Introductory Text",-1),Te={class:"field column is-11 mb-0"},je=y("label",{for:"",class:"label"},"Closing Text",-1),Ae={class:"column is-12"},Oe=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const C=e,I=l(),j=Y(I),B=u(),Oe=P(),Pe=O(),De=A(),Ue=c(),Me=m(),ze=l(!1),Ne=l(""),qe=l(""),Ee=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),$e=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],He=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Fe=l({title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",is_task_created:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),Le=async()=>{try{const e=await De.get(`/api/lead-proposal/${Ue.params.id}/detail/`);Fe.value=e.data,Oe.getProposalCostItems(Ue.params.id)}catch(e){console.log(e)}},Re=async()=>{try{ze.value=!0,Fe.value.columns_to_show=JSON.stringify(R.value);const e=L(Fe.value,[]);if(C.proposalId||Fe.value.id){const l=await De.patch(`/api/lead-proposal/${C.proposalId?C.proposalId:Fe.value.id}/`,e);Fe.value=l.data}Pe.success("Proposal updated successfully"),Le()}catch(e){Pe.error("Something went wrong, try again")}finally{ze.value=!1}},Ye=async()=>{try{ze.value=!0;await De.delete(`/api/lead-proposal/${qe.value}/`);He.value.isSweetAlertOpen=!1,Pe.success("Proposal delete successfully"),Me.go(-1)}catch(e){Pe.error(` ${e}, Proposal`),Pe.error("Something went wrong please try later")}finally{ze.value=!1}},Be=async()=>{try{ze.value=!0;await De.patch(`/api/lead-proposal/${Ue.params.id}/`,{status:Ne.value});Le(),Pe.success(`You have ${Ne.value} this proposal.`),He.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{ze.value=!1}},Je=l(!1),We=l("");l("worksheet");const Ge=_((()=>v((()=>import("./ckeditor-42ec909e.js").then((e=>e.c))),["assets/ckeditor-42ec909e.js","assets/index-e7dfe9a4.js","assets/index-a879fc9d.css","assets/vue.runtime.esm-bundler-73b6f855.js"]).then((e=>e.default.component)))),Ke={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},Qe=l(!1),Xe=l([]),Ze=l({}),el=l(!1),ll=()=>{Ze.value=Oe.leadProposalFormData,Xe.value.push(Oe.leadProposalFormData),el.value=!el.value};return a((async()=>{B.value=await v((()=>import("./ckeditor-f948dc44.js").then((e=>e.c))),["assets/ckeditor-f948dc44.js","assets/index-e7dfe9a4.js","assets/index-a879fc9d.css"]).then((e=>e.default)),(C.proposalId||Ue.params.id)&&(Le(),Oe.getProposalDetail(C.proposalId||Ue.params.id))})),(e,l)=>{const a=p,d=F,u=H,c=$,m=T,_=S,v=E,A=q,O=D,P=N,L=U,R=M,Y=J;return t(),f(V,null,[y("div",W,[y("div",G,[y("div",K,[y("div",null,[g(Fe).is_task_created||"approved"!=g(Fe).status?b("",!0):(t(),s(a,{key:0,onClick:l[0]||(l[0]=e=>{return l=g(Ue).params.id,We.value=l,void(Je.value=!0);var l}),size:"xsmall",class:"mr-2",light:"",outlined:"",color:"success",raised:""},{default:o((()=>[i(" Generate Tasks ")])),_:1})),r(a,{onClick:Re,size:"xsmall",class:"mr-2",light:"",outlined:"",color:"primary",raised:""},{default:o((()=>[i(" Update ")])),_:1}),r(a,{size:"xsmall",onClick:l[1]||(l[1]=e=>{return l=g(Fe).id,qe.value=l,void(Ee.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),light:"",outlined:"",icon:"fas fa-trash",color:"danger",raised:""},{default:o((()=>[Q])),_:1})]),y("div",X,[y("div",{ref_key:"dropdownElement",ref:I,class:"dropdown is-spaced is-dots is-right dropdown-trigger"},[y("div",{tabindex:"0",class:"is-trigger","aria-haspopup":"true",onClick:l[2]||(l[2]=(...e)=>g(j).toggle&&g(j).toggle(...e)),onKeydown:l[3]||(l[3]=h(n(((...e)=>g(j).toggle&&g(j).toggle(...e)),["prevent"]),["space"]))},[r(a,{size:"xsmall",class:"mr-2",light:"",style:{"margin-top":"-6px"},outlined:"",color:"success",raised:""},{default:o((()=>[i("More Action")])),_:1})],32),y("div",Z,[y("div",ee,[y("div",le,[y("div",ae,[r(a,{onClick:l[4]||(l[4]=e=>Qe.value=!g(Qe)),size:"xsmall",class:"mr-2",light:"",outlined:"",color:"success",raised:""},{default:o((()=>[te,i(" Create Template ")])),_:1})]),y("div",se,[r(a,{size:"xsmall",light:"",outlined:"",raised:"",color:"warning",icon:"fa fa-cloud-download-alt",onClick:l[5]||(l[5]=e=>g(z)(g(Oe).leadProposalFormData))},{default:o((()=>[i(" Download ")])),_:1})]),y("div",oe,[r(a,{size:"xsmall",light:"",raised:"",onClick:ll,class:"ml-1",outlined:"",color:"success"},{default:o((()=>[re,i(" Send Mail          ")])),_:1})]),y("div",ie,["approved"!=g(Fe).status?(t(),s(a,{key:0,onClick:l[6]||(l[6]=e=>{return l="approved",Ne.value=l,void(He.value={title:`${Ne.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==Ne.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==Ne.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var l}),size:"xsmall",class:"mr-2 ml-1",light:"",outlined:"",color:"info",raised:""},{default:o((()=>[ne,i(" Approved ")])),_:1})):(t(),s(a,{key:1,light:"",size:"xsmall",color:"primary",class:"ml-1",icon:"fas fa-check-circle"},{default:o((()=>[i(" Approved ")])),_:1}))]),y("div",pe,[g(Fe).is_task_created?(t(),s(d,{key:0,title:"Calendar Tasks Created ",white:"",class:"ml-2",color:"info",icon:"fas fa-calendar-check"})):b("",!0)])])])])],512)])])]),g(Fe).client_note&&"review"==g(Fe).status?(t(),f("div",de,[r(u,{color:"warning"},{default:o((()=>[i(w(g(Fe).client_note),1)])),_:1})])):b("",!0),y("div",ue,[ce,y("div",me,[x(y("input",{type:"text",name:"firstName","onUpdate:modelValue":l[7]||(l[7]=e=>g(Fe).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[k,g(Fe).title]])])]),y("div",_e,[r(_,{class:"m-0 p-0",label:"Type"},{default:o((()=>[r(m,null,{default:o((()=>[r(c,{modelValue:g(Fe).type,"onUpdate:modelValue":l[8]||(l[8]=e=>g(Fe).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),r(c,{modelValue:g(Fe).type,"onUpdate:modelValue":l[9]||(l[9]=e=>g(Fe).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),r(c,{modelValue:g(Fe).type,"onUpdate:modelValue":l[10]||(l[10]=e=>g(Fe).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",ve,[fe,y("div",ye,[x(y("input",{type:"date",name:"firstName","onUpdate:modelValue":l[11]||(l[11]=e=>g(Fe).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[k,g(Fe).approval_deadline]])])]),y("div",ge,[be,r(_,{grouped:""},{default:o((()=>[r(m,null,{default:o((()=>[he])),_:1})])),_:1})]),y("div",we,[r(A,{items:$e,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":o((e=>[y("div",xe,[y("div",ke,[y("div",Ve,[Ce,r(_,null,{default:o((()=>[r(m,null,{default:o((()=>[r(v,{modelValue:g(Fe).internalNotes,"onUpdate:modelValue":l[12]||(l[12]=e=>g(Fe).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",Ie,[Se,g(B)?(t(),s(g(Ge),{key:0,modelValue:g(Fe).introductoryText,"onUpdate:modelValue":l[13]||(l[13]=e=>g(Fe).introductoryText=e),editor:g(B),config:Ke},null,8,["modelValue","editor"])):b("",!0)]),y("div",Te,[je,g(B)?(t(),s(g(Ge),{key:0,modelValue:g(Fe).closingText,"onUpdate:modelValue":l[14]||(l[14]=e=>g(Fe).closingText=e),editor:g(B),config:Ke},null,8,["modelValue","editor"])):b("",!0)])])])])),_:1})]),y("div",Ae,[r(O,{proposalData:g(Fe),proposalId:g(Fe).id},null,8,["proposalData","proposalId"])]),g(He).isSweetAlertOpen?(t(),s(P,{key:1,isSweetAlertOpen:g(He).isSweetAlertOpen,title:g(He).title,subtitle:g(He).subtitle,btntext:g(He).btntext,onConfirm:Be,onCancel:()=>g(He).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),g(Ee).isSweetAlertOpen?(t(),s(P,{key:2,isSweetAlertOpen:g(Ee).isSweetAlertOpen,title:g(Ee).title,subtitle:g(Ee).subtitle,btntext:g(Ee).btntext,onConfirm:Ye,onCancel:()=>g(Ee).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),g(Je)?(t(),s(L,{key:3,createProposalTasksModal:g(Je),proposalId:g(We),onCloseModalHandler:l[15]||(l[15]=e=>Je.value=!1),"onUpdate:OnSuccess":l[16]||(l[16]=()=>{})},null,8,["createProposalTasksModal","proposalId"])):b("",!0),g(el)?(t(),s(R,{key:4,proposalSenderModal:g(el),selectedProposalsIds:g(Xe),proposalData:g(Ze),"onUpdate:modalHandler":l[17]||(l[17]=e=>{el.value=!1,Xe.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData"])):b("",!0)]),g(Qe)?(t(),s(Y,{key:0,proposalId:g(Ue).params.id,openCreateTemplate:g(Qe),"onUpdate:OnSuccess":l[18]||(l[18]=()=>{(C.proposalId||g(Ue).params.id)&&Le()}),"onUpdate:modalHandler":l[19]||(l[19]=e=>Qe.value=!1)},null,8,["proposalId","openCreateTemplate"])):b("",!0)],64)}}}),Pe=e({__name:"[id]",setup:e=>(B().setPageTitle("Lead Proposals"),C({title:"Lead Proposals - Ibex"}),(e,l)=>(t(),f("div",null,[r(Oe)])))});export{Pe as default};
