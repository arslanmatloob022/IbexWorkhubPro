import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-248bedae.js";import{_ as t}from"./ScheduleEmailModal.vue_vue_type_script_setup_true_lang-b788d82e.js";import{_ as l}from"./VModal.vue_vue_type_style_index_0_lang-cc2df632.js";import{f as a,r as i,b as s,o as n,B as o,C as u,O as c,G as d,E as r,F as p,L as m,m as v,X as y,D as _,V as f,W as b,K as g,U as h,J as A,N as k,a5 as V,P as w,$ as U,av as j,k as C,I as S,aS as x,a4 as I}from"./index-5abab93c.js";import{_ as $}from"./VTextarea.vue_vue_type_script_setup_true_lang-91706865.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-37e68479.js";import{_ as O}from"./VField.vue_vue_type_script_setup_true_lang-75e62cce.js";import{_ as P}from"./VControl-85c123a4.js";import{_ as M,a as z}from"./VOption.vue_vue_type_style_index_0_lang-77331b36.js";import{u as E}from"./useAPI-a1737641.js";import{u as q}from"./useNotyf-d70c19fd.js";import{a as L,g as D,d as H}from"./useSupportElement-e00ebb58.js";import{a as B}from"./estimatesScripts-48c8895a.js";import{_ as N}from"./VAvatar.vue_vue_type_style_index_0_lang-baeb3a61.js";import{_ as R}from"./VIcon.vue_vue_type_script_setup_true_lang-6fcbfb3b.js";import{_ as Z}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-5783af8e.js";import{_ as F}from"./PlaceloadV3.vue_vue_type_style_index_0_lang-b042016d.js";import{_ as G,a as J}from"./search-3-dark-b5ef2271.js";const W={class:"modal-form columns is-multiline"},Y={class:"column is-12"},K=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Activity Information")],-1),X={class:"field column is-12 mb-0"},Q=r("label",null,"Title *",-1),ee={class:"control"},te={class:"field column is-6 mb-0"},le=r("label",null,"Activity Type *",-1),ae={class:"field column is-6"},ie=r("label",null,"Status",-1),se={class:"multiselect-single-label"},ne={class:"field column is-6 mb-0"},oe=r("label",null,"Date ",-1),ue={class:"field column is-3 mb-0"},ce=r("label",null,"Start Time ",-1),de={class:"field column is-3 mb-0"},re=r("label",null,"End Time ",-1),pe={class:"field column is-3 mb-0"},me=r("label",null,"Color ",-1),ve=r("datalist",{id:"colors-list"},[r("option",{value:"#84cc16"}),r("option",{value:"#22c55e"}),r("option",{value:"#0ea5e9"}),r("option",{value:"#6366f1"}),r("option",{value:"#8b5cf6"}),r("option",{value:"#d946ef"}),r("option",{value:"#f43f5e"}),r("option",{value:"#facc15"}),r("option",{value:"#fb923c"}),r("option",{value:"#9ca3af"})],-1),ye={class:"field column is-3 mb-0"},_e=r("label",null,"Reminder time: ",-1),fe={class:"field column is-3 mb-0"},be=r("label",null,"Attachment ",-1),ge={class:"file"},he={class:"file-label"},Ae={class:"file-cta"},ke=r("span",{class:"file-icon"},[r("i",{class:"fas fa-cloud-upload-alt"})],-1),Ve={class:"file-label"},we={class:"field column is-12 mb-0"},Ue=r("label",null,"Assigned * ",-1),je={class:"multiselect-tag is-user"},Ce=["src"],Se=["onMousedown"],xe=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Location")],-1),Ie={class:"field column is-4 mb-0"},$e=r("label",null,"Zip Code ",-1),Te={class:"control"},Oe={class:"field column is-4 mb-0"},Pe=r("label",null,"City ",-1),Me={class:"control"},ze={class:"field column is-4 mb-0"},Ee=r("label",null,"State ",-1),qe={class:"control"},Le={class:"field column is-12 mb-0"},De=r("label",null,"Street Address",-1),He={class:"control"},Be={class:"field column is-12 mb-0"},Ne=r("label",null,"Description ",-1),Re=a({__name:"LeadActivityModal",props:{addUpdateContactModal:{type:Boolean},activityId:{},objectId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const a=e;i(null);const U=s(),j=q(),C=E(),S=i(!1),x=()=>{t("update:modalHandler",!1)},I=i([{value:"",name:"",image:""}]),H=i([{label:"Pending",value:"pending"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"},{label:"Rescheduled",value:"rescheduled"},{label:"In Progress",value:"in_progress"}]),N=i({title:"",objectId:a.objectId??"",type:"",color:"",status:"pending",date:"",start_time:"",end_time:"",reminder_time:"",assignedUser:"",attendees:[],initiated_by:U.user.id,address:"",city:"",state:"",zip_code:"",description:"",latitude:0,longitude:0,file:""}),R=async()=>{try{S.value=!0;const e=L(N.value,["file"]);if(a.activityId){await C.patch(`/api/activity/${a.activityId}/`,e);j.success("Activity updated successfully")}else{await C.post("/api/activity/",e);j.success("Activity added successfully")}t("update:OnSuccess",null),x()}catch(e){j.error(` ${e}, Activity`)}finally{S.value=!1}},Z=async()=>{if(!N.value.zip_code)return;const e=await D(N.value.zip_code);console.log("API Response:",e),e?.status&&e.data?(N.value.latitude=e.data.lat,N.value.longitude=e.data.lng,N.value.address=e.data.address,N.value.city=e.data.city,N.value.state=e.data.state,j.success("Address fetched successfully")):console.log("Address not found.")},F=i(""),G=i(0),J=e=>{const t=e.target,l=t.files?.[0];t.value="",l&&(N.value.file=l,F.value=l.name,G.value=l.size)};return n((()=>{(async()=>{try{S.value=!0;const e=await C.get("/api/users/");I.value=e.data.map((e=>({value:e.id,name:`${e.username??"N/A"} ${e.last_name??""}`,icon:e.avatar})))}catch(e){j.error("something get wrong")}finally{S.value=!1}})(),a.activityId&&(async()=>{try{S.value=!0;const e=await C.get(`/api/activity/${a.activityId}/`);N.value=e.data}catch(e){j.error(` ${e}, Get Activity`)}finally{S.value=!1}})()})),(e,t)=>{const i=M,s=z,n=P,U=O,j=o("Multiselect"),C=T,E=V,q=$,L=w,D=l;return u(),c(D,{is:"form",open:a.addUpdateContactModal,title:"Activity Details",size:"large",actions:"right",onSubmit:A(R,["prevent"]),onClose:x},{content:d((()=>[r("div",W,[r("div",Y,[p(E,{class:"columns is-multiline"},{default:d((()=>[K,r("div",X,[Q,r("div",ee,[m(r("input",{type:"text",name:"title","onUpdate:modelValue":t[0]||(t[0]=e=>v(N).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Title"},null,512),[[y,v(N).title]])])]),r("div",te,[le,p(U,null,{default:d((()=>[p(n,null,{default:d((()=>[p(s,{modelValue:v(N).type,"onUpdate:modelValue":t[1]||(t[1]=e=>v(N).type=e),required:""},{default:d((()=>[(u(!0),_(f,null,b(v(B),(e=>(u(),c(i,{value:e.value},{default:d((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),r("div",ae,[ie,p(U,null,{default:d((({id:e})=>[p(n,null,{default:d((()=>[p(j,{modelValue:v(N).status,"onUpdate:modelValue":t[2]||(t[2]=e=>v(N).status=e),attrs:{id:e},placeholder:"Select status",label:"name",options:v(H),searchable:!0,"track-by":"name","max-height":145},{singlelabel:d((({value:e})=>[r("div",se,h(e.label),1)])),option:d((({option:e})=>[g(h(e.label),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),r("div",ne,[oe,m(r("input",{type:"date",name:"date","onUpdate:modelValue":t[3]||(t[3]=e=>v(N).date=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).date]])]),r("div",ue,[ce,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[4]||(t[4]=e=>v(N).start_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).start_time]])]),r("div",de,[re,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[5]||(t[5]=e=>v(N).end_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).end_time]])]),r("div",pe,[me,p(U,null,{default:d((()=>[p(n,null,{default:d((()=>[p(C,{modelValue:v(N).color,"onUpdate:modelValue":t[6]||(t[6]=e=>v(N).color=e),list:"colors-list",type:"color",placeholder:"Pick a color"},null,8,["modelValue"]),ve])),_:1})])),_:1})]),r("div",ye,[_e,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[7]||(t[7]=e=>v(N).reminder_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).reminder_time]])]),r("div",fe,[be,p(U,{grouped:""},{default:d((()=>[p(n,null,{default:d((()=>[r("div",ge,[r("label",he,[r("input",{onChange:J,class:"file-input",type:"file",name:"resume"},null,32),r("span",Ae,[ke,r("span",Ve,h(v(F)?v(F):"Choose a file to attacheâ€¦"),1)])])])])),_:1})])),_:1})]),r("div",we,[Ue,p(U,null,{default:d((({id:e})=>[p(n,null,{default:d((()=>[p(j,{required:"",modelValue:v(N).attendees,"onUpdate:modelValue":t[9]||(t[9]=e=>v(N).attendees=e),attrs:{id:e},mode:"tags",placeholder:"Select a user","track-by":"name",label:"name",search:!0,searchable:!0,options:v(I),"max-height":145},{tag:d((({option:e,remove:l,disabled:a})=>[r("div",je,[r("img",{src:e.image,alt:""},null,8,Ce),g(" "+h(e.name)+" ",1),a?k("",!0):(u(),_("i",{key:0,role:"button",tabindex:"0",onClick:t[8]||(t[8]=A((()=>{}),["prevent"])),onMousedown:A((t=>l(e)),["prevent","stop"])},null,40,Se))])])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])])),_:1}),p(E,{class:"columns is-multiline mt-3"},{default:d((()=>[xe,r("div",Ie,[$e,r("div",Te,[m(r("input",{type:"text",name:"state",onBlur:Z,"onUpdate:modelValue":t[10]||(t[10]=e=>v(N).zip_code=e),class:"input is-primary-focus is-primary-focus",placeholder:"Zip Code"},null,544),[[y,v(N).zip_code]])])]),r("div",Oe,[Pe,r("div",Me,[m(r("input",{type:"text",name:"city","onUpdate:modelValue":t[11]||(t[11]=e=>v(N).city=e),class:"input is-primary-focus is-primary-focus",placeholder:"City"},null,512),[[y,v(N).city]])])]),r("div",ze,[Ee,r("div",qe,[m(r("input",{type:"text",name:"state","onUpdate:modelValue":t[12]||(t[12]=e=>v(N).state=e),class:"input is-primary-focus is-primary-focus",placeholder:"State"},null,512),[[y,v(N).state]])])]),r("div",Le,[De,r("div",He,[m(r("input",{type:"tel",name:"phone","onUpdate:modelValue":t[13]||(t[13]=e=>v(N).address=e),class:"input is-primary-focus is-primary-focus",placeholder:"Street Address"},null,512),[[y,v(N).address]])])]),r("div",Be,[Ne,p(U,null,{default:d((()=>[p(n,null,{default:d((()=>[p(q,{modelValue:v(N).description,"onUpdate:modelValue":t[14]||(t[14]=e=>v(N).description=e),rows:"3",placeholder:"Enter description..."},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1})])])])),action:d((()=>[p(L,{loading:v(S),type:"submit",color:"primary",raised:""},{default:d((()=>[g(h(a.activityId?"Update":"Create")+" Activity",1)])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Ze={key:1},Fe={class:"card-grid-toolbar columns is-multiline"},Ge={class:"column is-4 is-flex"},Je=r("div",{class:"column is-4"},null,-1),We={class:"column is-4 is-flex is-justify-content-end"},Ye={class:"card-grid card-grid-v3"},Ke=r("img",{class:"light-image",src:G,alt:""},null,-1),Xe=r("img",{class:"dark-image",src:J,alt:""},null,-1),Qe=["onClick"],et=["checked"],tt={class:"toggler"},lt=r("span",{class:"active"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:check"})],-1),at={class:"inactive"},it={class:"dark-inverted"},st={class:"people"},nt={class:"buttons"},ot=["onClick"],ut=[r("span",{class:"icon"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:edit-2"})],-1),r("span",null,"Edit",-1)],ct=a({__name:"JobLeadActivities",props:{jobId:{},getUserActivities:{type:Boolean},user:{}},setup(l){const a=l,o=i(""),A=i({}),V=i(!1),$=i(!1),T=i([{id:"",attendees_info:[{id:"",username:"",last_name:null,email:"",role:"",avatar:""}],initiated_by_info:{id:"",username:"",last_name:"",email:"",role:"",avatar:""},title:"",description:"",objectId:"",type:"",color:"",status:"",date:"",start_time:"",end_time:"",reminder_time:"",created_at:"",address:"",city:"",state:"",zip_code:"",file:null,latitude:0,longitude:0,initiated_by:"",attendees:[""]}]),L=E(),D=q(),G=s(),J=i(!1),W=i(""),Y=async e=>{try{J.value=!0;const t=await L.get(`/api/activity/by-user/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{J.value=!1}},K=i(!1),X=U((()=>{if(!T.value)return[];const e=new RegExp(o.value,"i"),t=W.value?.trim();return T.value.filter((l=>{const a=!o.value||e.test(l.title)||e.test(l.start_time)||e.test(l.end_time)||e.test(l.date)||e.test(l.status)||e.test(l.type),i=!t||l.type===t;return a&&i}))})),Q=i({}),ee=i(""),te=i({title:"Are you sure?",subtitle:"This action cannot be undone.",color:"warning",btnText:"Yes Complete It",icon:"fas fa-bell",isSweetAlertOpen:!1}),le=async()=>{try{J.value=!1;let e={status:"completed"==Q.value.status?"pending":"completed"};await L.patch(`/api/activity/${ee.value}/`,e);D.success("Activity updated successfully"),ae(),te.value.isSweetAlertOpen=!1}catch(e){D.error(` ${e}, Activity`)}finally{J.value=!1}},ae=()=>{a.getUserActivities?Y(G.user.id):a.user?Y(a.user):a.jobId?(async e=>{try{J.value=!0;const t=await L.get(`/api/activity/by-object/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{J.value=!1}})(a.jobId):(async()=>{try{J.value=!0;const e=await L.get("/api/activity/");T.value=e.data}catch(e){D.error("something get wrong")}finally{J.value=!1}})()};return n((()=>{ae()})),(l,i)=>{const s=F,n=P,U=O,T=M,E=z,q=w,Y=Z,ie=R,se=N,ne=Re,oe=t,ue=e,ce=j("tooltip");return v(J)?(u(),c(s,{key:0})):(u(),_("div",Ze,[r("div",Fe,[r("div",Ge,[p(U,{style:{"min-width":"170px"}},{default:d((()=>[p(n,{icon:"feather:search"},{default:d((()=>[m(r("input",{"onUpdate:modelValue":i[0]||(i[0]=e=>C(o)?o.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[y,v(o)]])])),_:1})])),_:1}),p(U,{style:{"min-width":"170px"}},{default:d((()=>[p(n,null,{default:d((()=>[p(E,{modelValue:v(W),"onUpdate:modelValue":i[1]||(i[1]=e=>C(W)?W.value=e:null),required:""},{default:d((()=>[p(T,{value:""},{default:d((()=>[g("All")])),_:1}),(u(!0),_(f,null,b(v(B),(e=>(u(),c(T,{value:e.value},{default:d((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),Je,r("div",We,[v(G).checkUserPermission("am_create_activity")?(u(),c(q,{key:0,onClick:i[2]||(i[2]=e=>V.value=!v(V)),color:"warning",icon:"lnir lnir-alarm"},{default:d((()=>[g(" Create Activity ")])),_:1})):k("",!0),p(q,{onClick:i[3]||(i[3]=e=>$.value=!v($)),color:"success",class:"ml-2",icon:"fas fa-envelope"},{default:d((()=>[g(" Schedule Email ")])),_:1})])]),r("div",Ye,[p(Y,{class:S([0!==v(X).length&&"is-hidden"]),title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\nsearch terms you've entered. Please try different search terms or\ncriteria.",larger:""},{image:d((()=>[Ke,Xe])),_:1},8,["class"]),p(x,{name:"list",tag:"div",class:"columns is-multiline is-flex-tablet-p is-half-tablet-p"},{default:d((()=>[(u(!0),_(f,null,b(v(X),(e=>(u(),_("div",{key:e.id,class:"column is-4"},[r("div",{class:"card-grid-item",style:I({backgroundImage:`linear-gradient(\n-175deg,\ntransparent 70%,\n${e.color}30\n`})},[v(G).checkUserPermission("am_update_activity")?(u(),_("label",{key:0,class:"h-toggle",onClick:t=>{return l=e,Q.value=l,ee.value=l.id,void(te.value={title:`${l.title}`,subtitle:`Are you sure you have ${"completed"==Q.value.status?"pending":"completed"} this activity?`,color:"warning",btnText:"Yes, Mark "+("completed"==Q.value.status?"pending":"completed"),icon:"fas fa-bell",isSweetAlertOpen:!0});var l}},[r("input",{type:"checkbox",checked:"completed"==e.status},null,8,et),r("span",tt,[lt,r("span",at,[p(ie,{icon:"lucide:activity"})])])],8,Qe)):k("",!0),p(se,{size:"large",picture:`/IbexIcons/ActivitiesIcons/${e.type}.png`,squared:""},null,8,["picture"]),r("h3",it,h(e.title),1),r("p",null,h(v(H)(e.date))+" remaining",1),r("div",st,[(u(!0),_(f,null,b(e.attendees_info,(e=>m((u(),c(se,{key:e.id,size:"small",initials:e.username.slice(0,2),picture:e.avatar},null,8,["initials","picture"])),[[ce,`${e.username} ${e.last_name?e.last_name:""}`,void 0,{rounded:!0}]]))),128))]),r("div",nt,[v(G).checkUserPermission("am_delete_activity")?(u(),c(q,{key:0,onClick:t=>(async(e="")=>{try{K.value=!0,204===(await L.delete(`/api/activity/${e}/`)).status?(D.success("Activity deleted successfully"),ae()):D.error("Something went wrong")}catch(t){console.log("Err in deleting activity",t)}finally{K.value=!1}})(e.id),loading:v(K),icon:"feather:trash",outlined:""},{default:d((()=>[g(" Delete ")])),_:2},1032,["onClick","loading"])):k("",!0),v(G).checkUserPermission("am_update_activity")?(u(),_("button",{key:1,onClick:t=>{return l=e.id,A.value=l,void(V.value=!0);var l},class:"button v-button is-dark-outlined"},ut,8,ot)):k("",!0)])],4)])))),128))])),_:1})]),v(V)?(u(),c(ne,{key:0,addUpdateContactModal:v(V),objectId:a.jobId,activityId:v(A),"onUpdate:modalHandler":i[4]||(i[4]=e=>V.value=!1),"onUpdate:OnSuccess":ae},null,8,["addUpdateContactModal","objectId","activityId"])):k("",!0),v($)?(u(),c(oe,{key:1,mailSchedulerModal:v($),"onUpdate:modalHandler":i[5]||(i[5]=e=>$.value=!1)},null,8,["mailSchedulerModal"])):k("",!0),v(te).isSweetAlertOpen?(u(),c(ue,{key:2,isSweetAlertOpen:v(te).isSweetAlertOpen,title:v(te).title,subtitle:v(te).subtitle,btntext:v(te).btnText,onConfirm:le,onCancel:()=>{v(te).isSweetAlertOpen=!1,ae()}},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):k("",!0)]))}}});export{ct as _};
