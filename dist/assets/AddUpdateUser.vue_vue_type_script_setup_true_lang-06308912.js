import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-62c2b5f6.js";import{_ as l}from"./VRadio.vue_vue_type_style_index_0_lang-c4b4c263.js";import{_ as a}from"./VSwitchBlock.vue_vue_type_style_index_0_lang-61f3b734.js";import{e as t,r as o,o as s,M as u,y as r,H as i,B as n,C as d,A as m,D as c,l as p,z as _,P as f,J as v,K as y,E as g}from"./index-0be7d825.js";import{_ as V}from"./VIcon.vue_vue_type_script_setup_true_lang-539ccf9b.js";import{_ as b}from"./VAvatar.vue_vue_type_style_index_0_lang-2c6bcd74.js";import{_ as h}from"./VFilePond.vue_vue_type_script_lang-e05feb47.js";import{_ as U}from"./VField.vue_vue_type_script_setup_true_lang-aa0edb62.js";import{_ as w}from"./VControl-730c576e.js";import{_ as j}from"./VInput.vue_vue_type_script_setup_true_lang-e35048cd.js";import{_ as k}from"./VLabel.vue_vue_type_script_setup_true_lang-0f170a89.js";import{u as x}from"./useAPI-4f36037c.js";import{u as M}from"./useNotyf-8f2dd69a.js";import{a as P}from"./useSupportElement-7ea35b98.js";const A={class:"modal-form columns is-multiline"},I={class:"column is-6"},C={class:"columns is-multiline"},E={class:"column is-3"},S={key:0,class:"column is-3"},R={class:"multiselect-single-label"},H=["src"],N=["src"],z={class:"column is-12"},F=t({__name:"AddUpdateUser",props:{isModalOpen:{type:Boolean,default:!1},userRole:{default:""},userId:{default:""}},emits:["update:closeModalHandler","update:actionUpdateHandler"],setup(t,{emit:F}){const B=t,q=M(),D=x(),J=o(""),L=o(!1),O=o(!1);o();const $=o([{value:"javascript",name:"Javascript",icon:"/images/icons/stacks/js.svg"}]),G=()=>{F("update:closeModalHandler",!1)},K=o({username:"",email:"",password:"",is_sentMail:!1,status:"",role:"",phoneNumber:"",avatar:"",supplier:""}),W=e=>{const l=e?.target;if(l&&l.files&&l.files.length>0){const e=l.files[0];K.value.avatar=e;const a=new FileReader;a.onload=e=>{J.value=e.target?.result},a.readAsDataURL(e)}else console.error("No file selected")},Q=()=>{K.value.avatar=null,J.value=null},T=async()=>{try{O.value=!0;const e=P(K.value,["avatar"]);if(B.userId){await D.patch(`/api/users/${B.userId}/`,e);q.info("User updated successfully")}else{await D.post("/api/users/",e);q.success("User added successfully")}F("update:actionUpdateHandler",null),G()}catch(e){e.response?.data?.email&&e.response.data.email.includes("user with this email already exists.")?q.error("Email already exists. Please use a different email."):q.error("An error occurred. Please try again.")}finally{O.value=!1}},X=o(!1);return s((()=>{B.userId&&(async()=>{try{O.value=!0;const e=await D.get(`/api/users/${B.userId}`);J.value=e.data.avatar?e.data.avatar:"",X.value=e.data.avatar?e.data.avatar:"",K.value=e.data}catch(e){console.error(e)}finally{O.value=!1}})(),K.value.role=B.userRole,(async()=>{try{const e=await D.get("/api/users/by-role-option/supplier/");$.value=e.data.map((e=>({value:e.id,name:e.username,icon:e.avatar})))}catch(e){console.log(e)}})()})),(t,o)=>{const s=k,x=j,M=w,P=U,F=h,q=b,D=V,X=g,Y=a,Z=u("Multiselect"),ee=l,le=e;return r(),i(le,{is:"form",open:B.isModalOpen,title:B.userId?"Update user":"Add user",size:"big",actions:"right",onSubmit:y(T,["prevent"]),onClose:G},{content:n((()=>[d("div",A,[d("div",I,[d("div",C,[m(P,{class:"column is-12"},{default:n((()=>[m(s,null,{default:n((()=>[c("Full Name")])),_:1}),m(M,null,{default:n((()=>[m(x,{required:"",modelValue:p(K).username,"onUpdate:modelValue":o[0]||(o[0]=e=>p(K).username=e),type:"text",placeholder:"Enter name"},null,8,["modelValue"])])),_:1})])),_:1}),m(P,{class:"column is-12"},{default:n((()=>[m(s,null,{default:n((()=>[c("Phone")])),_:1}),m(M,null,{default:n((()=>[m(x,{modelValue:p(K).phoneNumber,"onUpdate:modelValue":o[1]||(o[1]=e=>p(K).phoneNumber=e),type:"phone",placeholder:"Enter phone number"},null,8,["modelValue"])])),_:1})])),_:1})])]),d("div",E,[m(P,null,{default:n((()=>[m(s,null,{default:n((()=>[c("Picture")])),_:1}),m(M,null,{default:n((()=>[m(F,{class:"profile-filepond",name:"profile_filepond","chunk-retry-delays":[500,1e3,3e3],"label-idle":"<i class='lnil lnil-cloud-upload'></i>","accepted-file-types":["image/png","image/jpeg","image/gif"],"image-preview-height":180,"image-resize-target-width":180,"image-resize-target-height":180,"image-crop-aspect-ratio":"1:1","style-panel-layout":"compact circle","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom",onChange:W,onRemovefile:Q})])),_:1})])),_:1})]),p(J)?(r(),_("div",S,[m(P,null,{default:n((()=>[m(s,null,{default:n((()=>[c("Preview")])),_:1}),p(J)?(r(),i(q,{key:0,picture:p(J),size:"xl",alt:"Avatar Preview"},null,8,["picture"])):f("",!0)])),_:1})])):f("",!0),m(P,{class:"column is-6"},{default:n((()=>[m(s,null,{default:n((()=>[c("Email")])),_:1}),m(M,null,{default:n((()=>[m(x,{required:"",modelValue:p(K).email,"onUpdate:modelValue":o[2]||(o[2]=e=>p(K).email=e),type:"email",placeholder:"Enter mail"},null,8,["modelValue"])])),_:1})])),_:1}),m(P,{class:"column is-6",label:"Password",addons:""},{default:n((()=>[m(M,{expanded:""},{default:n((()=>[m(x,{modelValue:p(K).password,"onUpdate:modelValue":o[3]||(o[3]=e=>p(K).password=e),type:p(L)?"text":"password",class:"input",placeholder:"Enter Password"},null,8,["modelValue","type"])])),_:1}),m(M,null,{default:n((()=>[m(X,{color:"primary",onClick:o[4]||(o[4]=e=>L.value=!p(L))},{default:n((()=>[p(L)?(r(),i(D,{key:0,icon:"lucide:eye-off"})):(r(),i(D,{key:1,icon:"lucide:eye"}))])),_:1})])),_:1})])),_:1}),m(P,{class:"column is-3"},{default:n((()=>[m(M,null,{default:n((()=>[m(Y,{modelValue:p(K).is_sentMail,"onUpdate:modelValue":o[5]||(o[5]=e=>p(K).is_sentMail=e),label:"Send email",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1}),m(P,{class:"column is-3"},{default:n((()=>[m(M,null,{default:n((()=>[m(Y,{modelValue:p(K).is_active,"onUpdate:modelValue":o[6]||(o[6]=e=>p(K).is_active=e),label:"Active",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1}),"worker"==B.userRole?(r(),i(P,{key:1,class:"column is-6"},{default:n((({id:e})=>[m(M,null,{default:n((()=>[m(Z,{modelValue:p(K).supplier,"onUpdate:modelValue":o[7]||(o[7]=e=>p(K).supplier=e),attrs:{id:e},placeholder:"Select a sub-contractor",label:"name",options:p($),searchable:!0,"track-by":"name","max-height":145},{singlelabel:n((({value:e})=>[d("div",R,[d("img",{class:"select-label-icon",src:e.icon,alt:""},null,8,H),c(" "+v(e.name),1)])])),option:n((({option:e})=>[d("img",{class:"select-option-icon",src:e.icon,alt:""},null,8,N),c(" "+v(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):f("",!0),d("div",z,[m(P,{label:"User role"},{default:n((()=>[m(M,null,{default:n((()=>[m(ee,{modelValue:p(K).role,"onUpdate:modelValue":o[8]||(o[8]=e=>p(K).role=e),value:"manager",label:"Manager",name:"outlined_radio",color:"primary"},null,8,["modelValue"]),m(ee,{modelValue:p(K).role,"onUpdate:modelValue":o[9]||(o[9]=e=>p(K).role=e),value:"worker",label:"Worker",name:"outlined_radio",color:"primary"},null,8,["modelValue"]),m(ee,{modelValue:p(K).role,"onUpdate:modelValue":o[10]||(o[10]=e=>p(K).role=e),value:"contractor",label:"Contractor",name:"outlined_radio",color:"info"},null,8,["modelValue"]),m(ee,{modelValue:p(K).role,"onUpdate:modelValue":o[11]||(o[11]=e=>p(K).role=e),value:"supplier",label:"Sub Contractor",name:"outlined_radio",color:"success"},null,8,["modelValue"]),m(ee,{modelValue:p(K).role,"onUpdate:modelValue":o[12]||(o[12]=e=>p(K).role=e),value:"client",label:"Client",name:"outlined_radio",color:"warning"},null,8,["modelValue"])])),_:1})])),_:1})])])])),action:n((()=>[m(X,{loading:p(O),type:"submit",color:"primary",raised:""},{default:n((()=>[c(v(B.userId?"Update":"Add"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{F as _};
