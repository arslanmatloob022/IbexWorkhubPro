import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-9110d096.js";import{f as l,r as a,w as t,o as u,B as s,C as o,O as d,G as n,E as i,F as r,K as c,D as p,W as m,m as v,V as _,k as f,N as y,U as V,J as g,P as k}from"./index-ff8cc036.js";import{_ as b}from"./VTextarea.vue_vue_type_script_setup_true_lang-3f480e4b.js";import{_ as h,a as S}from"./VOption.vue_vue_type_style_index_0_lang-2daa49ef.js";import{_ as D}from"./VField.vue_vue_type_script_setup_true_lang-0842cb1a.js";import{_ as w}from"./VControl-328926fd.js";import{_ as U}from"./VInput.vue_vue_type_script_setup_true_lang-fc59c4b4.js";import{_ as j}from"./VLabel.vue_vue_type_script_setup_true_lang-1e6c0b2b.js";import{u as C}from"./useAPI-9b3b30e1.js";import{u as I}from"./useNotyf-9ffdf924.js";import{a as T}from"./useSupportElement-ace64250.js";import{C as x}from"./estimatesScripts-6d3cdb53.js";const L={class:"modal-form columns is-multiline"},q={class:"field column is-6 mb-0"},O={class:"field column is-6 mb-0"},N=i("label",null,"Status ",-1),A={class:"field column is-6 mb-0"},E={class:"field column is-6"},$=i("label",null,"New Cost Code List *",-1),M={class:"field column is-3 mb-0"},Q={class:"field column is-3 mb-0"},B={class:"field column is-3 mb-0"},F={class:"field column is-3 mb-0"},G={class:"field column is-6 mb-0"},H=i("label",null,"Select workers * ",-1),J={class:"field column is-6 mb-0"},P=i("label",null,"Select Subcontractor * ",-1),z={class:"field column is-6 mb-0"},K={class:"field column is-6 mb-0"},R=l({__name:"UpdateTask",props:{isOpen:{type:Boolean,default:!1},taskIdSelected:{default:""},projectID:{default:""},endDate:{default:""},startDate:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:R}){const W=l,X=I(),Y=C(),Z=a([]),ee=a([]),le=a(!1),ae=a(!1);let te=a([]);a([]),a([]),a();const ue=a({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",supplier:"",unit:"",costCode:"",color:"",project:"",priority:"",workers:[]});t(te.value,(()=>{console.log("data type",te)}));const se=async()=>{try{le.value=!0,ue.value.workers=te.value;let e=T(ue.value,["workers"]);W.taskIdSelected?(e.append("schedule_mode","false"),await Y.patch(`/api/task/${ue.value.id}/`,e),X.success("Task updated successfully"),R("update:OnSuccess",null)):(e.append("schedule_mode","false"),e.append("project",`${W.projectID}`),await Y.post("/api/task/",e),R("update:OnSuccess",null),X.success("Task added successfully")),re()}catch(e){console.log(e)}finally{le.value=!1}},oe=async()=>{try{ae.value=!0;const e=await Y.delete(`/api/task/${W.taskIdSelected}/`);console.log(e),X.error("Task deleted successfully"),re(),R("update:OnSuccess",null)}catch(e){console.log(e)}finally{ae.value=!1}},de=a(!1),ne=a([]),ie=a([]),re=()=>{R("update:modalHandler",!1),console.log("modal closed")};return u((()=>{W.taskIdSelected&&(async()=>{try{le.value=!0;const e=await Y.get(`/api/task/${W.taskIdSelected?W.taskIdSelected:""}/`);ue.value=e.data,te.value=e.data.workers.map((e=>e.id))}catch(e){console.log(e)}finally{le.value=!1}})(),(async()=>{try{de.value=!0;const e=await Y.get("/api/cost-code/");ne.value=e.data,ie.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{de.value=!1}})(),(async()=>{try{le.value=!0;const e=await Y.get("/api/users/by-role-option/worker/",{});Z.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{le.value=!1}})(),(async()=>{try{le.value=!0;const e=await Y.get("/api/users/by-role-option/supplier/",{});ee.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{le.value=!1}})(),W.startDate&&(ue.value.startDate=W.startDate,ue.value.endDate=W.endDate)})),(l,a)=>{const t=j,u=U,C=w,I=D,T=h,R=S,X=s("Multiselect"),Y=b,de=k,ne=e;return o(),d(ne,{is:"form",open:W.isOpen,title:W.taskIdSelected?"Update Task":"Add Task",size:"big",actions:"right",onSubmit:g(se,["prevent"]),onClose:re},{content:n((()=>[i("div",L,[i("div",q,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Title: *")])),_:1}),r(C,null,{default:n((()=>[r(u,{required:"",modelValue:ue.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>ue.value.title=e),type:"text",placeholder:le.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),i("div",O,[N,r(I,null,{default:n((()=>[r(C,null,{default:n((()=>[r(R,{modelValue:ue.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.value.status=e),name:"status",class:"is-rounded"},{default:n((()=>[r(T,{value:""},{default:n((()=>[c("Select Status")])),_:1}),(o(!0),p(_,null,m(v(x),(e=>(o(),d(T,{key:e.value,value:e.value},{default:n((()=>[c(V(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),i("div",A,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Cost Code: *")])),_:1}),r(C,null,{default:n((()=>[r(u,{required:"",type:"text",placeholder:le.value?"Loading...":"Cost code",modelValue:ue.value.costCode,"onUpdate:modelValue":a[2]||(a[2]=e=>ue.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",E,[$,r(I,null,{default:n((({id:e})=>[r(C,null,{default:n((()=>[r(X,{required:"",modelValue:ue.value.costCode,"onUpdate:modelValue":a[3]||(a[3]=e=>ue.value.costCode=e),attrs:{id:e},searchable:!0,options:ie.value,placeholder:"Select a cost code"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),i("div",M,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Quantity")])),_:1}),r(C,null,{default:n((()=>[r(u,{type:"text",placeholder:le.value?"Loading...":"Quantity",modelValue:ue.value.quantity,"onUpdate:modelValue":a[4]||(a[4]=e=>ue.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",Q,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Unit")])),_:1}),r(C,null,{default:n((()=>[r(u,{type:"text",placeholder:le.value?"Loading...":"Unit",modelValue:ue.value.unit,"onUpdate:modelValue":a[5]||(a[5]=e=>ue.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",B,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Start Date")])),_:1}),r(C,null,{default:n((()=>[r(u,{type:"date",placeholder:le.value?"Loading...":"Start date",modelValue:ue.value.startDate,"onUpdate:modelValue":a[6]||(a[6]=e=>ue.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",F,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("End Date")])),_:1}),r(C,null,{default:n((()=>[r(u,{type:"date",placeholder:le.value?"Loading...":"End date",modelValue:ue.value.endDate,"onUpdate:modelValue":a[7]||(a[7]=e=>ue.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",G,[H,r(I,null,{default:n((({id:e})=>[r(C,null,{default:n((()=>[r(X,{modelValue:v(te),"onUpdate:modelValue":a[8]||(a[8]=e=>f(te)?te.value=e:te=e),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:Z.value,placeholder:"Add workers"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),i("div",J,[P,r(I,null,{default:n((({id:e})=>[r(C,null,{default:n((()=>[r(X,{modelValue:ue.value.supplier,"onUpdate:modelValue":a[9]||(a[9]=e=>ue.value.supplier=e),required:!v(te),attrs:{id:e},searchable:!0,"create-tag":!0,options:ee.value,placeholder:"Add sub-contractor"},null,8,["modelValue","required","attrs","options"])])),_:2},1024)])),_:1})]),i("div",z,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Description")])),_:1}),r(C,null,{default:n((()=>[r(Y,{type:"text",rows:"3",placeholder:le.value?"Loading...":"Description",modelValue:ue.value.description,"onUpdate:modelValue":a[10]||(a[10]=e=>ue.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",K,[r(I,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Internal Notes")])),_:1}),r(C,null,{default:n((()=>[r(Y,{type:"text",rows:"3",placeholder:le.value?"Loading...":"Internal notes",modelValue:ue.value.internalNotes,"onUpdate:modelValue":a[11]||(a[11]=e=>ue.value.internalNotes=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})])])])),action:n((()=>[W.taskIdSelected?(o(),d(de,{key:0,onClick:oe,class:"is-left",color:"danger",loading:ae.value,raised:""},{default:n((()=>[c("Delete")])),_:1},8,["loading"])):y("",!0),r(de,{type:"submit",loading:le.value,color:"primary",raised:""},{default:n((()=>[c(V(W.taskIdSelected?"Update Task":"Add Task"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{R as _};
