import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-a4fd2482.js";import{_ as t}from"./UpdateTask.vue_vue_type_script_setup_true_lang-b6e8969b.js";import{e as a,r,w as l,o as s,B as n,C as i,D as o,I as d,E as c,F as u,l as p,j as m,M as v,H as g,T as y,U as f,V as h,N as w,ak as k,P as b,Q as _,R as x}from"./index-f47279ee.js";import{_ as j}from"./VDropdown.vue_vue_type_style_index_0_lang-fee51e31.js";import{_ as C}from"./VField.vue_vue_type_script_setup_true_lang-11a84c5e.js";import{_ as S}from"./VControl-3c0df596.js";import{_ as D}from"./VInput.vue_vue_type_script_setup_true_lang-a0c8f43d.js";import{F as A}from"./FullCalendar-171f9176.js";import{i as P}from"./index-55eb4335.js";import{i as I}from"./index-37e62c97.js";import{u as O}from"./userSession-d94cdc59.js";import{u as T}from"./useNotyf-1522757a.js";import{u as H}from"./useAPI-8cee7ced.js";const V=e=>(b("data-v-ea27d03a"),e=e(),_(),e),M=["onSubmit"],U={class:"datatable-toolbar"},F={key:0,class:"rota-loader"},Y=[V((()=>o("div",{class:"icon"},[o("i",{class:"lnil lnil-menu","aria-hidden":"true"})],-1))),V((()=>o("div",{class:"meta"},[o("span",null,"All"),o("span",null,"All projects owned by company")],-1)))],E=[V((()=>o("div",{class:"icon"},[o("i",{class:"lnil lnil-play","aria-hidden":"true"})],-1))),V((()=>o("div",{class:"meta"},[o("span",null,"Active"),o("span",null,"Projects that are in progress")],-1)))],W=[V((()=>o("div",{class:"icon"},[o("i",{class:"lnil lnil-alarm-clock","aria-hidden":"true"})],-1))),V((()=>o("div",{class:"meta"},[o("span",null,"Pending"),o("span",null,"Projects listed but not started")],-1)))],$=V((()=>o("hr",{class:"dropdown-divider"},null,-1))),L=[V((()=>o("div",{class:"icon"},[o("i",{class:"lnil lnil-round-box-check","aria-hidden":"true"})],-1))),V((()=>o("div",{class:"meta"},[o("span",null,"Completed"),o("span",null,"Projects that are done")],-1)))],N={style:{height:"100%",position:"relative"}},R={key:0,style:{"font-weight":"500","margin-bottom":"0px",color:"black"}},z=["onClick"],B={style:{"font-weight":"500","margin-bottom":"0px","padding-left":"1px","padding-right":"1px","z-index":"99","text-shadow":"2px 2px 2px black"}},J={key:0,class:"avatars"},K=["src","onClick","title","data-bs-original-title"],Q=["onClick","data-bs-original-title","title"],Z=["data-bs-original-title","title"],q={key:1,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},G=x(a({__name:"ProjectManagerCalendar",setup(a){const b=H(),_=r(null),x=O(),V=T(),G=r(!1);r(!1);const X=r("all"),ee=r(""),te=r([]),ae=r([]),re=r([]),le=r(0),se=r(""),ne=r(""),ie=r(""),oe=r(0),de=r(!0),ce=r(!1),ue=r(""),pe=r({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),me=r({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),ve=r({plugins:[P,I],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineYear",initialDate:(new Date).toISOString().split("T")[0],height:"auto",themeSystem:"cerulean",resourceAreaWidth:"20%",slotMinHeight:20,resourcesInitiallyExpanded:!1,selectable:!0,dragScroll:!0,nowIndicator:!0,eventOrder:"start",resourceOrder:"start",headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}},resourceTimelineYear:{type:"resourceTimeline",duration:{month:12},titleFormat:{year:"numeric"},title:"Year",slotMinWidth:30,dayMinWidth:30,slotMinHeight:28,dayMinHeight:26}},resourceAreaHeaderContent:"Projects",resources:[],events:[],eventDrop:e=>{ge(e),e.revert()},eventResize:e=>{ge(e)},select:e=>{"contractor"!==x.user.role&&("manager"!==x.user.role||e.resource.extendedProps.managers.includes(x.user.id))&&(console.log("start date",e.startStr),ue.value=0,le.value=e.resource.extendedProps.project,ne.value=e.startStr,ie.value=e.endStr,ce.value=!0)}}),ge=e=>{if("contractor"===x.user.role)return void e.revert();if("manager"===x.user.role&&!e.event.extendedProps.managers.includes(x.user.id))return e.revert(),void V.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);e.event.id==e.event._def.publicId?me.value={title:"Confirm Update",subtitle:`Are you sure you want to update the project "${e.event.title}" date from ${t} to ${a}?`,btntext:"Confirm",isSweetAlertOpen:!0,onConfirm:()=>{he(e.event.id,t,a),me.value.isSweetAlertOpen=!1},onCancel:()=>{me.value.isSweetAlertOpen=!1,e.revert()}}:e.revert()},ye=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},fe=e=>{window.location.hash="",oe.value=e.id,se.value=e.username,window.location.hash="workerCalendar"},he=async(e,t,a)=>{try{await b.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),V.success("Task updated successfully"),await _e(),await xe(),ke()}catch(r){V.error("Something went wrong"),console.log(r)}},we=e=>{const t=re.value.find((t=>t.id===e));return t?t.managers:[]},ke=()=>{const e=re.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color})));const t=[...te.value.map((e=>({id:e.id,resourceId:e.id,project:e.project,start:e.startDate,end:ye(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:pe[e.status],managers:we(e.project)}))),...e].sort(((e,t)=>new Date(e.start)-new Date(t.start))),a=re.value.map((e=>{const t=te.value.filter((t=>t.project===e.id)).map((e=>({id:e.id,title:e.title,project:e.project,initiallyExpanded:!0})));return{id:e.id,title:e.title,eventBackgroundColor:e.color,project:e.id,initiallyExpanded:!0,children:t}}));ve.value.resources=a,ve.value.events=t},be=()=>{if("all"!==X.value){let e=re.value.filter((e=>e.status===X.value));ae.value=e}else ae.value=re.value;ee.value&&(ae.value=re.value.filter((e=>e.title.toLowerCase().includes(ee.value.toLowerCase())))),ve.value.resources=ae.value},_e=async()=>{try{G.value=!0,console.log("inside all projects func");let e=(await b.get("/api/project/projects/",{})).data;re.value=e,ae.value=e}catch(e){console.error(e),re.value=[],ae.value=[]}finally{G.value=!1}},xe=async()=>{try{G.value=!0;let e=(await b.get("/api/task/",{})).data.map((e=>({...e,workers:e.workers.map((e=>({...e,picture:e.avatar||"default-avatar.png",initials:e.username?e.username.slice(0,2).toUpperCase():"N/A"})))})));te.value=e,console.log("new",te.value)}catch(e){console.error("Error fetching tasks:",e),te.value=[]}finally{G.value=!1}};l(X,((e,t)=>{be()}));const je=async()=>{await Promise.all([_e(),xe()]),await ke()};return s((async()=>{await je(),de.value=!0})),(a,r)=>{const l=D,s=S,b=C,P=j,I=k,O=t,T=e;return n(),i(f,null,[o("div",null,[o("form",{onSubmit:d(be,["prevent"])},[o("div",U,[c(b,{elevated:""},{default:u((()=>[c(s,{icon:"fas fa-search"},{default:u((()=>[c(l,{type:"text",placeholder:"Search projects...",modelValue:p(ee),"onUpdate:modelValue":r[0]||(r[0]=e=>m(ee)?ee.value=e:null),onInput:r[1]||(r[1]=e=>be()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),p(G)?(n(),i("div",F)):v("",!0),c(I,null,{default:u((()=>[c(P,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:u((()=>[o("a",{onClick:r[2]||(r[2]=()=>{be(),X.value="all"}),class:g(["dropdown-item is-media","all"==p(X)?"is-active":""])},Y,2),o("a",{href:"#",onClick:r[3]||(r[3]=()=>{be(),X.value="active"}),class:g(["active"==p(X)?"is-active":"","dropdown-item is-media"])},E,2),o("a",{onClick:r[4]||(r[4]=()=>{be(),X.value="pending"}),class:g(["pending"==p(X)?"is-active":"","dropdown-item is-media"])},W,2),$,o("a",{onClick:r[5]||(r[5]=()=>{be(),X.value="completed"}),class:g(["completed"==p(X)?"is-active":"","dropdown-item is-media"])},L,2)])),_:1})])),_:1})])],40,M),c(p(A),{options:p(ve),ref_key:"calendarRef",ref:_},{eventContent:u((e=>[o("div",N,["background"==e.event?.display?(n(),i("p",R," Job: "+y(e.event.title),1)):(n(),i("div",{key:1,onClick:t=>{return a=e,console.log(a.event),void("contractor"!==x.user.role&&("manager"!==x.user.role||a.event.extendedProps.managers.includes(x.user.id)?(ne.value="",le.value=0,ue.value=a.event.id,ce.value=!0):V.error("You can modify the task only for the projects for which you are a manager")));var a},style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},[o("p",B,[(n(!0),i(f,null,h(e.event.extendedProps?.workers,(e=>(n(),i("span",{key:e.id},y(e.username)+", ",1)))),128))]),e.event.extendedProps?.workers?.length?(n(),i("div",J,[(n(!0),i(f,null,h(e.event.extendedProps?.workers,(t=>(n(),i("div",{class:"avatars__item",key:t.id},[t.avatar?(n(),i("img",{key:0,src:t.avatar,alt:"",onClick:e=>fe(t),title:t.username,"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username.slice(0,2).toUpperCase():"Hi"},null,8,K)):v("",!0),0==e.event.extendedProps?.workers?.length?(n(),i("div",{key:1,onClick:e=>fe(t),"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[o("h6",{class:"mb-0",style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username},y(t.username?t.username.slice(0,2):"AA"),9,Z)],8,Q)):v("",!0),o("p",null,y(t.username),1)])))),128))])):v("",!0),e.event.extendedProps?.workers?.length||"background"==e.event?.display?v("",!0):(n(),i("p",q," No worker is assigned yet "))],8,z))])])),_:1},8,["options"]),p(ce)?(n(),w(O,{key:0,isOpen:p(ce),taskIdSelected:p(ue),projectID:p(le),startDate:p(ne),endDate:p(ie),"onUpdate:OnSuccess":je,"onUpdate:modalHandler":r[6]||(r[6]=()=>{ce.value=!1,console.log("Falling in main")})},null,8,["isOpen","taskIdSelected","projectID","startDate","endDate"])):v("",!0)]),p(me).isSweetAlertOpen?(n(),w(T,{key:0,isSweetAlertOpen:p(me).isSweetAlertOpen,title:p(me).title,loading:!1,subtitle:p(me).subtitle,btntext:p(me).btntext,onConfirm:p(me).onConfirm,onCancel:p(me).onCancel},null,8,["isSweetAlertOpen","title","subtitle","btntext","onConfirm","onCancel"])):v("",!0)],64)}}}),[["__scopeId","data-v-ea27d03a"]]);export{G as _};
