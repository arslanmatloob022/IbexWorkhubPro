import{e,r as l,o as a,B as t,N as o,F as s,E as r,J as i,I as n,O as p,R as d,s as u,x as c,v as m,b as _,_ as v,C as f,D as y,l as g,M as b,T as h,K as w,W as x,U as V,z as C}from"./index-797f323c.js";import{_ as k}from"./VModal.vue_vue_type_style_index_0_lang-ea769eae.js";import{_ as I}from"./VField.vue_vue_type_script_setup_true_lang-309269dc.js";import{_ as S}from"./VControl-bbf92ffd.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-228d2028.js";import{u as j}from"./useAPI-b2b28f22.js";import{u as A}from"./useNotyf-b138f887.js";import{u as O,c as P,_ as D,b as U,d as M}from"./CreateProposalTasksModal-d6f84737.js";import{_ as N}from"./SweetAlert.vue_vue_type_style_index_0_lang-77a5b8b5.js";import{_ as q}from"./VCollapse.vue_vue_type_style_index_0_lang-8125673b.js";import{_ as z}from"./VTextarea.vue_vue_type_script_setup_true_lang-db18e983.js";import{_ as $}from"./VRadio.vue_vue_type_style_index_0_lang-f154d1b4.js";import{_ as E}from"./VMessage.vue_vue_type_style_index_0_lang-7992006f.js";import{_ as H}from"./V-Snack.vue_vue_type_style_index_0_lang-8ebd73e7.js";import{a as F}from"./useSupportElement-012e6b86.js";import{s as L}from"./costItems-33806892.js";import{u as R}from"./viewWrapper-b24b3ba8.js";import"./VLabel.vue_vue_type_script_setup_true_lang-859c7375.js";import"./useVFieldContext-2bbe4b01.js";import"./userSession-591942fc.js";import"./notyf-72412716.js";import"./useThemeColors-d4407185.js";import"./VCheckbox.vue_vue_type_style_index_0_lang-0e6ca9b5.js";import"./VOption.vue_vue_type_style_index_0_lang-048157b0.js";import"./VAvatar.vue_vue_type_style_index_0_lang-415ba8c9.js";import"./VIconButton-1fbf9a94.js";import"./VDropdown.vue_vue_type_style_index_0_lang-0868859d.js";import"./VIcon.vue_vue_type_script_setup_true_lang-6ee0dd7e.js";import"./useDropdown-3a752b09.js";const Y=d(e({__name:"CreateTemplateModal",props:{openCreateTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const u=e,c=j(),m=A();l([]);const _=l(null);l(!1);const v=l(""),f=()=>{d("update:modalHandler",!1)},y=async()=>{console.log(_);try{await c.post(`/api/lead-proposal/${u.proposalId}/create-template/`,{title:v.value});m.success("Template Create successfully!"),f()}catch(e){console.error("Error importing template:",e),m.error("Something went wrong, try again")}};return a((()=>{})),(e,l)=>{const a=T,d=S,c=I,m=p,_=k;return t(),o(_,{open:u.openCreateTemplate,size:"small",is:"form",title:"Create Template",actions:"right",onSubmit:n(y,["prevent"]),onClose:f},{content:s((()=>[r(c,{label:"Enter title to identify your saved template"},{default:s((()=>[r(d,null,{default:s((()=>[r(a,{required:"",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),type:"text",placeholder:" Template Title"},null,8,["modelValue"])])),_:1})])),_:1})])),action:s((()=>[r(m,{color:"primary",type:"submit",raised:""},{default:s((()=>[i("Confirm")])),_:1})])),cancel:s((()=>[r(m,{color:"primary",style:{display:"none"},raised:""},{default:s((()=>[i("Close")])),_:1})])),_:1},8,["open","onSubmit"])}}}),[["__scopeId","data-v-3fb59420"]]),B={class:"modal-form columns is-multiline"},J={class:"column is-12 is-flex space-between align-items-center card"},W=y("i",{class:"fas fa-"},null,-1),G={key:0,class:"column is-12"},K={class:"field column is-6 mb-0"},Q=y("label",null,"Title: *",-1),X={class:"control"},Z={class:"column is-6"},ee={class:"field column is-6"},le=y("label",null,"Approval Deadline *",-1),ae={class:"control"},te={class:"field column is-6"},oe=y("label",null,"Attachments",-1),se=y("div",{class:"file"},[y("label",{class:"file-label"},[y("input",{class:"file-input",type:"file",name:"resume"}),y("span",{class:"file-cta"},[y("span",{class:"file-icon"},[y("i",{class:"fas fa-cloud-upload-alt"})]),y("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),re={class:"field column is-12"},ie={class:"body-inner-content"},ne={class:"field columns is-multiline mb-0"},pe={class:"field column is-11 mb-0"},de=y("label",{for:"",class:"label"},"Internal Notes",-1),ue={class:"field column is-11 mb-0"},ce=y("label",{for:"",class:"label"},"Introductory Text",-1),me={class:"field column is-11 mb-0"},_e=y("label",{for:"",class:"label"},"Closing Text",-1),ve={class:"column is-12"},fe=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:n}){const d=e,C=u(),k=O(),T=A(),R=j(),fe=c(),ye=m(),ge=l(!1),be=l(""),he=l(""),we=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),xe=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],Ve=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Ce=l({title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",is_task_created:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),ke=async()=>{try{const e=await R.get(`/api/lead-proposal/${fe.params.id}/detail/`);Ce.value=e.data,k.getProposalCostItems(fe.params.id)}catch(e){console.log(e)}},Ie=async()=>{try{ge.value=!0,Ce.value.columns_to_show=JSON.stringify(L.value);const e=F(Ce.value,[]);if(d.proposalId||Ce.value.id){const l=await R.patch(`/api/lead-proposal/${d.proposalId?d.proposalId:Ce.value.id}/`,e);Ce.value=l.data}T.success("Proposal updated successfully"),ke()}catch(e){T.error("Something went wrong, try again")}finally{ge.value=!1}},Se=async()=>{try{ge.value=!0;await R.delete(`/api/lead-proposal/${he.value}/`);Ve.value.isSweetAlertOpen=!1,T.success("Proposal delete successfully"),ye.go(-1)}catch(e){T.error(` ${e}, Proposal`),T.error("Something went wrong please try later")}finally{ge.value=!1}},Te=async()=>{try{ge.value=!0;await R.patch(`/api/lead-proposal/${fe.params.id}/`,{status:be.value});ke(),T.success(`You have ${be.value} this proposal.`),Ve.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{ge.value=!1}},je=l(!1),Ae=l("");l("worksheet");const Oe=_((()=>v((()=>import("./ckeditor-a40f5948.js").then((e=>e.c))),["assets/ckeditor-a40f5948.js","assets/index-797f323c.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-33ed4b7f.js"]).then((e=>e.default.component)))),Pe={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},De=l(!1),Ue=l([]),Me=l({}),Ne=l(!1),qe=()=>{Me.value=k.leadProposalFormData,Ue.value.push(k.leadProposalFormData),Ne.value=!Ne.value};return a((async()=>{C.value=await v((()=>import("./ckeditor-65aad31c.js").then((e=>e.c))),["assets/ckeditor-65aad31c.js","assets/index-797f323c.js","assets/index-ce8747cd.css"]).then((e=>e.default)),(d.proposalId||fe.params.id)&&(ke(),k.getProposalDetail(d.proposalId||fe.params.id))})),(e,l)=>{const a=p,n=H,u=E,c=$,m=S,_=I,v=z,T=q,j=P,A=N,O=D,F=U,L=Y;return t(),f(V,null,[y("div",B,[y("div",J,[y("div",null,[r(a,{size:"xsmall",light:"",outlined:"",raised:"",color:"warning",icon:"fa fa-cloud-download-alt",onClick:l[0]||(l[0]=e=>g(M)(g(k).leadProposalFormData))},{default:s((()=>[i(" Download ")])),_:1}),r(a,{size:"xsmall",light:"",raised:"",onClick:qe,class:"ml-1",outlined:"",color:"success",icon:"fas fa-envelope"},{default:s((()=>[i(" Send ")])),_:1}),"approved"!=g(Ce).status?(t(),o(a,{key:0,onClick:l[1]||(l[1]=e=>{return l="approved",be.value=l,void(Ve.value={title:`${be.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==be.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==be.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var l}),size:"xsmall",class:"mr-2 ml-1",light:"",outlined:"",color:"info",raised:""},{default:s((()=>[i(" Approved ")])),_:1})):(t(),o(n,{key:1,title:"Approved",white:"",color:"primary",icon:"fas fa-check-circle"})),g(Ce).is_task_created?(t(),o(n,{key:2,title:"Calendar Tasks Created ",white:"",class:"ml-2",color:"info",icon:"fas fa-calendar-check"})):b("",!0)]),y("div",null,[r(a,{onClick:l[2]||(l[2]=e=>De.value=!g(De)),size:"xsmall",class:"mr-2",light:"",outlined:"",color:"success",raised:""},{default:s((()=>[i(" Create Template ")])),_:1}),g(Ce).is_task_created||"approved"==g(Ce).status?b("",!0):(t(),o(a,{key:0,onClick:l[3]||(l[3]=e=>{return l=g(fe).params.id,Ae.value=l,void(je.value=!0);var l}),size:"xsmall",class:"mr-2",light:"",outlined:"",color:"success",raised:""},{default:s((()=>[i(" Generate Tasks ")])),_:1})),r(a,{onClick:Ie,size:"xsmall",class:"mr-2",light:"",outlined:"",color:"primary",raised:""},{default:s((()=>[i(" Update ")])),_:1}),r(a,{size:"xsmall",onClick:l[4]||(l[4]=e=>{return l=g(Ce).id,he.value=l,void(we.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),light:"",outlined:"",icon:"fas fa-trash",color:"danger",raised:""},{default:s((()=>[W])),_:1})])]),g(Ce).client_note&&"review"==g(Ce).status?(t(),f("div",G,[r(u,{color:"warning"},{default:s((()=>[i(h(g(Ce).client_note),1)])),_:1})])):b("",!0),y("div",K,[Q,y("div",X,[w(y("input",{type:"text",name:"firstName","onUpdate:modelValue":l[5]||(l[5]=e=>g(Ce).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[x,g(Ce).title]])])]),y("div",Z,[r(_,{class:"m-0 p-0",label:"Type"},{default:s((()=>[r(m,null,{default:s((()=>[r(c,{modelValue:g(Ce).type,"onUpdate:modelValue":l[6]||(l[6]=e=>g(Ce).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),r(c,{modelValue:g(Ce).type,"onUpdate:modelValue":l[7]||(l[7]=e=>g(Ce).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),r(c,{modelValue:g(Ce).type,"onUpdate:modelValue":l[8]||(l[8]=e=>g(Ce).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",ee,[le,y("div",ae,[w(y("input",{type:"date",name:"firstName","onUpdate:modelValue":l[9]||(l[9]=e=>g(Ce).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[x,g(Ce).approval_deadline]])])]),y("div",te,[oe,r(_,{grouped:""},{default:s((()=>[r(m,null,{default:s((()=>[se])),_:1})])),_:1})]),y("div",re,[r(T,{items:xe,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":s((e=>[y("div",ie,[y("div",ne,[y("div",pe,[de,r(_,null,{default:s((()=>[r(m,null,{default:s((()=>[r(v,{modelValue:g(Ce).internalNotes,"onUpdate:modelValue":l[10]||(l[10]=e=>g(Ce).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",ue,[ce,g(C)?(t(),o(g(Oe),{key:0,modelValue:g(Ce).introductoryText,"onUpdate:modelValue":l[11]||(l[11]=e=>g(Ce).introductoryText=e),editor:g(C),config:Pe},null,8,["modelValue","editor"])):b("",!0)]),y("div",me,[_e,g(C)?(t(),o(g(Oe),{key:0,modelValue:g(Ce).closingText,"onUpdate:modelValue":l[12]||(l[12]=e=>g(Ce).closingText=e),editor:g(C),config:Pe},null,8,["modelValue","editor"])):b("",!0)])])])])),_:1})]),y("div",ve,[r(j,{proposalData:g(Ce),proposalId:g(Ce).id},null,8,["proposalData","proposalId"])]),g(Ve).isSweetAlertOpen?(t(),o(A,{key:1,isSweetAlertOpen:g(Ve).isSweetAlertOpen,title:g(Ve).title,subtitle:g(Ve).subtitle,btntext:g(Ve).btntext,onConfirm:Te,onCancel:()=>g(Ve).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),g(we).isSweetAlertOpen?(t(),o(A,{key:2,isSweetAlertOpen:g(we).isSweetAlertOpen,title:g(we).title,subtitle:g(we).subtitle,btntext:g(we).btntext,onConfirm:Se,onCancel:()=>g(we).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),g(je)?(t(),o(O,{key:3,createProposalTasksModal:g(je),proposalId:g(Ae),onCloseModalHandler:l[13]||(l[13]=e=>je.value=!1),"onUpdate:OnSuccess":l[14]||(l[14]=()=>{})},null,8,["createProposalTasksModal","proposalId"])):b("",!0),g(Ne)?(t(),o(F,{key:4,proposalSenderModal:g(Ne),selectedProposalsIds:g(Ue),proposalData:g(Me),"onUpdate:modalHandler":l[15]||(l[15]=e=>{Ne.value=!1,Ue.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData"])):b("",!0)]),g(De)?(t(),o(L,{key:0,proposalId:g(fe).params.id,openCreateTemplate:g(De),"onUpdate:OnSuccess":l[16]||(l[16]=()=>{(d.proposalId||g(fe).params.id)&&ke()}),"onUpdate:modalHandler":l[17]||(l[17]=e=>De.value=!1)},null,8,["proposalId","openCreateTemplate"])):b("",!0)],64)}}}),ye=e({__name:"[id]",setup:e=>(R().setPageTitle("Lead Proposals"),C({title:"Lead Proposals - Ibex"}),(e,l)=>(t(),f("div",null,[r(fe)])))});export{ye as default};
