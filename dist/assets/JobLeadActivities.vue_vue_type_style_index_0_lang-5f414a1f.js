import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-b918f7d0.js";import{_ as t}from"./ScheduleEmailModal.vue_vue_type_script_setup_true_lang-49ddcc23.js";import{_ as a}from"./VModal.vue_vue_type_style_index_0_lang-a9138242.js";import{f as l,r as i,b as s,o as n,B as o,C as u,O as c,G as d,E as r,F as p,L as m,m as v,X as y,D as _,V as f,W as b,K as g,U as h,J as A,N as k,a5 as V,P as w,$ as U,av as C,k as S,I as j,aS as I,a4 as x}from"./index-27c88c30.js";import{_ as $}from"./VTextarea.vue_vue_type_script_setup_true_lang-74d68586.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-7f963d42.js";import{_ as O}from"./VField.vue_vue_type_script_setup_true_lang-eb404a69.js";import{_ as P}from"./VControl-40991241.js";import{_ as M,a as z}from"./VOption.vue_vue_type_style_index_0_lang-8e642ee5.js";import{u as E}from"./useAPI-5ec06f46.js";import{u as q}from"./useNotyf-d44b5a33.js";import{a as L,g as D,d as H}from"./useSupportElement-6b7f44cb.js";import{a as B}from"./estimatesScripts-aa115846.js";import{_ as N}from"./VAvatar.vue_vue_type_style_index_0_lang-c716de6a.js";import{_ as R}from"./VIcon.vue_vue_type_script_setup_true_lang-f275661a.js";import{_ as Z}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-ce523aee.js";import{_ as F}from"./PlaceloadV3.vue_vue_type_style_index_0_lang-7a248385.js";import{_ as G,a as J}from"./search-3-dark-b5ef2271.js";const W={class:"modal-form columns is-multiline"},Y={class:"column is-12"},K=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Activity Information")],-1),X={class:"field column is-12 mb-0"},Q=r("label",null,"Title *",-1),ee={class:"control"},te={class:"field column is-6 mb-0"},ae=r("label",null,"Activity Type *",-1),le={class:"field column is-6"},ie=r("label",null,"Status",-1),se={class:"multiselect-single-label"},ne={class:"field column is-6 mb-0"},oe=r("label",null,"Date ",-1),ue={class:"field column is-3 mb-0"},ce=r("label",null,"Start Time ",-1),de={class:"field column is-3 mb-0"},re=r("label",null,"End Time ",-1),pe={class:"field column is-3 mb-0"},me=r("label",null,"Color ",-1),ve=r("datalist",{id:"colors-list"},[r("option",{value:"#84cc16"}),r("option",{value:"#22c55e"}),r("option",{value:"#0ea5e9"}),r("option",{value:"#6366f1"}),r("option",{value:"#8b5cf6"}),r("option",{value:"#d946ef"}),r("option",{value:"#f43f5e"}),r("option",{value:"#facc15"}),r("option",{value:"#fb923c"}),r("option",{value:"#9ca3af"})],-1),ye={class:"field column is-3 mb-0"},_e=r("label",null,"Reminder time: ",-1),fe={class:"field column is-3 mb-0"},be=r("label",null,"Attachment ",-1),ge={class:"file"},he={class:"file-label"},Ae={class:"file-cta"},ke=r("span",{class:"file-icon"},[r("i",{class:"fas fa-cloud-upload-alt"})],-1),Ve={class:"file-label"},we={class:"field column is-12 mb-0"},Ue=r("label",null,"Assigned * ",-1),Ce={class:"multiselect-tag is-user"},Se=["src"],je=["onMousedown"],Ie=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Location")],-1),xe={class:"field column is-4 mb-0"},$e=r("label",null,"Zip Code ",-1),Te={class:"control"},Oe={class:"field column is-4 mb-0"},Pe=r("label",null,"City ",-1),Me={class:"control"},ze={class:"field column is-4 mb-0"},Ee=r("label",null,"State ",-1),qe={class:"control"},Le={class:"field column is-12 mb-0"},De=r("label",null,"Street Address",-1),He={class:"control"},Be={class:"field column is-12 mb-0"},Ne=r("label",null,"Description ",-1),Re=l({__name:"LeadActivityModal",props:{addUpdateContactModal:{type:Boolean},activityId:{},objectId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const l=e;i(null);const U=s(),C=q(),S=E(),j=i(!1),I=()=>{t("update:modalHandler",!1)},x=i([{value:"",name:"",image:""}]),H=i([{label:"Pending",value:"pending"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"},{label:"Rescheduled",value:"rescheduled"},{label:"In Progress",value:"in_progress"}]),N=i({title:"",objectId:l.objectId??"",type:"",color:"",status:"pending",date:"",start_time:"",end_time:"",reminder_time:"",assignedUser:"",attendees:[],initiated_by:U.user.id,address:"",city:"",state:"",zip_code:"",description:"",latitude:0,longitude:0,file:""}),R=async()=>{try{j.value=!0;const e=L(N.value,["file"]);if(l.activityId){await S.patch(`/api/activity/${l.activityId}/`,e);C.success("Activity updated successfully")}else{await S.post("/api/activity/",e);C.success("Activity added successfully")}t("update:OnSuccess",null),I()}catch(e){C.error(` ${e}, Activity`)}finally{j.value=!1}},Z=async()=>{if(!N.value.zip_code)return;const e=await D(N.value.zip_code);console.log("API Response:",e),e?.status&&e.data?(N.value.latitude=e.data.lat,N.value.longitude=e.data.lng,N.value.address=e.data.address,N.value.city=e.data.city,N.value.state=e.data.state,C.success("Address fetched successfully")):console.log("Address not found.")},F=i(""),G=i(0),J=e=>{const t=e.target,a=t.files?.[0];t.value="",a&&(N.value.file=a,F.value=a.name,G.value=a.size)};return n((()=>{(async()=>{try{j.value=!0;const e=await S.get("/api/users/");x.value=e.data.map((e=>({value:e.id,name:`${e.username??"N/A"} ${e.last_name??""}`,icon:e.avatar})))}catch(e){C.error("something get wrong")}finally{j.value=!1}})(),l.activityId&&(async()=>{try{j.value=!0;const e=await S.get(`/api/activity/${l.activityId}/`);N.value=e.data}catch(e){C.error(` ${e}, Get Activity`)}finally{j.value=!1}})()})),(e,t)=>{const i=M,s=z,n=P,U=O,C=o("Multiselect"),S=T,E=V,q=$,L=w,D=a;return u(),c(D,{is:"form",open:l.addUpdateContactModal,title:"Activity Details",size:"large",actions:"right",onSubmit:A(R,["prevent"]),onClose:I},{content:d((()=>[r("div",W,[r("div",Y,[p(E,{class:"columns is-multiline"},{default:d((()=>[K,r("div",X,[Q,r("div",ee,[m(r("input",{type:"text",name:"title","onUpdate:modelValue":t[0]||(t[0]=e=>v(N).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Title"},null,512),[[y,v(N).title]])])]),r("div",te,[ae,p(U,null,{default:d((()=>[p(n,null,{default:d((()=>[p(s,{modelValue:v(N).type,"onUpdate:modelValue":t[1]||(t[1]=e=>v(N).type=e),required:""},{default:d((()=>[(u(!0),_(f,null,b(v(B),(e=>(u(),c(i,{value:e.value},{default:d((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),r("div",le,[ie,p(U,null,{default:d((({id:e})=>[p(n,null,{default:d((()=>[p(C,{modelValue:v(N).status,"onUpdate:modelValue":t[2]||(t[2]=e=>v(N).status=e),attrs:{id:e},placeholder:"Select status",label:"name",options:v(H),searchable:!0,"track-by":"name","max-height":145},{singlelabel:d((({value:e})=>[r("div",se,h(e.label),1)])),option:d((({option:e})=>[g(h(e.label),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),r("div",ne,[oe,m(r("input",{type:"date",name:"date","onUpdate:modelValue":t[3]||(t[3]=e=>v(N).date=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).date]])]),r("div",ue,[ce,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[4]||(t[4]=e=>v(N).start_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).start_time]])]),r("div",de,[re,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[5]||(t[5]=e=>v(N).end_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).end_time]])]),r("div",pe,[me,p(U,null,{default:d((()=>[p(n,null,{default:d((()=>[p(S,{modelValue:v(N).color,"onUpdate:modelValue":t[6]||(t[6]=e=>v(N).color=e),list:"colors-list",type:"color",placeholder:"Pick a color"},null,8,["modelValue"]),ve])),_:1})])),_:1})]),r("div",ye,[_e,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[7]||(t[7]=e=>v(N).reminder_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).reminder_time]])]),r("div",fe,[be,p(U,{grouped:""},{default:d((()=>[p(n,null,{default:d((()=>[r("div",ge,[r("label",he,[r("input",{onChange:J,class:"file-input",type:"file",name:"resume"},null,32),r("span",Ae,[ke,r("span",Ve,h(v(F)?v(F):"Choose a file to attacheâ€¦"),1)])])])])),_:1})])),_:1})]),r("div",we,[Ue,p(U,null,{default:d((({id:e})=>[p(n,null,{default:d((()=>[p(C,{required:"",modelValue:v(N).attendees,"onUpdate:modelValue":t[9]||(t[9]=e=>v(N).attendees=e),attrs:{id:e},mode:"tags",placeholder:"Select a user","track-by":"name",label:"name",search:!0,searchable:!0,options:v(x),"max-height":145},{tag:d((({option:e,remove:a,disabled:l})=>[r("div",Ce,[r("img",{src:e.image,alt:""},null,8,Se),g(" "+h(e.name)+" ",1),l?k("",!0):(u(),_("i",{key:0,role:"button",tabindex:"0",onClick:t[8]||(t[8]=A((()=>{}),["prevent"])),onMousedown:A((t=>a(e)),["prevent","stop"])},null,40,je))])])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])])),_:1}),p(E,{class:"columns is-multiline mt-3"},{default:d((()=>[Ie,r("div",xe,[$e,r("div",Te,[m(r("input",{type:"text",name:"state",onBlur:Z,"onUpdate:modelValue":t[10]||(t[10]=e=>v(N).zip_code=e),class:"input is-primary-focus is-primary-focus",placeholder:"Zip Code"},null,544),[[y,v(N).zip_code]])])]),r("div",Oe,[Pe,r("div",Me,[m(r("input",{type:"text",name:"city","onUpdate:modelValue":t[11]||(t[11]=e=>v(N).city=e),class:"input is-primary-focus is-primary-focus",placeholder:"City"},null,512),[[y,v(N).city]])])]),r("div",ze,[Ee,r("div",qe,[m(r("input",{type:"text",name:"state","onUpdate:modelValue":t[12]||(t[12]=e=>v(N).state=e),class:"input is-primary-focus is-primary-focus",placeholder:"State"},null,512),[[y,v(N).state]])])]),r("div",Le,[De,r("div",He,[m(r("input",{type:"tel",name:"phone","onUpdate:modelValue":t[13]||(t[13]=e=>v(N).address=e),class:"input is-primary-focus is-primary-focus",placeholder:"Street Address"},null,512),[[y,v(N).address]])])]),r("div",Be,[Ne,p(U,null,{default:d((()=>[p(n,null,{default:d((()=>[p(q,{modelValue:v(N).description,"onUpdate:modelValue":t[14]||(t[14]=e=>v(N).description=e),rows:"3",placeholder:"Enter description..."},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1})])])])),action:d((()=>[p(L,{loading:v(j),type:"submit",color:"primary",raised:""},{default:d((()=>[g(h(l.activityId?"Update":"Create")+" Activity",1)])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Ze={key:1},Fe={class:"card-grid-toolbar"},Ge={class:"buttons"},Je={class:"card-grid card-grid-v3"},We=r("img",{class:"light-image",src:G,alt:""},null,-1),Ye=r("img",{class:"dark-image",src:J,alt:""},null,-1),Ke=["onClick"],Xe=["checked"],Qe={class:"toggler"},et=r("span",{class:"active"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:check"})],-1),tt={class:"inactive"},at={class:"dark-inverted"},lt={class:"people"},it={class:"buttons"},st=["onClick"],nt=[r("span",{class:"icon"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:edit-2"})],-1),r("span",null,"Edit",-1)],ot=l({__name:"JobLeadActivities",props:{jobId:{},getUserActivities:{type:Boolean},user:{}},setup(a){const l=a,o=i(""),A=i({}),V=i(!1),$=i(!1),T=i([{id:"",attendees_info:[{id:"",username:"",last_name:null,email:"",role:"",avatar:""}],initiated_by_info:{id:"",username:"",last_name:"",email:"",role:"",avatar:""},title:"",description:"",objectId:"",type:"",color:"",status:"",date:"",start_time:"",end_time:"",reminder_time:"",created_at:"",address:"",city:"",state:"",zip_code:"",file:null,latitude:0,longitude:0,initiated_by:"",attendees:[""]}]),L=E(),D=q(),G=s(),J=i(!1),W=i(""),Y=async e=>{try{J.value=!0;const t=await L.get(`/api/activity/by-user/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{J.value=!1}},K=i(!1),X=U((()=>{if(!T.value)return[];const e=new RegExp(o.value,"i"),t=W.value?.trim();return T.value.filter((a=>{const l=!o.value||e.test(a.title)||e.test(a.start_time)||e.test(a.end_time)||e.test(a.date)||e.test(a.status)||e.test(a.type),i=!t||a.type===t;return l&&i}))})),Q=i({}),ee=i(""),te=i({title:"Are you sure?",subtitle:"This action cannot be undone.",color:"warning",btnText:"Yes Complete It",icon:"fas fa-bell",isSweetAlertOpen:!1}),ae=async()=>{try{J.value=!1;let e={status:"completed"==Q.value.status?"pending":"completed"};await L.patch(`/api/activity/${ee.value}/`,e);D.success("Activity updated successfully"),le(),te.value.isSweetAlertOpen=!1}catch(e){D.error(` ${e}, Activity`)}finally{J.value=!1}},le=()=>{l.getUserActivities?Y(G.user.id):l.user?Y(l.user):l.jobId?(async e=>{try{J.value=!0;const t=await L.get(`/api/activity/by-object/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{J.value=!1}})(l.jobId):(async()=>{try{J.value=!0;const e=await L.get("/api/activity/");T.value=e.data}catch(e){D.error("something get wrong")}finally{J.value=!1}})()};return n((()=>{le()})),(a,i)=>{const s=F,n=P,U=M,T=z,E=O,q=w,Y=Z,ie=R,se=N,ne=Re,oe=t,ue=e,ce=C("tooltip");return v(J)?(u(),c(s,{key:0})):(u(),_("div",Ze,[r("div",Fe,[p(n,{icon:"feather:search"},{default:d((()=>[m(r("input",{"onUpdate:modelValue":i[0]||(i[0]=e=>S(o)?o.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[y,v(o)]])])),_:1}),r("div",Ge,[p(E,null,{default:d((()=>[p(n,null,{default:d((()=>[p(T,{modelValue:v(W),"onUpdate:modelValue":i[1]||(i[1]=e=>S(W)?W.value=e:null),required:""},{default:d((()=>[p(U,{value:""},{default:d((()=>[g("All")])),_:1}),(u(!0),_(f,null,b(v(B),(e=>(u(),c(U,{value:e.value},{default:d((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1}),v(G).checkUserPermission("am_create_activity")?(u(),c(q,{key:0,onClick:i[2]||(i[2]=e=>V.value=!v(V)),color:"warning",icon:"lnir lnir-alarm"},{default:d((()=>[g(" Create Activity ")])),_:1})):k("",!0),p(q,{onClick:i[3]||(i[3]=e=>$.value=!v($)),color:"success",class:"ml-2",icon:"fas fa-envelope"},{default:d((()=>[g(" Schedule Email ")])),_:1})])]),r("div",Je,[p(Y,{class:j([0!==v(X).length&&"is-hidden"]),title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\nsearch terms you've entered. Please try different search terms or\ncriteria.",larger:""},{image:d((()=>[We,Ye])),_:1},8,["class"]),p(I,{name:"list",tag:"div",class:"columns is-multiline is-flex-tablet-p is-half-tablet-p"},{default:d((()=>[(u(!0),_(f,null,b(v(X),(e=>(u(),_("div",{key:e.id,class:"column is-4"},[r("div",{class:"card-grid-item",style:x({backgroundImage:`linear-gradient(\n-175deg,\ntransparent 70%,\n${e.color}30\n`})},[v(G).checkUserPermission("am_update_activity")?(u(),_("label",{key:0,class:"h-toggle",onClick:t=>{return a=e,Q.value=a,ee.value=a.id,void(te.value={title:`${a.title}`,subtitle:`Are you sure you have ${"completed"==Q.value.status?"pending":"completed"} this activity?`,color:"warning",btnText:"Yes, Mark "+("completed"==Q.value.status?"pending":"completed"),icon:"fas fa-bell",isSweetAlertOpen:!0});var a}},[r("input",{type:"checkbox",checked:"completed"==e.status},null,8,Xe),r("span",Qe,[et,r("span",tt,[p(ie,{icon:"lucide:activity"})])])],8,Ke)):k("",!0),p(se,{size:"large",picture:`/IbexIcons/ActivitiesIcons/${e.type}.png`,squared:""},null,8,["picture"]),r("h3",at,h(e.title),1),r("p",null,h(v(H)(e.date))+" remaining",1),r("div",lt,[(u(!0),_(f,null,b(e.attendees_info,(e=>m((u(),c(se,{key:e.id,size:"small",initials:e.username.slice(0,2),picture:e.avatar},null,8,["initials","picture"])),[[ce,`${e.username} ${e.last_name?e.last_name:""}`,void 0,{rounded:!0}]]))),128))]),r("div",it,[v(G).checkUserPermission("am_delete_activity")?(u(),c(q,{key:0,onClick:t=>(async(e="")=>{try{K.value=!0,204===(await L.delete(`/api/activity/${e}/`)).status?(D.success("Activity deleted successfully"),le()):D.error("Something went wrong")}catch(t){console.log("Err in deleting activity",t)}finally{K.value=!1}})(e.id),loading:v(K),icon:"feather:trash",outlined:""},{default:d((()=>[g(" Delete ")])),_:2},1032,["onClick","loading"])):k("",!0),v(G).checkUserPermission("am_update_activity")?(u(),_("button",{key:1,onClick:t=>{return a=e.id,A.value=a,void(V.value=!0);var a},class:"button v-button is-dark-outlined"},nt,8,st)):k("",!0)])],4)])))),128))])),_:1})]),v(V)?(u(),c(ne,{key:0,addUpdateContactModal:v(V),objectId:l.jobId,activityId:v(A),"onUpdate:modalHandler":i[4]||(i[4]=e=>V.value=!1),"onUpdate:OnSuccess":le},null,8,["addUpdateContactModal","objectId","activityId"])):k("",!0),v($)?(u(),c(oe,{key:1,mailSchedulerModal:v($),"onUpdate:modalHandler":i[5]||(i[5]=e=>$.value=!1)},null,8,["mailSchedulerModal"])):k("",!0),v(te).isSweetAlertOpen?(u(),c(ue,{key:2,isSweetAlertOpen:v(te).isSweetAlertOpen,title:v(te).title,subtitle:v(te).subtitle,btntext:v(te).btnText,onConfirm:ae,onCancel:()=>{v(te).isSweetAlertOpen=!1,le()}},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):k("",!0)]))}}});export{ot as _};
