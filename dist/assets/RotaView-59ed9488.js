import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-f9dc49bb.js";import{f as a,r as l,o as t,C as o,D as s,F as i,G as n,E as d,K as r,U as u,L as c,k as m,X as p,m as v,a1 as f,P as g,Q as y,R as h,S as b,w as _,B as k,O as w,J as x,s as I,N as S,M as V,aB as T,x as C,V as R,a5 as j,W as O,a4 as M}from"./index-c5e45f53.js";import{u as L}from"./useNotyf-25b7a264.js";import{_ as N}from"./VCollapse.vue_vue_type_style_index_0_lang-e0e2b8b8.js";import{_ as A}from"./VInput.vue_vue_type_script_setup_true_lang-c7092a36.js";import{_ as U}from"./VLabel.vue_vue_type_script_setup_true_lang-af2715c2.js";import{_ as D}from"./VField.vue_vue_type_script_setup_true_lang-82d05aad.js";import{_ as $}from"./VControl-4d3f173c.js";import{u as z}from"./useAPI-bef75d24.js";import{u as B}from"./company-f1630f44.js";import{_ as P}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-192cbc6f.js";import{A as E}from"./vue3-apexcharts.common-62efcf6d.js";import{u as H}from"./useThemeColors-ce2a63b4.js";import{_ as q}from"./VAvatar.vue_vue_type_style_index_0_lang-2997f58b.js";import{_ as J,a as F}from"./projects-dark-4a371d8a.js";import{_ as W}from"./VTag.vue_vue_type_style_index_0_lang-7f78b8c9.js";import{F as G}from"./FullCalendar-32248d96.js";import{i as K}from"./index-04e05ac8.js";import{_ as X}from"./VSwitchBlock.vue_vue_type_style_index_0_lang-bbc2dba3.js";import{_ as Y}from"./VTags.vue_vue_type_script_setup_true_lang-bdd8e8aa.js";import{i as Z}from"./index-5790eff9.js";import{i as Q}from"./index-8b132f24.js";const ee=e=>(y("data-v-c4615761"),e=e(),h(),e),ae={class:"cus-justify-center"},le=ee((()=>d("i",{class:"lnir lnir-alarm-2 m-4",style:{"font-size":"60px",color:"var(--danger)"}},null,-1))),te={class:"modal-form columns is-multiline"},oe={class:"field column is-12 mb-0"},se={class:"content",style:{"background-color":"#ececec71",padding:"6px","border-radius":"8px"}},ie={style:{"font-size":"14px"}},ne=ee((()=>d("span",{style:{color:"var(--danger)","font-size":"17px","font-weight":"500"}},"Caution: ",-1))),de=ee((()=>d("br",null,null,-1))),re={class:"field column is-12 mb-0"},ue={style:{"font-weight":"500",color:"var(--danger)"}},ce={class:"control"},me=a({__name:"ActionsVerificationModal",props:{actionVerificationModal:{type:Boolean},message:{},captionText:{},btnText:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:y}){const h=a,b=l(""),_=L(),k=()=>{b.value==h.captionText?(console.log("consoliingg"),y("update:OnSuccess",null),y("update:modalHandler",!1)):_.error("Your entered text does not match.")};return t((()=>{})),(a,l)=>{const t=g,y=e;return o(),s("template",null,[i(f,{name:"fade-slow"},{default:n((()=>[i(y,{open:a.actionVerificationModal,title:"Action Alert",actions:"right",onClose:l[1]||(l[1]=e=>a.actionVerificationModal=!1)},{content:n((()=>[d("div",ae,[le,d("div",te,[d("div",oe,[d("div",se,[d("p",ie,[ne,r(" "+u(h.message)+" ",1),de])])]),d("div",re,[d("label",null,[r("To perform this action, type: "),d("span",ue,u(h.captionText),1),r(" below:")]),d("div",ce,[c(d("input",{type:"text",name:"documentTitle","onUpdate:modelValue":l[0]||(l[0]=e=>m(b)?b.value=e:null),required:"",class:"input is-primary-focus",placeholder:"Enter captcha text"},null,512),[[p,v(b)]])])])])])])),cancel:n((()=>[i(t,{style:{display:"none"},rounded:"",color:"light",raised:""},{default:n((()=>[r("Close")])),_:1})])),action:n((()=>[i(t,{type:"submit",onClick:k,color:"primary",raised:""},{default:n((()=>[r(u(h.btnText?h.btnText:"Confirm"),1)])),_:1})])),_:1},8,["open"])])),_:1})])}}}),pe=b(me,[["__scopeId","data-v-c4615761"]]),ve=e=>(y("data-v-0615def8"),e=e(),h(),e),fe={class:"modal-form columns is-multiline",id:"addRota"},ge={class:"field column is-12 mb-0"},ye={class:"columns is-multiline mb-3"},he={class:"field column is-6 mb-0"},be=ve((()=>d("label",null,"Select customer company*",-1))),_e={class:"multiselect-single-label"},ke=["src"],we=["src"],xe={class:"field column is-6 mb-0"},Ie=ve((()=>d("label",null,"Select Site *",-1))),Se={class:"multiselect-single-label"},Ve={class:"field column is-6 mb-0"},Te=ve((()=>d("label",{class:"mb-2"},"Select Worker *",-1))),Ce={class:"multiselect-single-label"},Re=["src"],je=["src"],Oe={class:"field column is-3 mb-0"},Me={class:"field column is-3 mb-0"},Le=ve((()=>d("div",{class:"head-info"},[d("div",{class:"head-progress"})],-1))),Ne={class:"body-inner-content"},Ae={class:"field columns is-multiline mb-0"},Ue={class:"column is-12"},De={class:"columns is-multiline space-around"},$e={class:"field column is-5 mb-0"},ze=ve((()=>d("label",null,"Charge Rate",-1))),Be={class:"control"},Pe={class:"field column is-5 mb-0"},Ee=ve((()=>d("label",null,"Charge Hours",-1))),He={class:"control"},qe={class:"field column is-11 mb-0"},Je=ve((()=>d("label",null,"Notes",-1))),Fe={class:"control"},We=b(a({__name:"editRotaModal",props:{editRotaModalOpen:{type:Boolean},rotaId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:s}){const m=a,f=B(),y=l(!1),h=L(),b=z(),I=l("");l("");let S=l([]);const V=l("");let T=l([]);l("");let C=l([]);l([{id:0,firstName:"",lastName:"",profileImageURL:""}]);const R=[{title:"Additional Information",content:"Add additional information about rota, rate or worker"}],j=l({dates:[],id:0,start:"",end:"",hours:0,shift:"",hourlyRate:0,notes:"",createdBy:"",UpdatedAt:"",updatedBy:"",company:"",site:"",worker:"",customerCompany:"",job:""}),O=()=>{s("update:modalHandler",!1)},M=async()=>{y.value=!0;try{j.value.shift="day";const e=await b.patch(`/v3/api/rota/${m.rotaId}/`,j.value);console.log("rota resopmse",e.data),s("update:OnSuccess",null),h.success("Rota Added Successfuly"),y.value=!1,O()}catch(e){console.log(e),y.value=!1}},P=async e=>{try{const a=await b.get(`/v3/api/site/customer-company/${e||V.value}/`);S.value=a.data.map((e=>({value:e.id.toString(),name:e.name})))}catch(a){console.log(a)}},E=e=>{P(e)};_(V,((e,a)=>{P(e)}));return t((()=>{(async()=>{try{const e=await b.get(`/v3/api/rota/${m.rotaId}/`);j.value=e.data}catch(e){console.log(e)}})(),(async()=>{try{const e=await b.get(`/v3/api/worker/${f.loggedCompany.id}/worker-short-info/`);C.value=e.data.map((e=>({value:e.id.toString(),name:`${e.firstName} ${e.lastName}`,icon:e.profileImageURL}))),I.value=m.workerId}catch{h.error("Invalid data")}finally{y.value=!1}})(),(async()=>{y.value=!0;const e=await b.get(`/v3/api/customer-company/company/${f.loggedCompany.id}`);T.value=e.data.map((e=>({value:e.id.toString(),name:e.name,icon:e.logo?e.logo:"/default/icon.png"}))),e.data&&(V.value=e.data[0].id),y.value=!1})()})),(a,l)=>{const t=k("Multiselect"),s=$,f=D,h=U,b=A,_=N,I=g,V=e;return o(),w(V,{is:"form",size:"xl",open:m.editRotaModalOpen,title:"Edit Rota",actions:"right",onSubmit:x(M,["prevent"]),onClose:O},{content:n((()=>[d("div",fe,[d("div",ge,[d("div",ye,[d("div",he,[be,i(f,{class:"pl-2"},{default:n((({id:e})=>[i(s,null,{default:n((()=>[i(t,{required:"",modelValue:v(j).customerCompany,"onUpdate:modelValue":l[0]||(l[0]=e=>v(j).customerCompany=e),attrs:{id:e},placeholder:"Select customer company",label:"name",options:v(T),searchable:!0,"track-by":"name",height:300,class:"lg-multiselect",onInput:E},{singlelabel:n((({value:e})=>[d("div",_e,[d("img",{style:{width:"30px"},class:"select-label-icon mr-2",src:e.icon,alt:""},null,8,ke),r(" "+u(e.name),1)])])),option:n((({option:e})=>[d("img",{style:{width:"40px","padding-right":"6px"},class:"select-option-icon mr-2",src:e.icon,alt:""},null,8,we),r(" "+u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",xe,[Ie,i(f,{class:"pl-2"},{default:n((({id:e})=>[i(s,null,{default:n((()=>[i(t,{required:"",modelValue:v(j).site,"onUpdate:modelValue":l[1]||(l[1]=e=>v(j).site=e),attrs:{id:e},placeholder:"Select a site",label:"name",options:v(S),searchable:!0,"track-by":"name",height:400},{singlelabel:n((({value:e})=>[d("div",Se,u(e.name),1)])),option:n((({option:e})=>[r(u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Ve,[Te,i(f,{class:""},{default:n((({id:e})=>[i(s,null,{default:n((()=>[i(t,{required:"",modelValue:v(j).worker,"onUpdate:modelValue":l[2]||(l[2]=e=>v(j).worker=e),attrs:{id:e},placeholder:"Select worker",label:"name",options:v(C),searchable:!0,"track-by":"name",height:400},{singlelabel:n((({value:e})=>[d("div",Ce,[d("img",{style:{width:"24px",height:"24px"},class:"select-label-icon mr-2",src:e.icon,alt:""},null,8,Re),r(" "+u(e.name),1)])])),option:n((({option:e})=>[d("img",{style:{width:"30px","padding-right":"6px"},class:"select-option-icon mr-2",src:e.icon,alt:""},null,8,je),r(" "+u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Oe,[i(f,null,{default:n((()=>[i(h,null,{default:n((()=>[r("Start Time *")])),_:1}),i(s,null,{default:n((()=>[i(b,{required:"",modelValue:v(j).start,"onUpdate:modelValue":l[3]||(l[3]=e=>v(j).start=e),type:"time"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Me,[i(f,null,{default:n((()=>[i(h,null,{default:n((()=>[r("End Time *")])),_:1}),i(s,null,{default:n((()=>[i(b,{required:"",modelValue:v(j).end,"onUpdate:modelValue":l[4]||(l[4]=e=>v(j).end=e),type:"time"},null,8,["modelValue"])])),_:1})])),_:1})])]),i(_,{items:R,"with-chevron":"",style:{"border-radius":"14px"}},{"collapse-item-head":n((e=>[Le])),"collapse-item-content":n((e=>[d("div",Ne,[d("div",Ae,[d("div",Ue,[d("div",De,[d("div",$e,[ze,d("div",Be,[c(d("input",{type:"number",name:"rate","onUpdate:modelValue":l[5]||(l[5]=e=>v(j).hourlyRate=e),class:"input is-primary-focus",placeholder:"Rate per hour"},null,512),[[p,v(j).hourlyRate]])])]),d("div",Pe,[Ee,d("div",He,[c(d("input",{type:"number",name:"rate","onUpdate:modelValue":l[6]||(l[6]=e=>v(j).hours=e),class:"input is-primary-focus",placeholder:"Rate per hour"},null,512),[[p,v(j).hours]])])]),d("div",qe,[Je,d("div",Fe,[c(d("input",{type:"text",name:"note","onUpdate:modelValue":l[7]||(l[7]=e=>v(j).notes=e),class:"input is-primary-focus",placeholder:"Enter Note"},null,512),[[p,v(j).notes]])])])])])])])])),_:1})])])])),action:n((()=>[i(I,{type:"submit",color:"primary",loading:v(y),raised:""},{default:n((()=>[r("Save")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),[["__scopeId","data-v-0615def8"]]),Ge={styke:"width:100%; height:100%"},Ke=a({__name:"TimestampMap",props:{activities:{},timestamp:{}},emits:["update:modalHandler"],setup(e,{emit:a}){const i=e,n=H(),d=l(!1),r=I({series:[{name:"Profiles",data:i.activities}],chart:{height:270,type:"area",zoom:{enabled:!1},toolbar:{show:!1}},colors:[n.success],dataLabels:{enabled:!1},stroke:{width:[4,5,5],curve:"smooth"},grid:{row:{colors:["transparent","transparent"],opacity:0},yaxis:{lines:{show:!1}}},xaxis:{categories:i.timestamp},tooltip:{y:{formatter:function(e){return e}}}});return t((()=>{d.value=!0})),(e,a)=>(o(),s("div",Ge,[d.value?(o(),w(v(E),{key:0,id:"line-stats-widget-chart2",height:r.value.chart.height,type:r.value.chart.type,series:r.value.series,options:r.value},null,8,["height","type","series","options"])):S("",!0)]))}}),Xe={id:"activity_map2",style:{"border-radius":"20px"}},Ye=a({__name:"HeatMap",props:{activity:{}},setup(e){const a=e;return t((()=>{(e=>{var a=[],l=51.45047,t=-.34572;e.forEach((e=>{0!=e.latitude&&0!=e.longitude&&(a.push(new google.maps.LatLng(e.latitude,e.longitude)),l=e.latitude,t=e.longitude)}));let o=new google.maps.Map(document.getElementById("activity_map2"),{zoom:16,center:{lat:l,lng:t},mapTypeId:google.maps.MapTypeId.ROADMAP});console.log("mapp",o),new google.maps.visualization.HeatmapLayer({data:a,map:o,radius:20})})(a.activity),console.log("acitivity",a.activity)})),(e,a)=>(o(),s("div",Xe))}}),Ze={key:0,class:"columns is-multiline"},Qe={class:"column is-12"},ea={class:"is-flex"},aa={class:"content-wrap"},la={class:"content-box"},ta={class:"columns is-multiline"},oa={class:"column is-6"},sa=d("p",{class:"is-bold mb-1"},"Book on",-1),ia={class:"card is-flex p-3"},na={class:"box-text ml-2"},da={class:"meta-text"},ra={class:"ml-1 mb-3 is-bold"},ua={class:"ml-1 mb-1 is-bold"},ca={class:"ml-1",style:{width:"80px"}},ma=d("i",{class:"lnir lnir-hospital-location mr-2",style:{"font-size":"larger",color:"var(--primary)"},"aria-hidden":"true"},null,-1),pa=d("div",{id:"myMapOn",style:{height:"140px",width:"160px","border-radius":"10px"}},null,-1),va={class:"column is-6"},fa=d("p",{class:"is-bold mb-1"},"Book off",-1),ga={class:"card is-flex p-3"},ya={class:"box-text ml-2"},ha={class:"meta-text"},ba={class:"ml-1 mb-3 is-bold"},_a={class:"ml-1"},ka={class:"ml-1",style:{width:"80px"}},wa=d("i",{class:"lnir lnir-hospital-location mr-2",style:{"font-size":"larger",color:"var(--primary)"},"aria-hidden":"true"},null,-1),xa=d("div",{id:"myMapOff",style:{height:"140px",width:"160px","border-radius":"10px"}},null,-1),Ia={class:"column is-12 mt-3"},Sa={class:"column is-12"},Va={key:1},Ta=d("img",{class:"light-image is-larger",src:J,alt:""},null,-1),Ca=d("img",{class:"dark-image is-larger",src:F,alt:""},null,-1),Ra=a({__name:"timeSheetComponent",props:{timesheetId:{}},emits:["update:modalHandler"],setup(e,{emit:a}){const m=e,p=H(),v=l(!1);L();const f=z(),g=l(!1),y=l([]),h=l([]),b=l({timeSheetID:0,device_data:[{acceX:0,acceY:0,acceZ:0,accuracy_level:0,activity_type:"",activity_value:0,altitude:0,app_version:"",battery_level:0,climb:0,deviceUserName:"",device_type:"",direction:0,gyroX:0,gyroY:0,gyroZ:0,heartRate:0,horizontal:0,id:0,latitude:0,longitude:0,movement_type:"",readingsTimeDelta:0,speed:0,timeStamp:"",vertical:0,timeSheetID:0,worker_id:0}],created_at:"",worker_id:0,bookOnTime:"",bookOffTime:"",bookOnLat:"",bookOnLong:"",bookOnLocation:"",bookOffLat:"",bookOffLong:"",bookOffLocation:"",hoursWorked:"",bookOnImageURL:"",bookOffImageURL:"",isBookOnImageVerified:!1,isBookOffImageVerified:!1}),_=I({series:[{name:"Profiles",data:[]}],chart:{height:270,type:"area",zoom:{enabled:!1},toolbar:{show:!1}},colors:[p.success],dataLabels:{enabled:!1},stroke:{width:[4,5,5],curve:"smooth"},grid:{row:{colors:["transparent","transparent"],opacity:0},yaxis:{lines:{show:!1}}},xaxis:{categories:[]},tooltip:{y:{formatter:function(e){return e}}}});let k={};return t((()=>{((e,a)=>{let l={lat:e,lng:length};k=new google.maps.Map(document.getElementById("myMapOn"),{center:l,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.Satellite,zoom:6}),new google.maps.Marker({position:{lat:e,lng:a},map:k,title:"Worker"})})(51.4497984,-.3464489),((e,a)=>{let l={lat:e,lng:length};k=new google.maps.Map(document.getElementById("myMapOff"),{center:l,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.Satellite,zoom:6}),new google.maps.Marker({position:{lat:e,lng:a},map:k,title:"Worker"})})(51.4497984,-.3464489),(async()=>{try{v.value=!0;const e=await f.get(`v3/api/timesheet/details/${m.timesheetId}/`,{});b.value=e.data;let a=[],l=[];e.data.device_data.forEach((e=>{a.push(parseFloat(e.activity_value).toFixed(3)),l.push(e.timeStamp&&e.timeStamp.length>20?e.timeStamp.slice(11,16):e.timeStamp)})),_.value.series[0].data=a,_.value.xaxis.categories=l,y.value=a,h.value=l,g.value=!0}catch(e){console.log(e)}finally{v.value=!1}})()})),(e,a)=>{const l=T,t=q,m=Ye,p=Ke,f=P;return b.value.device_data.length?(o(),s("div",Ze,[d("div",Qe,[d("div",ea,[v.value?(o(),w(l,{key:0,height:"80px",width:"50%",class:"mx-2"})):S("",!0),v.value?(o(),w(l,{key:1,height:"80px",width:"50%",class:"mx-2 mb-6"})):S("",!0)]),d("div",aa,[c(d("div",la,[d("div",ta,[d("div",oa,[sa,d("div",ia,[i(t,{picture:b.value.bookOnImageURL?b.value.bookOnImageURL:"",squared:"",size:"medium"},null,8,["picture"]),d("div",na,[d("div",da,[d("p",ra,[r(" Time: "),d("span",ua,u(b.value.bookOnTime?b.value.bookOnTime.slice(0,10):"-- --")+" "+u(b.value.bookOnTime?b.value.bookOnTime.slice(11,16):"-- --"),1)]),d("span",ca,[ma,r(" "+u(b.value.bookOnLocation?b.value.bookOnLocation:"-----")+" London ",1)])])]),pa])]),d("div",va,[fa,d("div",ga,[i(t,{picture:b.value.bookOffImageURL?b.value.bookOffImageURL:"",squared:"",size:"medium"},null,8,["picture"]),d("div",ya,[d("div",ha,[d("p",ba,[r(" Time: "),d("span",_a,u(b.value.bookOffTime?b.value.bookOffTime.slice(0,10):"-- --")+" "+u(b.value.bookOnTime?b.value.bookOnTime.slice(11,16):"-- --"),1)]),d("span",ka,[wa,r(" "+u(b.value.bookOffLocation?b.value.bookOffLocation:"-----")+", London ",1)])])]),xa])])])],512),[[V,!v.value]])])]),d("div",Ia,[g.value?(o(),w(m,{key:0,style:{height:"280px",width:"100%"},activity:b.value.device_data},null,8,["activity"])):S("",!0),v.value?(o(),w(l,{key:1,height:"280px",width:"100%",class:"mx-2"})):S("",!0)]),d("div",Sa,[v.value?(o(),w(l,{key:0,height:"280px",width:"100%",class:"mx-2"})):S("",!0),g.value?(o(),w(p,{key:1,activities:y.value,timestamp:h.value},null,8,["activities","timestamp"])):S("",!0)])])):(o(),s("div",Va,[i(f,{title:"No Activity found.",subtitle:"Looks like worker did not performed any activity within this time-stamp "},{image:n((()=>[Ta,Ca])),_:1})]))}}}),ja={class:"row"},Oa={class:"columns is-multiline"},Ma={class:"column is-6"},La={class:"columns is-multiline"},Na={class:"column is-12"},Aa={class:"columns is-multiline"},Ua={class:"column is-3"},Da={class:"column is-9"},$a={class:"is-flex space-between"},za={style:{width:"120px","white-space":"nowrap"},class:"title is-5 mb-2"},Ba=[d("i",{class:"lnir lnir-apple","aria-hidden":"true"},null,-1),d("i",{class:"iconify ml-3 cu-pointer pointer","data-icon":"feather:external-link"},null,-1)],Pa={class:"is-flex cus-align-center mb-1"},Ea=d("i",{class:"iconify text-light","data-icon":"feather:phone","aria-hidden":"true"},null,-1),Ha={class:"is-bold"},qa={class:"is-flex cus-align-center mb-1"},Ja=d("i",{class:"iconify","data-icon":"feather:mail","aria-hidden":"true"},null,-1),Fa={class:"is-bold"},Wa={class:"is-flex cus-align-center mb-1 text-light"},Ga=d("i",{class:"iconify","data-icon":"feather:map-pin","aria-hidden":"true"},null,-1),Ka={class:"is-bold"},Xa={class:"column is-12"},Ya={class:"columns is-multiline"},Za={class:"column is-5"},Qa={class:"columns is-multiline"},el={class:"column is-12"},al=d("h3",{class:"title is-5 mb-2"},"Site Name",-1),ll={class:"is-bold"},tl={class:"column is-12"},ol=d("h3",{class:"title is-5 mb-2"},"Site Addreess",-1),sl={class:"is-bold"},il={class:"column is-5"},nl={class:"columns is-multiline"},dl={class:"column is-12"},rl=d("h3",{class:"title is-5 mb-2"},"Date",-1),ul={class:"is-bold"},cl={class:"column is-12"},ml=d("h3",{class:"title is-5 mb-2"},"Shift Time",-1),pl={class:"is-bold"},vl={class:"column is-2"},fl={class:"columns is-multiline"},gl={class:"column is-12"},yl={class:"column is-12"},hl=d("div",{class:"column is-6"},[d("div",{id:"myMap",style:{height:"324px",width:"100%","border-radius":"10px"}})],-1),bl={class:"column is-12"},_l={class:"p-2 is-flex",style:{}},kl=d("p",{style:{"font-weight":"600","margin-bottom":"0px","padding-left":"10px",color:"white",display:"flex","align-items":"center"}},null,-1),wl={class:"item-name dark-inverted",style:{"font-weight":"500"}},xl={style:{"font-weight":"500","margin-bottom":"0px","padding-left":"5px",color:"white"}},Il=d("button",{style:{display:"none"}},"close",-1),Sl=a({__name:"rotaDetailModal",props:{timeSheetDetailModal:{type:Boolean},timesheetId:{},rotaId:{},getRota:{type:Function}},emits:["update:modalHandler"],setup(a,{emit:r}){const c=a;let m,p,f;const g=l([]),y=C(),h=L(),b=z(),_=l(!1),k=l(!1);l(0);const x=l({id:0,siteInfo:{id:5,name:"",address:"",postcode:"",city:"",inchargeName:"",color:"",latitude:0,longitude:0,geofence:{},comments:""},wokrkerInfo:{id:0,firstName:"",lastName:"",latitude:0,longitude:0,postCode:" ",phoneNumber:"",emailAddress:"",profileImageURL:""},customerCompanyInfo:{id:36,name:"",trade_name:"",email:"",phone_number:"",logo:"",postcode:"",latitude:0,longitude:0,business_details:"",reg_no:"",business_type:"",covered_distance:75,vat_no:null,address:"",color:"",created_at:"",company:0,industry:0},date:"",start:"",end:"",shift:"",hourlyRate:0,notes:"",createdAt:"",createdBy:"",UpdatedAt:null,updatedBy:"",company:0,site:0,worker:0,customerCompany:0,job:null,jobsList:[{id:"",end:"",start:"",jobName:"",resourceId:""}]}),I=()=>{r("update:modalHandler",!1),c.getRota()},V=async()=>{try{const e=await b.get(`/v3/api/rota/${c.rotaId}/detail/`);x.value=e.data,g.value=e.data.jobsList.map((e=>({...e,title:e.jobName}))),M()}catch(e){console.log(e)}},T=async()=>{try{await b.delete(`/v3/api/rota/${c.rotaId}/`);I(),h.error("Job deleted successfuly")}catch(e){console.log(e)}},O=()=>{y.push({name:"/sidebar/company/workers/[id]",params:{id:x.value.wokrkerInfo.id}}),console.log("clickingg")},M=()=>{N.value.resources=g.value,N.value.events=g.value},N=l({plugins:[K],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineDay",height:"auto",resourceAreaWidth:"10%",selectable:!0,now:"2024-04-23",headerToolbar:{left:"",center:"",right:""},droppable:!0,editable:!0,views:{resourceTimelineDay:{type:"timeline",duration:{days:2},slotDuration:"00:30:00",slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1}}},resourceAreaHeaderContent:"Jobs",eventClick:e=>{console.log("clicking on",e.event.id)}});return t((async()=>{await V(),((e,a,l,t)=>{const o=new google.maps.LatLng(e,a),s=new google.maps.LatLng(l,t);m=new google.maps.Map(document.getElementById("myMap"),{center:o,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.Satellite,zoom:7}),p=new google.maps.DirectionsService,f=new google.maps.DirectionsRenderer,f.setMap(m);const i={origin:o,destination:s,travelMode:google.maps.TravelMode.DRIVING};p.route(i,(function(e,a){a===google.maps.DirectionsStatus.OK?f.setDirections(e):console.error("Error fetching directions: "+a)})),new google.maps.Marker({position:o,map:m,title:"Worker Location"}),new google.maps.Marker({position:s,map:m,title:"Site Location"})})(x.value.wokrkerInfo.latitude,x.value.wokrkerInfo.longitude,x.value.siteInfo.latitude,x.value.siteInfo.longitude)})),(a,l)=>{const t=q,r=j,m=W,p=Ra,f=e,g=We,y=pe;return o(),s(R,null,[i(f,{open:c.timeSheetDetailModal,title:"Rota Detail",size:"xl",actions:"right",onClose:I},{content:n((()=>[d("div",ja,[d("div",Oa,[d("div",Ma,[d("div",La,[d("i",{style:{position:"absolute",top:"44px",left:"166px"},class:"fas fa-pencil-alt cu-pointer flex-align-end","aria-hidden":"true",onClick:l[0]||(l[0]=e=>_.value=!0)}),d("i",{style:{position:"absolute",top:"44px",left:"190px",color:"var(--danger)"},class:"fas fa-trash-alt cu-pointer flex-align-end","aria-hidden":"true",onClick:l[1]||(l[1]=()=>{k.value=!k.value})}),d("div",Na,[i(r,{radius:"large",elevated:""},{default:n((()=>[d("div",Aa,[d("div",Ua,[i(t,{onClick:O,picture:x.value.wokrkerInfo.profileImageURL,size:"big",squared:""},null,8,["picture"])]),d("div",Da,[d("div",$a,[d("div",null,[d("h3",za,u(x.value.wokrkerInfo?x.value.wokrkerInfo.firstName:"------")+" "+u(x.value.wokrkerInfo?x.value.wokrkerInfo.lastName:"------"),1)]),d("div",{onClick:O,class:"is-flex cus-align-center"},Ba)]),d("div",Pa,[Ea,d("p",Ha,u(x.value.wokrkerInfo?x.value.wokrkerInfo.phoneNumber:"------"),1)]),d("div",qa,[Ja,d("p",Fa,u(x.value.wokrkerInfo?x.value.wokrkerInfo.emailAddress:"------"),1)]),d("div",Wa,[Ga,d("p",Ka,u(x.value.wokrkerInfo?x.value.wokrkerInfo.postCode:"------"),1)])])])])),_:1})]),d("div",Xa,[i(r,{radius:"large",elevated:""},{default:n((()=>[d("div",Ya,[d("div",Za,[d("div",Qa,[d("div",el,[al,d("p",ll,u(x.value.siteInfo?x.value.siteInfo.name:"------"),1)]),d("div",tl,[ol,d("p",sl,u(x.value.siteInfo?x.value.siteInfo.address:"------"),1)])])]),d("div",il,[d("div",nl,[d("div",dl,[rl,d("p",ul,u(x.value?x.value.date:"------"),1)]),d("div",cl,[ml,d("p",pl,u(x.value?x.value.start:"-- --")+" "+u(x.value?x.value.end:"-- --"),1)])])]),d("div",vl,[d("div",fl,[d("div",gl,[i(t,{picture:x.value.customerCompanyInfo?x.value.customerCompanyInfo.logo:"/images/logoplaceholder.png",size:"medium",rounded:""},null,8,["picture"])]),d("div",yl,[i(t,{picture:"day"==x.value.shift?"/images/dayTime.png":"/images/nightTime.png",size:"medium",rounded:""},null,8,["picture"])])])])])])),_:1})])])]),hl,d("div",bl,[i(v(G),{options:N.value},{eventContent:n((e=>[d("div",_l,[kl,e.event.id?(o(),w(m,{key:0,light:"",color:"info",class:"mr-5"},{default:n((()=>[d("span",wl,"Job-00"+u(e.event.id),1)])),_:2},1024)):S("",!0),d("p",xl,u(e.event.extendedProps.jobName),1)])])),_:1},8,["options"])])])]),i(r,{class:"mt-3",radius:"large",elevated:""},{default:n((()=>[i(p,{timesheetId:c.timesheetId},null,8,["timesheetId"])])),_:1})])),action:n((()=>[])),cancel:n((()=>[Il])),_:1},8,["open"]),_.value?(o(),w(g,{key:0,editRotaModalOpen:_.value,rotaId:x.value.id,"onUpdate:modalHandler":l[2]||(l[2]=e=>_.value=!1),"onUpdate:OnSuccess":V},null,8,["editRotaModalOpen","rotaId"])):S("",!0),k.value?(o(),w(y,{key:1,actionVerificationModal:k.value,captionText:"delete job",message:"Are you sure you want to delete this job permanentaly, if you do so then you won't be able to recover it again?","onUpdate:OnSuccess":T},null,8,["actionVerificationModal"])):S("",!0)],64)}}}),Vl=e=>(y("data-v-96011dba"),e=e(),h(),e),Tl={class:"modal-form columns is-multiline",id:"addRota"},Cl={class:"field column is-12 mb-0"},Rl={class:"columns is-multiline mb-3"},jl={class:"field is-flex column is-12 mb-0"},Ol=Vl((()=>d("h1",null,"Selected dates:",-1))),Ml={class:"field column is-6 mb-0"},Ll=Vl((()=>d("label",null,"Select customer company*",-1))),Nl={class:"multiselect-single-label"},Al=["src"],Ul=["src"],Dl={class:"field column is-6 mb-0"},$l=Vl((()=>d("label",null,"Select Site *",-1))),zl={class:"multiselect-single-label"},Bl={class:"field column is-6 mb-0"},Pl=Vl((()=>d("label",{class:"mb-2"},"Select Worker *",-1))),El={class:"multiselect-single-label"},Hl=["src"],ql=["src"],Jl={class:"field column is-3 mb-0"},Fl={class:"field column is-3 mb-0"},Wl={class:"field column is-12 mb-0"},Gl=Vl((()=>d("label",null,"Select Job ",-1))),Kl={class:"multiselect-single-label"},Xl={class:"column is-12 mb-0"},Yl={key:0,class:"field column is-6 mb-0"},Zl={key:1,class:"field column is-6 mb-0"},Ql={key:2,class:"field column is-6 mb-0"},et={key:3,class:"field column is-6 mb-0"},at={key:4,class:"field column is-12 mb-0",style:{width:"100%",display:"flex","justify-content":"flex-end",float:"right"}},lt={class:"column is-12"},tt={class:"p-2 is-flex",style:{position:"relative",width:"100%"}},ot=["onClick"],st=[Vl((()=>d("i",{class:"iconify close","data-icon":"feather:x-circle","aria-hidden":"true",style:{"font-size":"1.5rem"}},null,-1)))],it=Vl((()=>d("p",{style:{"font-weight":"600","margin-bottom":"0px","padding-left":"10px",color:"white",display:"flex","align-items":"center"}},null,-1))),nt={class:"item-name dark-inverted",style:{"font-weight":"500"}},dt={style:{"font-weight":"500","margin-bottom":"0px","padding-left":"5px",color:"white"}},rt=Vl((()=>d("div",{class:"head-info"},[d("div",{class:"head-progress"})],-1))),ut={class:"body-inner-content"},ct={class:"field columns is-multiline mb-0"},mt={class:"column is-12"},pt={class:"columns is-multiline space-around"},vt={class:"field column is-5 mb-0"},ft=Vl((()=>d("label",null,"Charge Rate",-1))),gt={class:"control"},yt={class:"field column is-5 mb-0"},ht=Vl((()=>d("label",null,"Charge Hours",-1))),bt={class:"control"},_t={class:"field column is-11 mb-0"},kt=Vl((()=>d("label",null,"Notes",-1))),wt={class:"control"},xt=a({__name:"AddRotaModal",props:{AddRotaModalOpen:{type:Boolean},selectedDatesArray:{},workerId:{}},emits:["update:modalHandler","update:OnSuccess","remove-date"],setup(a,{emit:f}){const y=a,h=B(),b=l(!1),I=L(),V=z(),T=l(!1),C=l(""),j=l(""),M=l("");let P=l([]);const E=l("");l("");const H=l([]),q=l([]);let J=l([]),F=l([]),Z=l([]);l([{id:0,firstName:"",lastName:"",profileImageURL:""}]);const Q=[{title:"Additional Information",content:"Add additional information about rota, rate or worker"}],ee=l([{id:0,jobName:"",description:"",shift:"",startDate:"",endDate:"",startTime:"08:00:00",endTime:"16:00:00",hourlyRate:0,overtimeRate:0,isActive:!1,jobType:"",color:"",isApproval:!0,createdAt:"",updatedAt:null,workingDays:[],contractSite:0}]),ae=l({id:0,jobName:"",start:"",end:""}),le=l({dates:[],id:0,start:"08:00",end:"16:00",hours:0,shift:"",hourlyRate:0,notes:"",createdBy:"",UpdatedAt:"",updatedBy:"",company:"",site:"",worker:"",customerCompany:"",job:"",jobsList:[]}),te=()=>{f("update:modalHandler",!1)},oe=()=>{q.value=q.value.filter((e=>!e.hasOwnProperty("display"))),q.value.push({start:`2024-04-23T${le.value.start}`,end:`2024-04-23T${le.value.end}`,display:"background"}),se.value.resources=q.value,se.value.events=q.value},se=l({plugins:[K],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineDay",height:"auto",resourceAreaWidth:"10%",selectable:!0,now:"2024-04-23",headerToolbar:{left:"",center:"",right:""},droppable:!0,editable:!0,views:{resourceTimelineDay:{type:"timeline",duration:{days:2},slotDuration:"00:30:00",slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1}}},resourceAreaHeaderContent:"Jobs"}),ie=async()=>{b.value=!0;try{await V.post("/v3/api/rota/create/",{dates:JSON.stringify(y.selectedDatesArray),start:le.value.start,end:le.value.end,shift:le.value.shift,hourlyRate:le.value.hourlyRate,notes:le.value.notes,createdBy:le.value.createdBy,UpdatedAt:le.value.UpdatedAt,updatedBy:le.value.updatedBy,company:h.loggedCompany.id,site:j.value,worker:C.value,customerCompany:E.value,job:le.value.job,jobsList:JSON.stringify(q.value)});f("update:OnSuccess",null),I.success("Rota Added Successfuly"),b.value=!1,te()}catch(e){console.log(e),I.error("You're assigning the same worker on the same date please try different."),b.value=!1}},ne=()=>{ae.value.start=`2024-04-23T${ae.value.start}`,ae.value.end=`2024-04-23T${ae.value.end}`,ae.value.resourceId=ae.value.id;const e={...ae.value};q.value.push(e),oe(),ae.value.id=0,ae.value.end="",ae.value.start="",ae.value.jobName="",I.success("Job Added")};return _(M,((e,a)=>{console.log("wactch id",M);const l=H.value.find((a=>a.id==e));l&&(q.value.push({id:l.id,jobName:l.jobName,start:`2024-04-23T${l.startTime}`,end:`2024-04-23T${l.endTime}`,resourceId:l.id,title:l.jobName}),console.log("selected job",l),oe())})),_(E,((e,a)=>{(async()=>{try{const e=await V.get(`/v3/api/site/customer-company/${E.value}/`);P.value=e.data.map((e=>({value:e.id.toString(),name:`${e.name} - ${e.contractInfo.name}`}))),e.data&&(j.value=e.data[0].id)}catch(e){console.log(e)}})()})),_(j,((e,a)=>{(async()=>{try{const e=await V.get(`/v3/api/jobs/site/${j.value}/`,{});ee.value=e.data,H.value=e.data.jobs,console.log("jobs",H.value),Z.value=e.data.jobs.map((e=>({value:e.id.toString(),name:e.jobName})))}catch(e){}})()})),_([()=>le.value.start,()=>le.value.end],(([e,a],[l,t])=>{oe()})),t((()=>{(async()=>{try{const e=await V.get(`/v3/api/worker/${h.loggedCompany.id}/worker-short-info/`);F.value=e.data.map((e=>({value:e.id.toString(),name:`${e.firstName} ${e.lastName}`,icon:e.profileImageURL}))),C.value=y.workerId}catch{I.error("Invalid data")}finally{b.value=!1}})(),oe(),(async()=>{b.value=!0;const e=await V.get(`/v3/api/customer-company/company/${h.loggedCompany.id}`);J.value=e.data.map((e=>({value:e.id.toString(),name:e.name,icon:e.logo?e.logo:"/default/icon.png"}))),e.data&&(E.value=e.data[0].id),b.value=!1})(),y.workerId&&(C.value=y.workerId.toString())})),(a,l)=>{const t=W,h=Y,_=$,I=k("Multiselect"),V=D,L=U,z=A,B=X,H=g,K=N,ee=e;return o(),w(ee,{is:"form",size:"xl",open:y.AddRotaModalOpen,title:"Add Rota",actions:"right",onSubmit:x(ie,["prevent"]),onClose:te},{content:n((()=>[d("div",Tl,[d("div",Cl,[d("div",Rl,[d("div",jl,[Ol,i(_,{class:"is-flex"},{default:n((()=>[(o(!0),s(R,null,O(y.selectedDatesArray,((e,a)=>(o(),w(h,{addons:"",key:a},{default:n((()=>[i(t,{light:"",class:"ml-2",label:e,color:"primary",outlined:"",rounded:""},null,8,["label"]),i(t,{rounded:"",outlined:"",remove:"",onClick:e=>(e=>{f("remove-date",e)})(a)},null,8,["onClick"])])),_:2},1024)))),128))])),_:1})]),d("div",Ml,[Ll,i(V,{class:"pl-2"},{default:n((({id:e})=>[i(_,null,{default:n((()=>[i(I,{required:"",modelValue:v(E),"onUpdate:modelValue":l[0]||(l[0]=e=>m(E)?E.value=e:null),attrs:{id:e},placeholder:"Select customer company",label:"name",options:v(J),searchable:!0,"track-by":"name",height:300,class:"lg-multiselect"},{singlelabel:n((({value:e})=>[d("div",Nl,[d("img",{style:{width:"30px"},class:"select-label-icon mr-2",src:e.icon,alt:""},null,8,Al),r(" "+u(e.name),1)])])),option:n((({option:e})=>[d("img",{style:{width:"40px","padding-right":"6px"},class:"select-option-icon mr-2",src:e.icon,alt:""},null,8,Ul),r(" "+u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Dl,[$l,i(V,{class:"pl-2"},{default:n((({id:e})=>[i(_,null,{default:n((()=>[i(I,{required:"",modelValue:v(j),"onUpdate:modelValue":l[1]||(l[1]=e=>m(j)?j.value=e:null),attrs:{id:e},placeholder:"Select a site",label:"name",options:v(P),searchable:!0,"track-by":"name",height:40},{singlelabel:n((({value:e})=>[d("div",zl,u(e.name),1)])),option:n((({option:e})=>[r(u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Bl,[Pl,i(V,{class:""},{default:n((({id:e})=>[i(_,null,{default:n((()=>[i(I,{required:"",modelValue:v(C),"onUpdate:modelValue":l[2]||(l[2]=e=>m(C)?C.value=e:null),attrs:{id:e},placeholder:"Select worker",label:"name",options:v(F),searchable:!0,"track-by":"name",height:400},{singlelabel:n((({value:e})=>[d("div",El,[d("img",{style:{width:"24px",height:"24px"},class:"select-label-icon mr-2",src:e.icon,alt:""},null,8,Hl),r(" "+u(e.name),1)])])),option:n((({option:e})=>[d("img",{style:{width:"30px","padding-right":"6px"},class:"select-option-icon mr-2",src:e.icon,alt:""},null,8,ql),r(" "+u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Jl,[i(V,null,{default:n((()=>[i(L,null,{default:n((()=>[r("Start Time *")])),_:1}),i(_,null,{default:n((()=>[i(z,{required:"",modelValue:v(le).start,"onUpdate:modelValue":l[3]||(l[3]=e=>v(le).start=e),type:"time"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Fl,[i(V,null,{default:n((()=>[i(L,null,{default:n((()=>[r("End Time *")])),_:1}),i(_,null,{default:n((()=>[i(z,{required:"",modelValue:v(le).end,"onUpdate:modelValue":l[4]||(l[4]=e=>v(le).end=e),type:"time"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Wl,[Gl,i(V,{class:"pl-2"},{default:n((({id:e})=>[i(_,null,{default:n((()=>[i(I,{modelValue:v(M),"onUpdate:modelValue":l[5]||(l[5]=e=>m(M)?M.value=e:null),attrs:{id:e},placeholder:"Select a job",label:"name",options:v(Z),searchable:!0,"track-by":"name",height:100},{singlelabel:n((({value:e})=>[d("div",Kl,u(e.name),1)])),option:n((({option:e})=>[r(u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Xl,[i(V,null,{default:n((()=>[i(_,null,{default:n((()=>[i(B,{modelValue:v(T),"onUpdate:modelValue":l[6]||(l[6]=e=>m(T)?T.value=e:null),label:"Create new jobs"},null,8,["modelValue"])])),_:1})])),_:1})]),v(T)?(o(),s("div",Yl,[i(V,null,{default:n((()=>[i(L,null,{default:n((()=>[r("Job Name")])),_:1}),i(_,null,{default:n((()=>[i(z,{modelValue:v(ae).jobName,"onUpdate:modelValue":l[7]||(l[7]=e=>v(ae).jobName=e),type:"text",placeholder:"Job name"},null,8,["modelValue"])])),_:1})])),_:1})])):S("",!0),v(T)?(o(),s("div",Zl,[i(V,null,{default:n((()=>[i(L,null,{default:n((()=>[r("Job Id")])),_:1}),i(_,null,{default:n((()=>[i(z,{modelValue:v(ae).id,"onUpdate:modelValue":l[8]||(l[8]=e=>v(ae).id=e),type:"text",placeholder:"Job id"},null,8,["modelValue"])])),_:1})])),_:1})])):S("",!0),v(T)?(o(),s("div",Ql,[i(V,null,{default:n((()=>[i(L,null,{default:n((()=>[r("Start Time *")])),_:1}),i(_,null,{default:n((()=>[i(z,{modelValue:v(ae).start,"onUpdate:modelValue":l[9]||(l[9]=e=>v(ae).start=e),type:"time"},null,8,["modelValue"])])),_:1})])),_:1})])):S("",!0),v(T)?(o(),s("div",et,[i(V,null,{default:n((()=>[i(L,null,{default:n((()=>[r("End Time *")])),_:1}),i(_,null,{default:n((()=>[i(z,{modelValue:v(ae).end,"onUpdate:modelValue":l[10]||(l[10]=e=>v(ae).end=e),type:"time"},null,8,["modelValue"])])),_:1})])),_:1})])):S("",!0),v(T)?(o(),s("div",at,[i(H,{color:"primary",onClick:ne,elevated:"",rounded:"",light:""},{default:n((()=>[r(" Add ")])),_:1})])):S("",!0),d("div",lt,[i(v(G),{options:v(se)},{eventContent:n((e=>[d("div",tt,[e.event.extendedProps.jobName?(o(),s("span",{key:0,style:{position:"absolute",top:"0.7rem",right:"1rem","z-index":"9999909"},onClick:()=>{return a=e.event.id,a=parseInt(a),q.value=q.value.filter((e=>e.id!==a)),void oe();var a},class:"close-icon"},st,8,ot)):S("",!0),it,e.event.id?(o(),w(t,{key:1,light:"",color:"info",class:"mr-5"},{default:n((()=>[d("span",nt,"Job-00"+u(e.event.id),1)])),_:2},1024)):S("",!0),d("p",dt,u(e.event.extendedProps.jobName),1)])])),_:1},8,["options"])])]),i(K,{items:Q,"with-chevron":"",style:{"border-radius":"14px"}},{"collapse-item-head":n((e=>[rt])),"collapse-item-content":n((e=>[d("div",ut,[d("div",ct,[d("div",mt,[d("div",pt,[d("div",vt,[ft,d("div",gt,[c(d("input",{type:"number",name:"rate","onUpdate:modelValue":l[11]||(l[11]=e=>v(le).hourlyRate=e),class:"input is-primary-focus",placeholder:"Rate per hour"},null,512),[[p,v(le).hourlyRate]])])]),d("div",yt,[ht,d("div",bt,[c(d("input",{type:"number",name:"rate","onUpdate:modelValue":l[12]||(l[12]=e=>v(le).hours=e),class:"input is-primary-focus",placeholder:"Rate per hour"},null,512),[[p,v(le).hours]])])]),d("div",_t,[kt,d("div",wt,[c(d("input",{type:"text",name:"note","onUpdate:modelValue":l[13]||(l[13]=e=>v(le).notes=e),class:"input is-primary-focus",placeholder:"Enter Note"},null,512),[[p,v(le).notes]])])])])])])])])),_:1})])])])),action:n((()=>[i(H,{type:"submit",color:"primary",loading:v(b),raised:""},{default:n((()=>[r("Save")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),It=b(xt,[["__scopeId","data-v-96011dba"]]),St={id:"rota-celender"},Vt={class:"columns is-multiline"},Tt=(e=>(y("data-v-07129a90"),e=e(),h(),e))((()=>d("div",{class:"column is-7 is-flex space-between"},[d("h6",{style:{"white-space":"nowrap"},class:"cus-main-heading mr-3 ml-1 mt-5"}," Rota View ")],-1))),Ct={class:"column is-5 mt-4"},Rt={class:"list-flex-toolbar is-reversed"},jt={class:"buttons"},Ot={class:"is-flex space-between mb-2"},Mt={key:0,style:{color:"#f89216","font-size":"16px"},class:"fas fa-sun","aria-hidden":"true"},Lt={key:1,class:"fas fa-moon",style:{color:"#3f72c8","font-size":"16px"},"aria-hidden":"true"},Nt={style:{"font-weight":"600","margin-bottom":"0px","padding-left":"10px",color:"#444"}},At={class:"is-flex mb-1"},Ut={style:{"font-weight":"600","margin-bottom":"0px","padding-left":"10px",color:"#444"}},Dt={class:"is-flex"},$t={style:{"font-weight":"600","margin-bottom":"0px","padding-left":"10px",color:"#666"}},zt={style:{"font-weight":"600","margin-bottom":"0px","padding-left":"10px",color:"#666"}},Bt=a({__name:"RotaView",props:{id:{type:String,default:"0"},workerId:{type:Number,default:0},siteID:{type:Number,default:0},calendarView:{type:String,default:"dayGridMonth"}},setup(e){const a=e,c=l(""),m=l(""),p=B(),f=z(),y=l(!1),h=l(!1),b=l([]);l([]);const k=l("3773"),x=l(0);const I=l({plugins:[Q,Z],initialView:a.calendarView,height:"auto",selectable:!0,eventClick:function(e){y.value=!y.value,x.value=e.event.id},eventColor:"transparent",themeSystem:"bootstrap5",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,dayGridWeek,dayGridDay"},views:{dayGridMonth:{eventLimit:3},dayGridWeek:{eventLimit:50},dayGridDay:{eventLimit:50}},eventLimitClick:"popover",droppable:!0,editable:!0,dayCellDidMount:function(e){!function(e){var a=e.el;a.style.background="#fff",a.style.borderRadius="16px"}(e)},events:[],dateClick:function(e){(e=>{const a=b.value.indexOf(e.dateStr);-1!==a?(b.value.splice(a,1),e.dayEl.style.backgroundColor="#fff"):(b.value.push(e.dateStr),e.dayEl.style.backgroundColor="#C0DEFF")})(e)},datesSet:function(e){c.value=e.startStr.substring(0,10),m.value=e.endStr.substring(0,10)}}),V=()=>{b.value=[];const e=document.querySelector("#rota-celender");e&&e.querySelectorAll("td").forEach((function(e){e.removeAttribute("style")}))},T=e=>{b.value.splice(e,1)},C=async()=>{let e={company:p.loggedCompany.id,start_date:c.value,end_date:m.value};console.log("props",a.workerId),0===a.workerId?delete e.worker:0!==a.workerId&&(e.worker=a.workerId),0===a.siteID?delete e.site:0!==a.siteID&&(e.site=a.siteID);const{data:l}=await f.post("/v3/api/rota/date-range/",e);var t;I.value.events=((t=l).forEach((e=>{const a=e.start,l=e.end;e.startedTime=a,e.endedTime=l,e.start=e.date})),t),console.log("rota data",l),V()};return _([()=>c.value,()=>m.value],(([e,a],[l,t])=>{C()})),t((()=>{C()})),_((()=>a.workerId),((e,a)=>{C()})),(e,l)=>{const t=g,c=It,m=Sl;return o(),s(R,null,[d("div",St,[d("div",Vt,[Tt,d("div",Ct,[d("div",Rt,[d("div",jt,[i(t,{disabled:!b.value.length,color:"info",onClick:V,elevated:""},{default:n((()=>[r(" Clear Selection ("+u(b.value.length)+") ",1)])),_:1},8,["disabled"]),i(t,{disabled:!b.value.length,color:"primary",onClick:l[0]||(l[0]=e=>h.value=!h.value),elevated:""},{default:n((()=>[r(" Add Rota - Days ("+u(b.value.length)+") ",1)])),_:1},8,["disabled"])])])])]),i(v(G),{options:I.value},{eventContent:n((e=>[d("div",{class:"p-2 flex-columns event-content",style:M([{backgroundColor:"day"==e.event.extendedProps.shift?"#effaec":"#eae9f1"},{display:"flex","justify-content":"space-between",height:"90px",width:"100%","border-radius":"12px"}])},[d("div",Ot,["day"==e.event.extendedProps.shift?(o(),s("i",Mt)):(o(),s("i",Lt)),d("p",Nt,u(e.event.extendedProps.startedTime?e.event.extendedProps.startedTime:"-- : --")+" - "+u(e.event.extendedProps.endedTime?e.event.extendedProps.endedTime:"----"),1)]),d("div",null,[d("div",At,[d("p",Ut,u(e.event.extendedProps.worker?`${e.event.extendedProps.worker.firstName}\n              ${e.event.extendedProps.worker.lastName}`:"Not Added"),1)]),d("div",Dt,[d("p",$t,u(e.event.extendedProps.companyName?e.event.extendedProps.companyName:"----"),1)]),d("p",zt,u(e.event.extendedProps.siteName?e.event.extendedProps.siteName.slice(0,28):"-- -- --"),1)])],4)])),_:1},8,["options"])]),h.value?(o(),w(c,{key:0,"onUpdate:modalHandler":l[1]||(l[1]=()=>{h.value=!h.value,V()}),"onUpdate:OnSuccess":C,AddRotaModalOpen:h.value,selectedDatesArray:b.value,workerId:a.workerId,onRemoveDate:T},null,8,["AddRotaModalOpen","selectedDatesArray","workerId"])):S("",!0),y.value?(o(),w(m,{key:1,timeSheetDetailModal:y.value,timesheetId:k.value,rotaId:x.value,"onUpdate:modalHandler":l[2]||(l[2]=()=>{y.value=!1}),getRota:C},null,8,["timeSheetDetailModal","timesheetId","rotaId"])):S("",!0)],64)}}}),Pt=b(Bt,[["__scopeId","data-v-07129a90"]]);export{Pt as _};
