import{e,o as t,y as l,z as a,r as o,s as i,b as s,_ as n,H as c,B as d,C as r,S as u,l as p,T as m,A as g,D as v,a3 as f,Q as y,R as h,P as b,J as E,K as x,E as S,aB as k,W as C,X as w,L as P}from"./index-b750ebd3.js";import{_}from"./VModal.vue_vue_type_style_index_0_lang-81be354b.js";import{u as O,a as M}from"./useAPI-d7cc4ad4.js";import{u as D}from"./useNotyf-fd6acdce.js";import{m as I}from"./useSupportElement-c5cb7903.js";const L={id:"plyGonMap",style:{"border-radius":"20px",width:"100%"}},N=e({__name:"PolygonMap",props:{siteData:{}},setup(e){const o=e;return t((()=>{console.log("site data",o.siteData),(e=>{console.log("ploygon data",e);const t=[],l=new google.maps.Map(document.getElementById("plyGonMap"),{zoom:14,center:{lat:e.latitude?e.latitude:51.449927,lng:e.longitude?e.longitude:-.34712}});new google.maps.Marker({position:{lat:e.latitude?e.latitude:51.449927,lng:e.longitude?e.longitude:-.34712},map:l,title:"Site Location",icon:{path:"M-1.547 12l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM0 0q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",scale:2.5,strokeWeight:2,fillOpacity:1,fillColor:"#FB0E03",anchor:new google.maps.Point(0,20)}}),Array.isArray(e.geofence)&&e.geofence.forEach((e=>{console.log("lat",e.lat),t.push({lat:e.lat,lng:e.lng})})),new google.maps.Polygon({paths:t,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}).setMap(l)})(o.siteData)})),(e,t)=>(l(),a("div",L))}}),A=e=>(C("data-v-a61a9100"),e=e(),w(),e),z={class:"modal-form columns is-multiline"},R={class:"field column is-12 mb-0"},V={class:"field columns is-multiline mb-0 cu-all-input"},T={class:"field column is-6 mb-0"},U={class:"field column is-12 mb-0"},F=A((()=>r("label",null,"Site Name *",-1))),q={class:"control"},j={class:"field column is-12 mb-0"},B=A((()=>r("label",null,"Post Code *",-1))),H={class:"control",style:{position:"relative"}},G=A((()=>r("i",{class:"iconify","data-icon":"feather:search","aria-hidden":"true",style:{"font-size":"1.5rem"}},null,-1))),W={class:"field column is-12 mb-0"},K=A((()=>r("label",null,"Site Address:",-1))),J={class:"control"},$={class:"field column is-12 mb-0"},X=A((()=>r("label",null,"City",-1))),Y={class:"control"},Q={class:"field column is-6 mb-0"},Z={class:"field column is-12 mb-0"},ee=A((()=>r("label",null,"Site Manager Name",-1))),te={class:"control"},le={class:"field column is-12 mb-0"},ae=A((()=>r("label",null,"Phone",-1))),oe={class:"control"},ie={class:"field column is-12 mb-0"},se=A((()=>r("label",null,"Email",-1))),ne={class:"control"},ce={class:"field column is-12 mt-5",style:{position:"relative","margin-left":"0.4rem",cursor:"pointer",display:"flex","align-items":"center","flex-direction":"row"}},de={class:"",style:{display:"flex","align-items":"center","justify-content":"space-between",width:"70%"}},re=A((()=>r("i",{style:{color:"var(--primary)","margin-left":"10px",size:"3rem"},class:"fas fa-paint-brush","aria-hidden":"true"},null,-1))),ue={class:"column is-4 pb-4"},pe={key:0,style:{position:"absolute",bottom:"3.5rem","background-color":"white",width:"350px",right:"3rem","z-index":"999"}},me={class:"colorContainer"},ge={class:"close-btn"},ve=["onClick"],fe={key:0,class:"fas fa-check","aria-hidden":"true"},ye={class:"field column is-12 mb-0"},he={key:0,class:"",style:{display:"flex","align-items":"end","justify-content":"end","margin-bottom":"0.8rem"}},be=A((()=>r("i",{class:"iconify","data-icon":"feather:edit-2","aria-hidden":"true",style:{color:"#666","font-size":"1.2rem"}},null,-1))),Ee={key:0,id:"map",style:{width:"100%",height:"380px","background-color":"#f3f3f3"}},xe={class:"field column is-12 mb-0 mt-0",style:{padding:"0px 20px"}},Se=A((()=>r("label",null,"Comment",-1))),ke={class:"columns"},Ce={class:"column is-12 content",style:{}},we=P(e({__name:"SiteDetailModal",props:{AddSiteModalOpen:{type:Boolean},contractId:{},EditSiteID:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:C}){const w=e,P=D(),L=O(),A=o(!1),we=o(!1),Pe=o({id:0,hexCode:""}),_e=o({}),Oe=o(!1),Me=i(),De=o({id:0,name:"",address:"",postcode:"",latitude:0,longitude:0,city:"",inchargeName:"",inchargePhoneNo:"",inchargeEmail:"",comments:"",geofence:{},color:"#D875C7"}),Ie=()=>{C("update:modalHandler",!1)};let Le="";const Ne=async()=>{try{const e=await M.get(`https://maps.googleapis.com/maps/api/geocode/json?address=${De.value.postcode}&key=AIzaSyDWHedwkLGGa4_3XgPqYxIzMkFpOdKJRik`);if("OK"===e.data.status){De.value.address=e.data.results[0].formatted_address;const t=e.data.results[0].geometry.location.lat;De.value.latitude=t;const l=e.data.results[0].geometry.location.lng;De.value.longitude=l,P.success("Address Added"),Ae()}else"ZERO_RESULTS"===e.data.status&&P.error("Invalid Post-Code")}catch(e){P.error("Invalid Post-Code"),console.error(e)}};var Ae=function(){var e;Le=new google.maps.Map(document.getElementById("map"),{center:{lat:De.value.latitude,lng:De.value.longitude},zoom:18}),google.maps.event.addListener(Le,"click",(function(e){var t;t=e.latLng,new google.maps.Marker({position:t,map:Le}),console.log(e.latLng.toUrlValue(5))})),new google.maps.Marker({position:{lat:De.value.latitude?De.value.latitude:51.449927,lng:De.value.longitude?De.value.longitude:-.34712},map:Le,title:"Site Location",icon:{path:"M-1.547 12l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM0 0q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",scale:2.5,strokeWeight:2,fillOpacity:1,fillColor:"#FB0E03",anchor:new google.maps.Point(0,20)}});var t=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.RECTANGLE]},markerOptions:{icon:"images/beachflag.png"},circleOptions:{fillColor:"#ffff00",fillOpacity:.2,strokeWeight:3,clickable:!1,editable:!0,zIndex:1},polygonOptions:{clickable:!0,draggable:!0,editable:!0,fillColor:"#2aac8e",fillOpacity:.4},rectangleOptions:{clickable:!0,draggable:!0,editable:!0,fillColor:"#ffff00",fillOpacity:.5}});function l(t){e&&(e.setEditable(!1),e=null),e=t,t.setEditable(!0),console.log("shpes",t),function(e){const t=e.getPath().getLength(),l=[];for(let a=0;a<t;a++){const t=e.getPath().getAt(a).toUrlValue(6),[o,i]=t.split(",");l.push({lat:parseFloat(o),lng:parseFloat(i)})}De.value.geofence=l}(e)}t.setMap(Le),google.maps.event.addListener(t,"polygoncomplete",(function(e){e.getPath().getLength(),google.maps.event.addListener(e.getPath(),"insert_at",(function(){for(var t=e.getPath().getLength(),l=0;l<t;l++)console.log(e.getPath().getAt(l).toUrlValue(5))})),google.maps.event.addListener(e.getPath(),"set_at",(function(){for(var t=e.getPath().getLength(),l=0;l<t;l++)console.log(e.getPath().getAt(l).toUrlValue(5))}))})),google.maps.event.addListener(t,"overlaycomplete",(function(e){if(e.type!==google.maps.drawing.OverlayType.MARKER){t.setDrawingMode(null);var a=e.overlay;a.type=e.type,google.maps.event.addListener(a,"click",(function(){l(a)})),l(a)}}));var a=document.createElement("div");new function(t){var l=document.createElement("div");l.style.backgroundColor="#fff",l.style.border="2px solid #fff",l.style.borderRadius="3px",l.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",l.style.cursor="pointer",l.style.marginBottom="22px",l.style.textAlign="center",l.title="Select to delete the shape",t.appendChild(l);var a=document.createElement("div");a.style.color="#FF0000",a.style.fontFamily="Roboto,Arial,sans-serif",a.style.fontSize="16px",a.style.lineHeight="38px",a.style.paddingLeft="5px",a.style.paddingRight="5px",a.innerHTML="Delete Selected Area",l.appendChild(a),l.addEventListener("click",(function(){e&&e.setMap(null)}))}(a),a.index=1,Le.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(a)};const ze=async()=>{if(!De.value.latitude&&!De.value.longitude)return P.error("Please enter valid Post Code!");A.value=!0;try{if(w.EditSiteID){await L.patch(`/v3/api/site/${w.EditSiteID}/`,{contract:w.contractId,name:De.value.name,address:De.value.address,postcode:De.value.postcode,latitude:De.value.latitude,longitude:De.value.longitude,city:De.value.city,inchargeName:De.value.inchargeName,inchargePhoneNo:De.value.inchargePhoneNo,inchargeEmail:De.value.inchargeEmail,comments:De.value.comments,color:De.value.color,geofence:JSON.stringify(De.value.geofence)});C("update:OnSuccess",null),P.success("Site updated Successfuly"),Ie(),A.value=!1}else{await L.post("/v3/api/site/",{contract:w.contractId,name:De.value.name,address:De.value.address,postcode:De.value.postcode,latitude:De.value.latitude,longitude:De.value.longitude,city:De.value.city,inchargeName:De.value.inchargeName,inchargePhoneNo:De.value.inchargePhoneNo,inchargeEmail:De.value.inchargeEmail,comments:De.value.comments,color:De.value.color,geofence:JSON.stringify(De.value.geofence)});C("update:OnSuccess",null),P.success("Site Added Successfuly"),Ie()}A.value=!1}catch(e){console.log(e),A.value=!1}},Re=()=>{we.value=!we.value};t((()=>{w.EditSiteID&&(async()=>{const e=await L.get(`/v3/api/site/${w.EditSiteID}/`);De.value=e.data,_e.value=e.data,console.log("Data:",_e.value.geofence?_e.value.geofence.length:0)})(),w.EditSiteID||Ae()}));const Ve=s((()=>n((()=>import("./ckeditor-0cf493a0.js").then((e=>e.c))),["assets/ckeditor-0cf493a0.js","assets/index-b750ebd3.js","assets/index-798f0d7e.css","assets/vue.runtime.esm-bundler-b6659918.js"]).then((e=>e.default.component)))),Te={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return t((async()=>{Me.value=await n((()=>import("./ckeditor-165adbae.js").then((e=>e.c))),["assets/ckeditor-165adbae.js","assets/index-b750ebd3.js","assets/index-798f0d7e.css"]).then((e=>e.default))})),(e,t)=>{const o=S,i=N,s=k,n=_;return l(),c(n,{is:"form",size:"xl",open:w.AddSiteModalOpen,title:w.EditSiteID?"Update Site":"Add Site",actions:"right",onSubmit:x(ze,["prevent"]),onClose:Ie},{content:d((()=>[r("div",z,[r("div",R,[r("div",V,[r("div",T,[r("div",U,[F,r("div",q,[u(r("input",{type:"text",name:"title",required:"","onUpdate:modelValue":t[0]||(t[0]=e=>p(De).name=e),class:"input is-primary-focus",placeholder:"Site name"},null,512),[[m,p(De).name]])])]),r("div",j,[B,r("div",H,[g(o,{color:"primary",light:"",style:{position:"absolute",right:"0.2rem",top:"0.3rem","z-index":"10",width:"3rem","border-radius":"2rem"},onClick:t[1]||(t[1]=()=>{Oe.value=!0,Ne()})},{default:d((()=>[G])),_:1}),u(r("input",{type:"text",name:"postcode",required:"","onUpdate:modelValue":t[2]||(t[2]=e=>p(De).postcode=e),class:"input is-primary-focus",placeholder:"Enter post-code",onBlur:Ne},null,544),[[m,p(De).postcode]])])]),r("div",W,[K,r("div",J,[u(r("input",{type:"text",name:"title","onUpdate:modelValue":t[3]||(t[3]=e=>p(De).address=e),class:"input is-primary-focus",placeholder:"Site address"},null,512),[[m,p(De).address]])])]),r("div",$,[X,r("div",Y,[u(r("input",{type:"text",name:"city","onUpdate:modelValue":t[4]||(t[4]=e=>p(De).city=e),class:"input is-primary-focus",placeholder:"City"},null,512),[[m,p(De).city]])])])]),r("div",Q,[r("div",Z,[ee,r("div",te,[u(r("input",{type:"text",name:"title","onUpdate:modelValue":t[5]||(t[5]=e=>p(De).inchargeName=e),class:"input is-primary-focus",placeholder:"Manager Name"},null,512),[[m,p(De).inchargeName]])])]),r("div",le,[ae,r("div",oe,[u(r("input",{type:"text",name:"phone","onUpdate:modelValue":t[6]||(t[6]=e=>p(De).inchargePhoneNo=e),class:"input is-primary-focus",placeholder:"Phone"},null,512),[[m,p(De).inchargePhoneNo]])])]),r("div",ie,[se,r("div",ne,[u(r("input",{type:"email",name:"Email","onUpdate:modelValue":t[7]||(t[7]=e=>p(De).inchargeEmail=e),class:"input is-primary-focus",placeholder:"Email"},null,512),[[m,p(De).inchargeEmail]])])]),r("div",ce,[r("div",de,[r("div",{class:"column is-4 pb-4 cus-input-label",style:{display:"flex","align-items":"center",gap:"0.5rem",color:"#bbb","font-weight":"500",width:"100%"},onClick:Re},[v(" Color "),re]),r("div",ue,[r("div",null,[r("div",{onClick:Re,class:"color-pellate"},[r("div",{class:"current-color-div",style:f([{backgroundColor:p(De).color},{width:"5rem"}])},null,4)])])])]),p(we)?(l(),a("div",pe,[r("div",me,[r("div",ge,[r("i",{onClick:t[8]||(t[8]=e=>we.value=!1),class:"lnir lnir-close","aria-hidden":"true"})]),(l(!0),a(y,null,h(p(I),((e,t)=>(l(),a("div",{key:e.id,onClick:t=>(e=>{Pe.value=e,we.value=!1,De.value={...De.value,color:e.hexCode}})(e),style:f({backgroundColor:e.hexCode}),class:"colorDiv"},[p(Pe)==e?(l(),a("i",fe)):b("",!0)],12,ve)))),128))])])):b("",!0)])])])]),r("div",ye,[w.EditSiteID?(l(),a("div",he,[r("span",{style:{"font-size":"1rem",color:"#bbb",cursor:"pointer"},onClick:t[9]||(t[9]=()=>{Oe.value=!p(Oe),Ne()})},[v("Edit Geofence "),be])])):b("",!0),r("div",null,[w.EditSiteID&&!0!==p(Oe)?b("",!0):(l(),a("div",Ee)),w.EditSiteID&&p(_e)&&p(_e).geofence&&!1===p(Oe)?(l(),c(i,{key:1,style:{width:"100%",height:"380px"},siteData:p(_e)},null,8,["siteData"])):b("",!0)])]),r("div",xe,[Se,r("div",ke,[r("div",Ce,[p(Me)?(l(),c(p(Ve),{key:0,modelValue:p(De).comments,"onUpdate:modelValue":t[10]||(t[10]=e=>p(De).comments=e),editor:p(Me),config:Te,style:{color:"#fff"}},null,8,["modelValue","editor"])):(l(),c(s,{key:1,height:"500px"}))])])])])])),action:d((()=>[g(o,{type:"submit",color:"primary",loading:p(A),raised:""},{default:d((()=>[v(E(w.EditSiteID?"Update & close":"Save & close"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}}),[["__scopeId","data-v-a61a9100"]]);export{we as _,N as a};
