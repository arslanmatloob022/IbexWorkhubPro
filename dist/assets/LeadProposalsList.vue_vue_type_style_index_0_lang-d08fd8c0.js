import{_ as e,a,b as l}from"./ProposalViewModal.vue_vue_type_style_index_0_lang-3905f3f9.js";import{_ as t}from"./SweetAlert.vue_vue_type_style_index_0_lang-c1514b99.js";import{b as s,c as o}from"./CreateProposalTasksModal-9efb06d4.js";import{_ as i}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-1d501f08.js";import{_ as r,c as n}from"./VFlexTable.vue_vue_type_style_index_0_lang-5042693c.js";import{_ as d}from"./VDropdown.vue_vue_type_style_index_0_lang-478c91ff.js";import{_ as p}from"./VTag.vue_vue_type_style_index_0_lang-5fd863b9.js";import{f as u,x as c,y as m,r as v,$ as _,o as f,av as y,C as k,D as b,m as h,F as w,E as g,G as C,L as x,X as P,k as A,K as S,O as I,N as j,V as O,W as L,aS as M,P as T,U as $}from"./index-e4314370.js";import{_ as V}from"./VControl-36f44f30.js";import{_ as D}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-017a075b.js";import{_ as U,a as H}from"./search-4-dark-2b5b440c.js";import{u as E}from"./useAPI-1e83a242.js";import{u as N}from"./useNotyf-efc5ad4e.js";import{f as z,j as F}from"./useSupportElement-60397a8c.js";import{b as K,c as Y,d as B,e as G}from"./estimatesScripts-871fa4a7.js";const R={key:0},W={key:1},X={class:"flex-toolbar is-reversed is-flex space-between my-4"},Z={class:"flex-list-wrapper flex-list-v2"},q={class:"item-name dark-inverted show-text-250"},J={class:"item-meta"},Q=g("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),ee={class:"item-name dark-inverted"},ae=["onClick"],le=[g("div",{class:"icon"},[g("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),g("div",{class:"meta"},[g("span",null,"Edit"),g("span",null,"Edit Proposal Details")],-1)],te=["onClick"],se=[g("div",{class:"icon"},[g("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),g("div",{class:"meta"},[g("span",null,"Preview"),g("span",null,"Preview proposal detail")],-1)],oe=["onClick"],ie=[g("div",{class:"icon"},[g("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),g("div",{class:"meta"},[g("span",null,"Create Tasks"),g("span",null,"Create tasks in chart ")],-1)],re=g("hr",{class:"dropdown-divider"},null,-1),ne=["onClick"],de=[g("div",{class:"icon"},[g("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),g("div",{class:"meta"},[g("span",null,"Mark Approved"),g("span",null,"Mark Proposal As Approved")],-1)],pe=["onClick"],ue=[g("div",{class:"icon"},[g("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),g("div",{class:"meta"},[g("span",null,"Delete"),g("span",null,"Delete from list")],-1)],ce=g("img",{class:"light-image",src:U,alt:""},null,-1),me=g("img",{class:"dark-image",src:H,alt:""},null,-1),ve=u({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},emits:["updateCompany"],setup(u,{emit:U}){const H=u,ve=c();m();const _e=E(),fe=N(),ye=v(!1),ke=v([]),be=v(!1),he=v(""),we=v(!1),ge=v(!1),Ce=v(""),xe=v("");v(H.activeTab);const Pe=v({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Ae=v({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),Se=async()=>{try{ye.value=!0;await _e.delete(`/api/lead-proposal/${xe.value}/`);fe.success("Proposal delete successfully"),Ve()}catch(e){fe.error(` ${e}, Proposal`),fe.error("Something went wrong please try later")}finally{ye.value=!1,Pe.value.isSweetAlertOpen=!1}},Ie={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},je=_((()=>{if(Ce.value){const e=new RegExp(Ce.value,"i");return ke.value.filter((a=>a.title.match(e)||a.approval_deadline.match(e)))}return ke.value})),Oe=v(!1),Le=v(!1),Me=v(!1),Te=v(""),$e=e=>{ve.push(`/sidebar/dashboard/proposals/${e}`)},Ve=()=>{1==H.allProposal?(async()=>{try{ye.value=!0;const e=await _e.get("/api/lead-proposal/");ke.value=e.data}catch(e){fe.error(` ${e}, Lead`)}finally{ye.value=!1}})():H.leadId&&(async()=>{try{ye.value=!0;const e=await _e.get(`/api/lead-proposal/by-project/${H.leadId}/`);ke.value=e.data}catch(e){fe.error(` ${e}, Lead`)}finally{ye.value=!1}})()};return f((()=>{Ve()})),(u,c)=>{const m=D,v=V,_=T,f=n,E=p,N=d,ve=r,De=i,Ue=s,He=e,Ee=a,Ne=o,ze=t,Fe=l,Ke=y("tooltip");return k(),b("div",null,[h(ye)?(k(),b("div",R,[w(m)])):(k(),b("div",W,[g("div",X,[w(v,{icon:"feather:search"},{default:C((()=>[x(g("input",{"onUpdate:modelValue":c[0]||(c[0]=e=>A(Ce)?Ce.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[P,h(Ce)]])])),_:1}),g("div",null,[w(_,{color:"primary",onClick:c[1]||(c[1]=e=>be.value=!h(be)),icon:"fas fa-plus"},{default:C((()=>[S("Lead Proposal ")])),_:1}),H.leadId?(k(),I(_,{key:0,color:"warning",class:"ml-2",onClick:c[2]||(c[2]=e=>{ge.value=!0}),icon:"fas fa-cogs"},{default:C((()=>[S("Proposals")])),_:1})):j("",!0)])]),g("div",Z,[h(je).length>0&&h(ke).length>0?(k(),I(ve,{key:0,data:h(je),columns:Ie,rounded:""},{body:C((()=>[w(M,{name:"list",tag:"div",class:"flex-list-inner"},{default:C((()=>[(k(!0),b(O,null,L(h(je),(e=>(k(),b("div",{key:e.id,class:"flex-table-item"},[w(f,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[x((k(),b("div",null,[g("span",q,$(e.title),1),g("span",J,[g("span",null,[Q,S($(h(z)(e.created_at)),1)])])])),[[Ke,`${e.title}`,void 0,{rounded:!0,light:!0}]])])),_:2},1032,["onClick"]),w(f,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[w(E,{rounded:"",color:h(K)[e.type]},{default:C((()=>[S($(h(Y)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),w(f,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[w(E,{class:"capitalized",rounded:"",color:h(B)[e.status]},{default:C((()=>[S($(h(G)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),w(f,{class:"cu-pointer",onClick:a=>$e(e.id),column:{media:!0}},{default:C((()=>[g("div",null,[g("span",ee,$(h(F)(e?.proposalAmount)),1)])])),_:2},1032,["onClick"]),w(f,{class:"cu-pointer",onClick:a=>$e(e.id)},{default:C((()=>[w(E,{color:"purple",outlined:""},{default:C((()=>[S($(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),w(f,{column:{align:"end"}},{default:C((()=>[w(N,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:C((()=>[g("a",{role:"menuitem",onClick:a=>{return l=e.id,he.value=l,void(be.value=!0);var l},class:"dropdown-item is-media"},le,8,ae),g("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Le.value=l,void(Oe.value=!Oe.value);var l},class:"dropdown-item is-media"},se,8,te),"approved"==e.status?(k(),b("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,he.value=l,void(we.value=!0);var l},class:"dropdown-item is-media"},ie,8,oe)):j("",!0),re,"approved"!=e.status?(k(),b("a",{key:1,role:"menuitem",onClick:a=>(async(e,a)=>{try{await _e.patch(`/api/lead-proposal/${a}/`,{status:e}),fe.success(`You have ${e} this proposal.`),"approved"==e&&U("updateCompany",null),Ve()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},de,8,ne)):j("",!0),g("a",{role:"menuitem",onClick:a=>{return l=e.id,xe.value=l,void(Pe.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},ue,8,pe)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):j("",!0),h(ke).length<1&&0==h(je).length?(k(),I(De,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:C((()=>[ce,me])),_:1})):j("",!0)]),h(we)?(k(),I(Ue,{key:0,createProposalTasksModal:h(we),proposalId:h(he),onCloseModalHandler:c[3]||(c[3]=e=>we.value=!1),"onUpdate:OnSuccess":c[4]||(c[4]=e=>Ve())},null,8,["createProposalTasksModal","proposalId"])):j("",!0),h(be)?(k(),I(He,{key:1,leadId:H.leadId,proposalId:h(he),leadProposalModal:h(be),getLeadsList:H.allProposal,"onUpdate:modalHandler":c[5]||(c[5]=()=>{Ve(),be.value=!1}),onClearProposalId:c[6]||(c[6]=e=>he.value="")},null,8,["leadId","proposalId","leadProposalModal","getLeadsList"])):j("",!0),h(Oe)?(k(),I(Ee,{key:2,"preview-modal":h(Oe),proposalId:h(Le),"onUpdate:modalHandler":c[7]||(c[7]=e=>Oe.value=!1)},null,8,["preview-modal","proposalId"])):j("",!0),h(Me)?(k(),I(Ne,{key:3,costItemModal:h(Me),proposalId:h(Te),"onUpdate:modalHandler":c[8]||(c[8]=e=>Me.value=!1),"onUpdate:OnSuccess":Ve},null,8,["costItemModal","proposalId"])):j("",!0),h(Pe).isSweetAlertOpen?(k(),I(ze,{key:4,isSweetAlertOpen:h(Pe).isSweetAlertOpen,title:h(Pe).title,subtitle:h(Pe).subtitle,btntext:h(Pe).btntext,onConfirm:Se,onCancel:()=>h(Pe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):j("",!0),h(Ae).isSweetAlertOpen?(k(),I(ze,{key:5,isSweetAlertOpen:h(Ae).isSweetAlertOpen,title:h(Ae).title,subtitle:h(Ae).subtitle,btntext:h(Ae).btntext,onConfirm:Se,onCancel:()=>h(Ae).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):j("",!0),h(ge)?(k(),I(Fe,{key:6,leadProposalListModal:h(ge),leadID:H.leadId,"group-proposal-modal":h(ge),"onUpdate:modalHandler":c[9]||(c[9]=e=>ge.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):j("",!0)]))])}}});export{ve as _};
