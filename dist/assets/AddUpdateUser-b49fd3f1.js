import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-483ee21f.js";import{f as l,r as a,o as s,B as t,C as o,O as u,G as i,E as r,F as n,K as d,m as c,D as p,N as m,U as _,L as f,X as v,J as y,P as g,a5 as h,Q as b,R as V,S as U}from"./index-f3dee3af.js";import{_ as w}from"./VTextarea.vue_vue_type_script_setup_true_lang-992155be.js";import{_ as I}from"./VIcon.vue_vue_type_script_setup_true_lang-da5bf67a.js";import{_ as x}from"./VSwitchBlock.vue_vue_type_style_index_0_lang-f56d7a50.js";import{_ as j}from"./VAvatar.vue_vue_type_style_index_0_lang-efb4c369.js";import{_ as C}from"./VFilePond.vue_vue_type_script_lang-32b6a046.js";import{_ as A}from"./VField.vue_vue_type_script_setup_true_lang-b4b7b0d4.js";import{_ as k}from"./VControl-85fa2479.js";import{_ as P}from"./VInput.vue_vue_type_script_setup_true_lang-01960579.js";import{_ as S}from"./VLabel.vue_vue_type_script_setup_true_lang-8af1eab0.js";import{u as R}from"./useAPI-91b247fc.js";import{u as E}from"./useNotyf-248ceabc.js";import{g as M,a as N}from"./useSupportElement-c80bf490.js";const L=e=>(b("data-v-f8c8a5ad"),e=e(),V(),e),F={class:"modal-form columns is-multiline"},z={class:"column is-6"},B={class:"columns is-multiline"},H={class:"column is-3"},O={key:0,class:"column is-3"},D={class:"column is-6 is-flex space-around"},J={class:"multiselect-single-label"},q=["src"],G=["src"],Q={class:"column is-12"},T=L((()=>r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Other Details")],-1))),$={class:"field column is-4 mb-0"},K=L((()=>r("label",null,"Postal Code ",-1))),X={class:"control"},W={class:"field column is-4 mb-0"},Y=L((()=>r("label",null,"City ",-1))),Z={class:"control"},ee={class:"field column is-4 mb-0"},le=L((()=>r("label",null,"State ",-1))),ae={class:"control"},se={class:"field column is-12 mb-0"},te=L((()=>r("label",null,"Street Address",-1))),oe={class:"control"},ue={class:"field column is-12 mb-0"},ie=L((()=>r("label",null,"About ",-1))),re=U(l({__name:"AddUpdateUser",props:{isModalOpen:{type:Boolean,default:!1},userRole:{default:""},userId:{default:""},supplierId:{default:""}},emits:["update:closeModalHandler","update:actionUpdateHandler"],setup(l,{emit:b}){const V=l,U=E(),L=R(),re=a(""),ne=a(!1),de=a(!1),ce=a([{value:"javascript",name:"Javascript",icon:"/images/icons/stacks/js.svg"}]),pe=()=>{b("update:closeModalHandler",!1)},me=()=>{b("update:actionUpdateHandler",null)},_e=a({username:"",last_name:"",email:"",password:"",is_sentMail:!1,status:"",role:"",phoneNumber:"",avatar:"",supplier:"",address:"",city:"",state:"",country:"",postalCode:"",latitude:"",longitude:"",about:""}),fe=e=>{const l=e?.target;if(l&&l.files&&l.files.length>0){const e=l.files[0];_e.value.avatar=e;const a=new FileReader;a.onload=e=>{re.value=e.target?.result},a.readAsDataURL(e)}else console.error("No file selected")},ve=async()=>{if(!_e.value.postalCode)return;const e=await M(_e.value.postalCode);console.log("API Response:",e),e?.status&&e.data?(_e.value.latitude=e.data.lat,_e.value.longitude=e.data.lng,_e.value.address=e.data.address,_e.value.city=e.data.city,_e.value.state=e.data.state,U.success("Address fetched successfully")):console.log("Address not found.")},ye=()=>{_e.value.avatar=null,re.value=null},ge=async()=>{try{de.value=!0,V.supplierId&&(_e.value.supplier=V.supplierId);const e=N(_e.value,["avatar"]);if(V.userId){await L.patch(`/api/users/${V.userId}/`,e);me(),pe(),U.info("User updated successfully")}else{await L.post("/api/users/",e);me(),pe(),U.success("User added successfully")}}catch(e){e.response?.data?.email&&e.response.data.email.includes("user with this email already exists.")?U.error("Email already exists. Please use a different email."):U.error("An error occurred. Please try again.")}finally{de.value=!1}},he=a(!1);return s((()=>{V.userId&&(async()=>{try{de.value=!0;const e=await L.get(`/api/users/${V.userId}/`);re.value=e.data.avatar?e.data.avatar:"",he.value=e.data.avatar?e.data.avatar:"",_e.value=e.data}catch(e){console.error(e)}finally{de.value=!1}})(),_e.value.role=V.userRole,"worker"==V.userRole&&(async()=>{try{const e=await L.get("/api/users/by-role-option/supplier/");ce.value=e.data.map((e=>({value:e.id,name:e.username,icon:e.avatar})))}catch(e){console.log(e)}})(),V.supplierId&&(_e.value.supplier=V.supplierId)})),(l,a)=>{const s=S,b=P,U=k,R=A,E=C,M=j,N=x,L=I,me=g,he=t("Multiselect"),be=w,Ve=h,Ue=e;return o(),u(Ue,{is:"form",open:V.isModalOpen,title:V.userId?"Update User":"Add User",size:"big",actions:"right",onSubmit:y(ge,["prevent"]),onClose:pe},{content:i((()=>[r("div",F,[r("div",z,[r("div",B,[n(R,{class:"column is-12"},{default:i((()=>[n(s,null,{default:i((()=>[d("First Name")])),_:1}),n(U,null,{default:i((()=>[n(b,{required:"",modelValue:c(_e).username,"onUpdate:modelValue":a[0]||(a[0]=e=>c(_e).username=e),type:"text",placeholder:"Enter name"},null,8,["modelValue"])])),_:1})])),_:1}),n(R,{class:"column is-12"},{default:i((()=>[n(s,null,{default:i((()=>[d("Last Name")])),_:1}),n(U,null,{default:i((()=>[n(b,{modelValue:c(_e).last_name,"onUpdate:modelValue":a[1]||(a[1]=e=>c(_e).last_name=e),type:"text",placeholder:"Last name"},null,8,["modelValue"])])),_:1})])),_:1})])]),r("div",H,[n(R,null,{default:i((()=>[n(s,null,{default:i((()=>[d("Picture")])),_:1}),n(U,null,{default:i((()=>[n(E,{class:"profile-filepond",name:"profile_filepond","chunk-retry-delays":[500,1e3,3e3],"label-idle":"<i class='lnil lnil-cloud-upload'></i>","accepted-file-types":["image/png","image/jpeg","image/gif"],"image-preview-height":180,"image-resize-target-width":180,"image-resize-target-height":180,"image-crop-aspect-ratio":"1:1","style-panel-layout":"compact circle","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom",onChange:fe,onRemovefile:ye})])),_:1})])),_:1})]),c(re)?(o(),p("div",O,[n(R,null,{default:i((()=>[n(s,null,{default:i((()=>[d("Preview")])),_:1}),c(re)?(o(),u(M,{key:0,picture:c(re),size:"xl",alt:"Avatar Preview"},null,8,["picture"])):m("",!0)])),_:1})])):m("",!0),n(R,{class:"column is-6"},{default:i((()=>[n(s,null,{default:i((()=>[d("Phone")])),_:1}),n(U,null,{default:i((()=>[n(b,{modelValue:c(_e).phoneNumber,"onUpdate:modelValue":a[2]||(a[2]=e=>c(_e).phoneNumber=e),type:"phone",placeholder:"Enter phone number"},null,8,["modelValue"])])),_:1})])),_:1}),r("div",D,[n(R,{class:"mt-5"},{default:i((()=>[n(U,null,{default:i((()=>[n(N,{modelValue:c(_e).is_sentMail,"onUpdate:modelValue":a[3]||(a[3]=e=>c(_e).is_sentMail=e),label:"Send email",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1}),n(R,{class:"mt-5"},{default:i((()=>[n(U,null,{default:i((()=>[n(N,{modelValue:c(_e).is_active,"onUpdate:modelValue":a[4]||(a[4]=e=>c(_e).is_active=e),label:"Active",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1})]),n(R,{class:"column is-6"},{default:i((()=>[n(s,null,{default:i((()=>[d("Email")])),_:1}),n(U,null,{default:i((()=>[n(b,{required:"",modelValue:c(_e).email,"onUpdate:modelValue":a[5]||(a[5]=e=>c(_e).email=e),type:"email",placeholder:"Enter mail"},null,8,["modelValue"])])),_:1})])),_:1}),V.userId?m("",!0):(o(),u(R,{key:1,class:"column is-6",label:"Password",addons:""},{default:i((()=>[n(U,{expanded:""},{default:i((()=>[n(b,{modelValue:c(_e).password,"onUpdate:modelValue":a[6]||(a[6]=e=>c(_e).password=e),type:c(ne)?"text":"password",class:"input",placeholder:"Enter Password"},null,8,["modelValue","type"])])),_:1}),n(U,null,{default:i((()=>[n(me,{color:"primary",onClick:a[7]||(a[7]=e=>ne.value=!c(ne))},{default:i((()=>[c(ne)?(o(),u(L,{key:0,icon:"lucide:eye-off"})):(o(),u(L,{key:1,icon:"lucide:eye"}))])),_:1})])),_:1})])),_:1})),"worker"==V.userRole?(o(),u(R,{key:2,class:"column is-6"},{default:i((({id:e})=>[n(U,null,{default:i((()=>[n(he,{modelValue:c(_e).supplier,"onUpdate:modelValue":a[8]||(a[8]=e=>c(_e).supplier=e),attrs:{id:e},placeholder:"Select a sub-contractor",label:"name",options:c(ce),searchable:!0,"track-by":"name","max-height":145},{singlelabel:i((({value:e})=>[r("div",J,[r("img",{class:"select-label-icon",src:e.icon,alt:""},null,8,q),d(" "+_(e.name),1)])])),option:i((({option:e})=>[r("img",{class:"select-option-icon",src:e.icon,alt:""},null,8,G),d(" "+_(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):m("",!0),r("div",Q,[n(Ve,{class:"columns is-multiline mt-3"},{default:i((()=>[T,r("div",$,[K,r("div",X,[f(r("input",{type:"text",name:"state",onBlur:ve,"onUpdate:modelValue":a[9]||(a[9]=e=>c(_e).postalCode=e),class:"input is-primary-focus is-primary-focus",placeholder:"Postal Code"},null,544),[[v,c(_e).postalCode]])])]),r("div",W,[Y,r("div",Z,[f(r("input",{type:"text",name:"city","onUpdate:modelValue":a[10]||(a[10]=e=>c(_e).city=e),class:"input is-primary-focus is-primary-focus",placeholder:"City"},null,512),[[v,c(_e).city]])])]),r("div",ee,[le,r("div",ae,[f(r("input",{type:"text",name:"state","onUpdate:modelValue":a[11]||(a[11]=e=>c(_e).state=e),class:"input is-primary-focus is-primary-focus",placeholder:"State"},null,512),[[v,c(_e).state]])])]),r("div",se,[te,r("div",oe,[f(r("input",{type:"tel",name:"phone","onUpdate:modelValue":a[12]||(a[12]=e=>c(_e).address=e),class:"input is-primary-focus is-primary-focus",placeholder:"Street Address"},null,512),[[v,c(_e).address]])])]),r("div",ue,[ie,n(R,null,{default:i((()=>[n(U,null,{default:i((()=>[n(be,{modelValue:c(_e).about,"onUpdate:modelValue":a[13]||(a[13]=e=>c(_e).about=e),rows:"3",placeholder:"Enter about..."},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1})])])])),action:i((()=>[n(me,{loading:c(de),type:"submit",color:"primary",raised:""},{default:i((()=>[d(_(V.userId?"Update":"Add"),1)])),_:1},8,["loading"])])),cancel:i((()=>[n(me,{type:"cancel",loading:c(de),onClick:pe,raised:""},{default:i((()=>[d(" Cancel ")])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}}),[["__scopeId","data-v-f8c8a5ad"]]);export{re as _};
