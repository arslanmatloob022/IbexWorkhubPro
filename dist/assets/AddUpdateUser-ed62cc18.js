import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-8e68c9e9.js";import{_ as l}from"./VSwitchBlock.vue_vue_type_style_index_0_lang-f25b006c.js";import{e as a,r as s,o as t,A as o,B as u,N as i,F as r,D as n,E as d,J as p,l as c,C as m,M as _,H as f,T as v,I as y,O as g,R as h}from"./index-667864af.js";import{_ as V}from"./VIcon.vue_vue_type_script_setup_true_lang-dfbfe1eb.js";import{_ as b}from"./VAvatar.vue_vue_type_style_index_0_lang-68f3253d.js";import{_ as I}from"./VFilePond.vue_vue_type_script_lang-fe157c63.js";import{_ as w}from"./VField.vue_vue_type_script_setup_true_lang-05c1856f.js";import{_ as j}from"./VControl-c9219c12.js";import{_ as U}from"./VInput.vue_vue_type_script_setup_true_lang-a7c7f053.js";import{_ as x}from"./VLabel.vue_vue_type_script_setup_true_lang-e11748e1.js";import{u as k}from"./useAPI-afb99dd2.js";import{u as A}from"./useNotyf-61f2a938.js";import{a as M}from"./useSupportElement-de6ec886.js";const P={class:"modal-form columns is-multiline"},R={class:"column is-6"},E={class:"columns is-multiline"},N={class:"column is-3"},C={key:0,class:"column is-3"},H={class:"multiselect-single-label"},S=["src"],z=["src"],F=h(a({__name:"AddUpdateUser",props:{isModalOpen:{type:Boolean,default:!1},userRole:{default:""},userId:{default:""},supplierId:{default:""}},emits:["update:closeModalHandler","update:actionUpdateHandler"],setup(a,{emit:h}){const F=a,$=A(),B=k(),J=s(""),O=s(!1),q=s(!1);s();const D=s([{value:"javascript",name:"Javascript",icon:"/images/icons/stacks/js.svg"}]),L=()=>{h("update:closeModalHandler",!1)},K=s({username:"",email:"",password:"",is_sentMail:!1,status:"",role:"",phoneNumber:"",avatar:"",supplier:""}),T=e=>{const l=e?.target;if(l&&l.files&&l.files.length>0){const e=l.files[0];K.value.avatar=e;const a=new FileReader;a.onload=e=>{J.value=e.target?.result},a.readAsDataURL(e)}else console.error("No file selected")},Y=()=>{K.value.avatar=null,J.value=null},Z=async()=>{try{q.value=!0,F.supplierId&&(K.value.supplier=F.supplierId);const e=M(K.value,["avatar"]);if(F.userId){await B.patch(`/api/users/${F.userId}/`,e);$.info("User updated successfully")}else{await B.post("/api/users/",e);$.success("User added successfully")}h("update:actionUpdateHandler",null),L()}catch(e){e.response?.data?.email&&e.response.data.email.includes("user with this email already exists.")?$.error("Email already exists. Please use a different email."):$.error("An error occurred. Please try again.")}finally{q.value=!1}},G=s(!1);return t((()=>{F.userId&&(async()=>{try{q.value=!0;const e=await B.get(`/api/users/${F.userId}`);J.value=e.data.avatar?e.data.avatar:"",G.value=e.data.avatar?e.data.avatar:"",K.value=e.data}catch(e){console.error(e)}finally{q.value=!1}})(),K.value.role=F.userRole,(async()=>{try{const e=await B.get("/api/users/by-role-option/supplier/");D.value=e.data.map((e=>({value:e.id,name:e.username,icon:e.avatar})))}catch(e){console.log(e)}})(),F.supplierId&&(K.value.supplier=F.supplierId)})),(a,s)=>{const t=x,h=U,k=j,A=w,M=I,$=b,B=V,G=g,Q=l,W=o("Multiselect"),X=e;return u(),i(X,{is:"form",open:F.isModalOpen,title:F.userId?`Update ${F.userRole}`:`Add ${F.userRole}`,size:"big",actions:"right",onSubmit:y(Z,["prevent"]),onClose:L},{content:r((()=>[n("div",P,[n("div",R,[n("div",E,[d(A,{class:"column is-12"},{default:r((()=>[d(t,null,{default:r((()=>[p("Full Name")])),_:1}),d(k,null,{default:r((()=>[d(h,{required:"",modelValue:c(K).username,"onUpdate:modelValue":s[0]||(s[0]=e=>c(K).username=e),type:"text",placeholder:"Enter name"},null,8,["modelValue"])])),_:1})])),_:1}),d(A,{class:"column is-12"},{default:r((()=>[d(t,null,{default:r((()=>[p("Phone")])),_:1}),d(k,null,{default:r((()=>[d(h,{modelValue:c(K).phoneNumber,"onUpdate:modelValue":s[1]||(s[1]=e=>c(K).phoneNumber=e),type:"phone",placeholder:"Enter phone number"},null,8,["modelValue"])])),_:1})])),_:1})])]),n("div",N,[d(A,null,{default:r((()=>[d(t,null,{default:r((()=>[p("Picture")])),_:1}),d(k,null,{default:r((()=>[d(M,{class:"profile-filepond",name:"profile_filepond","chunk-retry-delays":[500,1e3,3e3],"label-idle":"<i class='lnil lnil-cloud-upload'></i>","accepted-file-types":["image/png","image/jpeg","image/gif"],"image-preview-height":180,"image-resize-target-width":180,"image-resize-target-height":180,"image-crop-aspect-ratio":"1:1","style-panel-layout":"compact circle","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom",onChange:T,onRemovefile:Y})])),_:1})])),_:1})]),c(J)?(u(),m("div",C,[d(A,null,{default:r((()=>[d(t,null,{default:r((()=>[p("Preview")])),_:1}),c(J)?(u(),i($,{key:0,picture:c(J),size:"xl",alt:"Avatar Preview"},null,8,["picture"])):_("",!0)])),_:1})])):_("",!0),d(A,{class:"column is-6"},{default:r((()=>[d(t,null,{default:r((()=>[p("Email")])),_:1}),d(k,null,{default:r((()=>[d(h,{required:"",modelValue:c(K).email,"onUpdate:modelValue":s[2]||(s[2]=e=>c(K).email=e),type:"email",placeholder:"Enter mail"},null,8,["modelValue"])])),_:1})])),_:1}),F.userId?_("",!0):(u(),i(A,{key:1,class:"column is-6",label:"Password",addons:""},{default:r((()=>[d(k,{expanded:""},{default:r((()=>[d(h,{modelValue:c(K).password,"onUpdate:modelValue":s[3]||(s[3]=e=>c(K).password=e),type:c(O)?"text":"password",class:"input",placeholder:"Enter Password"},null,8,["modelValue","type"])])),_:1}),d(k,null,{default:r((()=>[d(G,{color:"primary",onClick:s[4]||(s[4]=e=>O.value=!c(O))},{default:r((()=>[c(O)?(u(),i(B,{key:0,icon:"lucide:eye-off"})):(u(),i(B,{key:1,icon:"lucide:eye"}))])),_:1})])),_:1})])),_:1})),d(A,{class:f([F.userId?"mt-5":"","column is-3"])},{default:r((()=>[d(k,null,{default:r((()=>[d(Q,{modelValue:c(K).is_sentMail,"onUpdate:modelValue":s[5]||(s[5]=e=>c(K).is_sentMail=e),label:"Send email",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1},8,["class"]),d(A,{class:f([F.userId?"mt-5":"","column is-3"])},{default:r((()=>[d(k,null,{default:r((()=>[d(Q,{modelValue:c(K).is_active,"onUpdate:modelValue":s[6]||(s[6]=e=>c(K).is_active=e),label:"Active",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1},8,["class"]),"worker"==F.userRole?(u(),i(A,{key:2,class:"column is-6"},{default:r((({id:e})=>[d(k,null,{default:r((()=>[d(W,{modelValue:c(K).supplier,"onUpdate:modelValue":s[7]||(s[7]=e=>c(K).supplier=e),attrs:{id:e},placeholder:"Select a sub-contractor",label:"name",options:c(D),searchable:!0,"track-by":"name","max-height":145},{singlelabel:r((({value:e})=>[n("div",H,[n("img",{class:"select-label-icon",src:e.icon,alt:""},null,8,S),p(" "+v(e.name),1)])])),option:r((({option:e})=>[n("img",{class:"select-option-icon",src:e.icon,alt:""},null,8,z),p(" "+v(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):_("",!0)])])),action:r((()=>[d(G,{loading:c(q),type:"submit",color:"primary",raised:""},{default:r((()=>[p(v(F.userId?"Update":"Add"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}}),[["__scopeId","data-v-62f5fe79"]]);export{F as _};
