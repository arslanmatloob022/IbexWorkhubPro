import{_ as e,a}from"./ProjectFiles-e6d72378.js";import{_ as s}from"./ProjectTodayTasks.vue_vue_type_style_index_0_lang-0f3ecb77.js";import{_ as t,a as l}from"./VOption.vue_vue_type_style_index_0_lang-3cb7440a.js";import{_ as i}from"./VLabel.vue_vue_type_script_setup_true_lang-f5fa03ef.js";import{_ as r}from"./VField.vue_vue_type_script_setup_true_lang-8408ffa5.js";import{_ as o}from"./VControl-d632d657.js";import{_ as n}from"./UserPopoverContent.vue_vue_type_script_setup_true_lang-0764f7c8.js";import{_ as c}from"./VAvatar.vue_vue_type_style_index_0_lang-ed8237e0.js";import{_ as d}from"./VIcon.vue_vue_type_script_setup_true_lang-f2ad9ccc.js";import{f as u,y as p,x as v,b as m,r as h,s as g,o as f,B as _,C as y,D as k,E as b,m as j,O as x,N as C,F as w,U as I,K as V,G as A,I as D,H as T,V as N,W as P,k as U,Q as S,R as E,J as $,S as M}from"./index-9f52f094.js";import{A as z}from"./vue3-apexcharts.common-8d4f160e.js";import{u as F}from"./useNotyf-b160b288.js";import{u as L}from"./useAPI-644076b7.js";import{a as B}from"./useSupportElement-bf4a181d.js";import{u as H}from"./useThemeColors-a4ea6910.js";const K=e=>(S("data-v-5dd66bc1"),e=e(),E(),e),O={class:"personal-dashboard personal-dashboard-v2"},R={class:"columns is-multiline"},q={class:"column is-12"},G={class:"dashboard-header is-relative"},J={class:"user-meta is-dark-bordered-12"},Q={class:"title is-4 is-narrow is-bold"},W={class:"light-text"},Z={class:"info-text is-bold"},X=K((()=>b("i",{class:"fas fa-home"},null,-1))),Y={class:"user-action"},ee=K((()=>b("h3",{class:"title is-5 is-narrow"},"Information",-1))),ae={class:"light-text"},se={class:"light-text"},te={class:"light-text"},le={class:"media-flex inverted-text"},ie=K((()=>b("a",{class:"link inverted-text"},"Change status",-1))),re={key:0,class:"tabs-inner"},oe={class:"tabs is-boxed",slider:""},ne=[K((()=>b("span",null,"Project info",-1)))],ce=[K((()=>b("span",null,"Tasks",-1)))],de=K((()=>b("li",{class:"tab-naver"},null,-1))),ue={key:1,class:"columns is-multiline"},pe={key:0,class:"column is-8"},ve={class:"dashboard-card has-margin-bottom"},me=["innerHTML"],he={class:"dashboard-card has-margin-bottom"},ge={class:"dashboard-card"},fe=K((()=>b("div",{class:"card-head"},[b("h3",{class:"dark-inverted"},"Task Completion"),b("a",{class:"action-link",tabindex:"0"},"Reports")],-1))),_e={class:"dashboard-card"},ye={class:"card-head"},ke=K((()=>b("h3",{class:"dark-inverted"},"Assigned Manager",-1))),be={class:"active-team"},je={key:0,class:"user-list"},xe={class:"user-list-info"},Ce={class:"name dark-inverted"},we={class:"position"},Ie=K((()=>b("div",{class:"user-list-icons"},null,-1))),Ve={key:1,class:"user-list"},Ae=[K((()=>b("div",{class:"user-list-info"},[b("div",{class:"name dark-inverted"},"No Manager assigned yet")],-1)))],De={key:2},Te={class:"is-flex space-between"},Ne={key:0},Pe={class:"dashboard-card"},Ue={class:"card-head"},Se=K((()=>b("h3",{class:"dark-inverted"},"Client Information",-1))),Ee={class:"active-team"},$e={key:0,class:"user-list"},Me={class:"user-list-info"},ze={class:"name dark-inverted"},Fe={class:"position"},Le=K((()=>b("div",{class:"user-list-icons"},null,-1))),Be={key:1,class:"user-list"},He=[K((()=>b("div",{class:"user-list-info"},[b("div",{class:"name dark-inverted"},"No Client Info Added yet")],-1)))],Ke={key:2},Oe={class:"dashboard-card"},Re={class:"card-head"},qe=K((()=>b("h3",{class:"dark-inverted"},"Contractor Information",-1))),Ge={class:"active-team"},Je={key:0,class:"user-list"},Qe={class:"user-list-info"},We={class:"name dark-inverted"},Ze={class:"position"},Xe=K((()=>b("div",{class:"user-list-icons"},null,-1))),Ye={key:1,class:"user-list"},ea=[K((()=>b("div",{class:"user-list-info"},[b("div",{class:"name dark-inverted"}," No contractor Info Added yet ")],-1)))],aa={key:2},sa={class:"dashboard-card"},ta={key:2,class:"columns is-multiline"},la={class:"column is-12"},ia=M(u({__name:"ProjectDetail",setup(u){const S=H(),E=L(),M=F(),K=p(),ia=v(),ra=m(),oa=h("detail"),na=h(!1),ca=h(!1);h(!1);const da=h(!1);h(!1);const ua=h(!1),pa=h([]),va=h([]),ma=h([]),ha=h([]),ga=h([]);h(0);const fa=h(0),_a=h(0),ya=h(""),ka=h("");h("");const ba=h([{id:0,username:"",email:"",phoneNumber:""}]),ja=h([]),xa=h({id:0,title:"",created:"",startDate:"",color:"",endDate:"",description:"",image:"",is_active:null,status:"",address:"",total_tasks:0,client:0,contractor:0,clientInfo:{id:0,username:"",email:"",password:"",avatar:null},uploaded_files:[],contractorInfo:{id:0,username:"",email:"",password:"",avatar:null},managers:[{id:0,username:"",avatar:null,email:"",role:""}]});h({title:"",description:"",startDate:"",endDate:"",status:"",project:K.params.id,workers:[]});const Ca=h([{id:0,title:"",description:"",startDate:"",endDate:"",project:0,status:"",worker:[{id:0,username:"",email:"",role:"",avatar:""}]}]),wa=g({height:180,type:"radialBar",series:[],title:{text:""},chart:{toolbar:{show:!1}},colors:[S.primary,S.purple,S.orange],plotOptions:{radialBar:{hollow:{size:"55%"}}},labels:["Progress"]}),Ia=g({series:[],chart:{height:295,type:"pie",toolbar:{show:!1}},labels:["Active","Pending","Completed","Canceled"],colors:[S.accent,S.info,S.primary,S.orange],legend:{position:"right",horizontalAlign:"center"},responsive:[{breakpoint:480,options:{chart:{width:315,toolbar:{show:!1}},legend:{position:"top"}}}],dataLabels:{enabled:!1}}),Va=()=>{da.value=!da.value},Aa=()=>{ca.value=!ca.value},Da=h(!1),Ta=()=>{Da.value=!Da.value},Na=()=>{try{ua.value=!0;E.delete(`/api/project/${K.params.id}/`);M.green("Selected project deleted successfully!"),ia.push("/sidebar/dashboard/projects")}catch(e){console.log(e)}finally{ua.value=!1}};h(0);const Pa=async()=>{try{na.value=!0;const e=await E.get(`/api/project/${ka.value}/`);xa.value=e.data;let a=e.data.percentage.toFixed(2);wa.value.series.push(a),ya.value=e.data.image,ma.value=e.data.managers?e.data.managers:[],Ua()}catch(e){console.log(e)}finally{na.value=!1}};h([]);const Ua=async()=>{try{na.value=!0;const e=await E.get(`api/task/${K.params.id}/project/`);Ca.value=e.data;const a={pending:0,completed:0,active:0,canceled:0};Ca.value.forEach((e=>{const s=e.status||"Unknown";void 0!==a[s]&&a[s]++})),Ia.value.series=[a.completed,a.pending,a.active,a.canceled],na.value=!1}catch(e){console.log(e),na.value=!1}},Sa=h([]),Ea=async()=>{try{xa.value.managers=Sa.value;let e=B(xa.value,["image"]);e.delete("clientInfo"),e.delete("contractorInfo"),"object"==typeof xa.value.client&&e.delete("client"),"object"==typeof xa.value.contractor&&e.delete("contractor");const a=await E.patch(`/api/project/${K.params.id}/`,e);ca.value=!1,da.value=!1,M.green("Project updated successfully"),Da.value=!1,Pa(a.data.id)}catch(e){console.log(e)}};h("");const $a=e=>{fa.value=e},Ma=e=>{_a.value=e};return f((async()=>{ka.value=K.params.id,Pa(),(async()=>{try{ua.value=!0;const e=await E.get("/api/users/",{});ba.value=e.data.filter((e=>"worker"==e.role)),pa.value=e.data.filter((e=>"client"==e.role)),va.value=e.data.filter((e=>"contractor"==e.role)),ha.value=e.data.filter((e=>"manager"==e.role)),ga.value=ha.value.map((e=>({value:e.id.toString(),name:`${e.username}`,supplier:e.partner?e.partner:"",image:e.avatar}))),console.log("data",ba.value)}catch(e){console.log(e)}finally{ua.value=!1}})(),await Ua(),(async()=>{try{const e=await E.get(`/api/task/today-tasks/?project=${K.params.id}`);ja.value=e.data}catch(e){console.log(e)}})()})),(u,p)=>{const v=d,m=c,h=_("Address"),g=e,f=n,S=_("Tippy"),E=_("Multiselect"),M=o,F=r,L=i,B=t,H=l,ua=s,ha=a;return y(),k("div",O,[b("div",R,[b("div",q,[b("div",G,["admin"==j(ra).user.role||"manager"==j(ra).user.role?(y(),x(v,{key:0,style:{position:"absolute",top:"10px","font-size":"18px","font-weight":"600",right:"36px",color:"var(--info)"},class:"cu-pointer",onClick:p[0]||(p[0]=()=>{j(ia).push(`/sidebar/dashboard/projects/add-project/?id=${j(xa).id}`)}),icon:"lucide:edit"})):C("",!0),"admin"==j(ra).user.role||"manager"==j(ra).user.role?(y(),x(v,{key:1,style:{position:"absolute",top:"10px","font-size":"18px","font-weight":"600",right:"10px",color:"var(--danger)"},class:"cu-pointer",onClick:Na,icon:"lucide:trash"})):C("",!0),w(m,{picture:j(xa).image,squared:"",color:"primary",badge:"/images/icons/flags/united-states-of-america.svg",size:"xxl"},null,8,["picture"]),b("div",J,[b("h3",Q,I(j(xa).title?j(xa).title:"N/A"),1),b("p",W,[V(" Current status: "),b("span",Z,I("pending"===j(xa).status?"Pre Construction":j(xa).status.charAt(0).toUpperCase()+j(xa).status.slice(1)),1)]),w(h,null,{default:A((()=>[X,V(" "+I(j(xa).address),1)])),_:1})]),b("div",Y,[ee,b("p",ae," Started at: "+I(j(xa)?.startDate?j(xa)?.startDate:"N/A"),1),b("p",se," Expected end: "+I(j(xa)?.endDate?j(xa)?.endDate:"N/A"),1),b("p",te," Total jobs: "+I(j(xa).total_tasks?j(xa).total_tasks:"N/A")+" Tasks ",1)]),b("div",null,[b("div",le,[j(na)?C("",!0):(y(),x(j(z),{key:0,id:"completion-chart",height:j(wa).height,type:j(wa).type,series:j(wa).series,options:j(wa)},null,8,["height","type","series","options"]))]),ie])])])]),"admin"==j(ra).user.role||"manager"==j(ra).user.role?(y(),k("div",re,[b("div",oe,[b("ul",null,[b("li",{class:D(["detail"===j(oa)&&"is-active"])},[b("a",{tabindex:"0",role:"button",onKeydown:p[1]||(p[1]=T($((e=>oa.value="detail"),["prevent"]),["space"])),onClick:p[2]||(p[2]=e=>oa.value="detail")},ne,32)],2),b("li",{class:D(["tasks"===j(oa)&&"is-active"])},[b("a",{tabindex:"0",role:"button",onKeydown:p[3]||(p[3]=T($((e=>oa.value="tasks"),["prevent"]),["space"])),onClick:p[4]||(p[4]=e=>oa.value="tasks")},ce,32)],2),de])])])):C("",!0),"detail"===j(oa)?(y(),k("div",ue,["admin"==j(ra).user.role||"manager"==j(ra).user.role?(y(),k("div",pe,[b("div",ve,[b("div",{innerHTML:j(xa).description},null,8,me)]),b("div",he,[w(g,{projectId:j(K).params.id,files:j(xa).uploaded_files,"onUpdate:onUploadFile":Pa},null,8,["projectId","files"])]),b("div",ge,[fe,0!=j(Ca).length?(y(),x(j(z),{key:0,height:j(Ia).chart.height,type:j(Ia).chart.type,series:j(Ia).series,options:j(Ia)},null,8,["height","type","series","options"])):C("",!0)])])):C("",!0),b("div",{class:D("admin"==j(ra).user.role||"manager"==j(ra).user.role?"column is-4":"column is-12")},[b("div",_e,[b("div",ye,[ke,"admin"==j(ra).user.role||"manager"==j(ra).user.role?(y(),k("a",{key:0,onClick:Ta,class:"action-link",tabindex:"0"},I(j(Da)?"Close":"Edit"),1)):C("",!0)]),b("div",be,[j(ma).length>0?(y(),k("ul",je,[(y(!0),k(N,null,P(j(ma),(e=>(y(),k("li",{key:e.id},[b("div",null,[w(S,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:A((()=>[w(f,{user:e},null,8,["user"])])),default:A((()=>[w(m,{picture:e.avatar},null,8,["picture"])])),_:2},1024)]),b("div",xe,[b("div",Ce,I(e.username),1),b("div",we,I(e.email),1)]),Ie])))),128))])):(y(),k("ul",Ve,Ae)),j(Da)?(y(),k("div",De,[w(F,null,{default:A((({id:e})=>[w(M,null,{default:A((()=>[w(E,{modelValue:j(Sa),"onUpdate:modelValue":p[5]||(p[5]=e=>U(Sa)?Sa.value=e:null),attrs:{id:e},mode:"tags",placeholder:"Select manager","track-by":"name",label:"name",searchable:!0,"create-tag":!0,options:j(ga),"max-height":145},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):C("",!0),b("div",Te,[j(Da)?(y(),k("a",Ne)):C("",!0),j(Da)?(y(),k("a",{key:1,onClick:Ea,class:"action-link",tabindex:"0"},"Save ")):C("",!0)])])]),b("div",Pe,[b("div",Ue,[Se,"admin"==j(ra).user.role||"manager"==j(ra).user.role?(y(),k("a",{key:0,onClick:Aa,class:"action-link",tabindex:"0"},I(j(ca)?"Close":"Edit"),1)):C("",!0)]),b("div",Ee,[j(xa).client?(y(),k("ul",$e,[b("li",null,[b("div",null,[w(S,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:A((()=>[w(f,{user:j(xa).client},null,8,["user"])])),default:A((()=>[w(m,{picture:j(xa).client.avatar},null,8,["picture"])])),_:1})]),b("div",Me,[b("div",ze,I(j(xa).client.username),1),b("div",Fe,I(j(xa).client.email),1)]),Le])])):(y(),k("ul",Be,He)),j(ca)?(y(),k("div",Ke,[w(F,null,{default:A((()=>[w(L,null,{default:A((()=>[V("Select client")])),_:1}),w(M,null,{default:A((()=>[w(H,{modelValue:j(xa).client,"onUpdate:modelValue":p[6]||(p[6]=e=>j(xa).client=e),onChange:Ea},{default:A((()=>[w(B,{value:""},{default:A((()=>[V(" Clients ")])),_:1}),(y(!0),k(N,null,P(j(pa),(e=>(y(),x(B,{key:e.id,value:e.id},{default:A((()=>[V(I(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])):C("",!0)])]),b("div",Oe,[b("div",Re,[qe,"admin"==j(ra).user.role||"manager"==j(ra).user.role?(y(),k("a",{key:0,onClick:Va,class:"action-link",tabindex:"0"},I(j(da)?"Close":"Edit"),1)):C("",!0)]),b("div",Ge,[j(xa).contractor?(y(),k("ul",Je,[b("li",null,[b("div",null,[w(S,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:A((()=>[w(f,{user:j(xa).contractor},null,8,["user"])])),default:A((()=>[w(m,{picture:j(xa).contractor.avatar},null,8,["picture"])])),_:1})]),b("div",Qe,[b("div",We,I(j(xa).contractor.username),1),b("div",Ze,I(j(xa).contractor.email),1)]),Xe])])):(y(),k("ul",Ye,ea)),j(da)?(y(),k("div",aa,[w(F,null,{default:A((()=>[w(L,null,{default:A((()=>[V("Select contractor")])),_:1}),w(M,null,{default:A((()=>[w(H,{modelValue:j(xa).contractor,"onUpdate:modelValue":p[7]||(p[7]=e=>j(xa).contractor=e),onChange:Ea},{default:A((()=>[(y(!0),k(N,null,P(j(va),(e=>(y(),x(B,{key:e.id,value:e.id},{default:A((()=>[V(I(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])):C("",!0)])]),b("div",sa,[w(ua,{projectId:j(K).params.id},null,8,["projectId"])])],2)])):C("",!0),"tasks"===j(oa)?(y(),k("div",ta,[b("div",la,[w(ha,{"onUpdate:completedTasks":$a,"onUpdate:activeTasks":Ma,projectID:j(K).params.id},null,8,["projectID"])])])):C("",!0)])}}}),[["__scopeId","data-v-5dd66bc1"]]);export{ia as _};
