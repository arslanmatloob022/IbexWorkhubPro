import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-50304d71.js";import{f as a,r as l,av as t,C as s,O as u,G as o,E as d,K as n,U as i,m as r,D as c,V as p,W as m,L as v,a4 as f,N as _,F as y,P as k,S as g,w as h,o as V,B as b,k as D,J as w}from"./index-ac8711cd.js";import{d as S,a as x}from"./useSupportElement-27411722.js";import{_ as C}from"./VTextarea.vue_vue_type_script_setup_true_lang-d9468888.js";import{_ as U,a as j}from"./VOption.vue_vue_type_style_index_0_lang-3ce51752.js";import{_ as I}from"./VField.vue_vue_type_script_setup_true_lang-60ac471e.js";import{_ as T}from"./VControl-28ac31fa.js";import{_ as L}from"./VInput.vue_vue_type_script_setup_true_lang-a1cabaaf.js";import{_ as M}from"./VLabel.vue_vue_type_script_setup_true_lang-58375a4a.js";import{u as O}from"./useAPI-0fa72346.js";import{u as q}from"./useNotyf-acf2ea3e.js";import{C as N}from"./estimatesScripts-3481f1a0.js";const $={class:"heatmap-wrapper"},A={class:"heatmap-title"},H={class:"title-meta"},E={class:"primary-text"},B={class:"primary-text"},F={class:"heatmap-inner"},Q={class:"heatmap-row"},z={class:"heatmap-row-label"},G={class:"heatmap-row-content"},J=["onMouseenter"],P={style:{position:"absolute","font-weight":"bold",top:"1px",right:"1px",color:"var(--dark-inverted)"}},W={key:0,class:"fas fa-exclamation-triangle danger-text","aria-hidden":"true"},K={key:1,class:"fas fa-check primary-text","aria-hidden":"true"},R=g(a({__name:"WorkerTasksConflicts",props:{conflictsDetailModal:{type:Boolean},conflictData:{},startDate:{},endDate:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:g}){const h=a,V=()=>{g("update:modalHandler",!0)},b=l({visible:!1,tasks:[],x:0,y:0}),D=()=>{b.value.visible=!1};return(a,l)=>{const g=k,w=e,x=t("tooltip");return h.conflictsDetailModal?(s(),u(w,{key:0,open:h.conflictsDetailModal,title:"Conflicts Details",actions:"right",size:"big",onClose:V},{content:o((()=>[d("div",$,[d("div",A,[d("div",H,[d("p",null,[n(" Tasks found within given date range: "),d("span",E,i(r(S)(h.startDate)),1),n(" to "),d("span",B,i(r(S)(h.endDate)),1),n(". ")])])]),d("div",F,[(s(!0),c(p,null,m(h.conflictData?.map,(e=>(s(),c("div",Q,[d("div",z,[d("span",null,i(e.month),1)]),d("div",G,[(s(!0),c(p,null,m(e.dates,(a=>{return v((s(),c("div",{key:e.date,class:"heatmap-row-item is-relative",onMouseenter:e=>{return l=a.tasks,t=e,b.value.tasks=l,b.value.x=t.pageX+10,b.value.y=t.pageY+10,void(b.value.visible=!0);var l,t},onMouseleave:D},[d("span",P,i(a.date.slice(8,10)),1),a.count?(s(),c("i",W)):(s(),c("i",K))],40,J)),[[x,(l=a.tasks,l&&0!==l.length?l.map((e=>e.title)).join(" __ "):"No tasks available"),void 0,{rounded:!0,dark:!0}]]);var l})),128)),r(b).visible?(s(),c("div",{key:0,class:"tooltip",style:f({top:r(b).y+"px",left:r(b).x+"px"})},[d("ul",null,[(s(!0),c(p,null,m(r(b).tasks,(e=>(s(),c("li",{key:e.id},[d("a",null,i(e.title),1)])))),128))])],4)):_("",!0)])])))),256))])])])),action:o((()=>[y(g,{style:{display:"none"},color:"primary",raised:""},{default:o((()=>[n(" Confirm ")])),_:1})])),cancel:o((()=>[y(g,{onClick:V,raised:""},{default:o((()=>[n(" Close ")])),_:1})])),_:1},8,["open"])):_("",!0)}}}),[["__scopeId","data-v-196fa367"]]),X={class:"modal-form columns is-multiline"},Y={class:"field column is-6 mb-0"},Z={class:"field column is-6 mb-0"},ee=d("label",null,"Status ",-1),ae={class:"field column is-6 mb-0"},le={class:"field column is-6"},te=d("label",null,"New Cost Code List *",-1),se={class:"field column is-3 mb-0"},ue={class:"field column is-3 mb-0"},oe={class:"field column is-3 mb-0"},de={class:"field column is-3 mb-0"},ne={class:"field column is-6 mb-0"},ie=d("label",null,"Select workers * ",-1),re=d("i",{class:"fas fa-exclamation-triangle ml-2","aria-hidden":"true"},null,-1),ce={class:"field column is-6 mb-0"},pe=d("label",null,"Select Subcontractor * ",-1),me={class:"field column is-6 mb-0"},ve={class:"field column is-6 mb-0"},fe=a({__name:"UpdateTask",props:{isOpen:{type:Boolean,default:!1},taskIdSelected:{default:""},projectID:{default:""},endDate:{default:""},startDate:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:t}){const v=a,f=q(),g=O(),S=l([]),$=l([]),A=l(!1),H=l(!1);let E=l([]);l([]),l([]),l();const B=l({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",supplier:"",unit:"",costCode:"",color:"",project:"",priority:"",internalNotes:"",workers:[]});h(E.value,(()=>{console.log("data type",E)}));const F=async()=>{try{A.value=!0,B.value.workers=E.value;let e=x(B.value,["workers"]);v.taskIdSelected?(e.append("schedule_mode","false"),await g.patch(`/api/task/${B.value.id}/`,e),f.success("Task updated successfully"),t("update:OnSuccess",null)):(e.append("schedule_mode","false"),e.append("project",`${v.projectID}`),await g.post("/api/task/",e),t("update:OnSuccess",null),f.success("Task added successfully")),fe()}catch(e){console.log(e)}finally{A.value=!1}},Q=async()=>{try{H.value=!0;const e=await g.delete(`/api/task/${v.taskIdSelected}/`);console.log(e),f.error("Task deleted successfully"),fe(),t("update:OnSuccess",null)}catch(e){console.log(e)}finally{H.value=!1}},z=l({found_tasks:!1,map:[{month:"April 2025",found_task:!1,dates:[{date:"2025-04-15",count:0,tasks:[]}]}]}),G=l(!1),J=l(!1);h((()=>E.value),(()=>{J.value?(async()=>{try{const e=await g.get(`/api/task/worker-wise-date-map/${E.value}/?start_date=${B.value.startDate}&end_date=${B.value.endDate}`);z.value=e.data}catch(e){console.log(e)}})():J.value=!0}));const P=l(!1),W=l([]),K=l([]),fe=()=>{t("update:modalHandler",!1),console.log("modal closed")};return V((()=>{v.taskIdSelected&&(async()=>{try{A.value=!0;const e=await g.get(`/api/task/${v.taskIdSelected?v.taskIdSelected:""}/`);B.value=e.data,E.value=e.data.workers.map((e=>e.id))}catch(e){console.log(e)}finally{A.value=!1}})(),J.value=!0,(async()=>{try{P.value=!0;const e=await g.get("/api/cost-code/");W.value=e.data,K.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{P.value=!1}})(),(async()=>{try{A.value=!0;const e=await g.get("/api/users/by-role-option/worker/",{});S.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{A.value=!1}})(),(async()=>{try{A.value=!0;const e=await g.get("/api/users/by-role-option/supplier/",{});$.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{A.value=!1}})(),v.startDate&&(B.value.startDate=v.startDate,B.value.endDate=v.endDate)})),(a,l)=>{const t=M,f=L,g=T,h=I,V=U,x=j,O=b("Multiselect"),q=C,J=R,P=k,W=e;return s(),u(W,{is:"form",open:v.isOpen,title:v.taskIdSelected?"Update Task":"Add Task",size:"big",actions:"right",onSubmit:w(F,["prevent"]),onClose:fe},{content:o((()=>[d("div",X,[d("div",Y,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("Title: *")])),_:1}),y(g,null,{default:o((()=>[y(f,{required:"",modelValue:B.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>B.value.title=e),type:"text",placeholder:A.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),d("div",Z,[ee,y(h,null,{default:o((()=>[y(g,null,{default:o((()=>[y(x,{modelValue:B.value.status,"onUpdate:modelValue":l[1]||(l[1]=e=>B.value.status=e),name:"status",class:"is-rounded"},{default:o((()=>[y(V,{value:""},{default:o((()=>[n("Select Status")])),_:1}),(s(!0),c(p,null,m(r(N),(e=>(s(),u(V,{key:e.value,value:e.value},{default:o((()=>[n(i(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),d("div",ae,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("Cost Code: *")])),_:1}),y(g,null,{default:o((()=>[y(f,{required:"",type:"text",placeholder:A.value?"Loading...":"Cost code",modelValue:B.value.costCode,"onUpdate:modelValue":l[2]||(l[2]=e=>B.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",le,[te,y(h,null,{default:o((({id:e})=>[y(g,null,{default:o((()=>[y(O,{required:"",modelValue:B.value.costCode,"onUpdate:modelValue":l[3]||(l[3]=e=>B.value.costCode=e),attrs:{id:e},searchable:!0,options:K.value,placeholder:"Select a cost code"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",se,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("Quantity")])),_:1}),y(g,null,{default:o((()=>[y(f,{type:"text",placeholder:A.value?"Loading...":"Quantity",modelValue:B.value.quantity,"onUpdate:modelValue":l[4]||(l[4]=e=>B.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",ue,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("Unit")])),_:1}),y(g,null,{default:o((()=>[y(f,{type:"text",placeholder:A.value?"Loading...":"Unit",modelValue:B.value.unit,"onUpdate:modelValue":l[5]||(l[5]=e=>B.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",oe,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("Start Date")])),_:1}),y(g,null,{default:o((()=>[y(f,{type:"date",placeholder:A.value?"Loading...":"Start date",modelValue:B.value.startDate,"onUpdate:modelValue":l[6]||(l[6]=e=>B.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",de,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("End Date")])),_:1}),y(g,null,{default:o((()=>[y(f,{type:"date",placeholder:A.value?"Loading...":"End date",modelValue:B.value.endDate,"onUpdate:modelValue":l[7]||(l[7]=e=>B.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",ne,[ie,z.value.found_tasks?(s(),c("span",{key:0,onClick:l[8]||(l[8]=e=>G.value=!0),class:"warning-text cu-pointer"},[n(" Found Tasks Conflicts "),re])):_("",!0),y(h,null,{default:o((({id:e})=>[y(g,null,{default:o((()=>[y(O,{modelValue:r(E),"onUpdate:modelValue":l[9]||(l[9]=e=>D(E)?E.value=e:E=e),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:S.value,placeholder:"Add workers"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",ce,[pe,y(h,null,{default:o((({id:e})=>[y(g,null,{default:o((()=>[y(O,{modelValue:B.value.supplier,"onUpdate:modelValue":l[10]||(l[10]=e=>B.value.supplier=e),required:!r(E),attrs:{id:e},searchable:!0,"create-tag":!0,options:$.value,placeholder:"Add sub-contractor"},null,8,["modelValue","required","attrs","options"])])),_:2},1024)])),_:1})]),d("div",me,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("Description")])),_:1}),y(g,null,{default:o((()=>[y(q,{type:"text",rows:"3",placeholder:A.value?"Loading...":"Description",modelValue:B.value.description,"onUpdate:modelValue":l[11]||(l[11]=e=>B.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",ve,[y(h,null,{default:o((()=>[y(t,null,{default:o((()=>[n("Internal Notes")])),_:1}),y(g,null,{default:o((()=>[y(q,{type:"text",rows:"3",placeholder:A.value?"Loading...":"Internal notes",modelValue:B.value.internalNotes,"onUpdate:modelValue":l[12]||(l[12]=e=>B.value.internalNotes=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),G.value?(s(),u(J,{key:0,"conflicts-detail-modal":G.value,"conflict-data":z.value,startDate:B.value.startDate,endDate:B.value.endDate,"onUpdate:modalHandler":l[13]||(l[13]=e=>G.value=!1)},null,8,["conflicts-detail-modal","conflict-data","startDate","endDate"])):_("",!0)])])),action:o((()=>[v.taskIdSelected?(s(),u(P,{key:0,onClick:Q,class:"is-left",color:"danger",loading:H.value,raised:""},{default:o((()=>[n("Delete")])),_:1},8,["loading"])):_("",!0),y(P,{type:"submit",loading:A.value,color:"primary",raised:""},{default:o((()=>[n(i(v.taskIdSelected?"Update Task":"Add Task"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{fe as _};
