import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-1ae1087d.js";import{f as l,r as a,o,C as t,O as s,G as n,D as i,E as d,V as r,W as u,U as c,F as p,N as m,K as v,P as f,Q as _,R as y,S as b,s as g,b as I,B as h,m as w,k,J as C,a7 as x,$ as V,e as S,_ as P,w as U,L as D,X as T,a5 as j,a1 as O,I as M,Y as L,H as A,n as $,j as F}from"./index-055067d0.js";import{_ as E}from"./VControl-586408b5.js";import{_ as H}from"./VRadio.vue_vue_type_style_index_0_lang-7c57117a.js";import{u as N}from"./useAPI-e51c1ff6.js";import{u as R}from"./useNotyf-d5689beb.js";import{_ as B}from"./VField.vue_vue_type_script_setup_true_lang-cbca7836.js";import{a as q,j as z,C as W}from"./useSupportElement-ef36235c.js";import{a as K,_ as J}from"./UnitAddUpdateModal.vue_vue_type_script_setup_true_lang-947df653.js";import{_ as G}from"./VTextarea.vue_vue_type_script_setup_true_lang-b4c1f0b8.js";import{_ as Q}from"./VInput.vue_vue_type_script_setup_true_lang-edcd6335.js";import{_ as Y}from"./VCheckbox.vue_vue_type_style_index_0_lang-b5691e40.js";import{_ as X,a as Z}from"./VOption.vue_vue_type_style_index_0_lang-6d703efa.js";import{s as ee,c as le,g as ae,a as oe,b as te}from"./costItems-c3704a27.js";import{_ as se}from"./VIconButton-6e075fa1.js";import{_ as ne}from"./VTag.vue_vue_type_style_index_0_lang-f47394d5.js";import{u as ie}from"./company-2c58bcf8.js";import{_ as de}from"./SweetAlert.vue_vue_type_style_index_0_lang-f23438e9.js";import{_ as re}from"./VDropdown.vue_vue_type_style_index_0_lang-ef8cf209.js";const ue={key:0,class:"text-center py-4"},ce={key:1},pe={class:"table is-striped is-fullwidth"},me=(e=>(_("data-v-6d29306e"),e=e(),y(),e))((()=>d("thead",null,[d("tr",null,[d("th",{scope:"col"},"Title"),d("th",{scope:"col"},"Amount"),d("th",{scope:"col"},"Cost Items"),d("th",{scope:"col"},"Approval Deadline"),d("th",{scope:"col"},"Status"),d("th",{scope:"col",class:"is-end"},[d("div",{class:"dark-inverted is-flex is-justify-content-flex-end"}," Select ")])])],-1))),ve={key:0},fe={class:"capitalize"},_e={class:"is-end"},ye={class:"is-flex is-justify-content-flex-end"},be=l({__name:"OpenTempalteModal",props:{openTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:_}){const y=l,b=N(),g=R(),I=a([]),h=a(null),w=a(!1),k=()=>{_("update:modalHandler",!1)},C=async()=>{h.value?await x(h.value):g.error("Please select a template")},x=async e=>{try{const l=await b.post(`/api/lead-proposal/${e}/import-template/`,{existing_proposal:y.proposalId||"",lead:y.leadId});_("update:OnSuccess",l.data),console.log("test123"),g.success("Template imported successfully!"),k()}catch(l){console.error("Error importing template:",l),g.error("Something went wrong, try again")}};return o((()=>{(async()=>{w.value=!0;try{const e=await b.get("/api/lead-proposal/templates/");I.value=e.data}catch(e){g.error("Failed to fetch templates"),console.error(e)}finally{w.value=!1}})()})),(l,a)=>{const o=H,_=E,b=f,g=e;return t(),s(g,{open:y.openTemplate,size:"big",title:"Template List",actions:"right",onClose:k},{content:n((()=>[w.value?(t(),i("div",ue,"Loading...")):(t(),i("div",ce,[d("table",pe,[me,I.value.length?(t(),i("tbody",ve,[(t(!0),i(r,null,u(I.value,(e=>(t(),i("tr",{key:e.id},[d("td",null,c(e.title),1),d("td",null,c(e.proposalAmount),1),d("td",null,c(e.cost_items),1),d("td",null,c(e.approval_deadline),1),d("td",fe,c(e.status),1),d("td",_e,[d("div",ye,[p(_,{raw:"",subcontrol:""},{default:n((()=>[p(o,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e),value:e.id,name:"templateSelection"},null,8,["modelValue","value"])])),_:2},1024)])])])))),128))])):m("",!0)])]))])),action:n((()=>[p(b,{color:"primary",raised:"",onClick:C},{default:n((()=>[v("Confirm")])),_:1})])),cancel:n((()=>[p(b,{color:"primary",style:{display:"none"},raised:""},{default:n((()=>[v("Close")])),_:1})])),_:1},8,["open"])}}}),ge=b(be,[["__scopeId","data-v-6d29306e"]]),Ie={class:"multiselect-single-label"},he={class:"select-label-text"},we={class:"select-label-text"},ke=l({__name:"CostByCatalog",props:{centeredActionsOpen:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:i}){const r=l;g(),I();const u=R(),m=N();a(!1);const _=a(!1),y=a([]),b=a(""),x=a([]),V=()=>{i("update:modalHandler",!1)},S=()=>{i("update:OnSuccess",null)};return o((async()=>{(async()=>{try{_.value=!0;const e=await m.get("/api/cost/catalogs/");x.value=e.data,y.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{_.value=!1}})()})),(l,a)=>{const o=h("Multiselect"),i=E,_=B,g=f,I=e;return t(),s(I,{open:r.centeredActionsOpen,actions:"right",is:"form",title:"Create Cost item",onSubmit:a[1]||(a[1]=C((e=>(async()=>{const e=x.value.find((e=>e.id==b.value));e?console.log("Matched Item:",e):console.log("No item found with the given ID.");const l=q(e,[]);try{await m.post("/api/cost/",l),V(),S(),u.success("Item added successfully.")}catch(a){u.error("Failed try again")}})()),["prevent"])),onClose:V},{content:n((()=>[p(_,{class:"is-image-select m-b-80",label:"Selecte Catalog"},{default:n((({id:e})=>[p(i,null,{default:n((()=>[p(o,{modelValue:w(b),"onUpdate:modelValue":a[0]||(a[0]=e=>k(b)?b.value=e:null),attrs:{id:e},placeholder:"Select a catalog",label:"name",options:w(y)},{singlelabel:n((({value:e})=>[d("div",Ie,[d("span",he,c(e.name),1)])])),option:n((({option:e})=>[d("span",we,c(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])),action:n((()=>[p(g,{color:"primary",raised:"",type:"submit"},{default:n((()=>[v(" Confirm ")])),_:1})])),_:1},8,["open"])}}}),Ce=x("useProposal",(()=>{const e=a(!0),l=R(),o=N(),t=a("");a("");const s=a([]),n=a([]),i=a({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),d=a([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:d,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await o.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(t){l.error(` ${t}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const l=await o.get(`/api/lead-proposal/${e}/detail/`);i.value=l.data,ee.value=l.data.columns_to_show}catch(l){console.log(l)}},getCompanyProposals:async()=>{try{e.value=!0;const l=await o.get("/api/lead-proposal/");s.value=l.data}catch(a){l.error(` ${a}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{t.value=e;const l=await o.get(`/api/cost/by-proposal/${e}/`);d.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){t.value="",d.value=[]}}})),xe=x("useCostCode",(()=>{const e=a(!0),l=R(),o=N(),t=a([]),s=a([]),n=a([{value:"",label:"",labour_cost:"",unit_cost:0,worker_cost:0,unit:"--"}]);return{loading:e,companyProposalsList:t,costCodesList:n,costCodesWholeList:s,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await o.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(t){l.error(` ${t}, Lead`)}finally{e.value=!1}},getCostCodesHandler:async()=>{try{e.value=!0;const l=await o.get("/api/cost-code/");s.value=l.data,n.value=l.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(l){console.log(l)}finally{e.value=!1}}}})),Ve={class:"modal-form columns is-multiline"},Se={class:"columns is-multiline"},Pe={class:"field column is-6 mb-0"},Ue=d("label",null,"Title: ",-1),De={class:"control"},Te=["disabled"],je={class:"multiselect-single-label"},Oe={class:"select-label-text"},Me={class:"select-label-text"},Le={key:1,class:"field column is-6"},Ae=d("label",{for:""},"Cost Type",-1),$e={key:2,class:"field column is-3"},Fe=d("label",{for:""},"Add to catalogue",-1),Ee={class:"field column is-3"},He=d("label",{for:""},"Mark As",-1),Ne={class:"field column is-6"},Re=d("label",null,"Cost Code *",-1),Be={class:"field column is-6"},qe=d("label",{for:""},"Group Cost",-1),ze={class:"field column is-12 mb-0"},We=d("label",{for:"",class:"label"},"Description",-1),Ke={class:"field column is-12 mb-0"},Je=d("label",{for:"",class:"label"},"Internal Notes",-1),Ge={class:"columns is-multiline"},Qe={class:"field column is-6"},Ye=d("label",null,"Unit Cost",-1),Xe={class:"field column is-6"},Ze=d("label",null,"Quantity",-1),el={class:"field column is-6"},ll=d("label",null,"Unit",-1),al={class:"field column is-6"},ol=d("label",null,"Builder Cost",-1),tl={class:"field column is-6"},sl=d("label",null,"Markup (%)",-1),nl={class:"field column is-6"},il=d("label",null,"Total Price",-1),dl={class:"field column is-6"},rl=d("label",null,"Margin (%)",-1),ul={class:"field column is-6"},cl=d("label",null,"Worker Cost",-1),pl=l({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean},costMode:{}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:_}){const y=l,b=g(),x=xe(),O=Ce();I();const M=R(),L=N(),A=a(!1),$=a(""),F=a([]),H=a([]),z=a(!1),W=a(!1),ee=a({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,worker_cost:0,group:"",catalog:!1,proposal:y.proposalId});a([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]);const le=a([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]),ae=a([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]),oe=async()=>{try{A.value=!0;const e=q(ee.value,[]);if(y.proposalId&&e.append("proposal",y.proposalId.toString()),y.costItemId){await L.patch(`/api/cost/${y.costItemId}/`,e)}else{const l=await L.post("/api/cost/",e);if(ee.value.catalog){await L.post(`/api/cost/${l.data.id}/create-catalog/`)}O.getProposalDetail(y.proposalId)}te(),se(),M.success("Item added successfully.")}catch(e){M.error(` ${e}, New Worker`)}finally{A.value=!1}},te=()=>{_("update:modalHandler",!1)},se=()=>{_("update:OnSuccess",null)};a(0),a(0);const ne=V((()=>{const e=ee.value.unit_cost*ee.value.quantity;return Number.isFinite(e)?Number(e.toFixed(2)):0}));a(0),a(0);const ie=V((()=>{let e=ne.value;return ee.value.markup>0?e+=e*ee.value.markup/100:ee.value.margin>0&&(e/=1-ee.value.margin/100),Number.isFinite(e)?Number(e.toFixed(2)):0})),de=S((()=>P((()=>import("./ckeditor-3d6e92db.js").then((e=>e.c))),["assets/ckeditor-3d6e92db.js","assets/index-055067d0.js","assets/index-c59e13d3.css","assets/vue.runtime.esm-bundler-5ff4c0f4.js"]).then((e=>e.default.component)))),re={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},ue=a(!1),ce=a([]),pe=a(!1);U((()=>ee.value.cost_code),((e,l)=>{if(e){const l=ce.value.find((l=>l.id===e));l?(ee.value.unit_cost=l.unit_cost,ee.value.worker_cost=l.worker_cost,ee.value.unit=l.unit):console.warn("No matching item found for cost_code:",e)}}),{immediate:!1});const me=a([{id:"",title:"",value:"",description:"",is_active:!0,created_at:"",updated_at:""}]),ve=a([{id:"",title:"",value:"",description:"",is_active:!0,created_at:"",updated_at:""}]),fe=async()=>{try{ue.value=!0;const e=await L.get("/api/units/");me.value=e.data}catch(e){console.log(e)}finally{ue.value=!1}},_e=async()=>{try{ue.value=!0;const e=await L.get("/api/cost-types/");ve.value=e.data}catch(e){console.log(e)}finally{ue.value=!1}};return o((async()=>{b.value=await P((()=>import("./ckeditor-abae9d7d.js").then((e=>e.c))),["assets/ckeditor-abae9d7d.js","assets/index-055067d0.js","assets/index-c59e13d3.css"]).then((e=>e.default)),y.previousItemIndex&&(ee.value.previousItemIndex=y.previousItemIndex),y.costItemId&&(async()=>{try{ue.value=!0;const e=await L.get(`/api/cost/${y.costItemId}/`);ee.value=e.data}catch(e){console.log(e)}finally{ue.value=!1}})(),fe(),(async()=>{try{pe.value=!0;const e=await L.get("/api/cost-code/");ce.value=e.data,le.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{pe.value=!1}})(),(async()=>{try{ue.value=!0;const e=await L.get("/api/cost/catalogs/");F.value=e.data,H.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{ue.value=!1}})(),_e()})),(l,a)=>{const o=h("Multiselect"),_=E,g=B,I=X,V=Z,S=f,P=Y,U=Q,O=G,M=j,L=K,F=J,N=e;return t(),s(N,{is:"form",open:y.costItemModal,title:"catalog"==y.costMode?"Update Catalog":"Cost Item ",size:"xl",actions:"right",onSubmit:C(oe,["prevent"]),onClose:te},{content:n((()=>[d("div",Ve,[p(M,{class:"column is-12"},{default:n((()=>[d("div",Se,[d("div",Pe,[Ue,d("div",De,[D(d("input",{type:"text",name:"firstName","onUpdate:modelValue":a[0]||(a[0]=e=>w(ee).title=e),required:"",disabled:y.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,Te),[[T,w(ee).title]])])]),"catalog"!==y.costMode?(t(),s(g,{key:0,class:"column is-6 m-0",label:"Import cost code from catalogue"},{default:n((({id:e})=>[p(_,null,{default:n((()=>[p(o,{modelValue:w($),"onUpdate:modelValue":a[1]||(a[1]=e=>k($)?$.value=e:null),attrs:{id:e},placeholder:"Import from cost code",label:"name",options:w(H)},{singlelabel:n((({value:e})=>[d("div",je,[d("span",Oe,c(e.name),1)])])),option:n((({option:e})=>[d("span",Me,c(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):m("",!0),"catalog"!==y.costMode?(t(),i("div",Le,[Ae,p(g,{addons:""},{default:n((()=>[p(_,{expanded:""},{default:n((()=>[p(V,{modelValue:w(ee).cost_type,"onUpdate:modelValue":a[2]||(a[2]=e=>w(ee).cost_type=e),required:"",disabled:y.previewCostItems},{default:n((()=>[(t(!0),i(r,null,u(w(ve),((e,l)=>(t(),s(I,{value:e.value},{default:n((()=>[v(c(e.title),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1}),p(_,null,{default:n((()=>[p(S,{onClick:a[3]||(a[3]=e=>W.value=!w(W)),color:"primary",icon:"fas fa-plus"})])),_:1})])),_:1})])):m("",!0),y.costItemId?m("",!0):(t(),i("div",$e,[Fe,d("div",null,[p(_,{raw:"",subcontrol:""},{default:n((()=>[p(P,{modelValue:w(ee).catalog,"onUpdate:modelValue":a[4]||(a[4]=e=>w(ee).catalog=e),label:"Create template",color:"info"},null,8,["modelValue"])])),_:1})])])),d("div",Ee,[He,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(V,{modelValue:w(ee).mark_as,"onUpdate:modelValue":a[5]||(a[5]=e=>w(ee).mark_as=e),disabled:y.previewCostItems},{default:n((()=>[(t(!0),i(r,null,u(w(ae),((e,l)=>(t(),s(I,{value:e.value},{default:n((()=>[v(c(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Ne,[Re,p(g,null,{default:n((({id:e})=>[p(_,null,{default:n((()=>[p(o,{required:"",modelValue:w(ee).cost_code,"onUpdate:modelValue":a[6]||(a[6]=e=>w(ee).cost_code=e),disabled:y.previewCostItems,attrs:{id:e},searchable:!0,options:w(x).costCodesList,placeholder:"Select a cost code"},null,8,["modelValue","disabled","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Be,[qe,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(U,{modelValue:w(ee).group,"onUpdate:modelValue":a[7]||(a[7]=e=>w(ee).group=e),name:"gcost",placeholder:"Group Cost"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",ze,[We,w(b)?(t(),s(w(de),{key:0,disabled:y.previewCostItems,modelValue:w(ee).description,"onUpdate:modelValue":a[8]||(a[8]=e=>w(ee).description=e),editor:w(b),config:re},null,8,["disabled","modelValue","editor"])):m("",!0)]),d("div",Ke,[Je,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(O,{modelValue:w(ee).internal_notes,"onUpdate:modelValue":a[9]||(a[9]=e=>w(ee).internal_notes=e),disabled:y.previewCostItems,rows:"3",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),p(M,{class:"column is-12 mt-3"},{default:n((()=>[d("div",Ge,[d("div",Qe,[Ye,p(g,{addons:""},{default:n((()=>[p(_,{expanded:""},{default:n((()=>[p(U,{modelValue:w(ee).unit_cost,"onUpdate:modelValue":a[10]||(a[10]=e=>w(ee).unit_cost=e),disabled:y.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Xe,[Ze,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(U,{modelValue:w(ee).quantity,"onUpdate:modelValue":a[11]||(a[11]=e=>w(ee).quantity=e),disabled:y.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",el,[ll,p(g,{addons:""},{default:n((()=>[p(_,{expanded:""},{default:n((()=>[p(V,{disabled:y.previewCostItems,modelValue:w(ee).unit,"onUpdate:modelValue":a[12]||(a[12]=e=>w(ee).unit=e)},{default:n((()=>[p(I,{value:""},{default:n((()=>[v(" Select Unit ")])),_:1}),(t(!0),i(r,null,u(w(me),(e=>(t(),s(I,{value:e.value},{default:n((()=>[v(c(e.title)+" ("+c(e.value)+") ",1)])),_:2},1032,["value"])))),256))])),_:1},8,["disabled","modelValue"])])),_:1}),p(_,null,{default:n((()=>[p(S,{color:"primary",onClick:a[13]||(a[13]=e=>z.value=!w(z)),icon:"fas fa-plus"})])),_:1})])),_:1})]),d("div",al,[ol,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(U,{modelValue:w(ne),"onUpdate:modelValue":a[14]||(a[14]=e=>k(ne)?ne.value=e:null),disabled:y.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",tl,[sl,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(U,{modelValue:w(ee).markup,"onUpdate:modelValue":a[15]||(a[15]=e=>w(ee).markup=e),disabled:y.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",nl,[il,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(U,{modelValue:w(ie),"onUpdate:modelValue":a[16]||(a[16]=e=>k(ie)?ie.value=e:null),disabled:y.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",dl,[rl,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(U,{modelValue:w(ee).margin,"onUpdate:modelValue":a[17]||(a[17]=e=>w(ee).margin=e),disabled:y.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",ul,[cl,p(g,null,{default:n((()=>[p(_,null,{default:n((()=>[p(U,{modelValue:w(ee).worker_cost,"onUpdate:modelValue":a[18]||(a[18]=e=>w(ee).worker_cost=e),type:"number",name:"workerCost",step:"any",placeholder:"Worker Cost"},null,8,["modelValue"])])),_:1})])),_:1})])])])),_:1}),w(z)?(t(),s(L,{key:0,addUpdateCostUnitModal:w(z),"onUpdate:modalHandler":a[19]||(a[19]=e=>z.value=!1),"onUpdate:OnSuccess":a[20]||(a[20]=e=>fe())},null,8,["addUpdateCostUnitModal"])):m("",!0),w(W)?(t(),s(F,{key:1,addUpdateCostType:w(W),"onUpdate:modalHandler":a[21]||(a[21]=e=>W.value=!1),"onUpdate:OnSuccess":a[22]||(a[22]=e=>_e())},null,8,["addUpdateCostType"])):m("",!0)])])),action:n((()=>[p(S,{loading:w(A),type:"submit",color:"primary",icon:y.costItemId?"":"fas fa-plus",raised:""},{default:n((()=>[v(c(y.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","title","onSubmit"])}}}),ml={class:"modal-form columns is-multiline"},vl={class:"field column is-12 mb-0"},fl=d("label",null,"Section Title: ",-1),_l={class:"control"},yl=l({__name:"AddSectionLineModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean},costMode:{}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:i}){const r=l,u=Ce(),m=R(),_=N(),y=a(!1),b=a({previousItemIndex:0,index:0,title:"",description:"",catalog:!1,is_empty:!0,proposal:r.proposalId}),g=async()=>{try{y.value=!0;const e=q(b.value,[]);if(null!==r.proposalId&&void 0!==r.proposalId&&e.append("proposal",r.proposalId.toString()),r.costItemId){await _.patch(`/api/cost/${r.costItemId}/`,e)}else{const l=await _.post("/api/cost/",e);if(b.value.catalog){await _.post(`/api/cost/${l.data.id}/create-catalog/`)}u.getProposalDetail(r.proposalId)}I(),h(),m.success("Item added successfully.")}catch(e){m.error(` ${e}, New Worker`)}finally{y.value=!1}},I=()=>{i("update:modalHandler",!1)},h=()=>{i("update:OnSuccess",null)},k=V((()=>{const e=b.value.unit_cost*b.value.quantity;return Number.isFinite(e)?Number(e.toFixed(2)):0}));V((()=>{let e=k.value;return b.value.markup>0?e+=e*b.value.markup/100:b.value.margin>0&&(e/=1-b.value.margin/100),Number.isFinite(e)?Number(e.toFixed(2)):0}));const x=a(!1);return o((async()=>{r.previousItemIndex&&(b.value.previousItemIndex=r.previousItemIndex),r.costItemId&&(async()=>{try{x.value=!0;const e=await _.get(`/api/cost/${r.costItemId}/`);b.value=e.data}catch(e){console.log(e)}finally{x.value=!1}})()})),(l,a)=>{const o=f,i=e;return t(),s(i,{is:"form",open:r.costItemModal,title:"catalog"==r.costMode?"Update Catalog":"Add Section",size:"medium",actions:"right",onSubmit:C(g,["prevent"]),onClose:I},{content:n((()=>[d("div",ml,[d("div",vl,[fl,d("div",_l,[D(d("input",{type:"text",name:"firstName","onUpdate:modelValue":a[0]||(a[0]=e=>w(b).description=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Section Title"},null,512),[[T,w(b).description]])])])])])),action:n((()=>[p(o,{loading:w(y),type:"submit",color:"primary",icon:r.costItemId?"":"fas fa-plus",raised:""},{default:n((()=>[v(c(r.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","title","onSubmit"])}}}),bl={class:"modal-form columns is-multiline"},gl={class:"column is-full"},Il={class:"field"},hl=d("label",{class:"label"},"Send To ",-1),wl={class:"control"},kl={class:"column is-full"},Cl={class:"field"},xl=d("label",{class:"label"},"Subject ",-1),Vl={class:"control"},Sl={class:"column is-full"},Pl={class:"field column is-full mt-5"},Ul=d("label",{class:"label"},"Message",-1),Dl=d("i",{class:"feather:mail"},null,-1),Tl=l({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{},selectedProposalsIds:{}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:r}){const u=l,c=Ce(),_=N(),y=R(),b=a(!1),I=g(),x=window.origin;a(`${x}/proposal-view/?proposal=${u.proposalData?.id}`);const V=()=>{r("update:modalHandler",!1)},U=u.selectedProposalsIds.map((e=>e.id)),j=u.selectedProposalsIds.map((e=>e.proposalAmount)).map(((e,l)=>`<li>Total of proposal ${l+1}:<b> $${e} </b></li>`)).join("<br>"),M=U.map(((e,l)=>`<a href="${x}/proposal-view/?proposal=${e}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal ${l+1}, </a>`)).join("<br>"),L=a({email:c.leadProposalFormData?.jobInfo?.clientInfo?.email?c.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:`Proposal ${c.leadProposalFormData?.jobInfo?.title} `,message:`<p><b>Hi ${c.leadProposalFormData?.jobInfo?.clientInfo?.username?c.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${c.leadProposalFormData?.jobInfo?.clientInfo?.last_name?c.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n\n  <p>We hope this message finds you well.</p>\n\n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing.\n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n\n  <p>\n    Actions required for all proposals, and uou can review the full proposal(s), including the cost breakdown, by clicking the link below: <br />\n    ${M}\n  </p>\n\n  <p><b>Respectively proposal(s) amount are:</b></p>\n  <ul>\n    ${j}\n  </ul>\n\n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience.\n    We are here to assist you.\n  </p>\n\n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n\n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`,link:M[0],columns:["cost_code","title","description","unit_cost"],showClient:!0,proposal_ids:U}),A=a([]),$=a([{value:"",label:""}]),F=async()=>{try{b.value=!0;let e=L.value;e.proposal_ids=JSON.stringify(L.value.proposal_ids),e.columns=JSON.stringify(L.value.columns),e.cc_emails=JSON.stringify(A.value);await _.post("/api/lead-proposal/send-proposal-template/",e);y.success("Email sent successfully"),V()}catch(e){console.log(e)}finally{b.value=!1}},H=S((()=>P((()=>import("./ckeditor-3d6e92db.js").then((e=>e.c))),["assets/ckeditor-3d6e92db.js","assets/index-055067d0.js","assets/index-c59e13d3.css","assets/vue.runtime.esm-bundler-5ff4c0f4.js"]).then((e=>e.default.component)))),q={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return o((async()=>{I.value=await P((()=>import("./ckeditor-abae9d7d.js").then((e=>e.c))),["assets/ckeditor-abae9d7d.js","assets/index-055067d0.js","assets/index-c59e13d3.css"]).then((e=>e.default)),(async()=>{try{const e=await _.get("/api/users/by-role/admin/");$.value=e.data.map((e=>{const l=e.username||"",a=e.last_name||"";return{value:e.email,label:`${l}${a?" "+a:""}`}}))}catch(e){console.log(e)}})()})),(l,a)=>{const o=h("Multiselect"),r=E,c=B,_=f,y=e;return t(),i("div",null,[p(O,{name:"fade-slow"},{default:n((()=>[p(y,{is:"form",open:u.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:C(F,["prevent"]),onClose:V},{content:n((()=>[d("div",bl,[d("div",gl,[d("div",Il,[hl,d("div",wl,[D(d("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":a[0]||(a[0]=e=>w(L).email=e)},null,512),[[T,w(L).email]])])])]),d("div",kl,[d("div",Cl,[xl,d("div",Vl,[D(d("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":a[1]||(a[1]=e=>w(L).subject=e)},null,512),[[T,w(L).subject]])])])]),d("div",Sl,[p(c,{label:"Cc"},{default:n((({id:e})=>[p(r,null,{default:n((()=>[p(o,{modelValue:w(A),"onUpdate:modelValue":a[2]||(a[2]=e=>k(A)?A.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:w($),placeholder:"Add people"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Pl,[Ul,w(I)?(t(),s(w(H),{key:0,modelValue:w(L).message,"onUpdate:modelValue":a[3]||(a[3]=e=>w(L).message=e),editor:w(I),config:q},null,8,["modelValue","editor"])):m("",!0)])])])),action:n((()=>[p(_,{type:"submit",color:"primary",loading:w(b),raised:""},{default:n((()=>[Dl,v(" Send Proposal")])),_:1},8,["loading"])])),cancel:n((()=>[p(_,{color:"light",onClick:V,raised:""},{default:n((()=>[v("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),jl=N();R();const Ol=a(0),Ml=async(e,l=[])=>{try{Ol.value=3;if(l.length>0){const a=await jl.get(`/api/lead-proposal/${e.id}/download/?columns_to_show=${JSON.stringify(l)}`,{responseType:"blob"}),o=new Blob([a.data],{type:"application/pdf"}),t=document.createElement("a");t.href=URL.createObjectURL(o),t.download=`Proposal-${e.title}.pdf`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href)}else{const l=await jl.get(`/api/lead-proposal/${e.id}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`Proposal-${e.title}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)}}catch(a){console.error("Error downloading PDF:",a)}finally{Ol.value=0}},Ll=async(e,l=[])=>{try{if(Ol.value=1,l.length>0){const a=await jl.get(`/api/lead-proposal/${e}/download/?columns_to_show=${JSON.stringify(l)}`,{responseType:"blob"}),o=new Blob([a.data],{type:"application/pdf"}),t=URL.createObjectURL(o),s=window.open(t,"_blank");s?s.onload=()=>{try{s.print()}catch(e){console.error("Error triggering print:",e)}finally{URL.revokeObjectURL(t)}}:console.error("Failed to open PDF in a new window.")}else{const l=await jl.get(`/api/lead-proposal/${e}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=URL.createObjectURL(a),t=window.open(o,"_blank");t?t.onload=()=>{try{t.print()}catch(e){console.error("Error triggering print:",e)}finally{URL.revokeObjectURL(o)}}:console.error("Failed to open PDF in a new window.")}}catch(a){console.error("Error printing PDF:",a)}finally{Ol.value=0}},Al=e=>(_("data-v-42b3a938"),e=e(),y(),e),$l={class:"columns is-multiline"},Fl=Al((()=>d("div",{class:"column is-6"},[d("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),d("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),El={class:"column is-6"},Hl={class:"column is-12 is-flex is-justify-content-center"},Nl={class:"field"},Rl=Al((()=>d("label",{for:""}," Manage order of columns by dragging them",-1))),Bl={class:"d-flex"},ql={class:"column is-12"},zl={class:"invoice-wrapper"},Wl={class:"invoice-header"},Kl={class:"left"},Jl={class:"right"},Gl={class:"controls"},Ql=[Al((()=>d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"},null,-1)))],Yl=[Al((()=>d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"},null,-1)))],Xl=[Al((()=>d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],Zl={class:"invoice-body"},ea={class:"invoice-card"},la={class:"invoice-section is-flex pt-0 mt-4"},aa=["src"],oa=Al((()=>d("div",{class:"meta"},null,-1))),ta={class:"end is-right"},sa=Al((()=>d("span",null,"PO Box 242",-1))),na=Al((()=>d("span",null,"Evergreen, CO 80437-0242",-1))),ia=Al((()=>d("span",null,"Phone: 720 272-9061",-1))),da={class:"invoice-section is-flex"},ra={class:"meta"},ua={key:0},ca={key:1},pa={key:2},ma={class:"end is-left"},va={class:"invoice-section"},fa={class:"responsive-table"},_a=["innerHTML"],ya={key:1},ba={key:2},ga={key:3},Ia={key:4},ha={key:5},wa={key:6},ka={key:7},Ca={key:8},xa={key:9},Va={key:0},Sa={class:"invoice-section is-flex mt-0 pt-0"},Pa={class:"end is-left"},Ua={class:"text-right"},Da=L('<div class="invoice-section is-flex mt-0 pt-0" data-v-42b3a938><div class="footer" data-v-42b3a938><h1 class="subtitle is-6 py-0 mb-0" data-v-42b3a938> I confirm that my action here represents my electronic signature and is binding. </h1><div class="footer-meta" data-v-42b3a938><p data-v-42b3a938>Signature:</p><div data-v-42b3a938></div></div><div class="footer-meta" data-v-42b3a938><p data-v-42b3a938>Date:</p><div data-v-42b3a938></div></div><div class="footer-meta" data-v-42b3a938><p class="no-wrap" data-v-42b3a938>Print Name:</p><div data-v-42b3a938></div></div></div></div>',1),Ta=l({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const l=e,f=ie(),_=Ce(),y=a(!1),b=a([]),g=a([]),I=a([]),x=a({}),V=()=>{I.value.push(l.proposalData),x.value=l.proposalData,b.value=_.leadProposalFormData.columns_to_show,y.value=!y.value},S=a(null),P=a(null);function U(){S.value=null,P.value=null}function D(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}const T=a({proposal:"Proposal",change_order:"Change Order",draft:"Draft"});return o((()=>{g.value=l.columnsToShow})),(e,a)=>{const o=h("Multiselect"),b=E,x=B,j=ne,O=se,L=Tl;return t(),i("div",$l,[Fl,d("div",El,[p(x,{label:"Choose what to show to lead",class:"column is-12"},{default:n((({id:e})=>[p(b,null,{default:n((()=>[p(o,{modelValue:w(g),"onUpdate:modelValue":a[0]||(a[0]=e=>k(g)?g.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:w(le),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Hl,[d("div",Nl,[Rl,d("div",Bl,[(t(!0),i(r,null,u(w(g),((e,l)=>(t(),s(j,{key:e,class:M(["capitalized ml-1",{dragging:w(S)===l,"drag-over":w(P)===l}]),color:"info",outlined:"",draggable:"true",onDragstart:e=>function(e){S.value=e}(l),onDragover:C((e=>function(e){P.value=e}(l)),["prevent"]),onDrop:e=>function(e){if(null===S.value||S.value===e)return;const l=g.value.splice(S.value,1)[0];g.value.splice(e,0,l),S.value=null,P.value=null}(l),onDragend:U},{default:n((()=>[v(c(e),1)])),_:2},1032,["onDragstart","onDragover","onDrop","class"])))),128))])])]),d("div",ql,[d("div",zl,[d("div",Wl,[d("div",Kl,[d("h3",null," Proposal-ID "+c(w(_).leadProposalFormData?.id.slice(0,8)),1)]),d("div",Jl,[d("div",Gl,[1==w(Ol)?(t(),s(O,{key:0,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(t(),i("a",{key:1,class:"action",onClick:a[1]||(a[1]=e=>w(Ll)(w(_).leadProposalFormData?.id,w(g)))},Ql)),3==w(Ol)?(t(),s(O,{key:2,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(t(),i("a",{key:3,class:"action",onClick:a[2]||(a[2]=e=>w(Ml)(w(_).leadProposalFormData,w(g)))},Yl)),d("a",{class:"action",onClick:V},Xl)])])]),d("div",Zl,[d("div",ea,[d("div",la,[d("img",{style:{height:"110px",padding:"0",margin:"0"},src:w(f).currentCompany.invoice_header_logo},null,8,aa),oa,d("div",ta,[sa,na,ia,d("span",null,c(w(f).currentCompany.branding_line),1)])]),d("div",da,[d("div",ra,[w(_).leadProposalFormData?.jobInfo?.title?(t(),i("h3",ua,c(w(_).leadProposalFormData?.jobInfo?.title?w(_).leadProposalFormData?.jobInfo?.title:""),1)):m("",!0),w(_).leadProposalFormData?.jobInfo?.clientInfo?(t(),i("span",ca,c(w(_).leadProposalFormData?.jobInfo?.clientInfo?.username??"")+" "+c(w(_).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1)):(t(),i("span",pa,c(w(_).leadProposalFormData?.jobInfo?.contractor_info?.username??"")+" "+c(w(_).leadProposalFormData?.jobInfo?.contractor_info?.last_name??""),1)),d("span",null,c(w(T)[w(_).leadProposalFormData?.type]),1)]),d("div",ma,[d("h3",null,c(w(_).leadProposalFormData?.title),1),d("p",null,c(w(_).leadProposalFormData?.jobInfo?.address??""),1)])]),d("div",va,[d("table",fa,[d("thead",null,[(t(!0),i(r,null,u(w(g),((e,l)=>(t(),i("th",{key:l},c(w(ae)[e]),1)))),128))]),d("tbody",null,[(t(!0),i(r,null,u(w(_).proposalCostItems,((e,l)=>(t(),i("tr",{key:e.id},[(t(!0),i(r,null,u(w(g),((l,a)=>(t(),i("td",{key:a},[e.is_empty?(t(),i(r,{key:1},["description"===l?(t(),i("span",Va,c(e.title?e.title:e.description),1)):m("",!0)],64)):(t(),i(r,{key:0},["description"===l?(t(),i("div",{key:0,class:"custom-description",innerHTML:e[w(oe)[l]]},null,8,_a)):"cost_code"===l?(t(),i("span",ya,c(e?.cost_code_info?.name),1)):"unit_cost"===l?(t(),i("span",ba,c(D(e?.unit_cost)),1)):"margin"===l?(t(),i("span",ga,c(D(e?.margin)),1)):"markup"===l?(t(),i("span",Ia,c(D(e?.markup)),1)):"builder_cost"===l?(t(),i("span",ha,c(D(e?.builder_cost)),1)):"total_price"===l?(t(),i("span",wa,c(D(e?.total_price)),1)):"profit"===l?(t(),i("span",ka,c(D(e?.profit)),1)):"group_amount"===l?(t(),i("span",Ca,c(D(e?.group_amount)),1)):(t(),i("span",xa,c(e[w(oe)[l]]),1))],64))])))),128))])))),128))])])]),d("div",Sa,[d("div",Pa,[d("h3",Ua," Total Price: "+c(D(w(_).leadProposalFormData?.proposalAmount)),1)])]),Da])])])]),w(y)?(t(),s(L,{key:0,proposalSenderModal:w(y),selectedProposalsIds:w(I),proposalData:l.proposalData,columnsToShow:l.columnsToShow,"onUpdate:modalHandler":a[3]||(a[3]=e=>{y.value=!1,I.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData","columnsToShow"])):m("",!0)])}}}),ja=b(Ta,[["__scopeId","data-v-42b3a938"]]),Oa=e=>(_("data-v-be1f1728"),e=e(),y(),e),Ma={class:"datatable-wrapper mt-0"},La={class:"table-container"},Aa={class:"table datatable-table is-fullwidth",id:"external-events"},$a=Oa((()=>d("th",null,null,-1))),Fa=Oa((()=>d("th",null,"Actions",-1))),Ea=["data-event","onDragstart","onDrop"],Ha={class:"is-relative"},Na=["onClick"],Ra=["onClick"],Ba=["onClick"],qa=["onDblclick"],za=["id","onKeyup","onBlur"],Wa=["innerHTML"],Ka={key:1},Ja={key:2},Ga={key:3},Qa={key:0},Ya=["onClick"],Xa=[Oa((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),Oa((()=>d("div",{class:"meta"},[d("span",null,"Edit"),d("span",null,"Edit Cost Item")],-1)))],Za=Oa((()=>d("hr",{class:"dropdown-divider"},null,-1))),eo=["onClick"],lo=[Oa((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),Oa((()=>d("div",{class:"meta"},[d("span",null,"Remove"),d("span",null,"Remove from list")],-1)))],ao=l({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{},proposalId:{}},emits:["update:onsuccess"],setup(e,{emit:l}){const f=e,_=N(),y=a(""),b=a(!1),I=a(0),k=a(!1),x=Ce(),V=R(),U=a(""),j=a(0),O=a(""),M=a(!1),L=a(!1),F=g(),H=a({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),q=S((()=>P((()=>import("./ckeditor-3d6e92db.js").then((e=>e.c))),["assets/ckeditor-3d6e92db.js","assets/index-055067d0.js","assets/index-c59e13d3.css","assets/vue.runtime.esm-bundler-5ff4c0f4.js"]).then((e=>e.default.component)))),W={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},K=e=>{e.preventDefault()},J=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},G=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},Q=async()=>{try{L.value=!0;await _.delete(`/api/cost/${O.value}/`);O.value="",l("update:onsuccess",null),Y(f.proposalId),H.value.isSweetAlertOpen=!1,V.success("Cost item deleted")}catch(e){console.log(e)}finally{L.value=!1}},Y=e=>{l("update:onsuccess",null),x.getProposalCostItems(e||U.value)},ee=a(null),le=a("");function te(e,l){const a=oe[l]||l;e[a]=le.value,ee.value=null,console.log("Column",a,"cost",e,"value",le.value);let o=a.toString(),t={[o]:le.value};se(e.id,t)}const se=async(e="",a={})=>{try{await _.patch(`/api/cost/${e}/`,a);l("update:onsuccess",null),Y(f.proposalId),x.getProposalCostItems(f.proposalId),V.success("Item updated successfully.")}catch(o){V.error(` ${o}, New Worker`)}};function ne(){ee.value=null}const ie=a([]),ue=a([{id:"",title:"",value:"",description:"",is_active:!0,created_at:"",updated_at:""}]);return o((async()=>{U.value=f.proposalId,F.value=await P((()=>import("./ckeditor-abae9d7d.js").then((e=>e.c))),["assets/ckeditor-abae9d7d.js","assets/index-055067d0.js","assets/index-c59e13d3.css"]).then((e=>e.default)),(async()=>{try{const e=await _.get("/api/cost-code/");ie.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}})(),(async()=>{try{L.value=!0;const e=await _.get("/api/units/");ue.value=e.data}catch(e){console.log(e)}finally{L.value=!1}})()})),(e,l)=>{const a=h("Multiselect"),o=E,g=B,S=X,P=Z,L=re,N=de,R=yl,se=pl;return t(),i("div",Ma,[d("div",La,[d("table",Aa,[d("thead",null,[$a,(t(!0),i(r,null,u(f.columnsToShow,((e,l)=>(t(),i("th",{key:l},c(w(ae)[e]),1)))),128)),Fa]),d("tbody",null,[w(x).proposalCostItems.length>0?(t(!0),i(r,{key:0},u(w(x).proposalCostItems,((e,h)=>(t(),i("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,y.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=x.proposalCostItems.find((e=>e.id===y.value)),a=x.proposalCostItems.find((l=>l.id===e));if(l&&a){_.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=x.proposalCostItems.indexOf(l),o=x.proposalCostItems.indexOf(a);e>=0&&o>=0&&(x.proposalCostItems.splice(e,1),x.proposalCostItems.splice(o,0,l))}else console.error("Dragged or Dropped Item not found");y.value=null})(e.id),onDragover:K,onDragenter:J,onDragleave:G,class:"draggable-item events"},[d("td",Ha,[d("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","z-index":"9","font-weight":"600","font-size":"15px",color:"var(--primary)"},onClick:l=>(e=>{U.value=e.proposal,j.value=e.index,b.value=!b.value})(e),class:"fas fa-plus-circle","aria-hidden":"true"},null,8,Na),d("i",{style:{position:"absolute",bottom:"-7px",left:"19px",cursor:"pointer","z-index":"9","font-weight":"600","font-size":"14px"},onClick:l=>(e=>{I.value=e,k.value=!k.value})(e.index),class:"fas fa-plus-circle danger-text","aria-hidden":"true"},null,8,Ra),d("i",{style:{position:"absolute",bottom:"-7px",left:"36px",cursor:"pointer","z-index":"9","font-weight":"600","font-size":"14px"},onClick:l=>(async e=>{try{await _.post("/api/cost/add-empty-item/",{proposal:f.proposalId,previousItemIndex:e,is_empty:!0}),V.success("Blank line added successfully!"),Y(f.proposalId)}catch(l){console.log(l),V.error("Something went wrong, try again")}})(e.index),class:"lnir lnir-circle-plus dark-text","aria-hidden":"true"},null,8,Ba)]),(t(!0),i(r,null,u(f.columnsToShow,((d,f)=>(t(),i("td",{key:f,onDblclick:l=>function(e,l){const a=oe[l]||l;ee.value={rowId:e.id,column:l},le.value=e[a]??"",$((()=>{const a=document.getElementById(`edit-input-${e.id}-${l}`);a&&a.focus()}))}(e,d)},[ee.value&&ee.value.rowId===e.id&&ee.value.column===d?(t(),i(r,{key:0},[w(F)&&"description"===d?(t(),s(w(q),{key:0,id:`edit-input-${e.id}-${d}`,modelValue:le.value,"onUpdate:modelValue":l[0]||(l[0]=e=>le.value=e),editor:w(F),config:W,onKeyup:[A((l=>te(e,d)),["enter"]),A(ne,["esc"])],onReady:l=>function(e,l,a){e.editing.view.document.on("blur",(()=>{te(l,a)}))}(l,e,d)},null,8,["id","modelValue","editor","onKeyup","onReady"])):"cost_code"===d?(t(),s(g,{key:1,style:{"min-width":"120px","z-index":"9999"}},{default:n((({id:t})=>[p(o,null,{default:n((()=>[p(a,{required:"",modelValue:le.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>le.value=e),l=>{le.value=l,te(e,d)}],attrs:{id:t},searchable:!0,options:ie.value,onKeyup:[A((l=>te(e,d)),["enter"]),A(ne,["esc"])],placeholder:"Select a cost code",onBlur:l=>te(e,d)},null,8,["modelValue","attrs","options","onKeyup","onBlur","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)):"unit"===d?(t(),s(g,{key:2,addons:""},{default:n((()=>[p(o,{expanded:""},{default:n((()=>[p(P,{onKeyup:[A((l=>te(e,d)),["enter"]),A(ne,["esc"])],"onUpdate:modelValue":[l=>{le.value=l,te(e,d)},l[2]||(l[2]=e=>le.value=e)],modelValue:le.value},{default:n((()=>[p(S,{value:"",disabled:""},{default:n((()=>[v(" Select Unit ")])),_:1}),(t(!0),i(r,null,u(ue.value,(e=>(t(),s(S,{value:e.value},{default:n((()=>[v(c(e.title)+" ("+c(e.value)+") ",1)])),_:2},1032,["value"])))),256))])),_:2},1032,["onKeyup","onUpdate:modelValue","modelValue"])])),_:2},1024)])),_:2},1024)):D((t(),i("input",{key:3,id:`edit-input-${e.id}-${d}`,"onUpdate:modelValue":l[3]||(l[3]=e=>le.value=e),onKeyup:[A((l=>te(e,d)),["enter"]),A(ne,["esc"])],onBlur:l=>te(e,d),class:"input is-small",style:{width:"100%"}},null,40,za)),[[T,le.value]])],64)):(t(),i(r,{key:1},[e.is_empty?(t(),i(r,{key:1},["description"===d?(t(),i("span",Qa,c(e.title?e.title:e.description),1)):m("",!0)],64)):(t(),i(r,{key:0},["description"===d?(t(),i("div",{key:0,class:"custom-description",innerHTML:e[w(oe)[d]]},null,8,Wa)):["unit_cost","markup","total_price","builder_cost","margin","profit","worker_cost"].includes(d)?(t(),i("span",Ka,c(w(z)(e[w(oe)[d]])),1)):(t(),i("span",Ja,c(e[w(oe)[d]]),1)),"cost_code"===d?(t(),i("span",Ga,c(e?.cost_code_info?.name),1)):m("",!0)],64))],64))],40,qa)))),128)),d("td",null,[p(L,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:"",up:"",style:{"z-index":"99"}},{content:n((({close:l})=>[d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:C((()=>{((e,l=!1)=>{O.value=e.id,M.value=l,U.value=e.proposal,b.value=!b.value})(e,!1),l()}),["prevent"])},Xa,8,Ya),Za,d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:C((()=>{(e=>{O.value=e.id,U.value=e.proposal,H.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},lo,8,eo)])),_:2},1024)])],40,Ea)))),128)):m("",!0)])])]),H.value.isSweetAlertOpen?(t(),s(N,{key:0,isSweetAlertOpen:H.value.isSweetAlertOpen,title:H.value.title,subtitle:H.value.subtitle,btntext:H.value.btntext,onConfirm:Q,onCancel:()=>H.value.isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):m("",!0),k.value?(t(),s(R,{key:1,costItemModal:k.value,proposalId:f.proposalId,previousItemIndex:I.value,"onUpdate:modalHandler":l[4]||(l[4]=e=>k.value=!1),"onUpdate:OnSuccess":l[5]||(l[5]=e=>Y(f.proposalId))},null,8,["costItemModal","proposalId","previousItemIndex"])):m("",!0),b.value?(t(),s(se,{key:2,costItemModal:b.value,proposalId:U.value,costItemId:O.value,previousItemIndex:j.value,previewCostItems:M.value,"onUpdate:modalHandler":l[6]||(l[6]=e=>{b.value=!1,O.value=""}),"onUpdate:OnSuccess":l[7]||(l[7]=e=>Y(f.proposalId))},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):m("",!0)])}}}),oo=b(ao,[["__scopeId","data-v-be1f1728"]]),to={class:"columns is-multiline"},so={class:"column is-12 is-flex space-between"},no=d("div",null,[d("h1",{class:"title is-4"},"Proposal Worksheet")],-1),io={class:"is-flex align-items-center"},ro={key:0,class:"title is-6 mt-5 mr-3"},uo={key:0,class:"column is-12"},co={class:"tabs-wrapper column is-12 m-0"},po={class:"tabs-inner mt-4"},mo={class:"tabs is-boxed"},vo=[d("span",null,"Worksheet",-1)],fo=[d("span",null,"Format",-1)],_o=[d("span",null,"Preview",-1)],yo={key:1,class:"column is-12"},bo={class:"card bg-transparent column is-12 mt-3 is-flex space-between"},go={key:0,class:"title is-6 ml-2"},Io={key:2,class:"column is-12"},ho=d("div",{class:"column is-12",style:{"text-align":"center"}},[d("h1",{class:"title is-4"},"Connect your clients to their projects"),d("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),wo={class:"column is-12"},ko={key:3,class:"column is-12"},Co=l({__name:"WorksheetItems",props:{proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:l}){const r=e,u=N(),_=R(),y=g(),b=Ce(),I=a(!1),x=a(!1),V=a(!1),S=a(!1),U=a("worksheet"),D=async()=>{try{b.getProposalCostItems(r.proposalId),l("update:OnSuccess",null)}catch(e){console.log(e)}},T=async()=>{try{if(r.proposalId){await u.patch(`/api/lead-proposal/${r.proposalId}/`,{columns_to_show:JSON.stringify(ee.value)})}b.getProposalDetail(r.proposalId)}catch(e){_.error("Something went wrong, try again")}};return o((async()=>{y.value=await P((()=>import("./ckeditor-abae9d7d.js").then((e=>e.c))),["assets/ckeditor-abae9d7d.js","assets/index-055067d0.js","assets/index-c59e13d3.css"]).then((e=>e.default)),r.proposalId&&(D(),b.getProposalDetail(r.proposalId))})),F((()=>{b.clearProposalId()})),(e,a)=>{const o=f,y=h("Multiselect"),g=E,P=B,O=oo,L=j,$=ja,F=yl,H=pl,N=ke;return t(),i("div",null,[d("div",to,[d("div",so,[no,d("div",io,[r.proposalData?.proposalAmount?(t(),i("h1",ro," Total Amount: "+c(w(z)(r.proposalData?.proposalAmount)),1)):m("",!0),p(o,{size:"small",light:"",outlined:"",icon:"fas fa-cogs",class:"mr-2",color:w(V)?"danger":"warning",onClick:a[0]||(a[0]=e=>V.value=!w(V))},{default:n((()=>[v("Customize Columns")])),_:1},8,["color"]),p(o,{size:"small",icon:"fas fa-plus",color:"primary",onClick:a[1]||(a[1]=e=>I.value=!w(I))},{default:n((()=>[v(" Cost Item")])),_:1}),p(o,{size:"small",class:"ml-1",icon:"fas fa-plus",color:"danger",onClick:a[2]||(a[2]=e=>x.value=!w(x))},{default:n((()=>[v(" Section")])),_:1}),p(o,{onClick:a[3]||(a[3]=e=>(async()=>{try{await u.post("/api/cost/add-empty-item/",{proposal:r.proposalId,previousItemIndex:b.proposalCostItems.length?b.proposalCostItems[b.proposalCostItems.length-1].index:0,is_empty:!0}),_.success("Blank line added successfully!"),D()}catch(e){console.log(e),_.error("Something went wrong, try again")}})()),size:"small",light:"",outlined:"",class:"ml-1",color:"dark",icon:"fas fa-plus"},{default:n((()=>[v(" Blank Line")])),_:1})])]),w(V)?(t(),i("div",uo,[p(P,{label:"Choose what to show to lead",class:"column is-12"},{default:n((({id:e})=>[p(g,null,{default:n((()=>[p(y,{modelValue:w(ee),"onUpdate:modelValue":[a[4]||(a[4]=e=>k(ee)?ee.value=e:null),T],attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:w(le),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):m("",!0),d("div",co,[d("div",po,[d("div",mo,[d("ul",null,[d("li",{class:M(["worksheet"===w(U)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:a[5]||(a[5]=A(C((e=>U.value="worksheet"),["prevent"]),["space"])),onClick:a[6]||(a[6]=e=>U.value="worksheet")},vo,32)],2),d("li",{class:M(["format"===w(U)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:a[7]||(a[7]=A(C((e=>U.value="format"),["prevent"]),["space"])),onClick:a[8]||(a[8]=e=>U.value="format")},fo,32)],2),d("li",{class:M(["preview"===w(U)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:a[9]||(a[9]=A(C((e=>U.value="preview"),["prevent"]),["space"])),onClick:a[10]||(a[10]=e=>U.value="preview")},_o,32)],2)])])])]),"worksheet"===w(U)?(t(),i("div",yo,[p(O,{columnsToShow:w(ee),proposalId:r.proposalId,proposalData:r.proposalData,"onUpdate:onsuccess":a[11]||(a[11]=()=>{l("update:OnSuccess",null)})},null,8,["columnsToShow","proposalId","proposalData"]),d("div",bo,[p(o,{size:"small",light:"",outlined:"",color:"primary",onClick:a[12]||(a[12]=e=>I.value=!w(I))},{default:n((()=>[v(" Add Item")])),_:1}),d("div",null,[v(" Total Amount: "),r.proposalData?.proposalAmount?(t(),i("h1",go,c(w(z)(r.proposalData?.proposalAmount)),1)):m("",!0)])])])):m("",!0),"format"===w(U)?(t(),i("div",Io,[p(L,{class:"columns is-multiline m-0"},{default:n((()=>[ho,d("div",wo,[p(O,{columnsToShow:w(ee),proposalId:r.proposalId},null,8,["columnsToShow","proposalId"])])])),_:1})])):m("",!0),"preview"===w(U)?(t(),i("div",ko,[p($,{proposalData:r.proposalData,proposalId:r.proposalId,columnsToShow:w(ee)},null,8,["proposalData","proposalId","columnsToShow"])])):m("",!0)]),w(x)?(t(),s(F,{key:0,costItemModal:w(x),proposalId:r.proposalId,previousItemIndex:w(b).proposalCostItems.length?w(b).proposalCostItems[w(b).proposalCostItems.length-1].index:0,"onUpdate:modalHandler":a[13]||(a[13]=e=>x.value=!1),"onUpdate:OnSuccess":D},null,8,["costItemModal","proposalId","previousItemIndex"])):m("",!0),w(I)?(t(),s(H,{key:1,costItemModal:w(I),proposalId:r.proposalId,previousItemIndex:w(b).proposalCostItems.length?w(b).proposalCostItems[w(b).proposalCostItems.length-1].index:0,"onUpdate:modalHandler":a[14]||(a[14]=e=>I.value=!1),"onUpdate:OnSuccess":D},null,8,["costItemModal","proposalId","previousItemIndex"])):m("",!0),w(S)?(t(),s(N,{key:2,centeredActionsOpen:w(S),proposalId:r.proposalId,"onUpdate:modalHandler":a[15]||(a[15]=e=>S.value=!1),"onUpdate:OnSuccess":D},null,8,["centeredActionsOpen","proposalId"])):m("",!0)])}}}),xo={class:"modal-form columns is-multiline"},Vo={class:"column is-12"},So={class:"columns is-multiline"},Po=d("label",null,"Title: *",-1),Uo={class:"control"},Do=d("label",null,"Select Lead *",-1),To={class:"multiselect-single-label"},jo={class:"select-label-text"},Oo={class:"select-label-text"},Mo={class:"column is-4"},Lo=d("label",null,"Approval Deadline *",-1),Ao={class:"control"},$o={class:"field column is-2"},Fo=d("label",null,"Attachments",-1),Eo=d("div",{class:"file"},[d("label",{class:"file-label"},[d("input",{class:"file-input",type:"file",name:"resume",style:{width:"100%"}}),d("span",{class:"file-cta"},[d("span",{class:"file-icon"},[d("i",{class:"fas fa-cloud-upload-alt"})]),d("span",{class:"file-label"}," Choose a file… ")])])],-1),Ho={key:1,class:"column is-2"},No={class:"field column is-2"},Ro={class:"column is-12"},Bo={class:"body-inner-content columns is-multiline"},qo={class:"field column is-12"},zo=d("label",{for:"",class:"label"},"Internal Notes",-1),Wo={class:"field column is-12 mb-0"},Ko=d("label",{for:"",class:"label"},"Introductory Text",-1),Jo={class:"field column is-12 mb-0"},Go=d("label",{for:"",class:"label"},"Closing Text",-1),Qo={class:"column is-12",id:"items-div"},Yo={key:0},Xo=l({__name:"LeadProposalModal",props:{leadProposalModal:{type:Boolean},proposalId:{},leadId:{},createTemplate:{type:Boolean},getLeadsList:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess","clearProposalId"],setup(l,{emit:r}){const u=l;Ce(),g(),I();const _=R(),y=N(),b=a(!1),k=a(!1),x=a(""),V=a([]),S=a({id:"",title:"",approval_deadline:"",internal_notes:"",introductory_text:null,closing_text:null,payment_status:"",worksheetItems:[],type:"proposal",project:"",is_template:!1,attachments:[],columns_to_show:[],columns_to_print:[],status:"",created_at:"",updated_at:""}),P=a(!1),U=async(e=!1)=>{try{1==e?P.value=!0:b.value=!0,u.leadId&&(S.value.project=u.leadId),S.value.columns_to_show=JSON.stringify(ee.value),S.value.columns_to_print=JSON.stringify(te.value);const l=q(S.value,[]);if(u.proposalId||S.value.id){const e=await y.patch(`/api/lead-proposal/${u.proposalId?u.proposalId:S.value.id}/`,l);S.value=e.data,W({object_type:"proposal",action:"UPDATE",performedOnName:"proposal",object_id:u.leadId||S.value.project,message:`updated proposal titled <a>${S.value.title}</a> information.`})}else{const e=await y.post("/api/lead-proposal/",l);S.value=e.data,W({object_type:"proposal",action:"CREATE",performedOnName:"proposal",object_id:u.leadId||S.value.project,message:`created new proposal titled <a>${S.value.title}</a> information.`}),j(100)}1==e&&O(),_.success(`Proposal ${u.proposalId||S.value.id?"updated":"created"} successfully`)}catch(l){_.error("Something went wrong, try again")}finally{b.value=!1,P.value=!1}},j=(e=0)=>{const l=document.getElementById("items-div");if(l){const a=l.offsetTop-e;window.scrollTo({top:a,behavior:"smooth"})}},O=()=>{r("update:modalHandler",!1)},L=a(!1),A=e=>{S.value=e,console.log("test12")};return o((async()=>{u.proposalId&&(async()=>{try{const e=await y.get(`/api/lead-proposal/${u.proposalId}/`);S.value=e.data,ee.value=e.data.columns_to_show,te.value=e.data.columns_to_print}catch(e){console.log(e)}})(),u.getLeadsList&&(async()=>{try{const e=await y.get("/api/project/projects-short-info/");V.value=e.data.map((e=>({value:e.id.toString(),name:e.title}))),x.value=u.leadId||""}catch{_.error("Invalid data")}finally{k.value=!1}})(),u.createTemplate&&(S.value.is_template=!0)})),F((()=>{r("clearProposalId",null),S.value={}})),(l,a)=>{const o=h("Multiselect"),r=E,y=B,g=H,I=f,k=Y,x=G,j=Co,$=ge,F=e;return t(),s(F,{is:"form",open:u.leadProposalModal,title:u.createTemplate?"Proposal Template":"Lead Proposal",size:"xl",actions:"right",onSubmit:C(U,["prevent"]),onClose:O},{content:n((()=>[d("div",xo,[d("div",Vo,[d("div",So,[d("div",{class:M(["field mb-0",u.leadId?"column is-12":"column is-6"])},[Po,d("div",Uo,[D(d("input",{type:"text",name:"title","onUpdate:modelValue":a[0]||(a[0]=e=>w(S).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[T,w(S).title]])])],2),u.leadId||u.createTemplate?m("",!0):(t(),s(y,{key:0,class:"is-image-select has-curved-images column is-6"},{default:n((()=>[Do,p(r,null,{default:n((()=>[p(o,{modelValue:w(S).project,"onUpdate:modelValue":a[1]||(a[1]=e=>w(S).project=e),placeholder:"Select a lead",label:"name",searchable:!0,"max-height":145,options:w(V)},{singlelabel:n((({value:e})=>[d("div",To,[d("span",jo,c(e.name),1)])])),option:n((({option:e})=>[d("span",Oo,c(e.name),1)])),_:1},8,["modelValue","options"])])),_:1})])),_:1})),d("div",Mo,[p(y,{class:"m-0 p-0",label:"Type"},{default:n((()=>[p(r,{class:"m-0 p-0"},{default:n((()=>[p(g,{modelValue:w(S).type,"onUpdate:modelValue":a[2]||(a[2]=e=>w(S).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),p(g,{modelValue:w(S).type,"onUpdate:modelValue":a[3]||(a[3]=e=>w(S).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),p(g,{modelValue:w(S).type,"onUpdate:modelValue":a[4]||(a[4]=e=>w(S).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",{class:M(["field",(u.leadId||u.createTemplate,"column is-2")])},[Lo,d("div",Ao,[D(d("input",{type:"date",name:"firstName","onUpdate:modelValue":a[5]||(a[5]=e=>w(S).approval_deadline=e),class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[T,w(S).approval_deadline]])])],2),d("div",$o,[Fo,p(y,{grouped:"",class:""},{default:n((()=>[p(r,null,{default:n((()=>[Eo])),_:1})])),_:1})]),u.createTemplate||w(S).id||u.proposalId?m("",!0):(t(),i("div",Ho,[p(I,{color:"primary",class:"mt-5",icon:"fas fa-file-import",onClick:a[6]||(a[6]=()=>{w(S).project||u.leadId?L.value=!w(L):w(_).error("Please select a lead first")}),style:{width:"100%"}},{default:n((()=>[v("Templates")])),_:1})])),d("div",No,[p(y,{class:"is-flex mt-3"},{default:n((()=>[p(r,{raw:"",subcontrol:""},{default:n((()=>[p(k,{modelValue:w(S).is_template,"onUpdate:modelValue":a[7]||(a[7]=e=>w(S).is_template=e),label:"Create Template",color:"primary"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Ro,[d("div",Bo,[d("div",qo,[zo,p(y,null,{default:n((()=>[p(r,null,{default:n((()=>[p(x,{modelValue:w(S).internal_notes,"onUpdate:modelValue":a[8]||(a[8]=e=>w(S).internal_notes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Wo,[Ko,p(y,null,{default:n((()=>[p(r,null,{default:n((()=>[p(x,{modelValue:w(S).introductory_text,"onUpdate:modelValue":a[9]||(a[9]=e=>w(S).introductory_text=e),rows:"3",placeholder:"Introductory Notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Jo,[Go,p(y,null,{default:n((()=>[p(r,null,{default:n((()=>[p(x,{modelValue:w(S).closing_text,"onUpdate:modelValue":a[10]||(a[10]=e=>w(S).closing_text=e),rows:"2",placeholder:"Closing Text..."},null,8,["modelValue"])])),_:1})])),_:1})])])])])]),d("div",Qo,[w(S).id||u.proposalId?(t(),i("div",Yo,[p(j,{proposalId:w(S).id?w(S).id:u.proposalId,proposalData:w(S)},null,8,["proposalId","proposalData"])])):m("",!0)])]),w(L)?(t(),s($,{key:0,leadId:u.leadId||w(S).project,proposalId:u.proposalId,openTemplate:w(L),"onUpdate:OnSuccess":A,"onUpdate:modalHandler":a[11]||(a[11]=e=>L.value=!1)},null,8,["leadId","proposalId","openTemplate"])):m("",!0)])),action:n((()=>[u.createTemplate?(t(),s(I,{key:0,loading:w(b),type:"submit",color:"primary",raised:""},{default:n((()=>[v(c(u.proposalId||w(S).id?"Update Template":"Create Template"),1)])),_:1},8,["loading"])):(t(),s(I,{key:1,loading:w(b),type:"submit",color:"primary",raised:""},{default:n((()=>[v(c(u.proposalId||w(S).id?"Update Proposal":"Create Proposal"),1)])),_:1},8,["loading"])),p(I,{loading:w(P),onClick:a[12]||(a[12]=e=>U(!0)),color:"info",raised:""},{default:n((()=>[v(c(u.proposalId||w(S).id?"Update & Close":"Create & Close"),1)])),_:1},8,["loading"])])),cancel:n((()=>[p(I,{onClick:a[13]||(a[13]=e=>O()),raised:""},{default:n((()=>[v("Close")])),_:1})])),_:1},8,["open","title","onSubmit"])}}}),Zo=e=>(_("data-v-577783ca"),e=e(),y(),e),et={class:"columns is-multiline"},lt=Zo((()=>d("div",{class:"column is-2"},null,-1))),at={class:"column is-8"},ot=Zo((()=>d("div",{class:"column is-2"},null,-1))),tt=Zo((()=>d("div",{class:"column is-2"},null,-1))),st=Zo((()=>d("div",{class:"column is-8"},[d("p",null," All the tasks will be generated and will start from the date you will put. ")],-1))),nt=Zo((()=>d("div",{class:"column is-2"},null,-1))),it=l({__name:"CreateProposalTasksModal",props:{createProposalTasksModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(l,{emit:i}){const r=l,u=R(),c=N(),m=a(""),_=a(!1),y=()=>{i("update:OnSuccess",null),i("closeModalHandler",!1)},b=async()=>{try{_.value=!0;await c.post("/api/lead-proposal/create-tasks/",{start:m.value,proposal:r.proposalId});u.success("Tasks of this proposal are created in calendar successfully."),y()}catch(e){console.log(e),u.error("Something went wrong, please review the cost codes")}finally{_.value=!1}};return o((()=>{})),(l,a)=>{const o=Q,i=E,u=B,c=f,g=e;return t(),s(g,{is:"form",open:r.createProposalTasksModal,title:"Generate Tasks",size:"small",actions:"center",onSubmit:C(b,["prevent"]),onClose:y},{content:n((()=>[d("div",et,[lt,d("div",at,[p(u,{label:"Enter Tasks Starting Date"},{default:n((()=>[p(i,null,{default:n((()=>[p(o,{modelValue:w(m),"onUpdate:modelValue":a[0]||(a[0]=e=>k(m)?m.value=e:null),required:"",name:"startDate",type:"date"},null,8,["modelValue"])])),_:1})])),_:1})]),ot,tt,st,nt])])),cancel:n((()=>[p(c,{light:"",onClick:a[1]||(a[1]=e=>y())},{default:n((()=>[v("Cancel")])),_:1})])),action:n((()=>[p(c,{loading:w(_),type:"submit",color:"info",light:"",raised:""},{default:n((()=>[v("Generate")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),dt=b(it,[["__scopeId","data-v-577783ca"]]);export{Xo as _,dt as a,pl as b,Tl as c,xe as d,Co as e,Ol as f,Ml as g,Ce as u};
