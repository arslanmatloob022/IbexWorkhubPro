import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-a91a4a6d.js";import{e as l,r as a,o as s,A as t,B as o,N as u,F as i,D as r,E as n,J as d,l as p,C as c,M as m,T as _,I as f,O as v,R as y}from"./index-d3607b72.js";import{_ as g}from"./VIcon.vue_vue_type_script_setup_true_lang-0b762d42.js";import{_ as h}from"./VSwitchBlock.vue_vue_type_style_index_0_lang-802f3141.js";import{_ as V}from"./VAvatar.vue_vue_type_style_index_0_lang-24aa60f4.js";import{_ as b}from"./VFilePond.vue_vue_type_script_lang-8c42756f.js";import{_ as w}from"./VField.vue_vue_type_script_setup_true_lang-7194f2ec.js";import{_ as I}from"./VControl-af340e66.js";import{_ as U}from"./VInput.vue_vue_type_script_setup_true_lang-98d3f690.js";import{_ as j}from"./VLabel.vue_vue_type_script_setup_true_lang-d5394048.js";import{u as k}from"./useAPI-f59c28d8.js";import{u as x}from"./useNotyf-e593497f.js";import{a as M}from"./useSupportElement-b2119e21.js";const A={class:"modal-form columns is-multiline"},P={class:"column is-6"},R={class:"columns is-multiline"},E={class:"column is-3"},C={key:0,class:"column is-3"},N={class:"column is-6 is-flex space-around"},S={class:"multiselect-single-label"},z=["src"],F=["src"],L=y(l({__name:"AddUpdateUser",props:{isModalOpen:{type:Boolean,default:!1},userRole:{default:""},userId:{default:""},supplierId:{default:""}},emits:["update:closeModalHandler","update:actionUpdateHandler"],setup(l,{emit:y}){const L=l,$=x(),B=k(),H=a(""),q=a(!1),J=a(!1),O=a([{value:"javascript",name:"Javascript",icon:"/images/icons/stacks/js.svg"}]),D=()=>{y("update:closeModalHandler",!1)},K=a({username:"",last_name:"",email:"",password:"",is_sentMail:!1,status:"",role:"",phoneNumber:"",avatar:"",supplier:""}),T=e=>{const l=e?.target;if(l&&l.files&&l.files.length>0){const e=l.files[0];K.value.avatar=e;const a=new FileReader;a.onload=e=>{H.value=e.target?.result},a.readAsDataURL(e)}else console.error("No file selected")},G=()=>{K.value.avatar=null,H.value=null},Q=async()=>{try{J.value=!0,L.supplierId&&(K.value.supplier=L.supplierId);const e=M(K.value,["avatar"]);if(L.userId){await B.patch(`/api/users/${L.userId}/`,e);$.info("User updated successfully")}else{await B.post("/api/users/",e);$.success("User added successfully")}y("update:actionUpdateHandler",null),D()}catch(e){e.response?.data?.email&&e.response.data.email.includes("user with this email already exists.")?$.error("Email already exists. Please use a different email."):$.error("An error occurred. Please try again.")}finally{J.value=!1}},W=a(!1);return s((()=>{L.userId&&(async()=>{try{J.value=!0;const e=await B.get(`/api/users/${L.userId}/`);H.value=e.data.avatar?e.data.avatar:"",W.value=e.data.avatar?e.data.avatar:"",K.value=e.data}catch(e){console.error(e)}finally{J.value=!1}})(),K.value.role=L.userRole,"worker"==L.userRole&&(async()=>{try{const e=await B.get("/api/users/by-role-option/supplier/");O.value=e.data.map((e=>({value:e.id,name:e.username,icon:e.avatar})))}catch(e){console.log(e)}})(),L.supplierId&&(K.value.supplier=L.supplierId)})),(l,a)=>{const s=j,y=U,k=I,x=w,M=b,$=V,B=h,W=g,X=v,Y=t("Multiselect"),Z=e;return o(),u(Z,{is:"form",open:L.isModalOpen,title:L.userId?`Update ${L.userRole}`:`Add ${L.userRole}`,size:"big",actions:"right",onSubmit:f(Q,["prevent"]),onClose:D},{content:i((()=>[r("div",A,[r("div",P,[r("div",R,[n(x,{class:"column is-12"},{default:i((()=>[n(s,null,{default:i((()=>[d("First Name")])),_:1}),n(k,null,{default:i((()=>[n(y,{required:"",modelValue:p(K).username,"onUpdate:modelValue":a[0]||(a[0]=e=>p(K).username=e),type:"text",placeholder:"Enter name"},null,8,["modelValue"])])),_:1})])),_:1}),n(x,{class:"column is-12"},{default:i((()=>[n(s,null,{default:i((()=>[d("Last Name")])),_:1}),n(k,null,{default:i((()=>[n(y,{required:"",modelValue:p(K).last_name,"onUpdate:modelValue":a[1]||(a[1]=e=>p(K).last_name=e),type:"text",placeholder:"Last name"},null,8,["modelValue"])])),_:1})])),_:1})])]),r("div",E,[n(x,null,{default:i((()=>[n(s,null,{default:i((()=>[d("Picture")])),_:1}),n(k,null,{default:i((()=>[n(M,{class:"profile-filepond",name:"profile_filepond","chunk-retry-delays":[500,1e3,3e3],"label-idle":"<i class='lnil lnil-cloud-upload'></i>","accepted-file-types":["image/png","image/jpeg","image/gif"],"image-preview-height":180,"image-resize-target-width":180,"image-resize-target-height":180,"image-crop-aspect-ratio":"1:1","style-panel-layout":"compact circle","style-load-indicator-position":"center bottom","style-progress-indicator-position":"right bottom","style-button-remove-item-position":"left bottom","style-button-process-item-position":"right bottom",onChange:T,onRemovefile:G})])),_:1})])),_:1})]),p(H)?(o(),c("div",C,[n(x,null,{default:i((()=>[n(s,null,{default:i((()=>[d("Preview")])),_:1}),p(H)?(o(),u($,{key:0,picture:p(H),size:"xl",alt:"Avatar Preview"},null,8,["picture"])):m("",!0)])),_:1})])):m("",!0),n(x,{class:"column is-6"},{default:i((()=>[n(s,null,{default:i((()=>[d("Phone")])),_:1}),n(k,null,{default:i((()=>[n(y,{modelValue:p(K).phoneNumber,"onUpdate:modelValue":a[2]||(a[2]=e=>p(K).phoneNumber=e),type:"phone",placeholder:"Enter phone number"},null,8,["modelValue"])])),_:1})])),_:1}),r("div",N,[n(x,{class:"mt-5"},{default:i((()=>[n(k,null,{default:i((()=>[n(B,{modelValue:p(K).is_sentMail,"onUpdate:modelValue":a[3]||(a[3]=e=>p(K).is_sentMail=e),label:"Send email",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1}),n(x,{class:"mt-5"},{default:i((()=>[n(k,null,{default:i((()=>[n(B,{modelValue:p(K).is_active,"onUpdate:modelValue":a[4]||(a[4]=e=>p(K).is_active=e),label:"Active",color:"primary",thin:""},null,8,["modelValue"])])),_:1})])),_:1})]),n(x,{class:"column is-6"},{default:i((()=>[n(s,null,{default:i((()=>[d("Email")])),_:1}),n(k,null,{default:i((()=>[n(y,{required:"",modelValue:p(K).email,"onUpdate:modelValue":a[5]||(a[5]=e=>p(K).email=e),type:"email",placeholder:"Enter mail"},null,8,["modelValue"])])),_:1})])),_:1}),L.userId?m("",!0):(o(),u(x,{key:1,class:"column is-6",label:"Password",addons:""},{default:i((()=>[n(k,{expanded:""},{default:i((()=>[n(y,{modelValue:p(K).password,"onUpdate:modelValue":a[6]||(a[6]=e=>p(K).password=e),type:p(q)?"text":"password",class:"input",placeholder:"Enter Password"},null,8,["modelValue","type"])])),_:1}),n(k,null,{default:i((()=>[n(X,{color:"primary",onClick:a[7]||(a[7]=e=>q.value=!p(q))},{default:i((()=>[p(q)?(o(),u(W,{key:0,icon:"lucide:eye-off"})):(o(),u(W,{key:1,icon:"lucide:eye"}))])),_:1})])),_:1})])),_:1})),"worker"==L.userRole?(o(),u(x,{key:2,class:"column is-6"},{default:i((({id:e})=>[n(k,null,{default:i((()=>[n(Y,{modelValue:p(K).supplier,"onUpdate:modelValue":a[8]||(a[8]=e=>p(K).supplier=e),attrs:{id:e},placeholder:"Select a sub-contractor",label:"name",options:p(O),searchable:!0,"track-by":"name","max-height":145},{singlelabel:i((({value:e})=>[r("div",S,[r("img",{class:"select-label-icon",src:e.icon,alt:""},null,8,z),d(" "+_(e.name),1)])])),option:i((({option:e})=>[r("img",{class:"select-option-icon",src:e.icon,alt:""},null,8,F),d(" "+_(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):m("",!0)])])),action:i((()=>[n(X,{loading:p(J),type:"submit",color:"primary",raised:""},{default:i((()=>[d(_(L.userId?"Update":"Add"),1)])),_:1},8,["loading"])])),cancel:i((()=>[n(X,{type:"cancel",loading:p(J),onClick:D,raised:""},{default:i((()=>[d(" Cancel ")])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}}),[["__scopeId","data-v-96d7969f"]]);export{L as _};
