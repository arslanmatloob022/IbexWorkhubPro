import{e,s as l,r as a,o,A as t,B as s,N as n,F as i,E as d,l as r,j as u,D as c,T as p,J as m,I as v,O as b,Z as f,b as _,_ as y,w as h,K as g,W as I,C as w,V as k,U as C,M as V,a4 as P,a6 as x,a0 as D,X as S,P as T,Q as j,R as O,i as U,aR as A,H as M,G as F}from"./index-6ec76f2c.js";import{_ as E}from"./VModal.vue_vue_type_style_index_0_lang-4619ed61.js";import{_ as L}from"./VField.vue_vue_type_script_setup_true_lang-12cdb0f5.js";import{_ as $}from"./VControl-cd7a06dd.js";import{u as H}from"./useAPI-75ddec04.js";import{u as R}from"./useNotyf-f5a64182.js";import{a as B}from"./useSupportElement-51074a9f.js";import{u as q}from"./userSession-d90803bf.js";import{_ as N}from"./VTextarea.vue_vue_type_script_setup_true_lang-0ddcd2a4.js";import{_ as z}from"./VInput.vue_vue_type_script_setup_true_lang-94e4ee6c.js";import{_ as W}from"./VCheckbox.vue_vue_type_style_index_0_lang-a79f9266.js";import{a as J,_ as G}from"./VOption.vue_vue_type_style_index_0_lang-84b07de9.js";import{_ as K}from"./VAvatar.vue_vue_type_style_index_0_lang-8252aa84.js";import{_ as Q}from"./VIconButton-79dc9d51.js";import{a as X,g as Y,s as Z,c as ee}from"./costItems-cc57c928.js";import{_ as le}from"./SweetAlert.vue_vue_type_style_index_0_lang-d2e67747.js";import{_ as ae}from"./VDropdown.vue_vue_type_style_index_0_lang-32355ab6.js";const oe={class:"multiselect-single-label"},te={class:"select-label-text"},se={class:"select-label-text"},ne=e({__name:"CostByCatalog",props:{centeredActionsOpen:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:f}){const _=e;l(),q();const y=R(),h=H(),g=a(!1),I=a(!1),w=a([]),k=a(""),C=a([]),V=()=>{f("update:modalHandler",!1)},P=()=>{f("update:OnSuccess",null)};return o((async()=>{(async()=>{try{I.value=!0;const e=await h.get("/api/cost/catalogs/");C.value=e.data,w.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{I.value=!1}})()})),(e,l)=>{const a=t("Multiselect"),o=$,f=L,I=b,x=E;return s(),n(x,{open:_.centeredActionsOpen,actions:"right",is:"form",title:"Create Cost item",onSubmit:l[1]||(l[1]=v((e=>(async()=>{const e=C.value.find((e=>e.id==k.value));e?console.log("Matched Item:",e):console.log("No item found with the given ID.");const l=B(e,[]);try{await h.post("/api/cost/",l),V(),P(),y.success("Item added successfully.")}catch(a){y.error("Failed try again")}})()),["prevent"])),onClose:l[2]||(l[2]=e=>g.value=!1)},{content:i((()=>[d(f,{class:"is-image-select m-b-80",label:"Selecte Catalog"},{default:i((({id:e})=>[d(o,null,{default:i((()=>[d(a,{modelValue:r(k),"onUpdate:modelValue":l[0]||(l[0]=e=>u(k)?k.value=e:null),attrs:{id:e},placeholder:"Select a catalog",label:"name",options:r(w)},{singlelabel:i((({value:e})=>[c("div",oe,[c("span",te,p(e.name),1)])])),option:i((({option:e})=>[c("span",se,p(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])),action:i((()=>[d(I,{color:"primary",raised:"",type:"submit"},{default:i((()=>[m(" Confirm ")])),_:1})])),cancel:i((()=>[d(I,{color:"primary",raised:"",style:{display:"none"}},{default:i((()=>[m(" Confirm ")])),_:1})])),_:1},8,["open"])}}}),ie={class:"modal-form columns is-multiline"},de={class:"columns is-multiline"},re={class:"field column is-6 mb-0"},ue=c("label",null,"Title: ",-1),ce={class:"control"},pe=["disabled"],me={class:"multiselect-single-label"},ve={class:"select-label-text"},be={class:"select-label-text"},fe={class:"field column is-6"},_e=c("label",{for:""},"Cost Type",-1),ye={key:0,class:"field column is-3"},he=c("label",{for:""},"Catalog",-1),ge={class:"field column is-3"},Ie=c("label",{for:""},"Mark As",-1),we={class:"field column is-6"},ke=c("label",null,"Cost Code *",-1),Ce={class:"field column is-6"},Ve=c("label",{for:""},"Group Cost",-1),Pe={class:"field column is-12 mb-0"},xe=c("label",{for:"",class:"label"},"Description",-1),De={class:"field column is-12 mb-0"},Se=c("label",{for:"",class:"label"},"Internal Notes",-1),Te={class:"columns is-multiline"},je={class:"field column is-6"},Oe=c("label",null,"Unit Cost",-1),Ue={class:"field column is-6"},Ae=c("label",null,"Quantity",-1),Me={class:"field column is-6"},Fe=c("label",null,"Unit",-1),Ee={class:"field column is-6"},Le=c("label",null,"Builder Cost",-1),$e={class:"field column is-6"},He=c("label",null,"Markup (%)",-1),Re={class:"field column is-6"},Be=c("label",null,"Client Price",-1),qe={class:"field column is-6"},Ne=c("label",null,"Margin (%)",-1),ze=e({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:x}){const D=e,S=l();q();const T=R(),j=H(),O=a(!1);a([]),a([]);const U=a({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,group:"",catalog:!1,proposal:D.proposalId}),A=a([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]),M=a([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]);a([{value:"Tiling",label:"Tiling"},{value:"Material",label:"Material"},{value:"Paint",label:"Paint"},{value:"Carpenter",label:"Carpenter"}]);const F=a([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]);a([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const K=async()=>{try{O.value=!0;const e=B(U.value,[]);if(D.costItemId){await j.patch(`/api/cost/${D.costItemId}/`,e)}else{const l=await j.post("/api/cost/",e);if(U.value.catalog){await j.post(`/api/cost/${l.data.id}/create-catalog/`)}}Q(),X(),T.success("Item added successfully.")}catch(e){T.error(` ${e}, New Worker`)}finally{O.value=!1}},Q=()=>{x("update:modalHandler",!1)},X=()=>{x("update:OnSuccess",null)};a(0),a(0);const Y=f((()=>U.value.unit_cost*U.value.quantity));a(0),a(0);const Z=f((()=>U.value.markup>0?Y.value+Y.value*U.value.markup/100:U.value.margin>0?Y.value/(1-U.value.margin/100):Y.value));f((()=>(Z.value-Y.value)/Y.value*100)),f((()=>(Z.value-Y.value)/Z.value*100));const ee=_((()=>y((()=>import("./ckeditor-847d623f.js").then((e=>e.c))),["assets/ckeditor-847d623f.js","assets/index-6ec76f2c.js","assets/index-a879fc9d.css","assets/vue.runtime.esm-bundler-c71197d8.js"]).then((e=>e.default.component)))),le={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},ae=a(!1),oe=a(!1);o((async()=>{S.value=await y((()=>import("./ckeditor-e831084b.js").then((e=>e.c))),["assets/ckeditor-e831084b.js","assets/index-6ec76f2c.js","assets/index-a879fc9d.css"]).then((e=>e.default)),D.previousItemIndex&&(U.value.previousItemIndex=D.previousItemIndex),D.costItemId&&(async()=>{try{ae.value=!0;const e=await j.get(`/api/cost/${D.costItemId}/`);U.value=e.data}catch(e){console.log(e)}finally{ae.value=!1}})(),(async()=>{try{oe.value=!0;const e=await j.get("/api/cost-code/");M.value=e.data.map((e=>({value:e.id,label:e.name})))}catch(e){console.log(e)}finally{oe.value=!1}})(),ze()}));const te=a(""),se=a([]),ne=a([]),ze=async()=>{try{ae.value=!0;const e=await j.get("/api/cost/catalogs/");se.value=e.data,ne.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{ae.value=!1}};return h(te,((e,l)=>{const a=se.value.find((e=>e.id==te.value)),{id:o,...t}=a;U.value=t})),(e,l)=>{const a=t("Multiselect"),o=$,f=L,_=G,y=J,h=W,x=z,T=N,j=P,H=b,R=E;return s(),n(R,{is:"form",open:D.costItemModal,title:"Cost Item ",size:"xl",actions:"right",onSubmit:v(K,["prevent"]),onClose:Q},{content:i((()=>[c("div",ie,[d(j,{class:"column is-12"},{default:i((()=>[c("div",de,[c("div",re,[ue,c("div",ce,[g(c("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>r(U).title=e),required:"",disabled:D.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,pe),[[I,r(U).title]])])]),d(f,{class:"is-image-select column is-6",label:"Select Catalog"},{default:i((({id:e})=>[d(o,null,{default:i((()=>[d(a,{modelValue:r(te),"onUpdate:modelValue":l[1]||(l[1]=e=>u(te)?te.value=e:null),attrs:{id:e},placeholder:"Select a catalog",label:"name",options:r(ne)},{singlelabel:i((({value:e})=>[c("div",me,[c("span",ve,p(e.name),1)])])),option:i((({option:e})=>[c("span",be,p(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1}),c("div",fe,[_e,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(y,{modelValue:r(U).cost_type,"onUpdate:modelValue":l[2]||(l[2]=e=>r(U).cost_type=e),disabled:D.previewCostItems},{default:i((()=>[(s(!0),w(C,null,k(r(A),((e,l)=>(s(),n(_,{value:e.value},{default:i((()=>[m(p(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),D.costItemId?V("",!0):(s(),w("div",ye,[he,c("div",null,[d(o,{raw:"",subcontrol:""},{default:i((()=>[d(h,{modelValue:r(U).catalog,"onUpdate:modelValue":l[3]||(l[3]=e=>r(U).catalog=e),label:"Create Template",color:"info"},null,8,["modelValue"])])),_:1})])])),c("div",ge,[Ie,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(y,{modelValue:r(U).mark_as,"onUpdate:modelValue":l[4]||(l[4]=e=>r(U).mark_as=e),disabled:D.previewCostItems},{default:i((()=>[(s(!0),w(C,null,k(r(F),((e,l)=>(s(),n(_,{value:e.value},{default:i((()=>[m(p(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",we,[ke,d(f,null,{default:i((({id:e})=>[d(o,null,{default:i((()=>[d(a,{required:"",modelValue:r(U).cost_code,"onUpdate:modelValue":l[5]||(l[5]=e=>r(U).cost_code=e),disabled:D.previewCostItems,attrs:{id:e},searchable:!0,options:r(M),placeholder:"Select a cost code"},null,8,["modelValue","disabled","attrs","options"])])),_:2},1024)])),_:1})]),c("div",Ce,[Ve,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(U).group,"onUpdate:modelValue":l[6]||(l[6]=e=>r(U).group=e),name:"gcost",placeholder:"Group Cost"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",Pe,[xe,r(S)?(s(),n(r(ee),{key:0,disabled:D.previewCostItems,modelValue:r(U).description,"onUpdate:modelValue":l[7]||(l[7]=e=>r(U).description=e),editor:r(S),config:le},null,8,["disabled","modelValue","editor"])):V("",!0)]),c("div",De,[Se,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(T,{modelValue:r(U).internal_notes,"onUpdate:modelValue":l[8]||(l[8]=e=>r(U).internal_notes=e),disabled:D.previewCostItems,rows:"4",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),d(j,{class:"column is-12 mt-3"},{default:i((()=>[c("div",Te,[c("div",je,[Oe,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(U).unit_cost,"onUpdate:modelValue":l[9]||(l[9]=e=>r(U).unit_cost=e),disabled:D.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Ue,[Ae,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(U).quantity,"onUpdate:modelValue":l[10]||(l[10]=e=>r(U).quantity=e),disabled:D.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Me,[Fe,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(U).unit,"onUpdate:modelValue":l[11]||(l[11]=e=>r(U).unit=e),disabled:D.previewCostItems,type:"text",name:"unit",placeholder:"Unit"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Ee,[Le,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(Y),"onUpdate:modelValue":l[12]||(l[12]=e=>u(Y)?Y.value=e:null),disabled:D.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",$e,[He,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(U).markup,"onUpdate:modelValue":l[13]||(l[13]=e=>r(U).markup=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",Re,[Be,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(Z),"onUpdate:modelValue":l[14]||(l[14]=e=>u(Z)?Z.value=e:null),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),c("div",qe,[Ne,d(f,null,{default:i((()=>[d(o,null,{default:i((()=>[d(x,{modelValue:r(U).margin,"onUpdate:modelValue":l[15]||(l[15]=e=>r(U).margin=e),disabled:D.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1})])])),action:i((()=>[d(H,{loading:r(O),type:"submit",color:"primary",icon:D.costItemId?"":"fas fa-plus",raised:""},{default:i((()=>[m(p(D.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","onSubmit"])}}}),We=x("useProposal",(()=>{const e=a(!0),l=R(),o=H(),t=a("");a("");const s=a([]),n=a([]),i=a({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),d=a([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:d,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async a=>{try{a.value=a,e.value=!0;const l=await o.get(`/api/lead-proposal/by-job/${a.value}/`);n.value=l.data}catch(t){l.error(` ${t}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const l=await o.get(`/api/lead-proposal/${e}/detail/`);i.value=l.data}catch(l){console.log(l)}},getCompanyProposals:async()=>{try{e.value=!0;const l=await o.get("/api/lead-proposal/");s.value=l.data}catch(a){l.error(` ${a}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{t.value=e;const l=await o.get(`/api/cost/by-proposal/${e}/`);d.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){t.value="",d.value=[]}}})),Je={class:"modal-form columns is-multiline"},Ge={class:"column is-full"},Ke={class:"field"},Qe=c("label",{class:"label"},"Send To ",-1),Xe={class:"control"},Ye={class:"column is-full"},Ze={class:"field"},el=c("label",{class:"label"},"Subject ",-1),ll={class:"control"},al={class:"field column is-full mt-5"},ol=c("label",{class:"label"},"Message",-1),tl=c("i",{class:"feather:mail"},null,-1),sl=e({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{},selectedProposalsIds:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const u=e,p=We(),f=H(),h=R(),k=a(!1),C=l(),P=window.origin;a(`${P}/proposal-view/?proposal=${u.proposalData?.id}`);const x=()=>{t("update:modalHandler",!1)},S=u.selectedProposalsIds.map((e=>e.id)),T=u.selectedProposalsIds.map((e=>e.proposalAmount)).map(((e,l)=>`<li>Total of proposal ${l+1}:<b> $${e} </b></li>`)).join("<br>"),j=S.map(((e,l)=>`<a href="${P}/proposal-view/?proposal=${e}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal ${l+1}, </a>`)).join("<br>"),O=a({email:p.leadProposalFormData?.jobInfo?.clientInfo?.email?p.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:`Proposal ${p.leadProposalFormData?.jobInfo?.title} `,message:`<p><b>Hi ${p.leadProposalFormData?.jobInfo?.clientInfo?.username?p.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${p.leadProposalFormData?.jobInfo?.clientInfo?.last_name?p.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n\n  <p>We hope this message finds you well.</p>\n\n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing.\n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n\n  <p>\n    Actions required for all proposals, and uou can review the full proposal(s), including the cost breakdown, by clicking the link below: <br />\n    ${j}\n  </p>\n\n  <p><b>Respectively proposal(s) amount are:</b></p>\n  <ul>\n    ${T}\n  </ul>\n\n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience.\n    We are here to assist you.\n  </p>\n\n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n\n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`,link:j[0],columns:["cost_code","title","description","unit_cost"],showClient:!0,proposal_ids:S}),U=async()=>{try{k.value=!0;let e=O.value;e.proposal_ids=JSON.stringify(O.value.proposal_ids),e.columns=JSON.stringify(O.value.columns);await f.post("/api/lead-proposal/send-proposal-template/",e);h.success("Email sent successfully"),x()}catch(e){console.log(e)}finally{k.value=!1}},A=_((()=>y((()=>import("./ckeditor-847d623f.js").then((e=>e.c))),["assets/ckeditor-847d623f.js","assets/index-6ec76f2c.js","assets/index-a879fc9d.css","assets/vue.runtime.esm-bundler-c71197d8.js"]).then((e=>e.default.component)))),M={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return o((async()=>{C.value=await y((()=>import("./ckeditor-e831084b.js").then((e=>e.c))),["assets/ckeditor-e831084b.js","assets/index-6ec76f2c.js","assets/index-a879fc9d.css"]).then((e=>e.default))})),(e,l)=>{const a=b,o=E;return s(),w("div",null,[d(D,{name:"fade-slow"},{default:i((()=>[d(o,{is:"form",open:u.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:v(U,["prevent"]),onClose:x},{content:i((()=>[c("div",Je,[c("div",Ge,[c("div",Ke,[Qe,c("div",Xe,[g(c("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>r(O).email=e)},null,512),[[I,r(O).email]])])])]),c("div",Ye,[c("div",Ze,[el,c("div",ll,[g(c("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>r(O).subject=e)},null,512),[[I,r(O).subject]])])])]),c("div",al,[ol,r(C)?(s(),n(r(A),{key:0,modelValue:r(O).message,"onUpdate:modelValue":l[2]||(l[2]=e=>r(O).message=e),editor:r(C),config:M},null,8,["modelValue","editor"])):V("",!0)])])])),action:i((()=>[d(a,{type:"submit",color:"primary",loading:r(k),raised:""},{default:i((()=>[tl,m(" Send Proposal")])),_:1},8,["loading"])])),cancel:i((()=>[d(a,{color:"light",onClick:x,raised:""},{default:i((()=>[m("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),nl=H();R();const il=a(0),dl=async e=>{try{il.value=3;const l=await nl.get(`/api/lead-proposal/${e.id}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`Proposal-${e.title}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)}catch(l){console.error("Error downloading PDF:",l)}finally{il.value=0}},rl=async e=>{try{il.value=1;const l=await nl.get(`/api/lead-proposal/${e}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=URL.createObjectURL(a),t=document.createElement("iframe");t.style.display="none",t.src=o,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print(),document.body.removeChild(t)}}catch(l){console.error("Error printing PDF:",l)}finally{il.value=0}},ul=e=>(T("data-v-5c3b9a3b"),e=e(),j(),e),cl={class:"columns is-multiline"},pl=ul((()=>c("div",{class:"column is-9"},[c("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),c("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),ml={class:"column is-12"},vl={class:"invoice-wrapper"},bl={class:"invoice-header"},fl={class:"left"},_l={class:"right"},yl={class:"controls"},hl=[ul((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"},null,-1)))],gl=[ul((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"},null,-1)))],Il=[ul((()=>c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],wl={class:"invoice-body"},kl={class:"invoice-card"},Cl={class:"invoice-section is-flex"},Vl=ul((()=>c("div",{class:"meta"},null,-1))),Pl=ul((()=>c("div",{class:"end is-right"},[c("span",null,"PO Box 242"),c("span",null,"Evergreen, CO 80437-0242"),c("span",null,"Phone: 720 272-9061"),c("span",null,"Premium Trades for Premier Builders")],-1))),xl={class:"invoice-section is-flex"},Dl={class:"meta"},Sl={class:"end is-left"},Tl={class:"invoice-section"},jl={class:"responsive-table"},Ol=["innerHTML"],Ul={key:1},Al={key:2},Ml={class:"invoice-section is-flex mt-0 pt-0"},Fl={class:"end is-left"},El={class:"text-right"},Ll=S('<div class="invoice-section is-flex mt-0 pt-0" data-v-5c3b9a3b><div class="footer" data-v-5c3b9a3b><div class="footer-meta" data-v-5c3b9a3b><p data-v-5c3b9a3b>Signature:</p><div data-v-5c3b9a3b></div></div><div class="footer-meta" data-v-5c3b9a3b><p data-v-5c3b9a3b>Date:</p><div data-v-5c3b9a3b></div></div><div class="footer-meta" data-v-5c3b9a3b><p class="no-wrap" data-v-5c3b9a3b>Print Name:</p><div data-v-5c3b9a3b></div></div></div></div>',1),$l=O(e({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const l=e,t=We(),i=a(!1),u=a([]),m=a([]),v=a({}),b=()=>{m.value.push(l.proposalData),v.value=l.proposalData,u.value=t.leadProposalFormData.columns_to_show,i.value=!i.value};return o((()=>{})),(e,a)=>{const o=Q,u=K,v=sl;return s(),w("div",cl,[pl,c("div",ml,[c("div",vl,[c("div",bl,[c("div",fl,[c("h3",null," Proposal-ID "+p(r(t).leadProposalFormData?.id.slice(0,8)),1)]),c("div",_l,[c("div",yl,[1==r(il)?(s(),n(o,{key:0,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(s(),w("a",{key:1,class:"action",onClick:a[0]||(a[0]=e=>r(rl)(r(t).leadProposalFormData?.id))},hl)),3==r(il)?(s(),n(o,{key:2,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(s(),w("a",{key:3,class:"action",onClick:a[1]||(a[1]=e=>r(dl)(r(t).leadProposalFormData))},gl)),c("a",{class:"action",onClick:b},Il)])])]),c("div",wl,[c("div",kl,[c("div",Cl,[d(u,{size:"xl",picture:"/logos/IbexFavicon.png"}),Vl,Pl]),c("div",xl,[c("div",Dl,[c("h3",null,p(r(t).leadProposalFormData?.jobInfo?.clientInfo?.username??"N/A")+" "+p(r(t).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1),c("span",null,p(r(t).leadProposalFormData?.jobInfo?.clientInfo?.email?r(t).leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A"),1)]),c("div",Sl,[c("h3",null,p(r(t).leadProposalFormData?.title),1),c("p",null," Job Address: "+p(r(t).leadProposalFormData?.jobInfo?.address??"N/A"),1)])]),c("div",Tl,[c("table",jl,[c("thead",null,[(s(!0),w(C,null,k(r(t).leadProposalFormData.columns_to_show,((e,l)=>(s(),w("th",{key:l},p(r(X)[e]),1)))),128))]),c("tbody",null,[(s(!0),w(C,null,k(r(t).proposalCostItems,((e,l)=>(s(),w("tr",{key:e.id},[(s(!0),w(C,null,k(r(t).leadProposalFormData.columns_to_show,((l,a)=>(s(),w("td",{key:a},["description"===l?(s(),w("div",{key:0,innerHTML:e[r(Y)[l]]},null,8,Ol)):(s(),w("span",Ul,p(e[r(Y)[l]]),1)),"cost_code"===l?(s(),w("span",Al,p(e?.cost_code_info?.name),1)):V("",!0)])))),128))])))),128))])])]),c("div",Ml,[c("div",Fl,[c("h3",El," Total Price: $"+p(r(t).leadProposalFormData?.proposalAmount),1)])]),Ll])])])]),r(i)?(s(),n(v,{key:0,proposalSenderModal:r(i),selectedProposalsIds:r(m),proposalData:l.proposalData,columnsToShow:l.columnsToShow,"onUpdate:modalHandler":a[2]||(a[2]=e=>{i.value=!1,m.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData","columnsToShow"])):V("",!0)])}}}),[["__scopeId","data-v-5c3b9a3b"]]),Hl=e=>(T("data-v-4eb8bad8"),e=e(),j(),e),Rl={class:"datatable-wrapper mt-0"},Bl={class:"table-container"},ql={class:"table datatable-table is-fullwidth",id:"external-events"},Nl=Hl((()=>c("th",null,null,-1))),zl=Hl((()=>c("th",null,"Actions",-1))),Wl=["data-event","onDragstart","onDrop","onDblclick"],Jl={class:"is-relative"},Gl=["onClick"],Kl=["innerHTML"],Ql={key:1},Xl={key:2},Yl=["onClick"],Zl=[Hl((()=>c("div",{class:"icon"},[c("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),Hl((()=>c("div",{class:"meta"},[c("span",null,"Edit"),c("span",null,"Edit Cost Item")],-1)))],ea=Hl((()=>c("hr",{class:"dropdown-divider"},null,-1))),la=["onClick"],aa=[Hl((()=>c("div",{class:"icon"},[c("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),Hl((()=>c("div",{class:"meta"},[c("span",null,"Remove"),c("span",null,"Remove from list")],-1)))],oa=e({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{}},setup(e){const l=e,t=We(),u=R(),m=a({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),b=H(),f=a(""),_=a(!1);a([]);const y=e=>{e.preventDefault()},h=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},g=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},I=a(""),P=a(0),x=a(""),D=a(!1),S=a(!1),T=async()=>{try{S.value=!0;await b.delete(`/api/cost/${x.value}/`);O(),m.value.isSweetAlertOpen=!1,u.success("Cost item deleted")}catch(e){console.log(e)}finally{S.value=!1}},j=(e,l=!1)=>{x.value=e.id,D.value=l,I.value=e.proposal,_.value=!_.value},O=()=>{t.getProposalCostItems(I.value)};return o((()=>{})),(e,a)=>{const o=ae,u=le,S=ze;return s(),w("div",Rl,[c("div",Bl,[c("table",ql,[c("thead",null,[Nl,(s(!0),w(C,null,k(l.columnsToShow,((e,l)=>(s(),w("th",{key:l},p(r(X)[e]),1)))),128)),zl]),c("tbody",null,[r(t).proposalCostItems.length>0?(s(!0),w(C,{key:0},k(r(t).proposalCostItems,((e,a)=>(s(),w("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,f.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=t.proposalCostItems.find((e=>e.id===f.value)),a=t.proposalCostItems.find((l=>l.id===e));if(l&&a){b.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=t.proposalCostItems.indexOf(l),o=t.proposalCostItems.indexOf(a);e>=0&&o>=0&&(t.proposalCostItems.splice(e,1),t.proposalCostItems.splice(o,0,l))}else console.error("Dragged or Dropped Item not found");f.value=null})(e.id),onDragover:y,onDragenter:h,onDragleave:g,onDblclick:l=>j(e,!1),class:"draggable-item events"},[c("td",Jl,[c("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","font-weight":"600"},onClick:l=>(e=>{I.value=e.proposal,P.value=e.index,_.value=!_.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,Gl)]),(s(!0),w(C,null,k(l.columnsToShow,((l,a)=>(s(),w("td",{key:a},["description"===l?(s(),w("div",{key:0,innerHTML:e[r(Y)[l]]},null,8,Kl)):(s(),w("span",Ql,p(e[r(Y)[l]]),1)),"cost_code"===l?(s(),w("span",Xl,p(e?.cost_code_info?.name),1)):V("",!0)])))),128)),c("td",null,[d(o,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:"",up:"",style:{"z-index":"99999"}},{content:i((({close:l})=>[c("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:v((()=>{j(e,!1),l()}),["prevent"])},Zl,8,Yl),ea,c("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:v((()=>{(e=>{x.value=e.id,I.value=e.proposal,m.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},aa,8,la)])),_:2},1024)])],40,Wl)))),128)):V("",!0)])])]),r(m).isSweetAlertOpen?(s(),n(u,{key:0,isSweetAlertOpen:r(m).isSweetAlertOpen,title:r(m).title,subtitle:r(m).subtitle,btntext:r(m).btntext,onConfirm:T,onCancel:()=>r(m).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):V("",!0),r(_)?(s(),n(S,{key:1,costItemModal:r(_),proposalId:r(I),costItemId:r(x),previousItemIndex:r(P),previewCostItems:r(D),"onUpdate:modalHandler":a[0]||(a[0]=e=>{_.value=!1,x.value=""}),"onUpdate:OnSuccess":O},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):V("",!0)])}}}),ta=O(oa,[["__scopeId","data-v-4eb8bad8"]]),sa={class:"columns is-multiline"},na={class:"column is-12 is-flex space-between"},ia=c("div",null,[c("h1",{class:"title is-4"},"Proposal Worksheet")],-1),da={key:0,class:"column is-12"},ra={class:"tabs-wrapper column is-12 m-0"},ua={class:"tabs-inner mt-4"},ca={class:"tabs is-boxed"},pa=[c("span",null,"Worksheet",-1)],ma=[c("span",null,"Format",-1)],va=[c("span",null,"Preview",-1)],ba={key:0,class:"column is-12"},fa={key:0,class:"column is-12"},_a={class:"columns is-multiline"},ya=c("div",{class:"column is-12",style:{"text-align":"center"}},[c("h1",{class:"title is-4"},"Connect your clients to their projects"),c("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),ha={class:"column is-12"},ga={key:0,class:"column is-12"},Ia=e({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:p}){const f=e,h=l(),g=We(),I=a(!1),k=a(!1),C=a(!1),x=a("worksheet");_((()=>y((()=>import("./ckeditor-847d623f.js").then((e=>e.c))),["assets/ckeditor-847d623f.js","assets/index-6ec76f2c.js","assets/index-a879fc9d.css","assets/vue.runtime.esm-bundler-c71197d8.js"]).then((e=>e.default.component))));const D=async()=>{try{g.getProposalCostItems(f.proposalId)}catch(e){console.log(e)}};return o((async()=>{h.value=await y((()=>import("./ckeditor-e831084b.js").then((e=>e.c))),["assets/ckeditor-e831084b.js","assets/index-6ec76f2c.js","assets/index-a879fc9d.css"]).then((e=>e.default)),f.proposalId&&(D(),g.getProposalDetail(f.proposalId))})),U((()=>{g.clearProposalId()})),(e,l)=>{const a=b,o=t("Multiselect"),p=$,_=L,y=ta,h=P,g=$l,S=ze,T=ne;return s(),w("div",null,[c("div",sa,[c("div",na,[ia,c("div",null,[d(a,{size:"small",light:"",outlined:"",icon:"fas fa-cog",class:"mr-2",color:r(k)?"danger":"success",onClick:l[0]||(l[0]=e=>k.value=!r(k))},{default:i((()=>[m("Table")])),_:1},8,["color"]),d(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"info",onClick:l[1]||(l[1]=e=>C.value=!r(C))},{default:i((()=>[m("Import")])),_:1}),d(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"primary",onClick:l[2]||(l[2]=e=>I.value=!r(I))},{default:i((()=>[m("Add From")])),_:1}),d(a,{size:"small",light:"",outlined:"",color:"warning",onClick:l[3]||(l[3]=e=>I.value=!r(I))},{default:i((()=>[m("Add Item")])),_:1})])]),d(A,{class:"fade-slow",name:"fade-slow"},{default:i((()=>[r(k)?(s(),w("div",da,[d(_,{label:"Choose what to show to lead",class:"column is-12"},{default:i((({id:e})=>[d(p,null,{default:i((()=>[d(o,{modelValue:r(Z),"onUpdate:modelValue":l[4]||(l[4]=e=>u(Z)?Z.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:r(ee),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):V("",!0)])),_:1}),c("div",ra,[c("div",ua,[c("div",ca,[c("ul",null,[c("li",{class:M(["worksheet"===r(x)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[5]||(l[5]=F(v((e=>x.value="worksheet"),["prevent"]),["space"])),onClick:l[6]||(l[6]=e=>x.value="worksheet")},pa,32)],2),c("li",{class:M(["format"===r(x)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[7]||(l[7]=F(v((e=>x.value="format"),["prevent"]),["space"])),onClick:l[8]||(l[8]=e=>x.value="format")},ma,32)],2),c("li",{class:M(["preview"===r(x)?"is-active":"not-active"])},[c("a",{tabindex:"0",role:"button",onKeydown:l[9]||(l[9]=F(v((e=>x.value="preview"),["prevent"]),["space"])),onClick:l[10]||(l[10]=e=>x.value="preview")},va,32)],2)])])])]),d(A,{class:"fade-slow",name:"slide-x"},{default:i((()=>["worksheet"===r(x)?(s(),w("div",ba,[d(y,{columnsToShow:r(Z),proposalId:f.proposalId},null,8,["columnsToShow","proposalId"])])):V("",!0)])),_:1}),d(A,{class:"fade-slow",name:"slide-x"},{default:i((()=>["format"===r(x)?(s(),w("div",fa,[c("div",_a,[d(_,{label:"Choose what to show to lead",class:"column is-12"},{default:i((({id:e})=>[d(p,null,{default:i((()=>[d(o,{modelValue:r(Z),"onUpdate:modelValue":l[11]||(l[11]=e=>u(Z)?Z.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:r(ee),placeholder:"Add tags"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d(h,{class:"columns is-multiline m-0"},{default:i((()=>[ya,c("div",ha,[d(y,{columnsToShow:r(Z)},null,8,["columnsToShow"])])])),_:1})])):V("",!0)])),_:1}),d(A,{class:"fade-slow",name:"slide-x"},{default:i((()=>["preview"===r(x)?(s(),w("div",ga,[d(g,{proposalData:f.proposalData,columnsToShow:r(Z)},null,8,["proposalData","columnsToShow"])])):V("",!0)])),_:1})]),r(I)?(s(),n(S,{key:0,costItemModal:r(I),proposalId:f.proposalId,"onUpdate:modalHandler":l[12]||(l[12]=e=>I.value=!1),"onUpdate:OnSuccess":D},null,8,["costItemModal","proposalId"])):V("",!0),r(C)?(s(),n(T,{key:1,centeredActionsOpen:r(C),proposalId:f.proposalId,"onUpdate:modalHandler":l[13]||(l[13]=e=>C.value=!1),"onUpdate:OnSuccess":D},null,8,["centeredActionsOpen","proposalId"])):V("",!0)])}}}),wa=e=>(T("data-v-0317543a"),e=e(),j(),e),ka={class:"columns is-multiline"},Ca=wa((()=>c("div",{class:"column is-2"},null,-1))),Va={class:"column is-8"},Pa=wa((()=>c("div",{class:"column is-2"},null,-1))),xa=wa((()=>c("div",{class:"column is-2"},null,-1))),Da=wa((()=>c("div",{class:"column is-8"},[c("p",null," All the tasks will be generated and will start from the date you will put. ")],-1))),Sa=wa((()=>c("div",{class:"column is-2"},null,-1))),Ta=e({__name:"CreateProposalTasksModal",props:{createProposalTasksModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(e,{emit:l}){const t=e,p=R(),f=H(),_=a(""),y=a(!1),h=()=>{l("update:OnSuccess",null),l("closeModalHandler",!1)},g=async()=>{try{await f.post("/api/lead-proposal/create-tasks/",{start:_.value,proposal:t.proposalId});p.success("Tasks of this proposal are created in calendar successfully."),h()}catch(e){console.log(e),p.error("Something went wrong, please review the cost codes")}};return o((()=>{})),(e,l)=>{const a=z,o=$,p=L,f=b,I=E;return s(),n(I,{is:"form",open:t.createProposalTasksModal,title:"Generate Tasks",size:"small",actions:"center",onSubmit:v(g,["prevent"]),onClose:h},{content:i((()=>[c("div",ka,[Ca,c("div",Va,[d(p,{label:"Enter Tasks Starting Date"},{default:i((()=>[d(o,null,{default:i((()=>[d(a,{modelValue:r(_),"onUpdate:modelValue":l[0]||(l[0]=e=>u(_)?_.value=e:null),required:"",name:"startDate",type:"date"},null,8,["modelValue"])])),_:1})])),_:1})]),Pa,xa,Da,Sa])])),cancel:i((()=>[d(f,{light:"",onClick:l[1]||(l[1]=e=>h())},{default:i((()=>[m("Cancel")])),_:1})])),action:i((()=>[d(f,{loading:r(y),type:"submit",color:"info",light:"",raised:""},{default:i((()=>[m("Generate")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),ja=O(Ta,[["__scopeId","data-v-0317543a"]]);export{Ia as _,sl as a,ja as b,ze as c,dl as d,We as u};
