import{f as e,r as l,o as a,C as t,O as s,G as o,F as i,K as r,J as n,P as p,S as d,E as u,U as c,m,s as _,y as v,x as f,e as y,_ as b,av as g,D as h,N as C,L as w,X as x,V as k,A as V}from"./index-214b41f4.js";import{_ as I}from"./VModal.vue_vue_type_style_index_0_lang-f9c55c93.js";import{_ as S}from"./VField.vue_vue_type_script_setup_true_lang-18a0f1a4.js";import{_ as T}from"./VControl-dd3ab6ea.js";import{_ as A}from"./VInput.vue_vue_type_script_setup_true_lang-210450a9.js";import{u as j}from"./useAPI-6f812b7d.js";import{u as O}from"./useNotyf-55f225b6.js";import{d as P,u as D,_ as M,b as U,a as E,f as H,e as q}from"./CreateProposalTasksModal-bde8a5b0.js";import{_ as z}from"./SweetAlert.vue_vue_type_style_index_0_lang-9c698dac.js";import{_ as F}from"./VCollapse.vue_vue_type_style_index_0_lang-40cd9bb2.js";import{_ as N}from"./VTextarea.vue_vue_type_script_setup_true_lang-e79787ab.js";import{_ as $}from"./VRadio.vue_vue_type_style_index_0_lang-04e2e1dc.js";import{_ as L}from"./VMessage.vue_vue_type_style_index_0_lang-93e38e05.js";import{_ as R}from"./V-Snack.vue_vue_type_style_index_0_lang-43f78396.js";import{u as Y}from"./useDropdown-bfa3e483.js";import{u as B}from"./viewWrapper-9c0d69b3.js";import"./VLabel.vue_vue_type_script_setup_true_lang-b869aee1.js";import"./useVFieldContext-01c22f3c.js";import"./notyf-8d908ada.js";import"./useThemeColors-fc186e6a.js";import"./useSupportElement-683f6f68.js";import"./UnitAddUpdateModal.vue_vue_type_script_setup_true_lang-47a770dc.js";import"./VCheckbox.vue_vue_type_style_index_0_lang-b722320c.js";import"./VOption.vue_vue_type_style_index_0_lang-ae764e4c.js";import"./costItems-7db1ee49.js";import"./VIconButton-cb35e5c2.js";import"./company-f68b3c09.js";import"./VDropdown.vue_vue_type_style_index_0_lang-02d741a3.js";import"./VIcon.vue_vue_type_script_setup_true_lang-f3401f45.js";const G=d(e({__name:"CreateTemplateModal",props:{openCreateTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const u=e,c=j(),m=O();l([]);const _=l(null);l(!1);const v=l(""),f=()=>{d("update:modalHandler",!1)},y=async()=>{console.log(_);try{await c.post(`/api/lead-proposal/${u.proposalId}/create-template/`,{title:v.value});m.success("Template Create successfully!"),f()}catch(e){console.error("Error importing template:",e),m.error("Something went wrong, try again")}};return a((()=>{})),(e,l)=>{const a=A,d=T,c=S,m=p,_=I;return t(),s(_,{open:u.openCreateTemplate,size:"small",is:"form",title:"Create Template",actions:"right",onSubmit:n(y,["prevent"]),onClose:f},{content:o((()=>[i(c,{label:"Enter title to identify your saved template"},{default:o((()=>[i(d,null,{default:o((()=>[i(a,{required:"",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),type:"text",placeholder:" Template Title"},null,8,["modelValue"])])),_:1})])),_:1})])),action:o((()=>[i(m,{color:"primary",type:"submit",raised:""},{default:o((()=>[r("Confirm")])),_:1})])),cancel:o((()=>[i(m,{color:"primary",style:{display:"none"},raised:""},{default:o((()=>[r("Close")])),_:1})])),_:1},8,["open","onSubmit"])}}}),[["__scopeId","data-v-3fb59420"]]),K={class:"modal-form columns is-multiline"},X={class:"field column is-full"},J={class:"file"},Q={class:"file-label"},W={class:"file-cta"},Z=u("span",{class:"file-icon"},[u("i",{class:"fas fa-cloud-upload-alt"})],-1),ee={class:"file-label"},le=e({__name:"UploadEstimateFileModal",props:{openEstimatesModal:{type:Boolean},proposalId:{}},emits:["close:ModalHandler","update:OnSuccess"],setup(e,{emit:d}){const _=e,v=j(),f=O(),y=l(!1),b=()=>{d("close:ModalHandler",!1)},g=l(""),h=l(null),C=e=>{const l=e.target,a=l.files?.[0];l.value="",a&&(h.value=a,g.value=a.name)},w=async()=>{try{y.value=!0;const e=await v.post(`/api/lead-proposal/upload-estimates/${_.proposalId}/`,{file:h.value});f.success(`${e.data}`),g.value="",d("update:OnSuccess",null)}catch(e){console.log(e),f.error("File is not supported.")}finally{y.value=!1,b()}};return a((()=>{})),(e,l)=>{const a=T,d=S,v=p,f=I;return t(),s(f,{is:"form",open:_.openEstimatesModal,title:"Upload Estimates File",size:"medium",actions:"right",onSubmit:n(w,["prevent"]),onClose:b},{content:o((()=>[u("div",K,[u("div",X,[i(d,{grouped:""},{default:o((()=>[i(a,null,{default:o((()=>[u("div",J,[u("label",Q,[u("input",{onChange:C,class:"file-input",type:"file",name:"resume"},null,32),u("span",W,[Z,u("span",ee,c(m(g)?m(g):"Choose a file…"),1)])])])])),_:1})])),_:1})])])])),action:o((()=>[i(v,{type:"submit",disabled:!m(h),color:"primary",loading:m(y),raised:""},{default:o((()=>[r(" Create Estimates")])),_:1},8,["disabled","loading"])])),cancel:o((()=>[i(v,{color:"light",onClick:b,raised:""},{default:o((()=>[r("Close ")])),_:1})])),_:1},8,["open","onSubmit"])}}}),ae={class:"modal-form columns is-multiline"},te={class:"column is-12 is-flex space-between align-items-center bg-grey mx-3"},se={class:"is-flex"},oe={class:"is-flex"},ie={key:0,class:"rounded-loader mr-2"},re=u("i",{class:"fas fa-cloud-upload-alt","aria-hidden":"true"},null,-1),ne=u("i",{class:"fas fa-copy"},null,-1),pe=u("i",{class:"fas fa-envelope"},null,-1),de=u("i",{class:"fas fa-cloud-download-alt","aria-hidden":"true"},null,-1),ue=u("i",{class:"fas fa-trash"},null,-1),ce={key:0,class:"column is-12"},me={class:"field column is-6 mb-0"},_e=u("label",null,"Title: *",-1),ve={class:"control"},fe={class:"column is-6"},ye={class:"field column is-6"},be=u("label",null,"Approval Deadline *",-1),ge={class:"control"},he={class:"field column is-6"},Ce=u("label",null,"Attachments",-1),we=u("div",{class:"file"},[u("label",{class:"file-label"},[u("input",{class:"file-input",type:"file",name:"resume"}),u("span",{class:"file-cta"},[u("span",{class:"file-icon"},[u("i",{class:"fas fa-cloud-upload-alt"})]),u("span",{class:"file-label"}," Choose a file… ")])])],-1),xe={class:"field column is-12"},ke={class:"body-inner-content"},Ve={class:"field columns is-multiline mb-0"},Ie={class:"field column is-11 mb-0"},Se=u("label",{for:"",class:"label"},"Internal Notes",-1),Te={class:"field column is-11 mb-0"},Ae=u("label",{for:"",class:"label"},"Introductory Text",-1),je={class:"field column is-11 mb-0"},Oe=u("label",{for:"",class:"label"},"Closing Text",-1),Pe={class:"column is-12"},De=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:n}){const d=e,V=l();Y(V);const I=_(),A=P(),B=D(),K=O(),X=j(),J=v(),Q=f(),W=l(!1),Z=l(!1),ee=l([]),De=l({}),Me=l(!1),Ue=l(""),Ee=l(!1),He=l(!1),qe=l(""),ze=l(""),Fe=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Ne=l(!1),$e=y((()=>b((()=>import("./ckeditor-d8ca98be.js").then((e=>e.c))),["assets/ckeditor-d8ca98be.js","assets/index-214b41f4.js","assets/index-bee656d3.css","assets/vue.runtime.esm-bundler-e020e3d8.js"]).then((e=>e.default.component)))),Le={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},Re=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],Ye=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Be=l({id:"",title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",is_task_created:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),Ge=async()=>{try{const e=await X.get(`/api/lead-proposal/${J.params.id}/detail/`);Be.value=e.data,B.getProposalCostItems(J.params.id)}catch(e){console.log(e)}},Ke=async()=>{try{Ee.value=!0;await X.delete(`/api/lead-proposal/${ze.value}/`);Ye.value.isSweetAlertOpen=!1,K.success("Proposal delete successfully"),Q.go(-1)}catch(e){K.error(` ${e}, Proposal`),K.error("Something went wrong please try later")}finally{Ee.value=!1}},Xe=async()=>{try{Ee.value=!0;await X.patch(`/api/lead-proposal/${J.params.id}/`,{status:qe.value});Ge(),K.success(`You have ${qe.value} this proposal.`),Ye.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{Ee.value=!1}},Je=()=>{De.value=B.leadProposalFormData,ee.value.push(B.leadProposalFormData),Ne.value=!Ne.value},Qe=()=>{Z.value=!0},We=()=>{(d.proposalId||J.params.id)&&(Ge(),B.getProposalDetail(d.proposalId||J.params.id))};return a((async()=>{I.value=await b((()=>import("./ckeditor-f4e2d063.js").then((e=>e.c))),["assets/ckeditor-f4e2d063.js","assets/index-214b41f4.js","assets/index-bee656d3.css"]).then((e=>e.default)),We(),A.getCostCodesHandler()})),(e,l)=>{const a=R,n=p,_=L,v=$,f=T,y=S,b=N,V=F,A=M,j=z,O=U,P=E,D=le,Y=G,B=g("tooltip");return t(),h(k,null,[u("div",ae,[u("div",te,[u("div",se,[m(Be).is_task_created?(t(),s(a,{key:0,title:"Calendar Tasks Created ",white:"",class:"ml-2",color:"info",icon:"fas fa-calendar-check"})):C("",!0),"approved"!=m(Be).status?(t(),s(n,{key:1,onClick:l[0]||(l[0]=e=>{return l="approved",qe.value=l,void(Ye.value={title:`${qe.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==qe.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==qe.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var l}),size:"small",class:"ml-2",light:"",outlined:"",color:"info",raised:""},{default:o((()=>[r(" Approve Proposal ")])),_:1})):(t(),s(n,{key:2,light:"",size:"small",color:"primary",class:"ml-1 mt-1",icon:"fas fa-check-circle"},{default:o((()=>[r(" Approved ")])),_:1})),m(Be).is_task_created||"approved"!=m(Be).status?C("",!0):(t(),s(n,{key:3,size:"small",class:"mr-2",light:"",outlined:"",color:"success",raised:"",onClick:l[1]||(l[1]=e=>{return l=m(J).params.id,Ue.value=l,void(Me.value=!0);var l})},{default:o((()=>[r(" Generate Tasks ")])),_:1}))]),u("div",oe,[m(He)||3==m(H)?(t(),h("div",ie)):C("",!0),w((t(),s(n,{size:"small",class:"mr-2",outlined:"",color:"dark",raised:"",onClick:Qe},{default:o((()=>[re])),_:1})),[[B,"Upload File To Create Estimates",void 0,{rounded:!0,dark:!0,bottom:!0}]]),w((t(),s(n,{size:"small",class:"mr-2",light:"",outlined:"",onClick:l[2]||(l[2]=e=>W.value=!m(W)),color:"primary",raised:""},{default:o((()=>[ne])),_:1})),[[B,"Create Template Of This Proposal",void 0,{rounded:!0,primary:!0,bottom:!0}]]),w((t(),s(n,{size:"small",class:"mr-2",light:"",outlined:"",onClick:Je,color:"warning",raised:""},{default:o((()=>[pe])),_:1})),[[B,"Attach in email",void 0,{rounded:!0,warning:!0,bottom:!0}]]),w((t(),s(n,{size:"small",outlined:"",light:"",class:"mr-2",onClick:l[3]||(l[3]=e=>m(q)(m(Be))),color:"info",raised:""},{default:o((()=>[de])),_:1})),[[B,"Attach in email",void 0,{rounded:!0,info:!0,bottom:!0}]]),w((t(),s(n,{size:"small",class:"mr-2",light:"",outlined:"",onClick:l[4]||(l[4]=e=>{return l=m(Be).id,ze.value=l,void(Fe.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),color:"danger",raised:""},{default:o((()=>[ue])),_:1})),[[B,"Delete Proposal",void 0,{rounded:!0,danger:!0,bottom:!0}]])])]),m(Be).client_note&&"review"==m(Be).status?(t(),h("div",ce,[i(_,{color:"warning"},{default:o((()=>[r(c(m(Be).client_note),1)])),_:1})])):C("",!0),u("div",me,[_e,u("div",ve,[w(u("input",{type:"text",name:"firstName","onUpdate:modelValue":l[5]||(l[5]=e=>m(Be).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[x,m(Be).title]])])]),u("div",fe,[i(y,{class:"m-0 p-0",label:"Type"},{default:o((()=>[i(f,null,{default:o((()=>[i(v,{modelValue:m(Be).type,"onUpdate:modelValue":l[6]||(l[6]=e=>m(Be).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),i(v,{modelValue:m(Be).type,"onUpdate:modelValue":l[7]||(l[7]=e=>m(Be).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),i(v,{modelValue:m(Be).type,"onUpdate:modelValue":l[8]||(l[8]=e=>m(Be).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",ye,[be,u("div",ge,[w(u("input",{type:"date",name:"firstName","onUpdate:modelValue":l[9]||(l[9]=e=>m(Be).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[x,m(Be).approval_deadline]])])]),u("div",he,[Ce,i(y,{grouped:""},{default:o((()=>[i(f,null,{default:o((()=>[we])),_:1})])),_:1})]),u("div",xe,[i(V,{items:Re,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":o((e=>[u("div",ke,[u("div",Ve,[u("div",Ie,[Se,i(y,null,{default:o((()=>[i(f,null,{default:o((()=>[i(b,{modelValue:m(Be).internalNotes,"onUpdate:modelValue":l[10]||(l[10]=e=>m(Be).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",Te,[Ae,m(I)?(t(),s(m($e),{key:0,modelValue:m(Be).introductoryText,"onUpdate:modelValue":l[11]||(l[11]=e=>m(Be).introductoryText=e),editor:m(I),config:Le},null,8,["modelValue","editor"])):C("",!0)]),u("div",je,[Oe,m(I)?(t(),s(m($e),{key:0,modelValue:m(Be).closingText,"onUpdate:modelValue":l[12]||(l[12]=e=>m(Be).closingText=e),editor:m(I),config:Le},null,8,["modelValue","editor"])):C("",!0)])])])])),_:1})]),u("div",Pe,[i(A,{proposalData:m(Be),proposalId:m(Be).id},null,8,["proposalData","proposalId"])]),m(Ye).isSweetAlertOpen?(t(),s(j,{key:1,isSweetAlertOpen:m(Ye).isSweetAlertOpen,title:m(Ye).title,subtitle:m(Ye).subtitle,btntext:m(Ye).btntext,onConfirm:Xe,onCancel:()=>m(Ye).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):C("",!0),m(Fe).isSweetAlertOpen?(t(),s(j,{key:2,isSweetAlertOpen:m(Fe).isSweetAlertOpen,title:m(Fe).title,subtitle:m(Fe).subtitle,btntext:m(Fe).btntext,onConfirm:Ke,onCancel:()=>m(Fe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):C("",!0),m(Me)?(t(),s(O,{key:3,createProposalTasksModal:m(Me),proposalId:m(Ue),onCloseModalHandler:l[13]||(l[13]=e=>Me.value=!1)},null,8,["createProposalTasksModal","proposalId"])):C("",!0),m(Ne)?(t(),s(P,{key:4,proposalSenderModal:m(Ne),selectedProposalsIds:m(ee),proposalData:m(De),"onUpdate:modalHandler":l[14]||(l[14]=e=>{Ne.value=!1,ee.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData"])):C("",!0)]),m(Z)?(t(),s(D,{key:0,openEstimatesModal:m(Z),proposalId:m(J).params.id,"onClose:ModalHandler":l[15]||(l[15]=e=>Z.value=!1),"onUpdate:OnSuccess":We},null,8,["openEstimatesModal","proposalId"])):C("",!0),m(W)?(t(),s(Y,{key:1,proposalId:m(J).params.id,openCreateTemplate:m(W),"onUpdate:OnSuccess":l[16]||(l[16]=()=>{(d.proposalId||m(J).params.id)&&Ge()}),"onUpdate:modalHandler":l[17]||(l[17]=e=>W.value=!1)},null,8,["proposalId","openCreateTemplate"])):C("",!0)],64)}}}),Me=e({__name:"[id]",setup:e=>(B().setPageTitle("Lead Proposals"),V({title:"Lead Proposals - Ibex"}),(e,l)=>(t(),h("div",null,[i(De)])))});export{Me as default};
