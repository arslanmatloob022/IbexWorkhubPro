import{_ as e}from"./VMessage.vue_vue_type_style_index_0_lang-57696cf8.js";import{f as a,r as o,v as s,x as l,y as t,b as n,o as r,z as i,A as u,B as d,C as c,D as p,E as m,m as f,F as h,G as v,H as y,I as g,J as _,K as b,k as w,L as k,M as x,N as j,O as C,P as V,Q as I,R as z,S}from"./index-5437c3ff.js";import{_ as L}from"./VField.vue_vue_type_script_setup_true_lang-88afe542.js";import{_ as P}from"./VControl-99928d1c.js";import{_ as A}from"./VInput.vue_vue_type_script_setup_true_lang-b86e2a7b.js";import{_ as U}from"./VLabel.vue_vue_type_script_setup_true_lang-2653a3df.js";import{_ as D}from"./AnimatedLogo-d158db26.js";import{u as E}from"./useNotyf-19e6534b.js";import{u as F,a as K}from"./useAPI-15ad727f.js";import{u as T}from"./layoutSwitcher-30f7a69f.js";import{u as W}from"./company-c251fd9d.js";import{u as R}from"./supportElements-e2c3cdf4.js";import"./useVFieldContext-0b764790.js";import"./notyf-ebf58a6a.js";import"./useThemeColors-fa4464c7.js";import"./useSupportElement-64af5555.js";const H=e=>(I("data-v-43054081"),e=e(),z(),e),M={class:"modern-login"},N=H((()=>m("div",{class:"underlay h-hidden-mobile h-hidden-tablet-p"},null,-1))),q={class:"columns is-gapless is-vcentered"},B={style:{overflow:"hidden"},class:"column is-relative is-8 h-hidden-mobile h-hidden-tablet-p"},J={style:{overflow:"hidden",display:"flex","justify-content":"center","align-items":"center"},class:"hero is-image"},G=["src"],O={style:{"z-index":"99999",overflow:"hidden"},class:"column is-4 is-relative"},Q={class:"top-tools"},X=H((()=>m("h3",{style:{"font-size":"1.8rem","font-weight":"600","margin-left":"1rem",color:"#777"}},[m("span",{style:{color:"#2aac8e","font-size":"1.9rem"}},"Ibex"),b(" WorkHub ")],-1))),Y=["checked"],$=H((()=>m("span",null,null,-1))),Z={class:"is-form"},ee={class:"is-form-inner"},ae=[H((()=>m("h2",null,"Sign In",-1))),H((()=>m("p",null,"Welcome back to your account.",-1)))],oe=["onSubmit"],se=[H((()=>m("i",{class:"iconify","data-icon":"feather:eye","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],le=[H((()=>m("i",{class:"iconify","data-icon":"feather:eye-off","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],te={class:"button-wrap has-help"},ne=H((()=>m("span",null," To go to the account. ",-1))),re={key:0,class:"recover-text"},ie={class:"button-wrap"},ue=S(a({__name:"index",setup(a){const I=T(),z=o("login"),S=o(!1),H=s(),ue=l(),de=t(),ce=E(),pe=F(),me=W(),fe=n(),he=R(),ve=de.query.redirect,ye=o(""),ge=o(""),_e=o(""),be=o(!1),we=o(!1),ke=o(!1),xe=async()=>{if(!S.value){S.value=!0;try{const e=await K.post("https://api.ibexworkhub.com/api/auth/login/",{email:ye.value,password:ge.value});console.log("resp",e.data);const a=e.data.token,o=e.data.user;fe.setToken(a),fe.setUser(o),he.getUserPermissions(o.id),je()}catch(e){S.value=!1,ce.error("Invalid Credentials, Sign In")}finally{S.value=!1}}},je=()=>{me.loadCompany(),I.setDynamicLayoutId("sideblock-default"),ce.success(`Welcome back, ${fe.user.username}`),ve?ue.push(ve):(S.value=!1,"admin"==fe.user.role?ue.push("/sidebar/dashboard"):"worker"==fe.user.role?ue.push("/sidebar/worker/tasks"):"manager"==fe.user.role?ue.push("/sidebar/manager/projects"):"contractor"==fe.user.role?ue.push("/sidebar/contractor/projects"):"client"==fe.user.role&&ue.push("/sidebar/client/projects"))},Ce=()=>{be.value=!be.value};return r((()=>{})),i((()=>{const e=window.location.search,a=new URLSearchParams(e);console.log("urlDAta",window.location.search);const o=a.get("token");o?fe.setToken(o):console.log("Invalid token")})),u({title:"Login - Ibex"}),(a,o)=>{const s=D,l=d("RouterLink"),t=U,n=A,r=P,i=L,u=V,I=e;return c(),p("div",M,[N,m("div",q,[m("div",B,[m("div",J,[m("img",{style:{transform:"translateY(-6%)",width:"700px",height:"auto"},src:f(H).isDark?"/logos/ibexwhite.png":"/logos/IbexFaviconDark.png",alt:""},null,8,G)])]),m("div",O,[m("div",Q,[h(l,{to:"/auth/login",class:"top-logo"},{default:v((()=>[h(s,{style:{width:"38px",height:"38px"}}),X])),_:1}),m("label",{class:"dark-mode",tabindex:"0",role:"button",onKeydown:o[1]||(o[1]=y(_((e=>e.target.click()),["prevent"]),["space"]))},[m("input",{"data-cy":"dark-mode-toggle",type:"checkbox",checked:!f(H).isDark,onChange:o[0]||(o[0]=(...e)=>f(H).onChange&&f(H).onChange(...e))},null,40,Y),$],32)]),m("div",Z,[m("div",ee,[m("div",{class:g(["form-text",["login"!==f(z)&&"is-hidden"]])},ae,2),m("form",{method:"post",novalidate:"","data-cy":"login-form",class:g([["login"!==f(z)&&"is-hidden"],"login-wrapper"]),onSubmit:_(xe,["prevent"])},[h(i,null,{default:v((()=>[h(r,{icon:"lnil lnil-envelope autv-icon"},{default:v((()=>[h(t,{class:"auth-label"},{default:v((()=>[b(" Email Address ")])),_:1}),h(n,{modelValue:f(ye),"onUpdate:modelValue":o[2]||(o[2]=e=>w(ye)?ye.value=e:null),"data-cy":"email-input",type:"email",autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),h(i,null,{default:v((()=>[h(r,{icon:"lnil lnil-lock-alt autv-icon",style:{position:"relative"}},{default:v((()=>[k(m("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:Ce},se,512),[[x,!f(be)]]),k(m("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:Ce},le,512),[[x,f(be)]]),h(t,{class:"auth-label"},{default:v((()=>[b("Password")])),_:1}),h(n,{modelValue:f(ge),"onUpdate:modelValue":o[3]||(o[3]=e=>w(ge)?ge.value=e:null),"data-cy":"password-input",type:f(be)?"text":"password",autocomplete:"current-password"},null,8,["modelValue","type"])])),_:1})])),_:1}),h(i,null,{default:v((()=>[h(r,{class:"is-flex"},{default:v((()=>[m("a",{tabindex:"0",role:"button",onKeydown:o[4]||(o[4]=y(_((e=>z.value="forgot-password"),["prevent"]),["space"])),onClick:o[5]||(o[5]=e=>z.value="forgot-password")}," Forgot Password? ",32)])),_:1})])),_:1}),m("div",te,[h(u,{id:"login-button",loading:f(S),color:"primary",type:"submit",size:"big",rounded:"",raised:"",bold:""},{default:v((()=>[b(" Confirm ")])),_:1},8,["loading"]),ne])],42,oe),m("form",{method:"post",novalidate:"",class:g([["forgot-password"!==f(z)&&"is-hidden"],"login-wrapper"]),onSubmit:o[12]||(o[12]=_((()=>{}),["prevent"]))},[f(we)?j("",!0):(c(),p("p",re," Enter your email and click on the confirm button to reset your password. We'll send you an email detailing the steps to complete the procedure. ")),f(we)?(c(),C(I,{key:1,color:"primary",class:"is-flex",closable:"",onClose:o[6]||(o[6]=e=>we.value=!1)},{default:v((()=>[b(" A password reset request has been sent to your email. Please check your inbox to change your password. ")])),_:1})):j("",!0),f(ke)?(c(),C(I,{key:2,color:"danger",class:"is-flex mt-4",closable:"",onClose:o[7]||(o[7]=e=>ke.value=!1)},{default:v((()=>[b(" Please enter valid email address. ")])),_:1})):j("",!0),h(i,null,{default:v((()=>[h(r,{icon:"lnil lnil-envelope autv-icon"},{default:v((()=>[h(t,{class:"auth-label"},{default:v((()=>[b(" Email Address ")])),_:1}),h(n,{type:"email",modelValue:f(_e),"onUpdate:modelValue":o[8]||(o[8]=e=>w(_e)?_e.value=e:null),autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),h(i,null,{default:v((()=>[h(r,{class:"is-flex"},{default:v((()=>[m("a",{tabindex:"0",role:"button",onKeydown:o[9]||(o[9]=y(_((e=>z.value="login"),["prevent"]),["space"])),onClick:o[10]||(o[10]=e=>z.value="login")}," Login ? ",32)])),_:1})])),_:1}),m("div",ie,[h(u,{loading:f(S),color:"primary",size:"big",type:"submit",lower:"",rounded:"",solid:"",onClick:o[11]||(o[11]=e=>(async e=>{try{S.value=!0,await pe.post("/api/auth/forget-password/",{email:e}),we.value=!0}catch(a){ke.value=!0,ce.error("Please enter your valid email address")}finally{S.value=!1}})(f(_e)))},{default:v((()=>[b(" Confirm ")])),_:1},8,["loading"])])],34)])])])])])}}}),[["__scopeId","data-v-43054081"]]);export{ue as default};
