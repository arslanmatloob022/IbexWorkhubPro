import{_ as e}from"./UpdateTask.vue_vue_type_script_setup_true_lang-25a3971f.js";import{_ as t}from"./VAvatar.vue_vue_type_style_index_0_lang-89006900.js";import{e as a,r as l,w as s,o,M as r,y as n,z as i,C as c,A as d,B as u,l as p,j as v,P as m,O as g,K as _,J as y,Q as f,R as h,H as j,E as k,ad as w,W as b,X as x,L as C,v as P,ak as D}from"./index-ed878baa.js";import{_ as S}from"./VDropdown.vue_vue_type_style_index_0_lang-c405b2c5.js";import{_ as I}from"./VField.vue_vue_type_script_setup_true_lang-63cc4033.js";import{_ as V}from"./VControl-71751153.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-8eedbc96.js";import{F as A}from"./FullCalendar-671d61ae.js";import{i as H}from"./index-61000f42.js";import{i as M}from"./index-f1b5d68e.js";import{u as O}from"./userSession-3fb9a025.js";import{u as E}from"./useNotyf-51dcaca9.js";import{u as F}from"./useAPI-4dbd45d9.js";import{u as L}from"./viewWrapper-5df11b72.js";import{b as U}from"./route-block-83d24a4e.js";import"./VModal.vue_vue_type_style_index_0_lang-f6e4e1bc.js";import"./VTextarea.vue_vue_type_script_setup_true_lang-6682908c.js";import"./useVFieldContext-9a447149.js";import"./VOption.vue_vue_type_style_index_0_lang-ee8b4bf6.js";import"./VLabel.vue_vue_type_script_setup_true_lang-cb6c0e84.js";import"./useSupportElement-c53eaf20.js";import"./VIcon.vue_vue_type_script_setup_true_lang-63563bed.js";import"./useDropdown-c85775b5.js";import"./notyf-fd8b7ffd.js";import"./useThemeColors-be929954.js";const W=e=>(b("data-v-8210f582"),e=e(),x(),e),z=["onSubmit"],$={class:"datatable-toolbar"},B={key:0,class:"rota-loader"},N=[W((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-coins"})],-1))),W((()=>c("div",{class:"meta"},[c("span",null,"All"),c("span",null,"All projects owned by company")],-1)))],R=[W((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-dollar-up"})],-1))),W((()=>c("div",{class:"meta"},[c("span",null,"Active"),c("span",null,"Projects that are in progress")],-1)))],Y=[W((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-bank"})],-1))),W((()=>c("div",{class:"meta"},[c("span",null,"Pending"),c("span",null,"Projects listed but not started")],-1)))],K=W((()=>c("hr",{class:"dropdown-divider"},null,-1))),J=[W((()=>c("div",{class:"icon"},[c("i",{class:"lnil lnil-wallet-alt-1"})],-1))),W((()=>c("div",{class:"meta"},[c("span",null,"Completed"),c("span",null,"Projects that are done")],-1)))],Q={style:{height:"100%",position:"relative"}},X={key:0,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px",color:"black"}},q=["onClick"],G={style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},Z={key:0,class:"avatars"},ee=["src","onClick","title","data-bs-original-title"],te={class:"v-popover-content is-text"},ae={class:"popover-head"},le={class:"dark-inverted"},se={class:"popover-body"},oe=["onClick","data-bs-original-title","title"],re=["data-bs-original-title","title"],ne={key:1,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},ie=C(a({__name:"ProjectManagerCalendar",setup(a){const b=F(),x=l(null),C=O(),P=E(),D=l(!1);l(!1),l("");const L=l(!1),U=l("all"),W=l(""),ie=l([]),ce=l([]),de=l([]),ue=l(0),pe=l(""),ve=l(""),me=l(""),ge=l(0),_e=l(!0),ye=l(!1),fe=l(""),he=l({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),je=l({plugins:[H,M],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineMonth",height:"auto",themeSystem:"cerulean",resourceAreaWidth:"20%",resourcesInitiallyExpanded:!1,selectable:!0,headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}}},resourceAreaHeaderContent:"Projects",resources:[],eventDrop:e=>{e.revert()},eventResize:e=>{ke(e)},select:e=>{"contractor"!==C.user.role&&("manager"!==C.user.role||e.resource.extendedProps.managers.includes(C.user.id))&&(console.log("start date",e.startStr),fe.value=0,ue.value=e.resource.extendedProps.project,ve.value=e.startStr,me.value=e.endStr,ye.value=!0)}}),ke=e=>{if(console.warn("inside func"),console.log("inside ",C.user.role),"contractor"===C.user.role)return void e.revert();if("manager"===C.user.role&&!e.event.extendedProps.managers.includes(C.user.id))return e.revert(),void P.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);console.log("resource ids",e.event),console.log("event",e.event),e.event.id==e.event._def.publicId&&confirm(`Are you sure you want to update the project ${e.event.title} date from ${t} to ${a}?`)?xe(e.event.id,t,a):e.revert()},we=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},be=e=>{window.location.hash="",ge.value=e.id,pe.value=e.username,window.location.hash="workerCalendar"},xe=async(e,t,a)=>{try{await b.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),P.success("Task updated successfully")}catch(l){P.error("Something went wrong"),console.log(l)}},Ce=e=>{const t=de.value.find((t=>t.id===e));return t?t.managers:[]},Pe=()=>{console.log(de.value);const e=[...ie.value.map((e=>({id:e.id,resourceId:e.id,project:e.project,start:e.startDate,end:we(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:he[e.status],managers:Ce(e.project)}))),...de.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color})))],t=de.value.map((e=>{const t=ie.value.filter((t=>t.project===e.id)).map((e=>({id:e.id,title:e.title,project:e.project,initiallyExpanded:!0})));return{id:e.id,title:e.title,eventBackgroundColor:e.color,project:e.id,initiallyExpanded:!0,children:t}}));console.log("proejrct rources"),console.log(t),je.value.resources=t,je.value.events=e},De=()=>{if(console.log("func called",U.value),"all"!==U.value){let e=de.value.filter((e=>e.status===U.value));ce.value=e}else ce.value=de.value;W.value&&(ce.value=de.value.filter((e=>e.title.toLowerCase().includes(W.value.toLowerCase())))),je.value.resources=ce.value,console.log(ce.value),console.log(ce.value.length)},Se=async()=>{try{D.value=!0,console.log("inside all projects func");const e=await b.get("/api/project/projects",{});de.value=e.data,ce.value=e.data,console.log("scratch projects",de.value),D.value=!1}catch(e){console.error(e),de.value=[],D.value=!1}},Ie=async()=>{try{D.value=!0;const e=await b.get("/api/task",{});ie.value=e.data}catch(e){ie.value=[]}finally{D.value=!1}};s(U,((e,t)=>{De()}));const Ve=async()=>{await Se(),await Ie(),Pe()};return o((async()=>{await Promise.all([Se(),Ie()]),Pe(),console.log("projects",je.value),_e.value=!0})),(a,l)=>{const s=T,o=V,b=I,H=S,M=k,O=w,E=t,F=r("Tippy"),ie=e;return n(),i("div",null,[c("form",{onSubmit:_(De,["prevent"])},[c("div",$,[d(b,{elevated:""},{default:u((()=>[d(o,{icon:"fas fa-search"},{default:u((()=>[d(s,{type:"text",placeholder:"Search projects...",modelValue:p(W),"onUpdate:modelValue":l[0]||(l[0]=e=>v(W)?W.value=e:null),onInput:l[1]||(l[1]=e=>De()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),p(D)?(n(),i("div",B)):m("",!0),d(O,null,{default:u((()=>[d(H,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:u((()=>[c("a",{onClick:l[2]||(l[2]=()=>{De(),U.value="all"}),class:g(["dropdown-item is-media","all"==p(U)])},N,2),c("a",{href:"#",onClick:l[3]||(l[3]=()=>{De(),U.value="active"}),class:g(["active"==p(U),"dropdown-item is-media"])},R,2),c("a",{onClick:l[4]||(l[4]=()=>{De(),U.value="pending"}),class:g(["pending"==p(U),"dropdown-item is-media"])},Y,2),K,c("a",{onClick:l[5]||(l[5]=()=>{De(),U.value="completed"}),class:g(["completed"==p(U),"dropdown-item is-media"])},J,2)])),_:1}),d(M,{elevated:"",raised:"",color:"dark",onClick:l[6]||(l[6]=e=>(L.value=!L.value,void document.getElementById("fullCalendarView")))},{default:u((()=>[c("i",{class:g(p(L)?"fa fa-compress":"fa fa-expand")},null,2)])),_:1})])),_:1})])],40,z),d(p(A),{options:p(je),ref_key:"calendarRef",ref:x},{eventContent:u((e=>[c("div",Q,["background"==e.event?.display?(n(),i("p",X," project: "+y(e.event.title),1)):(n(),i("div",{key:1,onClick:t=>{return a=e,console.log(a.event),void("contractor"!==C.user.role&&("manager"!==C.user.role||a.event.extendedProps.managers.includes(C.user.id)?(ve.value="",ye.value=!0,ue.value=0,fe.value=a.event.id):P.error("You can modify the task only for the projects for which you are a manager")));var a},style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},[c("p",G,[(n(!0),i(f,null,h(e.event.extendedProps?.workers,(e=>(n(),i("span",{key:e.id},y(e.username)+", ",1)))),128))]),e.event.extendedProps?.workers?.length?(n(),i("div",Z,[(n(!0),i(f,null,h(e.event.extendedProps.workers,(t=>(n(),i("div",{class:"avatars__item",key:t.id},[d(F,null,{content:u((()=>[c("div",te,[c("div",ae,[d(E,{picture:t.avatar,size:"small"},null,8,["picture"]),c("h4",le,y(t.username?t.username:""),1)]),c("div",se,[c("p",null,y(e.event?.title),1)])])])),default:u((()=>[t.avatar?(n(),i("img",{key:0,src:t.avatar,alt:"",onClick:e=>be(t),title:t.username,"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi"},null,8,ee)):m("",!0)])),_:2},1024),0==e.event.extendedProps?.workers?.length?(n(),i("div",{key:0,onClick:e=>be(t),"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[c("h6",{class:"mb-0",style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username},y(t.username?t.username.slice(0,2):"AA"),9,re)],8,oe)):m("",!0),c("p",null,y(t.username),1)])))),128))])):m("",!0),e.event.extendedProps?.workers?.length||"background"==e.event?.display?m("",!0):(n(),i("p",ne," No worker is assigned yet "))],8,q))])])),_:1},8,["options"]),p(ye)?(n(),j(ie,{key:0,isOpen:p(ye),taskIdSelected:p(fe),projectID:p(ue),startDate:p(ve),endDate:p(me),"onUpdate:OnSuccess":Ve,"onUpdate:modalHandler":l[7]||(l[7]=()=>{ye.value=!1,console.log("Falling in main")})},null,8,["isOpen","taskIdSelected","projectID","startDate","endDate"])):m("",!0)])}}}),[["__scopeId","data-v-8210f582"]]),ce={class:"page-content-inner"},de=c("div",{class:"lifestyle-dashboard-bg has-top-nav"},null,-1),ue=a({__name:"index",setup:e=>(L().setPageTitle("Manage Projects"),P({title:"Manage Projects"}),(e,t)=>{const a=ie;return n(),i("div",ce,[(n(),j(D,{to:"[data-teleport-bg]"},[de])),d(a)])})});"function"==typeof U&&U(ue);export{ue as default};
