import{_ as e,b as a,c as l,e as t,f as s,g as o,a as i}from"./estimatesScripts-65cc6749.js";import{_ as n}from"./SweetAlert.vue_vue_type_style_index_0_lang-b468073a.js";import{_ as r,a as d}from"./CreateProposalTasksModal-070720d7.js";import{_ as p}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-d7f77b71.js";import{_ as u}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-f6e5226b.js";import{_ as c,c as m}from"./VFlexTable.vue_vue_type_style_index_0_lang-54a6828f.js";import{_ as v}from"./VDropdown.vue_vue_type_style_index_0_lang-7860900b.js";import{_}from"./VTag.vue_vue_type_style_index_0_lang-1c3765a2.js";import{_ as f}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-0f412216.js";import{e as y,v as k,x as h,r as g,Z as b,o as w,B as C,C as x,D as P,E as A,F as S,K as I,W as O,l as j,j as M,J as T,N as U,M as $,U as L,V,aR as D,O as E,T as H}from"./index-70b05a5f.js";import{_ as F}from"./VControl-0234c21a.js";import{_ as N,a as z}from"./search-4-dark-2b5b440c.js";import{u as B}from"./useAPI-ebd6fc63.js";import{u as J}from"./useNotyf-2c361439.js";import{f as R}from"./useSupportElement-300af3cd.js";const Y={class:"flex-toolbar is-reversed is-flex space-between my-4"},K={key:0},W={key:1,class:"flex-list-wrapper flex-list-v2"},Z={class:"item-name dark-inverted"},q={class:"item-meta"},G=P("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),Q={class:"item-name dark-inverted"},X={class:"light-text"},ee=["onClick"],ae=[P("div",{class:"icon"},[P("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),P("div",{class:"meta"},[P("span",null,"Edit"),P("span",null,"Edit Proposal Details")],-1)],le=["onClick"],te=[P("div",{class:"icon"},[P("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),P("div",{class:"meta"},[P("span",null,"Preview"),P("span",null,"Preview proposal detail")],-1)],se=["onClick"],oe=[P("div",{class:"icon"},[P("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),P("div",{class:"meta"},[P("span",null,"Create Tasks"),P("span",null,"Create tasks in chart ")],-1)],ie=P("hr",{class:"dropdown-divider"},null,-1),ne=["onClick"],re=[P("div",{class:"icon"},[P("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),P("div",{class:"meta"},[P("span",null,"Mark Approved"),P("span",null,"Mark Proposal As Approved")],-1)],de=["onClick"],pe=[P("div",{class:"icon"},[P("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),P("div",{class:"meta"},[P("span",null,"Delete"),P("span",null,"Delete from list")],-1)],ue=P("img",{class:"light-image",src:N,alt:""},null,-1),ce=P("img",{class:"dark-image",src:z,alt:""},null,-1),me=y({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},setup(y){const N=y,z=k();h();const me=B(),ve=J(),_e=g(!1),fe=g([]),ye=g(!1),ke=g(""),he=g(!1),ge=g(!1),be=g(""),we=g("");g(N.activeTab);const Ce=g({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),xe=g({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),Pe=async()=>{try{_e.value=!0;await me.delete(`/api/lead-proposal/${we.value}/`);ve.success("Proposal delete successfully"),Ue()}catch(e){ve.error(` ${e}, Proposal`),ve.error("Something went wrong please try later")}finally{_e.value=!1,Ce.value.isSweetAlertOpen=!1}},Ae={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},Se=b((()=>{if(be.value){const e=new RegExp(be.value,"i");return fe.value.filter((a=>a.title.match(e)||a.approval_deadline.match(e)))}return fe.value})),Ie=g(!1),Oe=g(!1),je=g(!1),Me=g(""),Te=e=>{z.push(`/sidebar/dashboard/proposals/${e}`)},Ue=()=>{1==N.allProposal?(async()=>{try{_e.value=!0;const e=await me.get("/api/lead-proposal/");fe.value=e.data}catch(e){ve.error(` ${e}, Lead`)}finally{_e.value=!1}})():N.leadId&&(async()=>{try{_e.value=!0;const e=await me.get(`/api/lead-proposal/by-project/${N.leadId}/`);fe.value=e.data}catch(e){ve.error(` ${e}, Lead`)}finally{_e.value=!1}})()};return w((()=>{Ue()})),(y,k)=>{const h=F,g=E,b=f,w=m,z=_,B=v,J=c,$e=u,Le=p,Ve=r,De=e,Ee=a,He=d,Fe=n,Ne=l;return C(),x("div",null,[P("div",Y,[A(h,{icon:"feather:search"},{default:S((()=>[I(P("input",{"onUpdate:modelValue":k[0]||(k[0]=e=>M(be)?be.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[O,j(be)]])])),_:1}),P("div",null,[A(g,{color:"primary",onClick:k[1]||(k[1]=e=>ye.value=!j(ye)),icon:"fas fa-plus"},{default:S((()=>[T("Lead Proposal ")])),_:1}),N.leadId?(C(),U(g,{key:0,color:"warning",class:"ml-2",onClick:k[2]||(k[2]=e=>{ge.value=!0}),icon:"fas fa-cogs"},{default:S((()=>[T("Proposals")])),_:1})):$("",!0)])]),j(_e)?(C(),x("div",K,[A(b)])):(C(),x("div",W,[j(Se).length>0&&j(fe).length>0?(C(),U(J,{key:0,data:j(Se),columns:Ae,rounded:""},{body:S((()=>[A(D,{name:"list",tag:"div",class:"flex-list-inner"},{default:S((()=>[(C(!0),x(L,null,V(j(Se),(e=>(C(),x("div",{key:e.id,class:"flex-table-item"},[A(w,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>Te(e.id)},{default:S((()=>[P("div",null,[P("span",Z,H(e.title),1),P("span",q,[P("span",null,[G,T(H(j(R)(e.created_at)),1)])])])])),_:2},1032,["onClick"]),A(w,{class:"cu-pointer",onClick:a=>Te(e.id)},{default:S((()=>[A(z,{rounded:"",color:j(t)[e.type]},{default:S((()=>[T(H(j(s)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),A(w,{class:"cu-pointer",onClick:a=>Te(e.id)},{default:S((()=>[A(z,{class:"capitalized",rounded:"",color:j(o)[e.status]},{default:S((()=>[T(H(j(i)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),A(w,{class:"cu-pointer",onClick:a=>Te(e.id),column:{media:!0}},{default:S((()=>[P("div",null,[P("span",Q,"$"+H(e.proposalAmount),1),P("span",X,H(e.payment_status),1)])])),_:2},1032,["onClick"]),A(w,{class:"cu-pointer",onClick:a=>Te(e.id)},{default:S((()=>[A(z,{color:"purple",outlined:""},{default:S((()=>[T(H(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),A(w,{column:{align:"end"}},{default:S((()=>[A(B,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:S((()=>[P("a",{role:"menuitem",onClick:a=>{return l=e.id,ke.value=l,void(ye.value=!0);var l},class:"dropdown-item is-media"},ae,8,ee),P("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Oe.value=l,void(Ie.value=!Ie.value);var l},class:"dropdown-item is-media"},te,8,le),"approve"==e.status?(C(),x("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,ke.value=l,void(he.value=!0);var l},class:"dropdown-item is-media"},oe,8,se)):$("",!0),ie,P("a",{role:"menuitem",onClick:a=>(async(e,a)=>{try{await me.patch(`/api/lead-proposal/${a}/`,{status:e}),ve.success(`You have ${e} this proposal.`),Ue()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},re,8,ne),P("a",{role:"menuitem",onClick:a=>{return l=e.id,we.value=l,void(Ce.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},pe,8,de)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):$("",!0),j(fe).length<1&&0==j(Se).length?(C(),U($e,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:S((()=>[ue,ce])),_:1})):$("",!0),j(Se).length>5?(C(),U(Le,{key:2,"item-per-page":10,"total-items":873,"current-page":42,"max-links-displayed":7})):$("",!0)])),j(he)?(C(),U(Ve,{key:2,createProposalTasksModal:j(he),proposalId:j(ke),onCloseModalHandler:k[3]||(k[3]=e=>he.value=!1),"onUpdate:OnSuccess":Ue},null,8,["createProposalTasksModal","proposalId"])):$("",!0),j(ye)?(C(),U(De,{key:3,leadId:N.leadId,proposalId:j(ke),leadProposalModal:j(ye),"onUpdate:modalHandler":k[4]||(k[4]=e=>ye.value=!1),"onUpdate:OnSuccess":Ue,onClearProposalId:k[5]||(k[5]=e=>ke.value="")},null,8,["leadId","proposalId","leadProposalModal"])):$("",!0),j(Ie)?(C(),U(Ee,{key:4,"preview-modal":j(Ie),proposalId:j(Oe),"onUpdate:modalHandler":k[6]||(k[6]=e=>Ie.value=!1)},null,8,["preview-modal","proposalId"])):$("",!0),j(je)?(C(),U(He,{key:5,costItemModal:j(je),proposalId:j(Me),"onUpdate:modalHandler":k[7]||(k[7]=e=>je.value=!1),"onUpdate:OnSuccess":Ue},null,8,["costItemModal","proposalId"])):$("",!0),j(Ce).isSweetAlertOpen?(C(),U(Fe,{key:6,isSweetAlertOpen:j(Ce).isSweetAlertOpen,title:j(Ce).title,subtitle:j(Ce).subtitle,btntext:j(Ce).btntext,onConfirm:Pe,onCancel:()=>j(Ce).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):$("",!0),j(xe).isSweetAlertOpen?(C(),U(Fe,{key:7,isSweetAlertOpen:j(xe).isSweetAlertOpen,title:j(xe).title,subtitle:j(xe).subtitle,btntext:j(xe).btntext,onConfirm:Pe,onCancel:()=>j(xe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):$("",!0),j(ge)?(C(),U(Ne,{key:8,leadProposalListModal:j(ge),leadID:N.leadId,"group-proposal-modal":j(ge),"onUpdate:modalHandler":k[8]||(k[8]=e=>ge.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):$("",!0)])}}});export{me as _};
