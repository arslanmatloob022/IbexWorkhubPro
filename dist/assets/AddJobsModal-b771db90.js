import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-02010cfa.js";import{_ as l}from"./VCollapse.vue_vue_type_style_index_0_lang-a8e3ee1f.js";import{_ as a}from"./VTextarea.vue_vue_type_script_setup_true_lang-f608710e.js";import{e as t,r as o,w as s,o as i,M as n,y as d,H as u,B as r,C as c,A as m,D as p,l as v,j as _,J as f,E as g,ad as y,W as b,X as h,L as j}from"./index-879cc21e.js";import{_ as V}from"./VSwitchSegment.vue_vue_type_style_index_0_lang-6001fac7.js";import{_ as w}from"./VField.vue_vue_type_script_setup_true_lang-8fda54d1.js";import{_ as x}from"./VControl-3a0d7b90.js";import{_ as C}from"./VInput.vue_vue_type_script_setup_true_lang-ae22abd0.js";import{_ as I}from"./VLabel.vue_vue_type_script_setup_true_lang-010b6911.js";import{u as S}from"./useAPI-bba6ff57.js";import{u as k}from"./useNotyf-953388fb.js";import{u as J}from"./company-5bfaee0a.js";const M=e=>(b("data-v-f088ffca"),e=e(),h(),e),$={class:"modal-form columns is-multiline cu-all-input",id:"addJob"},A={class:"field column is-12 mb-0",id:"rota-celender-two"},W={class:"columns is-multiline mb-3 cu-all-input"},U={class:"column is-12"},E={class:"columns is-multiline cu-all-input"},D={class:"column is-6"},F={class:"column is-6"},P={class:"column is-12 smart-search-dropdown"},H={class:"multiselect-single-label",style:{"background-color":"transparent"}},O=["src"],T={class:"options-div"},z={class:"option-cdiv"},B=["src"],L={class:"option-ddiv"},N={class:"option-span"},R={class:"mail-span"},X=M((()=>c("span",{class:"email-span"},"Email:",-1))),Y={class:"column is-6"},q={class:"column is-6"},G=M((()=>c("i",{class:"lnil lnil-envelope mr-2","aria-hidden":"true"},null,-1))),K=M((()=>c("i",{class:"lnil lnil-envelope mr-2","aria-hidden":"true"},null,-1))),Q=M((()=>c("div",{class:"head-info"},[c("div",{class:"head-progress"})],-1))),Z={class:"body-inner-content"},ee={class:"field columns is-multiline mb-0"},le={class:"column is-12"},ae={class:"columns is-multiline"},te={class:"field column is-5 mb-0"},oe=M((()=>c("label",null,"Upload File",-1))),se=M((()=>c("div",{class:"file has-name"},[c("label",{class:"file-label"},[c("input",{class:"file-input",type:"file",name:"resume"}),c("span",{class:"file-cta"},[c("span",{class:"file-icon"},[c("i",{class:"fas fa-cloud-upload-alt"})]),c("span",{class:"file-label"}," Choose a fileâ€¦ ")]),c("span",{class:"file-name light-text"}," filename... ")])],-1))),ie={class:"",style:{width:"97%"}},ne=j(t({__name:"AddJobsModal",props:{jobId:{},AddJobModalOpen:{type:Boolean}},emits:["update:modalHandler","update:onSuccess"],setup(t,{emit:b}){const h=t,j=J(),M=o(!1),ne=k(),de=S(),ue=o(""),re=o({}),ce=o({}),me=o([]),pe=o(""),ve=o(!1),_e=o(0),fe=o([]),ge=o([]),ye=o([]);let be=o([]);const he=o(""),je=[{title:"Additional Information",content:"Add additional information about job"}],Ve=o({externalId:"",title:"",company:"",description:"",manager:0,isWorkWithContractor:!0,file:File}),we=()=>{b("update:modalHandler",!1)},xe=()=>{h.jobId?Ie():Ce()},Ce=async()=>{M.value=!0;try{if(he.value){Ve.value.company=j.loggedCompany.id;await de.post("/v3/api/vixen-job/",Ve.value);ne.success("Job Added Successfuly"),we(),b("update:onSuccess",null)}else ne.error("Please select a Manager");M.value=!1}catch(e){console.log(e),ne.error("Error while adding a job"),M.value=!1}},Ie=async()=>{M.value=!0;try{await de.patch(`/v3/api/vixen-job/${h.jobId}/`,Ve.value);ne.success("Job Added Successfuly"),we(),b("update:onSuccess",null),M.value=!1}catch(e){console.log(e),ne.error("Error while adding a job"),M.value=!1}},Se=async()=>{await xe(),ke()},ke=async()=>{try{await de.post("/v3/api/vixen-job/rams-mail/",{job:_e.value});ne.green("Email sent sucessfuly")}catch(e){console.log(e)}},Je=e=>{const l=new Date(e),a=new Intl.DateTimeFormat("en-US",{weekday:"long",day:"2-digit",month:"long"});Ve.value.title=`Job at ${a.format(l)}`};return s(he,((e,l)=>{Ve.value.manager=e})),s(ue,((e,l)=>{ve.value=!1;const a=me.value.find((l=>l.id==e));a&&(re.value=a,ve.value=!0)})),s(pe,((e,l)=>{ve.value=!1;const a=fe.value.find((l=>l.id==e));a&&(ye.value.push(a),ce.value=a,ve.value=!0)})),i((()=>{(()=>{let e=new Date,l=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");Je(`${l}-${a}-${t}`)})(),(async()=>{try{const e=await de.get(`/v3/api/account/user/company-managers/${j.loggedCompany.id}/`,{});be.value=e.data.map((e=>({value:e.id.toString(),name:`${e.first_name} ${e.last_name}`,icon:e.profileImage,email:e.email}))),ge.value=e.data}catch{ne.error("Invalid data")}finally{M.value=!1}})(),h.jobId&&(async()=>{try{M.value=!0;const e=await de.get(`/v3/api/vixen-job/${h.jobId}/`);Ve.value=e.data,e.data.manager&&h.jobId&&(he.value=e.data.manager,console.log("current manager",he.value)),M.value=!1}catch(e){console.log(e)}})()})),(t,o)=>{const s=I,i=C,b=x,j=w,S=n("Multiselect"),k=V,J=g,ne=y,de=a,ue=l,re=e;return d(),u(re,{is:"form",size:"large",open:h.AddJobModalOpen,title:"Create Job",actions:"right",onClose:we},{content:r((()=>[c("div",$,[c("div",A,[c("div",W,[c("div",U,[c("div",E,[c("div",D,[m(j,null,{default:r((()=>[m(s,null,{default:r((()=>[p("Name")])),_:1}),m(b,null,{default:r((()=>[m(i,{modelValue:v(Ve).title,"onUpdate:modelValue":o[0]||(o[0]=e=>v(Ve).title=e),type:"text",placeholder:"Title"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",F,[m(j,null,{default:r((()=>[m(s,null,{default:r((()=>[p("External Id (Optional)")])),_:1}),m(b,null,{default:r((()=>[m(i,{modelValue:v(Ve).externalId,"onUpdate:modelValue":o[1]||(o[1]=e=>v(Ve).externalId=e),type:"text",placeholder:"External id"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",P,[m(j,null,{default:r((({id:e})=>[m(s,null,{default:r((()=>[p("Select Manager (PM)")])),_:1}),m(b,{class:"placement-wrapper"},{default:r((()=>[m(S,{class:"multi-select",modelValue:v(he),"onUpdate:modelValue":o[2]||(o[2]=e=>_(he)?he.value=e:null),attrs:{id:e},placeholder:"Select a manager",label:"name",options:v(be),searchable:!0,"track-by":"name",height:40,multiselectable:""},{singlelabel:r((({value:e})=>[c("div",H,[c("img",{class:"select-label-icon mr-2 value-image",src:e.icon,alt:""},null,8,O),p(" "+f(e.name),1)])])),option:r((({option:e})=>[c("div",T,[c("div",z,[c("img",{class:"select-option-icon mr-2 option-image",src:e.icon,alt:""},null,8,B),c("div",L,[c("span",N,f(e.name),1),c("span",R,[X,p(" "+f(e.email),1)])])])])])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),c("div",Y,[m(j,{horizontal:""},{default:r((()=>[m(b,null,{default:r((()=>[m(k,{modelValue:v(Ve).isWorkWithContractor,"onUpdate:modelValue":o[3]||(o[3]=e=>v(Ve).isWorkWithContractor=e),"label-true":"Work with contractor","label-false":"Self Serve",color:"primary"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",q,[m(ne,null,{default:r((()=>[v(Ve).isWorkWithContractor?(d(),u(J,{key:0,light:"",onClick:Se,rounded:"",color:"info"},{default:r((()=>[G,p("Initiate RAMS")])),_:1})):(d(),u(J,{key:1,light:"",rounded:"",color:"info"},{default:r((()=>[K,p("Initiate CPP")])),_:1}))])),_:1})]),m(ue,{items:je,"with-chevron":"",style:{"border-radius":"14px"}},{"collapse-item-head":r((e=>[Q])),"collapse-item-content":r((e=>[c("div",Z,[c("div",ee,[c("div",le,[c("div",ae,[c("div",te,[oe,m(j,{grouped:""},{default:r((()=>[m(b,null,{default:r((()=>[se])),_:1})])),_:1})]),c("div",ie,[m(j,null,{default:r((()=>[m(s,null,{default:r((()=>[p("Description")])),_:1}),m(b,null,{default:r((()=>[m(de,{modelValue:v(Ve).description,"onUpdate:modelValue":o[4]||(o[4]=e=>v(Ve).description=e),type:"text",placeholder:"Job description"},null,8,["modelValue"])])),_:1})])),_:1})])])])])])])),_:1})])])])])]),m(J,{style:{float:"right"},class:"mr-5",onClick:xe,loading:v(M),rounded:"",color:"primary"},{default:r((()=>[p(f(t.$props.jobId?"Update Job":"Create Job"),1)])),_:1},8,["loading"])])),cancel:r((()=>[m(J,{style:{display:"none"},type:"cancel",color:"primary",loading:v(M),raised:""},{default:r((()=>[p("Create job schedule")])),_:1},8,["loading"]),m(J,{style:{display:"none"},type:"submit",color:"primary",loading:v(M),raised:""},{default:r((()=>[p("Create job schedule")])),_:1},8,["loading"])])),action:r((()=>[m(J,{onClick:xe,color:"primary",style:{display:"none"},loading:v(M),raised:""},{default:r((()=>[p("Create job ")])),_:1},8,["loading"])])),_:1},8,["open"])}}}),[["__scopeId","data-v-f088ffca"]]);export{ne as _};
