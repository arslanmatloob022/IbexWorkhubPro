import{_ as e}from"./VMessage.vue_vue_type_style_index_0_lang-72ba53ee.js";import{f as a,r as s,v as l,x as o,y as t,b as i,o as n,z as r,A as u,B as d,C as c,D as p,E as m,F as v,G as f,H as h,m as g,I as y,J as b,K as _,k as w,L as k,M as x,N as j,O as C,Y as V,P as I,Q as z,R as L,S}from"./index-9bfc18e7.js";import{_ as A}from"./VField.vue_vue_type_script_setup_true_lang-32edfc5a.js";import{_ as P}from"./VControl-64f758be.js";import{_ as R}from"./VInput.vue_vue_type_script_setup_true_lang-25833f9c.js";import{_ as U}from"./VLabel.vue_vue_type_script_setup_true_lang-f6a28db8.js";import{_ as E}from"./AnimatedLogo-8ce069b6.js";import{u as W}from"./useNotyf-0d02186c.js";import{u as q}from"./company-685ef24c.js";import{u as D,a as F}from"./useAPI-999afbe5.js";import{u as K}from"./layoutSwitcher-48a13dde.js";import"./useVFieldContext-c7c51aaf.js";import"./notyf-9a2f2d22.js";import"./useThemeColors-f13223c1.js";import"./useSupportElement-735a1bcd.js";const M=e=>(z("data-v-e91ac0b2"),e=e(),L(),e),T={class:"modern-login"},H=M((()=>m("div",{class:"underlay h-hidden-mobile h-hidden-tablet-p"},null,-1))),N={class:"columns is-gapless is-vcentered"},B=V('<div style="background-image:url(&quot;/IbexImages/ibexnight.png&quot;);" class="column is-relative is-8 h-hidden-mobile h-hidden-tablet-p" data-v-e91ac0b2><div class="hero is-fullheight is-image" data-v-e91ac0b2><div class="hero-body" data-v-e91ac0b2><div class="container" data-v-e91ac0b2><div class="columns" data-v-e91ac0b2><div class="column" data-v-e91ac0b2></div></div></div></div></div></div>',1),J={style:{"z-index":"99999"},class:"column is-4 is-relative"},O={class:"top-tools"},G=M((()=>m("h3",{style:{"font-size":"1.8rem","font-weight":"600","margin-left":"1rem",color:"#777"}},[m("span",{style:{color:"#2aac8e","font-size":"1.9rem"}},"Ibex"),_(" WorkHub ")],-1))),Q=["checked"],X=M((()=>m("span",null,null,-1))),Y={class:"is-form"},$={class:"is-form-inner"},Z=[M((()=>m("h2",null,"Sign In",-1))),M((()=>m("p",null,"Welcome back to your account.",-1)))],ee=[M((()=>m("h2",null,"Recover Account",-1))),M((()=>m("p",null,"Reset your account password.",-1)))],ae=["onSubmit"],se=[M((()=>m("i",{class:"iconify","data-icon":"feather:eye","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],le=[M((()=>m("i",{class:"iconify","data-icon":"feather:eye-off","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],oe=M((()=>m("span",{class:"toggler"},[m("span",{class:"active"},[m("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:check"})]),m("span",{class:"inactive"},[m("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:circle"})])],-1))),te={class:"button-wrap has-help"},ie={key:0,class:"recover-text"},ne={class:"button-wrap"},re=S(a({__name:"login",setup(a){const V=K(),z=s("login"),L=s(!1),S=l(),M=o(),re=t(),ue=q(),de=W(),ce=D(),pe=i();re.query.redirect;const me=s(""),ve=s(""),fe=s(""),he=s(!1),ge=s(!1),ye=s(!1),be=async()=>{if(!L.value){L.value=!0;try{const e=await F.post("https://api.ibexworkhub.com/api/auth/login/",{email:me.value,password:ve.value});console.log("resp",e.data);const a=e.data.token,s=e.data.user;pe.setToken(a),pe.setUser(s),_e()}catch(e){L.value=!1}finally{L.value=!1}}},_e=()=>{ue.loadCompany(),V.setDynamicLayoutId("sideblock-default"),de.success(`Welcome back, ${pe.user.username}`),L.value=!1,"admin"==pe.user.role?M.push("/sidebar/dashboard"):"worker"==pe.user.role?M.push("/sidebar/worker/tasks"):"manager"==pe.user.role?M.push("/sidebar/manager/projects"):"contractor"==pe.user.role?M.push("/sidebar/contractor/projects"):"client"==pe.user.role&&M.push("/sidebar/client/projects")},we=()=>{he.value=!he.value};return n((()=>{})),r((()=>{const e=window.location.search,a=new URLSearchParams(e);console.log("urlDAta",window.location.search);const s=a.get("token");s?pe.setToken(s):console.log("Invalid token")})),u({title:"Login - Ibex"}),(a,s)=>{const l=E,o=d("RouterLink"),t=U,i=R,n=P,r=A,u=I,V=e;return c(),p("div",T,[H,m("div",N,[B,m("div",J,[m("div",O,[v(o,{to:"/auth/login",class:"top-logo"},{default:f((()=>[v(l,{style:{width:"38px",height:"38px"}}),G])),_:1}),m("label",{class:"dark-mode",tabindex:"0",role:"button",onKeydown:s[1]||(s[1]=h(b((e=>e.target.click()),["prevent"]),["space"]))},[m("input",{"data-cy":"dark-mode-toggle",type:"checkbox",checked:!g(S).isDark,onChange:s[0]||(s[0]=(...e)=>g(S).onChange&&g(S).onChange(...e))},null,40,Q),X],32)]),m("div",Y,[m("div",$,[m("div",{class:y(["form-text",["login"!==g(z)&&"is-hidden"]])},Z,2),m("div",{class:y(["form-text",["login"===g(z)&&"is-hidden"]])},ee,2),m("form",{method:"post",novalidate:"","data-cy":"login-form",class:y([["login"!==g(z)&&"is-hidden"],"login-wrapper"]),onSubmit:b(be,["prevent"])},[v(r,null,{default:f((()=>[v(n,{icon:"lnil lnil-envelope autv-icon"},{default:f((()=>[v(t,{class:"auth-label"},{default:f((()=>[_(" Email Address ")])),_:1}),v(i,{modelValue:g(me),"onUpdate:modelValue":s[2]||(s[2]=e=>w(me)?me.value=e:null),"data-cy":"email-input",type:"email",autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),v(r,null,{default:f((()=>[v(n,{icon:"lnil lnil-lock-alt autv-icon",style:{position:"relative"}},{default:f((()=>[k(m("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:we},se,512),[[x,!g(he)]]),k(m("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:we},le,512),[[x,g(he)]]),v(t,{class:"auth-label"},{default:f((()=>[_("Password")])),_:1}),v(i,{modelValue:g(ve),"onUpdate:modelValue":s[3]||(s[3]=e=>w(ve)?ve.value=e:null),"data-cy":"password-input",type:g(he)?"text":"password",autocomplete:"current-password"},null,8,["modelValue","type"])])),_:1})])),_:1}),v(r,null,{default:f((()=>[v(n,{class:"is-flex"},{default:f((()=>[v(t,{raw:"",class:"remember-toggle"},{default:f((()=>[v(i,{raw:"",type:"checkbox"}),oe])),_:1}),v(t,{raw:"",class:"remember-me"},{default:f((()=>[_(" Remember Me ")])),_:1}),m("a",{tabindex:"0",role:"button",onKeydown:s[4]||(s[4]=h(b((e=>z.value="forgot-password"),["prevent"]),["space"])),onClick:s[5]||(s[5]=e=>z.value="forgot-password")}," Forgot Password? ",32)])),_:1})])),_:1}),m("div",te,[v(u,{id:"login-button",loading:g(L),color:"primary",type:"submit",size:"big",rounded:"",raised:"",bold:""},{default:f((()=>[_(" Confirm ")])),_:1},8,["loading"]),m("span",null,[_(" Or "),v(o,{to:"/auth/signup-1"},{default:f((()=>[_("Create")])),_:1}),_(" an account. ")])])],42,ae),m("form",{method:"post",novalidate:"",class:y([["forgot-password"!==g(z)&&"is-hidden"],"login-wrapper"]),onSubmit:s[12]||(s[12]=b((()=>{}),["prevent"]))},[g(ge)?j("",!0):(c(),p("p",ie," Enter your email and click on the confirm button to reset your password. We'll send you an email detailing the steps to complete the procedure. ")),g(ge)?(c(),C(V,{key:1,color:"primary",class:"is-flex",closable:"",onClose:s[6]||(s[6]=e=>ge.value=!1)},{default:f((()=>[_(" A password reset request has been sent to your email. Please check your inbox to change your password. ")])),_:1})):j("",!0),g(ye)?(c(),C(V,{key:2,color:"danger",class:"is-flex mt-4",closable:"",onClose:s[7]||(s[7]=e=>ye.value=!1)},{default:f((()=>[_(" Please enter valid email address. ")])),_:1})):j("",!0),v(r,null,{default:f((()=>[v(n,{icon:"lnil lnil-envelope autv-icon"},{default:f((()=>[v(t,{class:"auth-label"},{default:f((()=>[_(" Email Address ")])),_:1}),v(i,{type:"email",modelValue:g(fe),"onUpdate:modelValue":s[8]||(s[8]=e=>w(fe)?fe.value=e:null),autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),v(r,null,{default:f((()=>[v(n,{class:"is-flex"},{default:f((()=>[m("a",{tabindex:"0",role:"button",onKeydown:s[9]||(s[9]=h(b((e=>z.value="login"),["prevent"]),["space"])),onClick:s[10]||(s[10]=e=>z.value="login")}," Login ? ",32)])),_:1})])),_:1}),m("div",ne,[v(u,{loading:g(L),color:"primary",size:"big",type:"submit",lower:"",rounded:"",solid:"",onClick:s[11]||(s[11]=e=>(async e=>{try{L.value=!0,await ce.post("/v3/api/account/auth/forget-password/",{email:e}),ge.value=!0}catch(a){ye.value=!0,de.error("Please enter your valid email address")}finally{L.value=!1}})(g(fe)))},{default:f((()=>[_(" Confirm ")])),_:1},8,["loading"])])],34)])])])])])}}}),[["__scopeId","data-v-e91ac0b2"]]);export{re as default};
