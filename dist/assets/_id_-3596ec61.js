import{f as e,r as l,o as a,C as t,O as s,G as o,F as i,K as r,J as n,P as p,S as d,s as u,y as c,x as m,e as _,_ as v,D as f,E as y,m as g,N as b,U as h,L as w,X as x,V as C,A as k}from"./index-5a128e29.js";import{_ as V}from"./VModal.vue_vue_type_style_index_0_lang-fd868b17.js";import{_ as S}from"./VField.vue_vue_type_script_setup_true_lang-7ac3721d.js";import{_ as I}from"./VControl-17ab89fe.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-1cd34a3b.js";import{u as j}from"./useAPI-9f6c8717.js";import{u as A}from"./useNotyf-fb1f1e6a.js";import{d as O,u as D,_ as P,b as U,a as M,e as E}from"./CreateProposalTasksModal-336c0371.js";import{_ as q}from"./SweetAlert.vue_vue_type_style_index_0_lang-413342ac.js";import{_ as N}from"./VCollapse.vue_vue_type_style_index_0_lang-a93f839e.js";import{_ as $}from"./VTextarea.vue_vue_type_script_setup_true_lang-feacbfe2.js";import{_ as H}from"./VRadio.vue_vue_type_style_index_0_lang-a7fe47a3.js";import{_ as L}from"./VMessage.vue_vue_type_style_index_0_lang-1718935a.js";import{_ as F}from"./VDropdown.vue_vue_type_style_index_0_lang-71dd7345.js";import{_ as z}from"./V-Snack.vue_vue_type_style_index_0_lang-f89aa0cd.js";import{a as R}from"./useSupportElement-ad8273ea.js";import{s as Y}from"./costItems-0fb0ebc2.js";import{u as G}from"./useDropdown-7e5a06b9.js";import{u as B}from"./viewWrapper-1e3e6207.js";import"./VLabel.vue_vue_type_script_setup_true_lang-a8f3db70.js";import"./useVFieldContext-8848b45d.js";import"./notyf-f61ac380.js";import"./useThemeColors-6194a233.js";import"./UnitAddUpdateModal.vue_vue_type_script_setup_true_lang-4ce594b2.js";import"./VCheckbox.vue_vue_type_style_index_0_lang-e24eb084.js";import"./VOption.vue_vue_type_style_index_0_lang-c3111867.js";import"./VIconButton-579cef81.js";import"./company-b1f227c3.js";import"./VIcon.vue_vue_type_script_setup_true_lang-86f088de.js";const J=d(e({__name:"CreateTemplateModal",props:{openCreateTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:d}){const u=e,c=j(),m=A();l([]);const _=l(null);l(!1);const v=l(""),f=()=>{d("update:modalHandler",!1)},y=async()=>{console.log(_);try{await c.post(`/api/lead-proposal/${u.proposalId}/create-template/`,{title:v.value});m.success("Template Create successfully!"),f()}catch(e){console.error("Error importing template:",e),m.error("Something went wrong, try again")}};return a((()=>{})),(e,l)=>{const a=T,d=I,c=S,m=p,_=V;return t(),s(_,{open:u.openCreateTemplate,size:"small",is:"form",title:"Create Template",actions:"right",onSubmit:n(y,["prevent"]),onClose:f},{content:o((()=>[i(c,{label:"Enter title to identify your saved template"},{default:o((()=>[i(d,null,{default:o((()=>[i(a,{required:"",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),type:"text",placeholder:" Template Title"},null,8,["modelValue"])])),_:1})])),_:1})])),action:o((()=>[i(m,{color:"primary",type:"submit",raised:""},{default:o((()=>[r("Confirm")])),_:1})])),cancel:o((()=>[i(m,{color:"primary",style:{display:"none"},raised:""},{default:o((()=>[r("Close")])),_:1})])),_:1},8,["open","onSubmit"])}}}),[["__scopeId","data-v-3fb59420"]]),K={class:"modal-form columns is-multiline"},X={class:"column is-12 is-flex space-between align-items-center card mx-3"},Q={class:"is-flex"},W=y("i",{class:"fas fa-check"},null,-1),Z={class:"is-flex"},ee={class:"file"},le={class:"file-label"},ae={class:"file-cta"},te=y("span",{class:"file-icon"},[y("i",{class:"fas fa-cloud-upload-alt"})],-1),se={class:"file-label"},oe=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-copy"})],-1),y("div",{class:"meta"},[y("span",null,"Create Template"),y("span",null,"Save as template for next use ")],-1)],ie=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-envelope"})],-1),y("div",{class:"meta"},[y("span",null,"Send Email"),y("span",null,"Send proposal email to the client ")],-1)],re=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-cloud-download"})],-1),y("div",{class:"meta"},[y("span",null,"Download"),y("span",null,"Download proposal as pdf ")],-1)],ne=y("hr",{class:"dropdown-divider"},null,-1),pe=[y("div",{class:"icon"},[y("i",{class:"lnil lnil-trash"})],-1),y("div",{class:"meta"},[y("span",null,"Delete "),y("span",null,"Delete proposal permanently ")],-1)],de={key:0,class:"column is-12"},ue={class:"field column is-6 mb-0"},ce=y("label",null,"Title: *",-1),me={class:"control"},_e={class:"column is-6"},ve={class:"field column is-6"},fe=y("label",null,"Approval Deadline *",-1),ye={class:"control"},ge={class:"field column is-6"},be=y("label",null,"Attachments",-1),he=y("div",{class:"file"},[y("label",{class:"file-label"},[y("input",{class:"file-input",type:"file",name:"resume"}),y("span",{class:"file-cta"},[y("span",{class:"file-icon"},[y("i",{class:"fas fa-cloud-upload-alt"})]),y("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),we={class:"field column is-12"},xe={class:"body-inner-content"},Ce={class:"field columns is-multiline mb-0"},ke={class:"field column is-11 mb-0"},Ve=y("label",{for:"",class:"label"},"Internal Notes",-1),Se={class:"field column is-11 mb-0"},Ie=y("label",{for:"",class:"label"},"Introductory Text",-1),Te={class:"field column is-11 mb-0"},je=y("label",{for:"",class:"label"},"Closing Text",-1),Ae={class:"column is-12"},Oe=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:n}){const d=e,k=l();G(k);const V=u(),T=O(),B=D(),Oe=A(),De=j(),Pe=c(),Ue=m(),Me=l(!1),Ee=l(!1),qe=l(""),Ne=l(""),$e=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),He=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],Le=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Fe=l({id:"",title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",is_task_created:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),ze=async()=>{try{const e=await De.get(`/api/lead-proposal/${Pe.params.id}/detail/`);Fe.value=e.data,B.getProposalCostItems(Pe.params.id)}catch(e){console.log(e)}},Re=async()=>{try{Me.value=!0,Fe.value.columns_to_show=JSON.stringify(Y.value);const e=R(Fe.value,[]);if(d.proposalId||Fe.value.id){const l=await De.patch(`/api/lead-proposal/${d.proposalId?d.proposalId:Fe.value.id}/`,e);Fe.value=l.data}Oe.success("Proposal updated successfully"),ze()}catch(e){Oe.error("Something went wrong, try again")}finally{Me.value=!1}},Ye=async()=>{try{Me.value=!0;await De.delete(`/api/lead-proposal/${Ne.value}/`);Le.value.isSweetAlertOpen=!1,Oe.success("Proposal delete successfully"),Ue.go(-1)}catch(e){Oe.error(` ${e}, Proposal`),Oe.error("Something went wrong please try later")}finally{Me.value=!1}},Ge=async()=>{try{Me.value=!0;await De.patch(`/api/lead-proposal/${Pe.params.id}/`,{status:qe.value});ze(),Oe.success(`You have ${qe.value} this proposal.`),Le.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{Me.value=!1}},Be=l(!1),Je=l("");l("worksheet");const Ke=_((()=>v((()=>import("./ckeditor-7e7cc313.js").then((e=>e.c))),["assets/ckeditor-7e7cc313.js","assets/index-5a128e29.js","assets/index-16b1d07e.css","assets/vue.runtime.esm-bundler-00c26185.js"]).then((e=>e.default.component)))),Xe={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},Qe=l(!1),We=l([]),Ze=l({}),el=l(!1),ll=()=>{Ze.value=B.leadProposalFormData,We.value.push(B.leadProposalFormData),el.value=!el.value},al=l(""),tl=l(null),sl=e=>{const l=e.target,a=l.files?.[0];l.value="",a&&(tl.value=a,al.value=a.name)},ol=async()=>{try{Ee.value=!0;const e=await De.post(`/api/lead-proposal/upload-estimates/${Pe.params.id}/`,{file:tl.value});Oe.success(`${e.data}`),ze(),al.value="",tl.value=null}catch(e){console.log(e)}finally{Ee.value=!1}};return a((async()=>{V.value=await v((()=>import("./ckeditor-7cbe0ff1.js").then((e=>e.c))),["assets/ckeditor-7cbe0ff1.js","assets/index-5a128e29.js","assets/index-16b1d07e.css"]).then((e=>e.default)),(d.proposalId||Pe.params.id)&&(ze(),B.getProposalDetail(d.proposalId||Pe.params.id)),T.getCostCodesHandler()})),(e,l)=>{const a=z,n=p,u=I,c=S,m=F,_=L,v=H,k=$,T=N,j=P,A=q,O=U,D=M,R=J;return t(),f(C,null,[y("div",K,[y("div",X,[y("div",Q,[g(Fe).is_task_created?(t(),s(a,{key:0,title:"Calendar Tasks Created ",white:"",class:"ml-2",color:"info",icon:"fas fa-calendar-check"})):b("",!0),"approved"!=g(Fe).status?(t(),s(n,{key:1,onClick:l[0]||(l[0]=e=>{return l="approved",qe.value=l,void(Le.value={title:`${qe.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==qe.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==qe.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var l}),size:"small",class:"ml-2",light:"",outlined:"",color:"info",raised:""},{default:o((()=>[W,r(" Mark Approved ")])),_:1})):(t(),s(n,{key:2,light:"",size:"small",color:"primary",class:"ml-1 mt-1",icon:"fas fa-check-circle"},{default:o((()=>[r(" Approved ")])),_:1}))]),y("div",Z,[g(al)?(t(),s(n,{key:0,size:"small",class:"mr-2",light:"",outlined:"",loading:g(Ee),color:"warning",raised:"",onClick:ol},{default:o((()=>[r(h(g(Ee)?"Generating Estimates..":"Create Estimates"),1)])),_:1},8,["loading"])):b("",!0),i(c,{grouped:"",class:"mr-2"},{default:o((()=>[i(u,null,{default:o((()=>[y("div",ee,[y("label",le,[y("input",{onChange:sl,class:"file-input",type:"file",accept:".xlsx, .xls, .csv",name:"resume"},null,32),y("span",ae,[te,y("span",se,h(g(al)?g(al):"Upload Estimates File."),1)])])])])),_:1})])),_:1}),g(Fe).is_task_created||"approved"!=g(Fe).status?b("",!0):(t(),s(n,{key:1,size:"small",class:"mr-2",light:"",outlined:"",color:"success",raised:"",onClick:l[1]||(l[1]=e=>{return l=g(Pe).params.id,Je.value=l,void(Be.value=!0);var l})},{default:o((()=>[r(" Generate Tasks ")])),_:1})),i(n,{onClick:Re,size:"small",class:"mr-2",light:"",outlined:"",color:"primary",raised:""},{default:o((()=>[r(" Update ")])),_:1}),i(m,{spaced:"",right:"",icon:"lucide:more-vertical"},{content:o((()=>[y("a",{onClick:l[2]||(l[2]=e=>Qe.value=!g(Qe)),class:"dropdown-item is-media"},oe),y("a",{onClick:ll,class:"dropdown-item is-media"},ie),y("a",{onClick:l[3]||(l[3]=e=>g(E)(g(Fe))),class:"dropdown-item is-media"},re),ne,y("a",{onClick:l[4]||(l[4]=e=>{return l=g(Fe).id,Ne.value=l,void($e.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),class:"dropdown-item is-media"},pe)])),_:1})])]),g(Fe).client_note&&"review"==g(Fe).status?(t(),f("div",de,[i(_,{color:"warning"},{default:o((()=>[r(h(g(Fe).client_note),1)])),_:1})])):b("",!0),y("div",ue,[ce,y("div",me,[w(y("input",{type:"text",name:"firstName","onUpdate:modelValue":l[5]||(l[5]=e=>g(Fe).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[x,g(Fe).title]])])]),y("div",_e,[i(c,{class:"m-0 p-0",label:"Type"},{default:o((()=>[i(u,null,{default:o((()=>[i(v,{modelValue:g(Fe).type,"onUpdate:modelValue":l[6]||(l[6]=e=>g(Fe).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),i(v,{modelValue:g(Fe).type,"onUpdate:modelValue":l[7]||(l[7]=e=>g(Fe).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),i(v,{modelValue:g(Fe).type,"onUpdate:modelValue":l[8]||(l[8]=e=>g(Fe).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",ve,[fe,y("div",ye,[w(y("input",{type:"date",name:"firstName","onUpdate:modelValue":l[9]||(l[9]=e=>g(Fe).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[x,g(Fe).approval_deadline]])])]),y("div",ge,[be,i(c,{grouped:""},{default:o((()=>[i(u,null,{default:o((()=>[he])),_:1})])),_:1})]),y("div",we,[i(T,{items:He,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":o((e=>[y("div",xe,[y("div",Ce,[y("div",ke,[Ve,i(c,null,{default:o((()=>[i(u,null,{default:o((()=>[i(k,{modelValue:g(Fe).internalNotes,"onUpdate:modelValue":l[10]||(l[10]=e=>g(Fe).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),y("div",Se,[Ie,g(V)?(t(),s(g(Ke),{key:0,modelValue:g(Fe).introductoryText,"onUpdate:modelValue":l[11]||(l[11]=e=>g(Fe).introductoryText=e),editor:g(V),config:Xe},null,8,["modelValue","editor"])):b("",!0)]),y("div",Te,[je,g(V)?(t(),s(g(Ke),{key:0,modelValue:g(Fe).closingText,"onUpdate:modelValue":l[12]||(l[12]=e=>g(Fe).closingText=e),editor:g(V),config:Xe},null,8,["modelValue","editor"])):b("",!0)])])])])),_:1})]),y("div",Ae,[i(j,{proposalData:g(Fe),proposalId:g(Fe).id},null,8,["proposalData","proposalId"])]),g(Le).isSweetAlertOpen?(t(),s(A,{key:1,isSweetAlertOpen:g(Le).isSweetAlertOpen,title:g(Le).title,subtitle:g(Le).subtitle,btntext:g(Le).btntext,onConfirm:Ge,onCancel:()=>g(Le).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),g($e).isSweetAlertOpen?(t(),s(A,{key:2,isSweetAlertOpen:g($e).isSweetAlertOpen,title:g($e).title,subtitle:g($e).subtitle,btntext:g($e).btntext,onConfirm:Ye,onCancel:()=>g($e).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),g(Be)?(t(),s(O,{key:3,createProposalTasksModal:g(Be),proposalId:g(Je),onCloseModalHandler:l[13]||(l[13]=e=>Be.value=!1),"onUpdate:OnSuccess":l[14]||(l[14]=()=>{})},null,8,["createProposalTasksModal","proposalId"])):b("",!0),g(el)?(t(),s(D,{key:4,proposalSenderModal:g(el),selectedProposalsIds:g(We),proposalData:g(Ze),"onUpdate:modalHandler":l[15]||(l[15]=e=>{el.value=!1,We.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData"])):b("",!0)]),g(Qe)?(t(),s(R,{key:0,proposalId:g(Pe).params.id,openCreateTemplate:g(Qe),"onUpdate:OnSuccess":l[16]||(l[16]=()=>{(d.proposalId||g(Pe).params.id)&&ze()}),"onUpdate:modalHandler":l[17]||(l[17]=e=>Qe.value=!1)},null,8,["proposalId","openCreateTemplate"])):b("",!0)],64)}}}),De=e({__name:"[id]",setup:e=>(B().setPageTitle("Lead Proposals"),k({title:"Lead Proposals - Ibex"}),(e,l)=>(t(),f("div",null,[i(Oe)])))});export{De as default};
