import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-7c403184.js";import{e as t,r as a,w as l,o as s,A as r,B as o,C as n,D as i,E as c,F as d,l as u,j as p,M as v,H as m,I as g,T as y,U as f,V as h,N as _,J as k,ak as w,O as j,P as b,Q as x,R as C}from"./index-fd0ff1bc.js";import{_ as D}from"./UpdateTask.vue_vue_type_script_setup_true_lang-3136dafb.js";import{_ as S}from"./VAvatar.vue_vue_type_style_index_0_lang-2d228be5.js";import{_ as P}from"./VDropdown.vue_vue_type_style_index_0_lang-996d1128.js";import{_ as I}from"./VField.vue_vue_type_script_setup_true_lang-b071d7cf.js";import{_ as A}from"./VControl-0edd8c23.js";import{_ as V}from"./VInput.vue_vue_type_script_setup_true_lang-673c9510.js";import{F as T}from"./FullCalendar-4d608af6.js";import{i as H}from"./index-f52ed8ce.js";import{i as F}from"./index-75e08f06.js";import{u as O}from"./userSession-71b1c148.js";import{u as M}from"./useNotyf-70dc65ec.js";import{u as U}from"./useAPI-4bb46aa3.js";const E=e=>(b("data-v-c8a5c677"),e=e(),x(),e),L=["onSubmit"],R={class:"datatable-toolbar"},Y={key:0,class:"rota-loader"},$=[E((()=>i("div",{class:"icon"},[i("i",{class:"lnil lnil-menu","aria-hidden":"true"})],-1))),E((()=>i("div",{class:"meta"},[i("span",null,"All"),i("span",null,"All projects owned by company")],-1)))],N=[E((()=>i("div",{class:"icon"},[i("i",{class:"lnil lnil-play","aria-hidden":"true"})],-1))),E((()=>i("div",{class:"meta"},[i("span",null,"Active"),i("span",null,"Projects that are in progress")],-1)))],W=[E((()=>i("div",{class:"icon"},[i("i",{class:"lnil lnil-alarm-clock","aria-hidden":"true"})],-1))),E((()=>i("div",{class:"meta"},[i("span",null,"Pending"),i("span",null,"Projects listed but not started")],-1)))],z=E((()=>i("hr",{class:"dropdown-divider"},null,-1))),B=[E((()=>i("div",{class:"icon"},[i("i",{class:"lnil lnil-round-box-check","aria-hidden":"true"})],-1))),E((()=>i("div",{class:"meta"},[i("span",null,"Completed"),i("span",null,"Projects that are done")],-1)))],J={style:{height:"100%",position:"relative"}},K={key:0,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px",color:"black"}},Q=["onClick"],Z={style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},q={key:0,class:"avatars"},G=["src","onClick","title","data-bs-original-title"],X={class:"v-popover-content is-text"},ee={class:"popover-head"},te={class:"dark-inverted"},ae={class:"popover-body"},le=["onClick","data-bs-original-title","title"],se=["data-bs-original-title","title"],re={key:1,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},oe=C(t({__name:"ProjectManagerCalendar",setup(t){const b=U(),x=a(null),C=O(),E=M(),oe=a(!1);a(!1),a(""),a(!1);const ne=a(!1),ie=a("all"),ce=a(""),de=a([]),ue=a([]),pe=a([]),ve=a(0),me=a(""),ge=a(""),ye=a(""),fe=a(0),he=a(!0),_e=a(!1),ke=a(""),we=a({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),je=a({plugins:[H,F],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineMonth",height:"auto",themeSystem:"cerulean",resourceAreaWidth:"20%",resourcesInitiallyExpanded:!1,selectable:!0,headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}}},resourceAreaHeaderContent:"Projects",resources:[],eventDrop:e=>{be(e),e.revert()},eventResize:e=>{be(e)},select:e=>{"contractor"!==C.user.role&&("manager"!==C.user.role||e.resource.extendedProps.managers.includes(C.user.id))&&(console.log("start date",e.startStr),ke.value=0,ve.value=e.resource.extendedProps.project,ge.value=e.startStr,ye.value=e.endStr,_e.value=!0)}}),be=e=>{if(console.warn("inside func"),console.log("inside ",C.user.role),"contractor"===C.user.role)return void e.revert();if("manager"===C.user.role&&!e.event.extendedProps.managers.includes(C.user.id))return e.revert(),void E.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);console.log("resource ids",e.event),console.log("event",e.event),e.event.id==e.event._def.publicId&&confirm(`Are you sure you want to update the project ${e.event.title} date from ${t} to ${a}?`)?De(e.event.id,t,a):e.revert()},xe=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},Ce=e=>{window.location.hash="",fe.value=e.id,me.value=e.username,window.location.hash="workerCalendar"},De=async(e,t,a)=>{try{await b.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),E.success("Task updated successfully"),await Ae(),await Ve(),Pe()}catch(l){E.error("Something went wrong"),console.log(l)}},Se=e=>{const t=pe.value.find((t=>t.id===e));return t?t.managers:[]},Pe=()=>{console.log(pe.value);const e=[...de.value.map((e=>({id:e.id,resourceId:e.id,project:e.project,start:e.startDate,end:xe(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:we[e.status],managers:Se(e.project)}))),...pe.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color})))],t=pe.value.map((e=>{const t=de.value.filter((t=>t.project===e.id)).map((e=>({id:e.id,title:e.title,project:e.project,initiallyExpanded:!0})));return{id:e.id,title:e.title,eventBackgroundColor:e.color,project:e.id,initiallyExpanded:!0,children:t}}));console.log("proejrct rources"),console.log(t),je.value.resources=t,je.value.events=e},Ie=()=>{if(console.log("func called",ie.value),"all"!==ie.value){let e=pe.value.filter((e=>e.status===ie.value));ue.value=e}else ue.value=pe.value;ce.value&&(ue.value=pe.value.filter((e=>e.title.toLowerCase().includes(ce.value.toLowerCase())))),je.value.resources=ue.value,console.log(ue.value),console.log(ue.value.length)},Ae=async()=>{try{oe.value=!0,console.log("inside all projects func");const e=await b.get("/api/project/projects",{});pe.value=e.data,ue.value=e.data,console.log("scratch projects",pe.value),oe.value=!1}catch(e){console.error(e),pe.value=[],oe.value=!1}},Ve=async()=>{try{oe.value=!0;const e=await b.get("/api/task",{});de.value=e.data}catch(e){de.value=[]}finally{oe.value=!1}};l(ie,((e,t)=>{Ie()}));const Te=async()=>{await Ae(),await Ve(),Pe()};return s((async()=>{await Promise.all([Ae(),Ve()]),Pe(),he.value=!0})),(t,a)=>{const l=V,s=A,b=I,H=P,F=w,O=S,M=r("Tippy"),U=D,de=j,ue=e;return o(),n("div",null,[i("form",{onSubmit:g(Ie,["prevent"])},[i("div",R,[c(b,{elevated:""},{default:d((()=>[c(s,{icon:"fas fa-search"},{default:d((()=>[c(l,{type:"text",placeholder:"Search projects...",modelValue:u(ce),"onUpdate:modelValue":a[0]||(a[0]=e=>p(ce)?ce.value=e:null),onInput:a[1]||(a[1]=e=>Ie()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),u(oe)?(o(),n("div",Y)):v("",!0),c(F,null,{default:d((()=>[c(H,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:d((()=>[i("a",{onClick:a[2]||(a[2]=()=>{Ie(),ie.value="all"}),class:m(["dropdown-item is-media","all"==u(ie)])},$,2),i("a",{href:"#",onClick:a[3]||(a[3]=()=>{Ie(),ie.value="active"}),class:m(["active"==u(ie),"dropdown-item is-media"])},N,2),i("a",{onClick:a[4]||(a[4]=()=>{Ie(),ie.value="pending"}),class:m(["pending"==u(ie),"dropdown-item is-media"])},W,2),z,i("a",{onClick:a[5]||(a[5]=()=>{Ie(),ie.value="completed"}),class:m(["completed"==u(ie),"dropdown-item is-media"])},B,2)])),_:1})])),_:1})])],40,L),c(u(T),{options:u(je),ref_key:"calendarRef",ref:x},{eventContent:d((e=>[i("div",J,["background"==e.event?.display?(o(),n("p",K," project: "+y(e.event.title),1)):(o(),n("div",{key:1,onClick:t=>{return a=e,console.log(a.event),void("contractor"!==C.user.role&&("manager"!==C.user.role||a.event.extendedProps.managers.includes(C.user.id)?(ge.value="",_e.value=!0,ve.value=0,ke.value=a.event.id):E.error("You can modify the task only for the projects for which you are a manager")));var a},style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},[i("p",Z,[(o(!0),n(f,null,h(e.event.extendedProps?.workers,(e=>(o(),n("span",{key:e.id},y(e.username)+", ",1)))),128))]),e.event.extendedProps?.workers?.length?(o(),n("div",q,[(o(!0),n(f,null,h(e.event.extendedProps.workers,(t=>(o(),n("div",{class:"avatars__item",key:t.id},[c(M,null,{content:d((()=>[i("div",X,[i("div",ee,[c(O,{picture:t.avatar,size:"small"},null,8,["picture"]),i("h4",te,y(t.username?t.username:""),1)]),i("div",ae,[i("p",null,y(e.event?.title)+"asas",1)])])])),default:d((()=>[t.avatar?(o(),n("img",{key:0,src:t.avatar,alt:"",onClick:e=>Ce(t),title:t.username,"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi"},null,8,G)):v("",!0)])),_:2},1024),0==e.event.extendedProps?.workers?.length?(o(),n("div",{key:0,onClick:e=>Ce(t),"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[i("h6",{class:"mb-0",style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username},y(t.username?t.username.slice(0,2):"AA"),9,se)],8,le)):v("",!0),i("p",null,y(t.username),1)])))),128))])):v("",!0),e.event.extendedProps?.workers?.length||"background"==e.event?.display?v("",!0):(o(),n("p",re," No worker is assigned yet "))],8,Q))])])),_:1},8,["options"]),u(_e)?(o(),_(U,{key:0,isOpen:u(_e),taskIdSelected:u(ke),projectID:u(ve),startDate:u(ge),endDate:u(ye),"onUpdate:OnSuccess":Te,"onUpdate:modalHandler":a[6]||(a[6]=()=>{_e.value=!1,console.log("Falling in main")})},null,8,["isOpen","taskIdSelected","projectID","startDate","endDate"])):v("",!0),u(ne)?(o(),_(ue,{key:1,open:u(ne),actions:"center",onClose:a[7]||(a[7]=e=>ne.value=!1)},{content:d((()=>[i("p",null,y(t.taskDetail),1)])),action:d((()=>[c(de,{color:"primary",raised:""},{default:d((()=>[k(" Confirm ")])),_:1})])),_:1},8,["open"])):v("",!0)])}}}),[["__scopeId","data-v-c8a5c677"]]);export{oe as _};
