import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-2b8cf63b.js";import{e as l,s as a,r as s,b as t,_ as o,o as i,i as n,B as r,N as d,F as u,D as p,H as c,l as m,G as v,C as _,K as f,W as y,E as b,M as g,J as h,I as w,O as x,v as k,x as V,Z as I,j as P,U as C,V as j,aR as T,T as A}from"./index-f3f4d694.js";import{_ as O}from"./VModal.vue_vue_type_style_index_0_lang-c62a44dd.js";import{u as S,_ as D}from"./WorksheetItems.vue_vue_type_script_setup_true_lang-f130dbde.js";import{_ as U}from"./VCollapse.vue_vue_type_style_index_0_lang-857beeed.js";import{_ as L}from"./VTextarea.vue_vue_type_script_setup_true_lang-e8c2fb9b.js";import{_ as N}from"./VField.vue_vue_type_script_setup_true_lang-c9bb6834.js";import{_ as $}from"./VControl-97faf42d.js";import{_ as M}from"./VRadio.vue_vue_type_style_index_0_lang-9ed5adfc.js";import{u as q}from"./useAPI-8c8e74af.js";import{u as E}from"./useNotyf-154cdbb2.js";import{a as R,e as W,g as H}from"./useSupportElement-72dbe297.js";import{u as F}from"./userSession-256ee40e.js";import{_ as B}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-5ae4ed8a.js";import{_ as J}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-79155122.js";import{_ as K,c as G}from"./VFlexTable.vue_vue_type_style_index_0_lang-1a33d331.js";import{_ as z}from"./VDropdown.vue_vue_type_style_index_0_lang-7bf06366.js";import{_ as Y}from"./VTag.vue_vue_type_style_index_0_lang-721ecf0f.js";import{_ as Z,a as Q}from"./search-4-dark-2b5b440c.js";const X={class:"modal-form columns is-multiline"},ee={class:"tabs-wrapper column is-12 m-0"},le={class:"tabs-inner"},ae={class:"tabs is-boxed"},se=[p("span",null,"Proposal",-1)],te=[p("span",null,"Worksheet",-1)],oe={key:0,class:"columns is-multiline"},ie={class:"field column is-6 mb-0"},ne=p("label",null,"Title: *",-1),re={class:"control"},de={class:"column is-6"},ue={class:"field column is-6"},pe=p("label",null,"Approval Deadline *",-1),ce={class:"control"},me={class:"field column is-6"},ve=p("label",null,"Attachments",-1),_e=p("div",{class:"file"},[p("label",{class:"file-label"},[p("input",{class:"file-input",type:"file",name:"resume"}),p("span",{class:"file-cta"},[p("span",{class:"file-icon"},[p("i",{class:"fas fa-cloud-upload-alt"})]),p("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),fe={class:"body-inner-content"},ye={class:"field columns is-multiline mb-0"},be={class:"field column is-12 mb-0"},ge=p("label",{for:"",class:"label"},"Internal Notes",-1),he={class:"field column is-12 mb-0"},we=p("label",{for:"",class:"label"},"Introductory Text",-1),xe={class:"field column is-12 mb-0"},ke=p("label",{for:"",class:"label"},"Closing Text",-1),Ve={key:1,class:"columns is-multiline"},Ie=l({__name:"LeadProposalModal",props:{leadProposalModal:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess","clearProposalId"],setup(e,{emit:l}){const k=e;S();const V=a();F();const I=E(),P=q(),C=s(!1);s({});const j=s("general");s(!1),s([]),s([]),s([]);const T=[{title:"More Details",content:"Add additional information about rota, rate or worker"}];s({title:"",description:"",quantity:0,unit:0,unitCost:0,markup:0,clientPrice:0,costCode:"",costType:"",builderCost:"",margin:0,profit:0,internalNotes:""});const A=s({title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",worksheetItems:[],type:"proposal",job:""});s([{value:"all",label:"All"},{value:"contact",label:"Contact Form"},{value:"google",label:"Google"},{value:"referral",label:"Referral"}]),s([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const W=s(""),H=async()=>{try{C.value=!0,k.leadId&&(A.value.job=k.leadId);const e=R(A.value,[""]);if(k.proposalId){await P.patch(`/api/lead-proposal/${k.proposalId}/`,e)}else{const l=await P.post("/api/lead-proposal/",e);W.value=l.data.id,A.value=l.data}J(),I.dismissAll(),I.success(`Proposal ${k.proposalId?"updated":"created"} successfully`)}catch(e){I.error(` ${e}, New Worker`)}finally{C.value=!1}},B=()=>{l("update:modalHandler",!1)},J=()=>{l("update:OnSuccess",null)},K=t((()=>o((()=>import("./ckeditor-178c5f59.js").then((e=>e.c))),["assets/ckeditor-178c5f59.js","assets/index-f3f4d694.js","assets/index-1c8d8af6.css","assets/vue.runtime.esm-bundler-3ca3fc2c.js"]).then((e=>e.default.component)))),G={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"};return i((async()=>{V.value=await o((()=>import("./ckeditor-023962a0.js").then((e=>e.c))),["assets/ckeditor-023962a0.js","assets/index-f3f4d694.js","assets/index-1c8d8af6.css"]).then((e=>e.default)),k.proposalId&&(async()=>{try{const e=await P.get(`/api/lead-proposal/${k.proposalId}/`);A.value=e.data}catch(e){console.log(e)}})()})),n((()=>{l("clearProposalId",null),A.value={}})),(e,l)=>{const a=M,s=$,t=N,o=L,i=U,n=D,I=x,P=O;return r(),d(P,{is:"form",open:k.leadProposalModal,title:"Lead Proposal",size:"xl",actions:"right",onSubmit:w(H,["prevent"]),onClose:B},{content:u((()=>[p("div",X,[p("div",ee,[p("div",le,[p("div",ae,[p("ul",null,[p("li",{class:c(["general"===m(j)?"is-active":"not-active"])},[p("a",{tabindex:"0",role:"button",onKeydown:l[0]||(l[0]=v(w((e=>j.value="general"),["prevent"]),["space"])),onClick:l[1]||(l[1]=e=>j.value="general")},se,32)],2),p("li",{class:c(["CostWorksheet"===m(j)?"is-active":"not-active"])},[p("a",{tabindex:"0",role:"button",onKeydown:l[2]||(l[2]=v(w((e=>j.value="CostWorksheet"),["prevent"]),["space"])),onClick:l[3]||(l[3]=e=>j.value="CostWorksheet")},te,32)],2)])])])]),"general"==m(j)?(r(),_("div",oe,[p("div",ie,[ne,p("div",re,[f(p("input",{type:"text",name:"firstName","onUpdate:modelValue":l[4]||(l[4]=e=>m(A).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[y,m(A).title]])])]),p("div",de,[b(t,{class:"m-0 p-0",label:"Type"},{default:u((()=>[b(s,null,{default:u((()=>[b(a,{modelValue:m(A).type,"onUpdate:modelValue":l[5]||(l[5]=e=>m(A).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),b(a,{modelValue:m(A).type,"onUpdate:modelValue":l[6]||(l[6]=e=>m(A).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),b(a,{modelValue:m(A).type,"onUpdate:modelValue":l[7]||(l[7]=e=>m(A).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),p("div",ue,[pe,p("div",ce,[f(p("input",{type:"date",name:"firstName","onUpdate:modelValue":l[8]||(l[8]=e=>m(A).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[y,m(A).approval_deadline]])])]),p("div",me,[ve,b(t,{grouped:""},{default:u((()=>[b(s,null,{default:u((()=>[_e])),_:1})])),_:1})]),b(i,{items:T,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":u((e=>[p("div",fe,[p("div",ye,[p("div",be,[ge,b(t,null,{default:u((()=>[b(s,null,{default:u((()=>[b(o,{modelValue:m(A).internalNotes,"onUpdate:modelValue":l[9]||(l[9]=e=>m(A).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),p("div",he,[we,m(V)?(r(),d(m(K),{key:0,modelValue:m(A).introductoryText,"onUpdate:modelValue":l[10]||(l[10]=e=>m(A).introductoryText=e),editor:m(V),config:G},null,8,["modelValue","editor"])):g("",!0)]),p("div",xe,[ke,m(V)?(r(),d(m(K),{key:0,modelValue:m(A).closingText,"onUpdate:modelValue":l[11]||(l[11]=e=>m(A).closingText=e),editor:m(V),config:G},null,8,["modelValue","editor"])):g("",!0)])])])])),_:1})])):g("",!0),"CostWorksheet"==m(j)?(r(),_("div",Ve,[b(n,{proposalId:m(A).id?m(A).id:k.proposalId},null,8,["proposalId"])])):g("",!0)])])),action:u((()=>[b(I,{loading:m(C),type:"submit",color:"primary",icon:"fas fa-plus",raised:""},{default:u((()=>[h("Create")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Pe={class:"flex-toolbar is-reversed is-flex space-between my-4"},Ce={class:"flex-list-wrapper flex-list-v2"},je={class:"item-name dark-inverted"},Te={class:"item-name dark-inverted"},Ae={class:"light-text"},Oe={class:"light-text"},Se=p("a",{role:"menuitem",class:"dropdown-item is-media"},[p("div",{class:"icon"},[p("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})]),p("div",{class:"meta"},[p("span",null,"View Proposal"),p("span",null,"View proposal detail")])],-1),De=["onClick"],Ue=[p("div",{class:"icon"},[p("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),p("div",{class:"meta"},[p("span",null,"Edit"),p("span",null,"Edit project details")],-1)],Le=["onClick"],Ne=[p("div",{class:"icon"},[p("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1),p("div",{class:"meta"},[p("span",null,"View Detail"),p("span",null,"View detail in page")],-1)],$e=p("a",{role:"menuitem",href:"#",class:"dropdown-item is-media"},[p("div",{class:"icon"},[p("i",{"aria-hidden":"true",class:"lnil lnil-add-files"})]),p("div",{class:"meta"},[p("span",null,"New Task"),p("span",null,"Add a new task")])],-1),Me=p("hr",{class:"dropdown-divider"},null,-1),qe=["onClick"],Ee=[p("div",{class:"icon"},[p("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),p("div",{class:"meta"},[p("span",null,"Delete"),p("span",null,"Delete from list")],-1)],Re=p("img",{class:"light-image",src:Z,alt:""},null,-1),We=p("img",{class:"dark-image",src:Q,alt:""},null,-1),He=l({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},setup(l){const a=l,t=k();V();const o=q(),n=E(),c=s(!1),v=s([]),w=s(!1),O=s(""),S=s(""),D=s("");s(a.activeTab);const U=s({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),L=async()=>{try{c.value=!0;const e=await o.delete(`/api/lead-proposal/${D.value}/`);v.value=e.data,n.success("Proposal delete successfully"),R()}catch(e){n.error(` ${e}, Proposal`),n.error("Something went wrong please try later")}finally{c.value=!1,U.value.isSweetAlertOpen=!1}},N={picture:{label:"Proposal",grow:!0,media:!0},customer:"Created At",industry:"Type",deadline:"Deadline",status:"Status",actions:{label:"Actions",align:"end"}},M=I((()=>{if(S.value){const e=new RegExp(S.value,"i");return v.value.filter((l=>l.title.match(e)||l.approval_deadline.match(e)))}return v.value})),R=()=>{1==a.allProposal?(async()=>{try{c.value=!0;const e=await o.get("/api/lead-proposal/");v.value=e.data}catch(e){n.error(` ${e}, Lead`)}finally{c.value=!1}})():a.leadId&&(async()=>{try{c.value=!0;const e=await o.get(`/api/lead-proposal/by-job/${a.leadId}/`);v.value=e.data}catch(e){n.error(` ${e}, Lead`)}finally{c.value=!1}})()};return i((()=>{R()})),(l,s)=>{const o=$,i=x,n=G,c=Y,k=z,V=K,I=J,q=B,E=Ie,F=e;return r(),_("div",null,[p("div",Pe,[b(o,{icon:"feather:search"},{default:u((()=>[f(p("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>P(S)?S.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[y,m(S)]])])),_:1}),p("div",null,[b(i,{color:"primary",onClick:s[1]||(s[1]=e=>w.value=!m(w)),icon:"fas fa-plus"},{default:u((()=>[h("Lead Proposal")])),_:1})])]),p("div",Ce,[m(M).length>0&&m(v).length>0?(r(),d(V,{key:0,data:m(M),columns:N,rounded:""},{body:u((()=>[b(T,{name:"list",tag:"div",class:"flex-list-inner"},{default:u((()=>[(r(!0),_(C,null,j(m(M),(e=>(r(),_("div",{key:e.id,class:"flex-table-item"},[b(n,{column:{media:!0,grow:!0}},{default:u((()=>[p("div",null,[p("span",je,A(e.title),1)])])),_:2},1024),b(n,{column:{media:!0}},{default:u((()=>[p("div",null,[p("span",Te,A(m(W)(e.created_at)),1),p("span",Ae,A(m(H)(e.created_at)),1)])])),_:2},1024),b(n,null,{default:u((()=>[b(c,{rounded:""},{default:u((()=>[h(A(e.type),1)])),_:2},1024)])),_:2},1024),b(n,null,{default:u((()=>[p("span",Oe,A(e.approval_deadline),1)])),_:2},1024),b(n,null,{default:u((()=>[b(c,{rounded:"",color:"info"},{default:u((()=>[h(A(e.payment_status),1)])),_:2},1024)])),_:2},1024),b(n,{column:{align:"end"}},{default:u((()=>[b(k,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:u((()=>[Se,p("a",{role:"menuitem",onClick:l=>{return a=e.id,O.value=a,void(w.value=!0);var a},class:"dropdown-item is-media"},Ue,8,De),p("a",{role:"menuitem",onClick:l=>m(t).push(`/sidebar/dashboard/proposals/${e.id}`),class:"dropdown-item is-media"},Ne,8,Le),$e,Me,p("a",{role:"menuitem",onClick:l=>{return a=e.id,D.value=a,void(U.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var a},class:"dropdown-item is-media"},Ee,8,qe)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):g("",!0),m(v).length<1&&0==m(M).length?(r(),d(I,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:u((()=>[Re,We])),_:1})):g("",!0),m(M).length>5?(r(),d(q,{key:2,"item-per-page":10,"total-items":873,"current-page":42,"max-links-displayed":7})):g("",!0)]),m(w)?(r(),d(E,{key:0,leadId:a.leadId,proposalId:m(O),leadProposalModal:m(w),"onUpdate:modalHandler":s[2]||(s[2]=e=>w.value=!1),"onUpdate:OnSuccess":R,onClearProposalId:s[3]||(s[3]=e=>O.value="")},null,8,["leadId","proposalId","leadProposalModal"])):g("",!0),m(U).isSweetAlertOpen?(r(),d(F,{key:1,isSweetAlertOpen:m(U).isSweetAlertOpen,title:m(U).title,subtitle:m(U).subtitle,btntext:m(U).btntext,onConfirm:L,onCancel:()=>m(U).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):g("",!0)])}}});export{He as _};
