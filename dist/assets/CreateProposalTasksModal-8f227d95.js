import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-d3ec3e1a.js";import{f as a,r as l,o,C as t,O as s,G as n,D as i,E as d,V as r,W as c,U as u,F as p,N as m,K as v,P as _,Q as f,R as y,S as b,s as g,b as h,B as I,m as w,k,J as C,a7 as V,$ as x,e as P,_ as S,w as D,L as T,X as U,a5 as j,a1 as O,Y as A,j as M,aS as L,I as F,H as $}from"./index-d6b0d16a.js";import{_ as E}from"./VControl-4f62aec1.js";import{_ as H}from"./VRadio.vue_vue_type_style_index_0_lang-bd737bf7.js";import{u as N}from"./useAPI-5a9a505c.js";import{u as q}from"./useNotyf-3544947d.js";import{_ as R}from"./VField.vue_vue_type_script_setup_true_lang-f996f5ed.js";import{a as B,j as z,C as J}from"./useSupportElement-e7ef2a3e.js";import{a as W,_ as G}from"./UnitAddUpdateModal.vue_vue_type_script_setup_true_lang-01d5054e.js";import{_ as K}from"./VTextarea.vue_vue_type_script_setup_true_lang-8db649df.js";import{_ as Q}from"./VInput.vue_vue_type_script_setup_true_lang-9dcb4a33.js";import{_ as Y}from"./VCheckbox.vue_vue_type_style_index_0_lang-23ab4fd5.js";import{_ as X,a as Z}from"./VOption.vue_vue_type_style_index_0_lang-1e870ae0.js";import{s as ee,g as ae,a as le,c as oe}from"./costItems-c1c530a4.js";import{_ as te}from"./VIconButton-d19ba3a7.js";import{u as se}from"./company-444ca41a.js";import{_ as ne}from"./SweetAlert.vue_vue_type_style_index_0_lang-3341500b.js";import{_ as ie}from"./VDropdown.vue_vue_type_style_index_0_lang-8bfbfde3.js";const de={key:0,class:"text-center py-4"},re={key:1},ce={class:"table is-striped is-fullwidth"},ue=(e=>(f("data-v-6d29306e"),e=e(),y(),e))((()=>d("thead",null,[d("tr",null,[d("th",{scope:"col"},"Title"),d("th",{scope:"col"},"Amount"),d("th",{scope:"col"},"Cost Items"),d("th",{scope:"col"},"Approval Deadline"),d("th",{scope:"col"},"Status"),d("th",{scope:"col",class:"is-end"},[d("div",{class:"dark-inverted is-flex is-justify-content-flex-end"}," Select ")])])],-1))),pe={key:0},me={class:"capitalize"},ve={class:"is-end"},_e={class:"is-flex is-justify-content-flex-end"},fe=a({__name:"OpenTempalteModal",props:{openTemplate:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:f}){const y=a,b=N(),g=q(),h=l([]),I=l(null),w=l(!1),k=()=>{f("update:modalHandler",!1)},C=async()=>{I.value?await V(I.value):g.error("Please select a template")},V=async e=>{try{const a=await b.post(`/api/lead-proposal/${e}/import-template/`,{existing_proposal:y.proposalId||"",lead:y.leadId});f("update:OnSuccess",a.data),console.log("test123"),g.success("Template imported successfully!"),k()}catch(a){console.error("Error importing template:",a),g.error("Something went wrong, try again")}};return o((()=>{(async()=>{w.value=!0;try{const e=await b.get("/api/lead-proposal/templates/");h.value=e.data}catch(e){g.error("Failed to fetch templates"),console.error(e)}finally{w.value=!1}})()})),(a,l)=>{const o=H,f=E,b=_,g=e;return t(),s(g,{open:y.openTemplate,size:"big",title:"Template List",actions:"right",onClose:k},{content:n((()=>[w.value?(t(),i("div",de,"Loading...")):(t(),i("div",re,[d("table",ce,[ue,h.value.length?(t(),i("tbody",pe,[(t(!0),i(r,null,c(h.value,(e=>(t(),i("tr",{key:e.id},[d("td",null,u(e.title),1),d("td",null,u(e.proposalAmount),1),d("td",null,u(e.cost_items),1),d("td",null,u(e.approval_deadline),1),d("td",me,u(e.status),1),d("td",ve,[d("div",_e,[p(f,{raw:"",subcontrol:""},{default:n((()=>[p(o,{modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=e=>I.value=e),value:e.id,name:"templateSelection"},null,8,["modelValue","value"])])),_:2},1024)])])])))),128))])):m("",!0)])]))])),action:n((()=>[p(b,{color:"primary",raised:"",onClick:C},{default:n((()=>[v("Confirm")])),_:1})])),cancel:n((()=>[p(b,{color:"primary",style:{display:"none"},raised:""},{default:n((()=>[v("Close")])),_:1})])),_:1},8,["open"])}}}),ye=b(fe,[["__scopeId","data-v-6d29306e"]]),be={class:"multiselect-single-label"},ge={class:"select-label-text"},he={class:"select-label-text"},Ie=a({__name:"CostByCatalog",props:{centeredActionsOpen:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:i}){const r=a;g(),h();const c=q(),m=N();l(!1);const f=l(!1),y=l([]),b=l(""),V=l([]),x=()=>{i("update:modalHandler",!1)},P=()=>{i("update:OnSuccess",null)};return o((async()=>{(async()=>{try{f.value=!0;const e=await m.get("/api/cost/catalogs/");V.value=e.data,y.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{f.value=!1}})()})),(a,l)=>{const o=I("Multiselect"),i=E,f=R,g=_,h=e;return t(),s(h,{open:r.centeredActionsOpen,actions:"right",is:"form",title:"Create Cost item",onSubmit:l[1]||(l[1]=C((e=>(async()=>{const e=V.value.find((e=>e.id==b.value));e?console.log("Matched Item:",e):console.log("No item found with the given ID.");const a=B(e,[]);try{await m.post("/api/cost/",a),x(),P(),c.success("Item added successfully.")}catch(l){c.error("Failed try again")}})()),["prevent"])),onClose:x},{content:n((()=>[p(f,{class:"is-image-select m-b-80",label:"Selecte Catalog"},{default:n((({id:e})=>[p(i,null,{default:n((()=>[p(o,{modelValue:w(b),"onUpdate:modelValue":l[0]||(l[0]=e=>k(b)?b.value=e:null),attrs:{id:e},placeholder:"Select a catalog",label:"name",options:w(y)},{singlelabel:n((({value:e})=>[d("div",be,[d("span",ge,u(e.name),1)])])),option:n((({option:e})=>[d("span",he,u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])),action:n((()=>[p(g,{color:"primary",raised:"",type:"submit"},{default:n((()=>[v(" Confirm ")])),_:1})])),_:1},8,["open"])}}}),we=V("useProposal",(()=>{const e=l(!0),a=q(),o=N(),t=l("");l("");const s=l([]),n=l([]),i=l({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),d=l([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:d,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async l=>{try{l.value=l,e.value=!0;const a=await o.get(`/api/lead-proposal/by-job/${l.value}/`);n.value=a.data}catch(t){a.error(` ${t}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const a=await o.get(`/api/lead-proposal/${e}/detail/`);i.value=a.data,ee.value=a.data.columns_to_show}catch(a){console.log(a)}},getCompanyProposals:async()=>{try{e.value=!0;const a=await o.get("/api/lead-proposal/");s.value=a.data}catch(l){a.error(` ${l}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{t.value=e;const a=await o.get(`/api/cost/by-proposal/${e}/`);d.value=a.data}catch(a){console.log(a)}},clearProposalId:function(){t.value="",d.value=[]}}})),ke=V("useCostCode",(()=>{const e=l(!0),a=q(),o=N(),t=l([]),s=l([]),n=l([{value:"",label:"",labour_cost:"",unit_cost:0,worker_cost:0,unit:"--"}]);return{loading:e,companyProposalsList:t,costCodesList:n,costCodesWholeList:s,getLeadProposals:async l=>{try{l.value=l,e.value=!0;const a=await o.get(`/api/lead-proposal/by-job/${l.value}/`);n.value=a.data}catch(t){a.error(` ${t}, Lead`)}finally{e.value=!1}},getCostCodesHandler:async()=>{try{e.value=!0;const a=await o.get("/api/cost-code/");s.value=a.data,n.value=a.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(a){console.log(a)}finally{e.value=!1}}}})),Ce={class:"modal-form columns is-multiline"},Ve={class:"columns is-multiline"},xe={class:"field column is-6 mb-0"},Pe=d("label",null,"Title: ",-1),Se={class:"control"},De=["disabled"],Te={class:"multiselect-single-label"},Ue={class:"select-label-text"},je={class:"select-label-text"},Oe={key:1,class:"field column is-6"},Ae=d("label",{for:""},"Cost Type",-1),Me={key:2,class:"field column is-3"},Le=d("label",{for:""},"Add to catalogue",-1),Fe={class:"field column is-3"},$e=d("label",{for:""},"Mark As",-1),Ee={class:"field column is-6"},He=d("label",null,"Cost Code *",-1),Ne={class:"field column is-6"},qe=d("label",{for:""},"Group Cost",-1),Re={class:"field column is-12 mb-0"},Be=d("label",{for:"",class:"label"},"Description",-1),ze={class:"field column is-12 mb-0"},Je=d("label",{for:"",class:"label"},"Internal Notes",-1),We={class:"columns is-multiline"},Ge={class:"field column is-6"},Ke=d("label",null,"Unit Cost",-1),Qe={class:"field column is-6"},Ye=d("label",null,"Quantity",-1),Xe={class:"field column is-6"},Ze=d("label",null,"Unit",-1),ea={class:"field column is-6"},aa=d("label",null,"Builder Cost",-1),la={class:"field column is-6"},oa=d("label",null,"Markup (%)",-1),ta={class:"field column is-6"},sa=d("label",null,"Total Price",-1),na={class:"field column is-6"},ia=d("label",null,"Margin (%)",-1),da={class:"field column is-6"},ra=d("label",null,"Worker Cost",-1),ca=a({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean},costMode:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:f}){const y=a,b=g(),V=ke(),O=we();h();const A=q(),M=N(),L=l(!1),F=l(""),$=l([]),H=l([]),z=l(!1),J=l(!1),ee=l({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,worker_cost:0,group:"",catalog:!1,proposal:y.proposalId});l([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]);const ae=l([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]),le=l([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]),oe=async()=>{try{L.value=!0;const e=B(ee.value,[]);if(null!==y.proposalId&&void 0!==y.proposalId&&e.append("proposal",y.proposalId.toString()),y.costItemId){await M.patch(`/api/cost/${y.costItemId}/`,e)}else{const a=await M.post("/api/cost/",e);if(ee.value.catalog){await M.post(`/api/cost/${a.data.id}/create-catalog/`)}O.getProposalDetail(y.proposalId)}te(),se(),A.success("Item added successfully.")}catch(e){A.error(` ${e}, New Worker`)}finally{L.value=!1}},te=()=>{f("update:modalHandler",!1)},se=()=>{f("update:OnSuccess",null)};l(0),l(0);const ne=x((()=>{const e=ee.value.unit_cost*ee.value.quantity;return Number.isFinite(e)?Number(e.toFixed(2)):0}));l(0),l(0);const ie=x((()=>{let e=ne.value;return ee.value.markup>0?e+=e*ee.value.markup/100:ee.value.margin>0&&(e/=1-ee.value.margin/100),Number.isFinite(e)?Number(e.toFixed(2)):0}));x((()=>(ie.value-ne.value)/ne.value*100)),x((()=>(ie.value-ne.value)/ie.value*100));const de=P((()=>S((()=>import("./ckeditor-5f0dead6.js").then((e=>e.c))),["assets/ckeditor-5f0dead6.js","assets/index-d6b0d16a.js","assets/index-da25c80f.css","assets/vue.runtime.esm-bundler-e71617b0.js"]).then((e=>e.default.component)))),re={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},ce=l(!1),ue=l([]),pe=l(!1);D((()=>ee.value.cost_code),((e,a)=>{if(e){const a=ue.value.find((a=>a.id===e));a?(ee.value.unit_cost=a.unit_cost,ee.value.worker_cost=a.worker_cost,ee.value.unit=a.unit):console.warn("No matching item found for cost_code:",e)}}));const me=()=>{if(ee.value.internal_notes){const e=V.costCodesList.find((e=>e.label?.match(ee.value.internal_notes)));e&&(console.log("matched",e.value),ee.value.cost_code=e.value,ee.value.internal_notes.includes("...")?(ee.value.internal_notes="",ee.value.internal_notes="..."):ee.value.internal_notes=""),ee.value.title||(ee.value.title="...")}},ve=l([{id:"",title:"",value:"",description:"",is_active:!0,created_at:"",updated_at:""}]),_e=l([{id:"",title:"",value:"",description:"",is_active:!0,created_at:"",updated_at:""}]),fe=async()=>{try{ce.value=!0;const e=await M.get("/api/units/");ve.value=e.data}catch(e){console.log(e)}finally{ce.value=!1}},ye=async()=>{try{ce.value=!0;const e=await M.get("/api/cost-types/");_e.value=e.data}catch(e){console.log(e)}finally{ce.value=!1}};return D(F,((e,a)=>{const l=$.value.find((e=>e.id==F.value));if(l){const{id:e,proposal_id:a,...o}=l;ee.value=o}})),o((async()=>{b.value=await S((()=>import("./ckeditor-474aa09c.js").then((e=>e.c))),["assets/ckeditor-474aa09c.js","assets/index-d6b0d16a.js","assets/index-da25c80f.css"]).then((e=>e.default)),y.previousItemIndex&&(ee.value.previousItemIndex=y.previousItemIndex),y.costItemId&&(async()=>{try{ce.value=!0;const e=await M.get(`/api/cost/${y.costItemId}/`);ee.value=e.data,me()}catch(e){console.log(e)}finally{ce.value=!1}})(),fe(),(async()=>{try{pe.value=!0;const e=await M.get("/api/cost-code/");ue.value=e.data,ae.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{pe.value=!1}})(),(async()=>{try{ce.value=!0;const e=await M.get("/api/cost/catalogs/");$.value=e.data,H.value=e.data.map((e=>({value:e.id,name:e.title})))}catch(e){console.log(e)}finally{ce.value=!1}})(),ye()})),(a,l)=>{const o=I("Multiselect"),f=E,g=R,h=X,x=Z,P=_,S=Y,D=Q,O=K,A=j,M=W,$=G,N=e;return t(),s(N,{is:"form",open:y.costItemModal,title:"catalog"==y.costMode?"Update Catalog":"Cost Item ",size:"xl",actions:"right",onSubmit:C(oe,["prevent"]),onClose:te},{content:n((()=>[d("div",Ce,[p(A,{class:"column is-12"},{default:n((()=>[d("div",Ve,[d("div",xe,[Pe,d("div",Se,[T(d("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>w(ee).title=e),required:"",disabled:y.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,De),[[U,w(ee).title]])])]),"catalog"!==y.costMode?(t(),s(g,{key:0,class:"column is-6 m-0",label:"Import cost code from catalogue"},{default:n((({id:e})=>[p(f,null,{default:n((()=>[p(o,{modelValue:w(F),"onUpdate:modelValue":l[1]||(l[1]=e=>k(F)?F.value=e:null),attrs:{id:e},placeholder:"Import from cost code",label:"name",options:w(H)},{singlelabel:n((({value:e})=>[d("div",Te,[d("span",Ue,u(e.name),1)])])),option:n((({option:e})=>[d("span",je,u(e.name),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})):m("",!0),"catalog"!==y.costMode?(t(),i("div",Oe,[Ae,p(g,{addons:""},{default:n((()=>[p(f,{expanded:""},{default:n((()=>[p(x,{modelValue:w(ee).cost_type,"onUpdate:modelValue":l[2]||(l[2]=e=>w(ee).cost_type=e),required:"",disabled:y.previewCostItems},{default:n((()=>[(t(!0),i(r,null,c(w(_e),((e,a)=>(t(),s(h,{value:e.value},{default:n((()=>[v(u(e.title),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1}),p(f,null,{default:n((()=>[p(P,{onClick:l[3]||(l[3]=e=>J.value=!w(J)),color:"primary",icon:"fas fa-plus"})])),_:1})])),_:1})])):m("",!0),y.costItemId?m("",!0):(t(),i("div",Me,[Le,d("div",null,[p(f,{raw:"",subcontrol:""},{default:n((()=>[p(S,{modelValue:w(ee).catalog,"onUpdate:modelValue":l[4]||(l[4]=e=>w(ee).catalog=e),label:"Create template",color:"info"},null,8,["modelValue"])])),_:1})])])),d("div",Fe,[$e,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(x,{modelValue:w(ee).mark_as,"onUpdate:modelValue":l[5]||(l[5]=e=>w(ee).mark_as=e),disabled:y.previewCostItems},{default:n((()=>[(t(!0),i(r,null,c(w(le),((e,a)=>(t(),s(h,{value:e.value},{default:n((()=>[v(u(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Ee,[He,p(g,null,{default:n((({id:e})=>[p(f,null,{default:n((()=>[p(o,{required:"",modelValue:w(ee).cost_code,"onUpdate:modelValue":l[6]||(l[6]=e=>w(ee).cost_code=e),disabled:y.previewCostItems,attrs:{id:e},searchable:!0,options:w(V).costCodesList,placeholder:"Select a cost code"},null,8,["modelValue","disabled","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Ne,[qe,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(D,{modelValue:w(ee).group,"onUpdate:modelValue":l[7]||(l[7]=e=>w(ee).group=e),name:"gcost",placeholder:"Group Cost"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Re,[Be,w(b)?(t(),s(w(de),{key:0,disabled:y.previewCostItems,modelValue:w(ee).description,"onUpdate:modelValue":l[8]||(l[8]=e=>w(ee).description=e),editor:w(b),config:re},null,8,["disabled","modelValue","editor"])):m("",!0)]),d("div",ze,[Je,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(O,{modelValue:w(ee).internal_notes,"onUpdate:modelValue":l[9]||(l[9]=e=>w(ee).internal_notes=e),disabled:y.previewCostItems,rows:"3",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),p(A,{class:"column is-12 mt-3"},{default:n((()=>[d("div",We,[d("div",Ge,[Ke,p(g,{addons:""},{default:n((()=>[p(f,{expanded:""},{default:n((()=>[p(D,{modelValue:w(ee).unit_cost,"onUpdate:modelValue":l[10]||(l[10]=e=>w(ee).unit_cost=e),disabled:y.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Qe,[Ye,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(D,{modelValue:w(ee).quantity,"onUpdate:modelValue":l[11]||(l[11]=e=>w(ee).quantity=e),disabled:y.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",Xe,[Ze,p(g,{addons:""},{default:n((()=>[p(f,{expanded:""},{default:n((()=>[p(x,{disabled:y.previewCostItems,modelValue:w(ee).unit,"onUpdate:modelValue":l[12]||(l[12]=e=>w(ee).unit=e)},{default:n((()=>[p(h,{value:""},{default:n((()=>[v(" Select Unit ")])),_:1}),(t(!0),i(r,null,c(w(ve),(e=>(t(),s(h,{value:e.value},{default:n((()=>[v(u(e.title)+" ("+u(e.value)+") ",1)])),_:2},1032,["value"])))),256))])),_:1},8,["disabled","modelValue"])])),_:1}),p(f,null,{default:n((()=>[p(P,{color:"primary",onClick:l[13]||(l[13]=e=>z.value=!w(z)),icon:"fas fa-plus"})])),_:1})])),_:1})]),d("div",ea,[aa,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(D,{modelValue:w(ne),"onUpdate:modelValue":l[14]||(l[14]=e=>k(ne)?ne.value=e:null),disabled:y.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",la,[oa,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(D,{modelValue:w(ee).markup,"onUpdate:modelValue":l[15]||(l[15]=e=>w(ee).markup=e),disabled:y.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",ta,[sa,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(D,{modelValue:w(ie),"onUpdate:modelValue":l[16]||(l[16]=e=>k(ie)?ie.value=e:null),disabled:y.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",na,[ia,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(D,{modelValue:w(ee).margin,"onUpdate:modelValue":l[17]||(l[17]=e=>w(ee).margin=e),disabled:y.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),d("div",da,[ra,p(g,null,{default:n((()=>[p(f,null,{default:n((()=>[p(D,{modelValue:w(ee).worker_cost,"onUpdate:modelValue":l[18]||(l[18]=e=>w(ee).worker_cost=e),type:"number",name:"workerCost",step:"any",placeholder:"Worker Cost"},null,8,["modelValue"])])),_:1})])),_:1})])])])),_:1}),w(z)?(t(),s(M,{key:0,addUpdateCostUnitModal:w(z),"onUpdate:modalHandler":l[19]||(l[19]=e=>z.value=!1),"onUpdate:OnSuccess":l[20]||(l[20]=e=>fe())},null,8,["addUpdateCostUnitModal"])):m("",!0),w(J)?(t(),s($,{key:1,addUpdateCostType:w(J),"onUpdate:modalHandler":l[21]||(l[21]=e=>J.value=!1),"onUpdate:OnSuccess":l[22]||(l[22]=e=>ye())},null,8,["addUpdateCostType"])):m("",!0)])])),action:n((()=>[p(P,{loading:w(L),type:"submit",color:"primary",icon:y.costItemId?"":"fas fa-plus",raised:""},{default:n((()=>[v(u(y.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","title","onSubmit"])}}}),ua={class:"modal-form columns is-multiline"},pa={class:"column is-full"},ma={class:"field"},va=d("label",{class:"label"},"Send To ",-1),_a={class:"control"},fa={class:"column is-full"},ya={class:"field"},ba=d("label",{class:"label"},"Subject ",-1),ga={class:"control"},ha={class:"column is-full"},Ia={class:"field column is-full mt-5"},wa=d("label",{class:"label"},"Message",-1),ka=d("i",{class:"feather:mail"},null,-1),Ca=a({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{},selectedProposalsIds:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:r}){const c=a,u=we(),f=N(),y=q(),b=l(!1),h=g(),V=window.origin;l(`${V}/proposal-view/?proposal=${c.proposalData?.id}`);const x=()=>{r("update:modalHandler",!1)},D=c.selectedProposalsIds.map((e=>e.id)),j=c.selectedProposalsIds.map((e=>e.proposalAmount)).map(((e,a)=>`<li>Total of proposal ${a+1}:<b> $${e} </b></li>`)).join("<br>"),A=D.map(((e,a)=>`<a href="${V}/proposal-view/?proposal=${e}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal ${a+1}, </a>`)).join("<br>"),M=l({email:u.leadProposalFormData?.jobInfo?.clientInfo?.email?u.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:`Proposal ${u.leadProposalFormData?.jobInfo?.title} `,message:`<p><b>Hi ${u.leadProposalFormData?.jobInfo?.clientInfo?.username?u.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${u.leadProposalFormData?.jobInfo?.clientInfo?.last_name?u.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n\n  <p>We hope this message finds you well.</p>\n\n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing.\n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n\n  <p>\n    Actions required for all proposals, and uou can review the full proposal(s), including the cost breakdown, by clicking the link below: <br />\n    ${A}\n  </p>\n\n  <p><b>Respectively proposal(s) amount are:</b></p>\n  <ul>\n    ${j}\n  </ul>\n\n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience.\n    We are here to assist you.\n  </p>\n\n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n\n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`,link:A[0],columns:["cost_code","title","description","unit_cost"],showClient:!0,proposal_ids:D}),L=l([]),F=l([{value:"",label:""}]),$=async()=>{try{b.value=!0;let e=M.value;e.proposal_ids=JSON.stringify(M.value.proposal_ids),e.columns=JSON.stringify(M.value.columns),e.cc_emails=JSON.stringify(L.value);await f.post("/api/lead-proposal/send-proposal-template/",e);y.success("Email sent successfully"),x()}catch(e){console.log(e)}finally{b.value=!1}},H=P((()=>S((()=>import("./ckeditor-5f0dead6.js").then((e=>e.c))),["assets/ckeditor-5f0dead6.js","assets/index-d6b0d16a.js","assets/index-da25c80f.css","assets/vue.runtime.esm-bundler-e71617b0.js"]).then((e=>e.default.component)))),B={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return o((async()=>{h.value=await S((()=>import("./ckeditor-474aa09c.js").then((e=>e.c))),["assets/ckeditor-474aa09c.js","assets/index-d6b0d16a.js","assets/index-da25c80f.css"]).then((e=>e.default)),(async()=>{try{const e=await f.get("/api/users/by-role/admin/");F.value=e.data.map((e=>{const a=e.username||"",l=e.last_name||"";return{value:e.email,label:`${a}${l?" "+l:""}`}}))}catch(e){console.log(e)}})()})),(a,l)=>{const o=I("Multiselect"),r=E,u=R,f=_,y=e;return t(),i("div",null,[p(O,{name:"fade-slow"},{default:n((()=>[p(y,{is:"form",open:c.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:C($,["prevent"]),onClose:x},{content:n((()=>[d("div",ua,[d("div",pa,[d("div",ma,[va,d("div",_a,[T(d("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>w(M).email=e)},null,512),[[U,w(M).email]])])])]),d("div",fa,[d("div",ya,[ba,d("div",ga,[T(d("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>w(M).subject=e)},null,512),[[U,w(M).subject]])])])]),d("div",ha,[p(u,{label:"Cc"},{default:n((({id:e})=>[p(r,null,{default:n((()=>[p(o,{modelValue:w(L),"onUpdate:modelValue":l[2]||(l[2]=e=>k(L)?L.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:w(F),placeholder:"Add people"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",Ia,[wa,w(h)?(t(),s(w(H),{key:0,modelValue:w(M).message,"onUpdate:modelValue":l[3]||(l[3]=e=>w(M).message=e),editor:w(h),config:B},null,8,["modelValue","editor"])):m("",!0)])])])),action:n((()=>[p(f,{type:"submit",color:"primary",loading:w(b),raised:""},{default:n((()=>[ka,v(" Send Proposal")])),_:1},8,["loading"])])),cancel:n((()=>[p(f,{color:"light",onClick:x,raised:""},{default:n((()=>[v("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),Va=N();q();const xa=l(0),Pa=async e=>{try{xa.value=3;const a=await Va.get(`/api/lead-proposal/${e.id}/download/`,{responseType:"blob"}),l=new Blob([a.data],{type:"application/pdf"}),o=document.createElement("a");o.href=URL.createObjectURL(l),o.download=`Proposal-${e.title}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)}catch(a){console.error("Error downloading PDF:",a)}finally{xa.value=0}},Sa=async e=>{try{xa.value=1;const a=await Va.get(`/api/lead-proposal/${e}/download/`,{responseType:"blob"}),l=new Blob([a.data],{type:"application/pdf"}),o=URL.createObjectURL(l),t=window.open(o,"_blank");t?t.onload=()=>{try{t.print()}catch(e){console.error("Error triggering print:",e)}finally{URL.revokeObjectURL(o)}}:console.error("Failed to open PDF in a new window.")}catch(a){console.error("Error printing PDF:",a)}finally{xa.value=0}},Da=e=>(f("data-v-5a92ed1e"),e=e(),y(),e),Ta={class:"columns is-multiline"},Ua=Da((()=>d("div",{class:"column is-9"},[d("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),d("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),ja={class:"column is-12"},Oa={class:"invoice-wrapper"},Aa={class:"invoice-header"},Ma={class:"left"},La={class:"right"},Fa={class:"controls"},$a=[Da((()=>d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"},null,-1)))],Ea=[Da((()=>d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"},null,-1)))],Ha=[Da((()=>d("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],Na={class:"invoice-body"},qa={class:"invoice-card"},Ra={class:"invoice-section is-flex pt-0 mt-4"},Ba=["src"],za=Da((()=>d("div",{class:"meta"},null,-1))),Ja={class:"end is-right"},Wa=Da((()=>d("span",null,"PO Box 242",-1))),Ga=Da((()=>d("span",null,"Evergreen, CO 80437-0242",-1))),Ka=Da((()=>d("span",null,"Phone: 720 272-9061",-1))),Qa={class:"invoice-section is-flex"},Ya={class:"meta"},Xa={key:0},Za={key:1},el={key:2},al={class:"end is-left"},ll={class:"invoice-section"},ol={class:"responsive-table"},tl=["innerHTML"],sl={key:1},nl={key:2},il={key:3},dl={key:4},rl={key:5},cl={key:6},ul={key:7},pl={key:8},ml={key:9},vl={class:"invoice-section is-flex mt-0 pt-0"},_l={class:"end is-left"},fl={class:"text-right"},yl=A('<div class="invoice-section is-flex mt-0 pt-0" data-v-5a92ed1e><div class="footer" data-v-5a92ed1e><h1 class="subtitle is-6 py-0 mb-0" data-v-5a92ed1e> I confirm that my action here represents my electronic signature and is binding. </h1><div class="footer-meta" data-v-5a92ed1e><p data-v-5a92ed1e>Signature:</p><div data-v-5a92ed1e></div></div><div class="footer-meta" data-v-5a92ed1e><p data-v-5a92ed1e>Date:</p><div data-v-5a92ed1e></div></div><div class="footer-meta" data-v-5a92ed1e><p class="no-wrap" data-v-5a92ed1e>Print Name:</p><div data-v-5a92ed1e></div></div></div></div>',1),bl=b(a({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const a=e,n=se(),p=we(),v=l(!1),_=l([]),f=l([]),y=l({}),b=()=>{f.value.push(a.proposalData),y.value=a.proposalData,_.value=p.leadProposalFormData.columns_to_show,v.value=!v.value};function g(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}const h=l({proposal:"Proposal",change_order:"Change Order",draft:"Draft"});return o((()=>{})),(e,l)=>{const o=te,_=Ca;return t(),i("div",Ta,[Ua,d("div",ja,[d("div",Oa,[d("div",Aa,[d("div",Ma,[d("h3",null," Proposal-ID "+u(w(p).leadProposalFormData?.id.slice(0,8)),1)]),d("div",La,[d("div",Fa,[1==w(xa)?(t(),s(o,{key:0,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(t(),i("a",{key:1,class:"action",onClick:l[0]||(l[0]=e=>w(Sa)(w(p).leadProposalFormData?.id))},$a)),3==w(xa)?(t(),s(o,{key:2,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(t(),i("a",{key:3,class:"action",onClick:l[1]||(l[1]=e=>w(Pa)(w(p).leadProposalFormData))},Ea)),d("a",{class:"action",onClick:b},Ha)])])]),d("div",Na,[d("div",qa,[d("div",Ra,[d("img",{style:{height:"110px",padding:"0",margin:"0"},src:w(n).currentCompany.invoice_header_logo},null,8,Ba),za,d("div",Ja,[Wa,Ga,Ka,d("span",null,u(w(n).currentCompany.branding_line),1)])]),d("div",Qa,[d("div",Ya,[w(p).leadProposalFormData?.jobInfo?.title?(t(),i("h3",Xa,u(w(p).leadProposalFormData?.jobInfo?.title?w(p).leadProposalFormData?.jobInfo?.title:""),1)):m("",!0),w(p).leadProposalFormData?.jobInfo?.clientInfo?(t(),i("span",Za,u(w(p).leadProposalFormData?.jobInfo?.clientInfo?.username??"")+" "+u(w(p).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1)):(t(),i("span",el,u(w(p).leadProposalFormData?.jobInfo?.contractor_info?.username??"")+" "+u(w(p).leadProposalFormData?.jobInfo?.contractor_info?.last_name??""),1)),d("span",null,u(w(h)[w(p).leadProposalFormData?.type]),1)]),d("div",al,[d("h3",null,u(w(p).leadProposalFormData?.title),1),d("p",null,u(w(p).leadProposalFormData?.jobInfo?.address??""),1)])]),d("div",ll,[d("table",ol,[d("thead",null,[(t(!0),i(r,null,c(a.columnsToShow,((e,a)=>(t(),i("th",{key:a},u(w(ae)[e]),1)))),128))]),d("tbody",null,[(t(!0),i(r,null,c(w(p).proposalCostItems,((e,l)=>(t(),i("tr",{key:e.id},[(t(!0),i(r,null,c(a.columnsToShow,((a,l)=>(t(),i("td",{key:l},["description"===a?(t(),i("div",{key:0,class:"custom-description",innerHTML:e[w(le)[a]]},null,8,tl)):"cost_code"===a?(t(),i("span",sl,u(e?.cost_code_info?.name),1)):"unit_cost"===a?(t(),i("span",nl,u(g(e?.unit_cost)),1)):"margin"===a?(t(),i("span",il,u(g(e?.margin)),1)):"markup"===a?(t(),i("span",dl,u(g(e?.markup)),1)):"builder_cost"===a?(t(),i("span",rl,u(g(e?.builder_cost)),1)):"total_price"===a?(t(),i("span",cl,u(g(e?.total_price)),1)):"profit"===a?(t(),i("span",ul,u(g(e?.profit)),1)):"group_amount"===a?(t(),i("span",pl,u(g(e?.group_amount)),1)):(t(),i("span",ml,u(e[w(le)[a]]),1))])))),128))])))),128))])])]),d("div",vl,[d("div",_l,[d("h3",fl," Total Price: "+u(g(w(p).leadProposalFormData?.proposalAmount)),1)])]),yl])])])]),w(v)?(t(),s(_,{key:0,proposalSenderModal:w(v),selectedProposalsIds:w(f),proposalData:a.proposalData,columnsToShow:a.columnsToShow,"onUpdate:modalHandler":l[2]||(l[2]=e=>{v.value=!1,f.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData","columnsToShow"])):m("",!0)])}}}),[["__scopeId","data-v-5a92ed1e"]]),gl=e=>(f("data-v-be68936f"),e=e(),y(),e),hl={class:"datatable-wrapper mt-0"},Il={class:"table-container"},wl={class:"table datatable-table is-fullwidth",id:"external-events"},kl=gl((()=>d("th",null,null,-1))),Cl=gl((()=>d("th",null,"Actions",-1))),Vl=["data-event","onDragstart","onDrop","onDblclick"],xl={class:"is-relative"},Pl=["onClick"],Sl=["innerHTML"],Dl={key:1},Tl={key:2},Ul={key:3},jl={key:4},Ol={key:5},Al={key:6},Ml={key:7},Ll={key:8},Fl={key:9},$l=["onClick"],El=[gl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),gl((()=>d("div",{class:"meta"},[d("span",null,"Edit"),d("span",null,"Edit Cost Item")],-1)))],Hl=gl((()=>d("hr",{class:"dropdown-divider"},null,-1))),Nl=["onClick"],ql=[gl((()=>d("div",{class:"icon"},[d("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),gl((()=>d("div",{class:"meta"},[d("span",null,"Remove"),d("span",null,"Remove from list")],-1)))],Rl=a({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{},proposalId:{}},setup(e){const a=e,v=N(),_=l(""),f=l(!1),y=we(),b=q(),g=l(""),h=l(0),I=l(""),k=l(!1),V=l(!1),x=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),P=e=>{e.preventDefault()},S=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},T=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},U=async()=>{try{V.value=!0;await v.delete(`/api/cost/${I.value}/`);O(),x.value.isSweetAlertOpen=!1,b.success("Cost item deleted")}catch(e){console.log(e)}finally{V.value=!1}},j=(e,a=!1)=>{I.value=e.id,k.value=a,g.value=e.proposal,f.value=!f.value},O=()=>{y.getProposalCostItems(g.value)};return D((()=>a.columnsToShow),((e,l)=>{e&&JSON.stringify(e)!==JSON.stringify(l)&&(async()=>{try{a.proposalId&&await v.patch(`/api/lead-proposal/${a.proposalId}/`,{columns_to_show:JSON.stringify(a.columnsToShow)}),y.getProposalDetail(a.proposalId)}catch(e){b.error("Something went wrong, try again")}})()}),{deep:!0}),o((()=>{})),(e,l)=>{const o=ie,b=ne,V=ca;return t(),i("div",hl,[d("div",Il,[d("table",wl,[d("thead",null,[kl,(t(!0),i(r,null,c(a.columnsToShow,((e,a)=>(t(),i("th",{key:a},u(w(ae)[e]),1)))),128)),Cl]),d("tbody",null,[w(y).proposalCostItems.length>0?(t(!0),i(r,{key:0},c(w(y).proposalCostItems,((e,l)=>(t(),i("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:a=>{return l=e.id,_.value=l,void console.log("Drag started for ID:",l);var l},onDrop:a=>(e=>{console.log("Dropped on ID:",e);const a=y.proposalCostItems.find((e=>e.id===_.value)),l=y.proposalCostItems.find((a=>a.id===e));if(a&&l){v.post("/api/cost/drag-drop-items/",{dragged_item_id:a.id,dropped_item_id:l.id});const e=y.proposalCostItems.indexOf(a),o=y.proposalCostItems.indexOf(l);e>=0&&o>=0&&(y.proposalCostItems.splice(e,1),y.proposalCostItems.splice(o,0,a))}else console.error("Dragged or Dropped Item not found");_.value=null})(e.id),onDragover:P,onDragenter:S,onDragleave:T,onDblclick:a=>j(e,!1),class:"draggable-item events"},[d("td",xl,[d("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","z-index":"99","font-weight":"600","font-size":"14px"},onClick:a=>(e=>{g.value=e.proposal,h.value=e.index,f.value=!f.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,Pl)]),(t(!0),i(r,null,c(a.columnsToShow,((a,l)=>(t(),i("td",{key:l},["description"===a?(t(),i("div",{key:0,class:"custom-description",innerHTML:e[w(le)[a]]},null,8,Sl)):"unit_cost"===a?(t(),i("span",Dl,u(w(z)(e[w(le)[a]])),1)):"markup"===a?(t(),i("span",Tl,u(w(z)(e[w(le)[a]])),1)):"total_price"===a?(t(),i("span",Ul,u(w(z)(e[w(le)[a]])),1)):"builder_cost"===a?(t(),i("span",jl,u(w(z)(e[w(le)[a]])),1)):"margin"===a?(t(),i("span",Ol,u(w(z)(e[w(le)[a]])),1)):"profit"===a?(t(),i("span",Al,u(w(z)(e[w(le)[a]])),1)):"worker_cost"===a?(t(),i("span",Ml,u(w(z)(e[w(le)[a]])),1)):(t(),i("span",Ll,u(e[w(le)[a]]),1)),"cost_code"===a?(t(),i("span",Fl,u(e?.cost_code_info?.name),1)):m("",!0)])))),128)),d("td",null,[p(o,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:"",up:"",style:{"z-index":"99"}},{content:n((({close:a})=>[d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:C((()=>{j(e,!1),a()}),["prevent"])},El,8,$l),Hl,d("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:C((()=>{(e=>{I.value=e.id,g.value=e.proposal,x.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),a()}),["prevent"])},ql,8,Nl)])),_:2},1024)])],40,Vl)))),128)):m("",!0)])])]),w(x).isSweetAlertOpen?(t(),s(b,{key:0,isSweetAlertOpen:w(x).isSweetAlertOpen,title:w(x).title,subtitle:w(x).subtitle,btntext:w(x).btntext,onConfirm:U,onCancel:()=>w(x).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):m("",!0),w(f)?(t(),s(V,{key:1,costItemModal:w(f),proposalId:w(g),costItemId:w(I),previousItemIndex:w(h),previewCostItems:w(k),"onUpdate:modalHandler":l[0]||(l[0]=e=>{f.value=!1,I.value=""}),"onUpdate:OnSuccess":O},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):m("",!0)])}}}),Bl=b(Rl,[["__scopeId","data-v-be68936f"]]),zl={class:"columns is-multiline"},Jl={class:"column is-12 is-flex space-between"},Wl=d("div",null,[d("h1",{class:"title is-4"},"Proposal Worksheet")],-1),Gl={class:"is-flex align-items-center"},Kl={key:0,class:"title is-6 mt-5 mr-3"},Ql={key:0,class:"column is-12"},Yl={class:"tabs-wrapper column is-12 m-0"},Xl={class:"tabs-inner mt-4"},Zl={class:"tabs is-boxed"},eo=[d("span",null,"Worksheet",-1)],ao=[d("span",null,"Format",-1)],lo=[d("span",null,"Preview",-1)],oo={key:0,class:"column is-12"},to={class:"card column is-12 mt-3 is-flex space-between"},so={key:0,class:"title is-6 ml-2"},no={key:0,class:"column is-12"},io=d("div",{class:"column is-12",style:{"text-align":"center"}},[d("h1",{class:"title is-4"},"Connect your clients to their projects"),d("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),ro={class:"column is-12"},co={key:0,class:"column is-12"},uo=a({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:a}){const r=e,c=N(),f=q(),y=g(),b=we(),h=l(!1),V=l(!1),x=l(!1),T=l("worksheet");P((()=>S((()=>import("./ckeditor-5f0dead6.js").then((e=>e.c))),["assets/ckeditor-5f0dead6.js","assets/index-d6b0d16a.js","assets/index-da25c80f.css","assets/vue.runtime.esm-bundler-e71617b0.js"]).then((e=>e.default.component))));const U=async()=>{try{b.getProposalCostItems(r.proposalId)}catch(e){console.log(e)}};return D((()=>ee.value),((e,a)=>{e&&JSON.stringify(e)!==JSON.stringify(a)&&(async()=>{try{r.proposalId&&await c.patch(`/api/lead-proposal/${r.proposalId}/`,{columns_to_show:JSON.stringify(ee.value)}),b.getProposalDetail(r.proposalId)}catch(e){f.error("Something went wrong, try again")}})()}),{deep:!0}),o((async()=>{y.value=await S((()=>import("./ckeditor-474aa09c.js").then((e=>e.c))),["assets/ckeditor-474aa09c.js","assets/index-d6b0d16a.js","assets/index-da25c80f.css"]).then((e=>e.default)),r.proposalId&&(U(),b.getProposalDetail(r.proposalId))})),M((()=>{b.clearProposalId()})),(e,a)=>{const l=_,o=I("Multiselect"),c=E,f=R,y=Bl,g=j,P=bl,S=ca,D=Ie;return t(),i("div",null,[d("div",zl,[d("div",Jl,[Wl,d("div",Gl,[r.proposalData?.proposalAmount?(t(),i("h1",Kl," Total Amount: "+u(w(z)(r.proposalData?.proposalAmount)),1)):m("",!0),p(l,{size:"small",light:"",outlined:"",icon:"fas fa-cogs",class:"mr-2",color:w(V)?"danger":"warning",onClick:a[0]||(a[0]=e=>V.value=!w(V))},{default:n((()=>[v("Customize Columns")])),_:1},8,["color"]),p(l,{size:"small",light:"",outlined:"",color:"primary",onClick:a[1]||(a[1]=e=>h.value=!w(h))},{default:n((()=>[v(" Add Item")])),_:1})])]),p(L,{class:"fade-slow",name:"fade-slow"},{default:n((()=>[w(V)?(t(),i("div",Ql,[p(f,{label:"Choose what to show to lead",class:"column is-12"},{default:n((({id:e})=>[p(c,null,{default:n((()=>[p(o,{modelValue:w(ee),"onUpdate:modelValue":a[2]||(a[2]=e=>k(ee)?ee.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:w(oe),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):m("",!0)])),_:1}),d("div",Yl,[d("div",Xl,[d("div",Zl,[d("ul",null,[d("li",{class:F(["worksheet"===w(T)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:a[3]||(a[3]=$(C((e=>T.value="worksheet"),["prevent"]),["space"])),onClick:a[4]||(a[4]=e=>T.value="worksheet")},eo,32)],2),d("li",{class:F(["format"===w(T)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:a[5]||(a[5]=$(C((e=>T.value="format"),["prevent"]),["space"])),onClick:a[6]||(a[6]=e=>T.value="format")},ao,32)],2),d("li",{class:F(["preview"===w(T)?"is-active":"not-active"])},[d("a",{tabindex:"0",role:"button",onKeydown:a[7]||(a[7]=$(C((e=>T.value="preview"),["prevent"]),["space"])),onClick:a[8]||(a[8]=e=>T.value="preview")},lo,32)],2)])])])]),p(L,{class:"fade-slow",name:"slide-x"},{default:n((()=>["worksheet"===w(T)?(t(),i("div",oo,[p(y,{columnsToShow:w(ee),proposalId:r.proposalId,proposalData:r.leadProposalModal},null,8,["columnsToShow","proposalId","proposalData"]),d("div",to,[p(l,{size:"small",light:"",outlined:"",color:"primary",onClick:a[9]||(a[9]=e=>h.value=!w(h))},{default:n((()=>[v(" Add Item")])),_:1}),d("div",null,[v(" Total Amount: "),r.proposalData?.proposalAmount?(t(),i("h1",so,u(w(z)(r.proposalData?.proposalAmount)),1)):m("",!0)])])])):m("",!0)])),_:1}),p(L,{class:"fade-slow",name:"slide-x"},{default:n((()=>["format"===w(T)?(t(),i("div",no,[p(g,{class:"columns is-multiline m-0"},{default:n((()=>[io,d("div",ro,[p(y,{columnsToShow:w(ee),proposalId:r.proposalId},null,8,["columnsToShow","proposalId"])])])),_:1})])):m("",!0)])),_:1}),p(L,{class:"fade-slow",name:"slide-x"},{default:n((()=>["preview"===w(T)?(t(),i("div",co,[p(P,{proposalData:r.proposalData,proposalId:r.proposalId,columnsToShow:w(ee)},null,8,["proposalData","proposalId","columnsToShow"])])):m("",!0)])),_:1})]),w(h)?(t(),s(S,{key:0,costItemModal:w(h),proposalId:r.proposalId,previousItemIndex:w(b).proposalCostItems.length?w(b).proposalCostItems[w(b).proposalCostItems.length-1].index:0,"onUpdate:modalHandler":a[10]||(a[10]=e=>h.value=!1),"onUpdate:OnSuccess":U},null,8,["costItemModal","proposalId","previousItemIndex"])):m("",!0),w(x)?(t(),s(D,{key:1,centeredActionsOpen:w(x),proposalId:r.proposalId,"onUpdate:modalHandler":a[11]||(a[11]=e=>x.value=!1),"onUpdate:OnSuccess":U},null,8,["centeredActionsOpen","proposalId"])):m("",!0)])}}}),po={class:"modal-form columns is-multiline"},mo={class:"column is-12"},vo={class:"columns is-multiline"},_o=d("label",null,"Title: *",-1),fo={class:"control"},yo=d("label",null,"Select Lead *",-1),bo={class:"multiselect-single-label"},go={class:"select-label-text"},ho={class:"select-label-text"},Io={class:"column is-4"},wo=d("label",null,"Approval Deadline *",-1),ko={class:"control"},Co={class:"field column is-2"},Vo=d("label",null,"Attachments",-1),xo=d("div",{class:"file"},[d("label",{class:"file-label"},[d("input",{class:"file-input",type:"file",name:"resume",style:{width:"100%"}}),d("span",{class:"file-cta"},[d("span",{class:"file-icon"},[d("i",{class:"fas fa-cloud-upload-alt"})]),d("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),Po={key:1,class:"column is-2"},So={class:"field column is-2"},Do={class:"column is-12"},To={class:"body-inner-content columns is-multiline"},Uo={class:"field column is-12"},jo=d("label",{for:"",class:"label"},"Internal Notes",-1),Oo={class:"field column is-12 mb-0"},Ao=d("label",{for:"",class:"label"},"Introductory Text",-1),Mo={class:"field column is-12 mb-0"},Lo=d("label",{for:"",class:"label"},"Closing Text",-1),Fo={class:"column is-12",id:"items-div"},$o={key:0},Eo=a({__name:"LeadProposalModal",props:{leadProposalModal:{type:Boolean},proposalId:{},leadId:{},createTemplate:{type:Boolean},getLeadsList:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess","clearProposalId"],setup(a,{emit:r}){const c=a;we(),g(),h();const f=q(),y=N(),b=l(!1),k=l(!1),V=l(""),x=l([]),P=l({id:"",title:"",approval_deadline:"",internal_notes:"",introductory_text:null,closing_text:null,payment_status:"",worksheetItems:[],type:"proposal",project:"",is_template:!1,attachments:[],columns_to_show:[],status:"",created_at:"",updated_at:""}),S=l(!1),D=async(e=!1)=>{try{1==e?S.value=!0:b.value=!0,c.leadId&&(P.value.project=c.leadId),P.value.columns_to_show=JSON.stringify(ee.value);const a=B(P.value,[]);if(c.proposalId||P.value.id){const e=await y.patch(`/api/lead-proposal/${c.proposalId?c.proposalId:P.value.id}/`,a);P.value=e.data,J({object_type:"proposal",action:"UPDATE",performedOnName:"proposal",object_id:c.leadId||P.value.project,message:`updated proposal titled <a>${P.value.title}</a> information.`})}else{const e=await y.post("/api/lead-proposal/",a);P.value=e.data,J({object_type:"proposal",action:"CREATE",performedOnName:"proposal",object_id:c.leadId||P.value.project,message:`created new proposal titled <a>${P.value.title}</a> information.`}),j(100)}1==e&&O(),f.success(`Proposal ${c.proposalId||P.value.id?"updated":"created"} successfully`)}catch(a){f.error("Something went wrong, try again")}finally{b.value=!1,S.value=!1}},j=(e=0)=>{const a=document.getElementById("items-div");if(a){const l=a.offsetTop-e;window.scrollTo({top:l,behavior:"smooth"})}},O=()=>{r("update:modalHandler",!1)},A=l(!1),L=e=>{P.value=e,console.log("test12")};return o((async()=>{c.proposalId&&(async()=>{try{const e=await y.get(`/api/lead-proposal/${c.proposalId}/`);P.value=e.data,ee.value=e.data.columns_to_show}catch(e){console.log(e)}})(),c.getLeadsList&&(async()=>{try{const e=await y.get("/api/project/projects-short-info/");x.value=e.data.map((e=>({value:e.id.toString(),name:e.title}))),V.value=c.leadId||""}catch{f.error("Invalid data")}finally{k.value=!1}})(),c.createTemplate&&(P.value.is_template=!0)})),M((()=>{r("clearProposalId",null),P.value={}})),(a,l)=>{const o=I("Multiselect"),r=E,f=R,y=H,g=_,h=Y,k=K,V=uo,j=ye,M=e;return t(),s(M,{is:"form",open:c.leadProposalModal,title:c.createTemplate?"Proposal Template":"Lead Proposal",size:"xl",actions:"right",onSubmit:C(D,["prevent"]),onClose:O},{content:n((()=>[d("div",po,[d("div",mo,[d("div",vo,[d("div",{class:F(["field mb-0",c.leadId?"column is-12":"column is-6"])},[_o,d("div",fo,[T(d("input",{type:"text",name:"title","onUpdate:modelValue":l[0]||(l[0]=e=>w(P).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[U,w(P).title]])])],2),c.leadId||c.createTemplate?m("",!0):(t(),s(f,{key:0,class:"is-image-select has-curved-images column is-6"},{default:n((()=>[yo,p(r,null,{default:n((()=>[p(o,{modelValue:w(P).project,"onUpdate:modelValue":l[1]||(l[1]=e=>w(P).project=e),placeholder:"Select a lead",label:"name",searchable:!0,"max-height":145,options:w(x)},{singlelabel:n((({value:e})=>[d("div",bo,[d("span",go,u(e.name),1)])])),option:n((({option:e})=>[d("span",ho,u(e.name),1)])),_:1},8,["modelValue","options"])])),_:1})])),_:1})),d("div",Io,[p(f,{class:"m-0 p-0",label:"Type"},{default:n((()=>[p(r,{class:"m-0 p-0"},{default:n((()=>[p(y,{modelValue:w(P).type,"onUpdate:modelValue":l[2]||(l[2]=e=>w(P).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),p(y,{modelValue:w(P).type,"onUpdate:modelValue":l[3]||(l[3]=e=>w(P).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),p(y,{modelValue:w(P).type,"onUpdate:modelValue":l[4]||(l[4]=e=>w(P).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",{class:F(["field",(c.leadId||c.createTemplate,"column is-2")])},[wo,d("div",ko,[T(d("input",{type:"date",name:"firstName","onUpdate:modelValue":l[5]||(l[5]=e=>w(P).approval_deadline=e),class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[U,w(P).approval_deadline]])])],2),d("div",Co,[Vo,p(f,{grouped:"",class:""},{default:n((()=>[p(r,null,{default:n((()=>[xo])),_:1})])),_:1})]),c.createTemplate||w(P).id||c.proposalId?m("",!0):(t(),i("div",Po,[p(g,{color:"primary",class:"mt-5",icon:"fas fa-file-import",onClick:l[6]||(l[6]=e=>A.value=!w(A)),style:{width:"100%"}},{default:n((()=>[v("Templates")])),_:1})])),d("div",So,[p(f,{class:"is-flex mt-3"},{default:n((()=>[p(r,{raw:"",subcontrol:""},{default:n((()=>[p(h,{modelValue:w(P).is_template,"onUpdate:modelValue":l[7]||(l[7]=e=>w(P).is_template=e),label:"Create Template",color:"primary"},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Do,[d("div",To,[d("div",Uo,[jo,p(f,null,{default:n((()=>[p(r,null,{default:n((()=>[p(k,{modelValue:w(P).internal_notes,"onUpdate:modelValue":l[8]||(l[8]=e=>w(P).internal_notes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Oo,[Ao,p(f,null,{default:n((()=>[p(r,null,{default:n((()=>[p(k,{modelValue:w(P).introductory_text,"onUpdate:modelValue":l[9]||(l[9]=e=>w(P).introductory_text=e),rows:"3",placeholder:"Introductory Notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),d("div",Mo,[Lo,p(f,null,{default:n((()=>[p(r,null,{default:n((()=>[p(k,{modelValue:w(P).closing_text,"onUpdate:modelValue":l[10]||(l[10]=e=>w(P).closing_text=e),rows:"2",placeholder:"Closing Text..."},null,8,["modelValue"])])),_:1})])),_:1})])])])])]),d("div",Fo,[w(P).id||c.proposalId?(t(),i("div",$o,[p(V,{proposalId:w(P).id?w(P).id:c.proposalId,proposalData:w(P)},null,8,["proposalId","proposalData"])])):m("",!0)])]),w(A)?(t(),s(j,{key:0,leadId:c.leadId||w(P).project,proposalId:c.proposalId,openTemplate:w(A),"onUpdate:OnSuccess":L,"onUpdate:modalHandler":l[11]||(l[11]=e=>A.value=!1)},null,8,["leadId","proposalId","openTemplate"])):m("",!0)])),action:n((()=>[c.createTemplate?(t(),s(g,{key:0,loading:w(b),type:"submit",color:"primary",raised:""},{default:n((()=>[v(u(c.proposalId||w(P).id?"Update Template":"Create Template"),1)])),_:1},8,["loading"])):(t(),s(g,{key:1,loading:w(b),type:"submit",color:"primary",raised:""},{default:n((()=>[v(u(c.proposalId||w(P).id?"Update Proposal":"Create Proposal"),1)])),_:1},8,["loading"])),p(g,{loading:w(S),onClick:l[12]||(l[12]=e=>D(!0)),color:"info",raised:""},{default:n((()=>[v(u(c.proposalId||w(P).id?"Update & Close":"Create & Close"),1)])),_:1},8,["loading"])])),cancel:n((()=>[p(g,{onClick:l[13]||(l[13]=e=>O()),raised:""},{default:n((()=>[v("Close")])),_:1})])),_:1},8,["open","title","onSubmit"])}}}),Ho=e=>(f("data-v-577783ca"),e=e(),y(),e),No={class:"columns is-multiline"},qo=Ho((()=>d("div",{class:"column is-2"},null,-1))),Ro={class:"column is-8"},Bo=Ho((()=>d("div",{class:"column is-2"},null,-1))),zo=Ho((()=>d("div",{class:"column is-2"},null,-1))),Jo=Ho((()=>d("div",{class:"column is-8"},[d("p",null," All the tasks will be generated and will start from the date you will put. ")],-1))),Wo=Ho((()=>d("div",{class:"column is-2"},null,-1))),Go=a({__name:"CreateProposalTasksModal",props:{createProposalTasksModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(a,{emit:i}){const r=a,c=q(),u=N(),m=l(""),f=l(!1),y=()=>{i("update:OnSuccess",null),i("closeModalHandler",!1)},b=async()=>{try{f.value=!0;await u.post("/api/lead-proposal/create-tasks/",{start:m.value,proposal:r.proposalId});c.success("Tasks of this proposal are created in calendar successfully."),y()}catch(e){console.log(e),c.error("Something went wrong, please review the cost codes")}finally{f.value=!1}};return o((()=>{})),(a,l)=>{const o=Q,i=E,c=R,u=_,g=e;return t(),s(g,{is:"form",open:r.createProposalTasksModal,title:"Generate Tasks",size:"small",actions:"center",onSubmit:C(b,["prevent"]),onClose:y},{content:n((()=>[d("div",No,[qo,d("div",Ro,[p(c,{label:"Enter Tasks Starting Date"},{default:n((()=>[p(i,null,{default:n((()=>[p(o,{modelValue:w(m),"onUpdate:modelValue":l[0]||(l[0]=e=>k(m)?m.value=e:null),required:"",name:"startDate",type:"date"},null,8,["modelValue"])])),_:1})])),_:1})]),Bo,zo,Jo,Wo])])),cancel:n((()=>[p(u,{light:"",onClick:l[1]||(l[1]=e=>y())},{default:n((()=>[v("Cancel")])),_:1})])),action:n((()=>[p(u,{loading:w(f),type:"submit",color:"info",light:"",raised:""},{default:n((()=>[v("Generate")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Ko=b(Go,[["__scopeId","data-v-577783ca"]]);export{Eo as _,Ko as a,ca as b,Ca as c,ke as d,uo as e,xa as f,Pa as g,we as u};
