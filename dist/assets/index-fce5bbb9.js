import{_ as e}from"./UpdateTask.vue_vue_type_script_setup_true_lang-a570885d.js";import{e as t,r as a,w as l,o as s,y as o,z as r,C as n,A as i,B as c,l as u,j as d,O as p,D as v,K as m,J as _,Q as g,R as f,H as y,P as j,E as h,ad as w,W as b,X as k,L as C,v as x,ak as D}from"./index-879cc21e.js";import{_ as I}from"./VDropdown.vue_vue_type_style_index_0_lang-5a74bf98.js";import{_ as P}from"./VField.vue_vue_type_script_setup_true_lang-8fda54d1.js";import{_ as V}from"./VControl-3a0d7b90.js";import{_ as S}from"./VInput.vue_vue_type_script_setup_true_lang-ae22abd0.js";import{i as T,F as A}from"./index-f3193dbb.js";import{i as F}from"./index-1987827f.js";import{u as H}from"./userSession-a2fa2e58.js";import{u as M}from"./useNotyf-953388fb.js";import{u as O}from"./useAPI-bba6ff57.js";import{u as L}from"./viewWrapper-cd4cd6f9.js";import"./VModal.vue_vue_type_style_index_0_lang-02010cfa.js";import"./VTextarea.vue_vue_type_script_setup_true_lang-f608710e.js";import"./useVFieldContext-1b6aa39a.js";import"./VTags.vue_vue_type_script_setup_true_lang-ebc728c4.js";import"./VTag.vue_vue_type_style_index_0_lang-725ce0ff.js";import"./VOption.vue_vue_type_style_index_0_lang-6cc7e380.js";import"./VLabel.vue_vue_type_script_setup_true_lang-010b6911.js";import"./useSupportElement-23fcf6e3.js";import"./VIcon.vue_vue_type_script_setup_true_lang-8eb8745d.js";import"./useDropdown-84fb480e.js";import"./notyf-058d7186.js";import"./useThemeColors-9b3162c4.js";const E=e=>(b("data-v-432125c6"),e=e(),k(),e),U=["onSubmit"],W={class:"datatable-toolbar"},$=[E((()=>n("div",{class:"icon"},[n("i",{class:"lnil lnil-coins"})],-1))),E((()=>n("div",{class:"meta"},[n("span",null,"All"),n("span",null,"All projects owned by company")],-1)))],Y=[E((()=>n("div",{class:"icon"},[n("i",{class:"lnil lnil-dollar-up"})],-1))),E((()=>n("div",{class:"meta"},[n("span",null,"Active"),n("span",null,"Projects that are in progress")],-1)))],z=[E((()=>n("div",{class:"icon"},[n("i",{class:"lnil lnil-bank"})],-1))),E((()=>n("div",{class:"meta"},[n("span",null,"Pending"),n("span",null,"Projects listed but not started")],-1)))],B=E((()=>n("hr",{class:"dropdown-divider"},null,-1))),G=[E((()=>n("div",{class:"icon"},[n("i",{class:"lnil lnil-wallet-alt-1"})],-1))),E((()=>n("div",{class:"meta"},[n("span",null,"Completed"),n("span",null,"Projects that are done")],-1)))],K={style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},R=["onClick"],J={class:"avatars"},N=["src","onClick","title","data-bs-original-title"],Q=["onClick","data-bs-original-title","title"],X=["data-bs-original-title","title"],q=C(t({__name:"ProjectManagerCalendar",setup(t){const b=O(),k=H(),C=M(),x=a(!1);a(!1),a("");const D=a(!1),L=a("all"),E=a(""),q=a([]),Z=a([]),ee=a([]),te=a(0),ae=a(""),le=a(""),se=a(0),oe=a(!0),re=a(!1),ne=a(0);a({all:"all",active:"active",pending:"pending",completed:"completed"});const ie=a({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),ce=a({plugins:[T,F],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineMonth",height:"auto",themeSystem:"cerulean",resourceAreaWidth:"20%",resourceGroupField:"title",resourcesInitiallyExpanded:!1,selectable:!0,headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}}},resourceAreaHeaderContent:"Projects",resources:[],resourceId:se.value,eventDrop:e=>{console.log(e.event),ue(e)},eventResize:e=>{ue(e)},dateClick:e=>{"contractor"!==k.user.role&&("manager"!==k.user.role||e.resource.extendedProps.managers.includes(k.user.id))&&(ne.value=0,te.value=e.resource.id,le.value=e.dateStr,re.value=!0)}}),ue=e=>{if(console.warn("inside func"),console.log("inside ",k.user.role),"contractor"===k.user.role)return console.log("inside ",k.user.role),void e.revert();if("manager"===k.user.role&&!e.event.extendedProps.managers.includes(k.user.id))return e.revert(),void C.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);console.log("resource ids",e.event._def.resourceIds[0]),e.event.extendedProps.project==e.event._def.resourceIds[0]&&confirm(`Are you sure you want to update the project ${e.event.title} date from ${t} to ${a}?`)?ve(e.event.id,t,a):e.revert()},de=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},pe=e=>{window.location.hash="",se.value=e.id,ae.value=e.username,window.location.hash="workerCalendar"},ve=async(e,t,a)=>{try{await b.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),C.success("Task updated successfully")}catch(l){C.error("Something went wrong"),console.log(l)}},me=e=>{const t=ee.value.find((t=>t.id===e));return t?t.managers:[]},_e=()=>{if(console.log("func called",L.value),"all"!==L.value){let e=ee.value.filter((e=>e.status===L.value));Z.value=e}else Z.value=ee.value;E.value&&(Z.value=ee.value.filter((e=>e.title.toLowerCase().includes(E.value.toLowerCase())))),ce.value.resources=Z.value,console.log(Z.value),console.log(Z.value.length)},ge=async()=>{try{x.value=!0,console.log("inside all projects func");const e=await b.get("/api/project/projects",{});ee.value=e.data,Z.value=e.data,console.log("scratch projects",ee.value),x.value=!1}catch(e){console.error(e),ee.value=[],x.value=!1}},fe=async()=>{try{const e=await b.get("/api/task",{});q.value=e.data}catch(e){q.value=[]}};return l(L,((e,t)=>{_e()})),s((async()=>{await Promise.all([ge(),fe()]),(()=>{console.log(ee.value);const e=q.value.map((e=>({id:e.id,resourceId:e.project,project:e.project,start:e.startDate,end:de(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:ie[e.status],managers:me(e.project)})));ee.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color}))),ce.value.resources=ee.value,ce.value.events=e})(),console.log("projects",ce.value),oe.value=!0})),(t,a)=>{const l=S,s=V,b=P,x=I,T=h,F=w,H=e;return o(),r("div",null,[n("form",{onSubmit:m(_e,["prevent"])},[n("div",W,[i(b,{elevated:""},{default:c((()=>[i(s,{icon:"fas fa-search"},{default:c((()=>[i(l,{type:"text",placeholder:"Search projects...",modelValue:u(E),"onUpdate:modelValue":a[0]||(a[0]=e=>d(E)?E.value=e:null),onInput:a[1]||(a[1]=e=>_e()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),i(F,null,{default:c((()=>[i(x,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:c((()=>[n("a",{onClick:a[2]||(a[2]=()=>{_e(),L.value="all"}),class:p(["dropdown-item is-media","all"==u(L)])},$,2),n("a",{href:"#",onClick:a[3]||(a[3]=()=>{_e(),L.value="active"}),class:p(["active"==u(L),"dropdown-item is-media"])},Y,2),n("a",{onClick:a[4]||(a[4]=()=>{_e(),L.value="pending"}),class:p(["pending"==u(L),"dropdown-item is-media"])},z,2),B,n("a",{onClick:a[5]||(a[5]=()=>{_e(),L.value="completed"}),class:p(["completed"==u(L),"dropdown-item is-media"])},G,2)])),_:1}),i(T,{elevated:"",onClick:a[6]||(a[6]=()=>{_e(),L.value="all"}),class:p("all"==u(L)?"active-btn":""),color:"primary"},{default:c((()=>[v("All")])),_:1},8,["class"]),i(T,{elevated:"",onClick:a[7]||(a[7]=()=>{_e(),L.value="active"}),class:p("active"==u(L)?"active-btn":""),color:"info"},{default:c((()=>[v("Active")])),_:1},8,["class"]),i(T,{elevated:"",onClick:a[8]||(a[8]=()=>{_e(),L.value="pending"}),class:p("pending"==u(L)?"active-btn":""),color:"warning"},{default:c((()=>[v("Pre Construction")])),_:1},8,["class"]),i(T,{elevated:"",raised:"",color:"dark",onClick:a[9]||(a[9]=e=>(D.value=!D.value,void document.getElementById("fullCalendarView")))},{default:c((()=>[n("i",{class:p(u(D)?"fa fa-compress":"fa fa-expand")},null,2)])),_:1})])),_:1})])],40,U),i(u(A),{options:u(ce)},{eventContent:c((e=>[n("div",K,[n("p",{style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"},onClick:t=>{return a=e,console.log(a.event),void("contractor"!==k.user.role&&("manager"!==k.user.role||a.event.extendedProps.managers.includes(k.user.id)?(le.value="",re.value=!0,te.value=0,ne.value=a.event.id):C.error("You can modify the task only for the projects for which you are a manager")));var a}},_(e.event.title),9,R),n("div",J,[(o(!0),r(g,null,f(e.event.extendedProps.workers,(e=>(o(),r("div",{class:"avatars__item",key:e.id},[e.avatar?(o(),r("img",{key:0,src:e.avatar,alt:"",onClick:t=>pe(e),title:e.username,"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":e.username?e.username:"Hi"},null,8,N)):(o(),r("div",{key:1,onClick:t=>pe(e),"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":e.username?e.username:"Hi",title:e.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[n("h6",{class:"mb-0",style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":e.username?e.username:"Hi",title:e.username},_(e.username?e.username.slice(0,2):"AA"),9,X)],8,Q))])))),128))])])])),_:1},8,["options"]),u(re)?(o(),y(H,{key:0,isOpen:u(re),taskId:u(ne),projectID:u(te),startDate:u(le),"onUpdate:OnSuccess":a[10]||(a[10]=()=>{ge(),fe()}),"onUpdate:modalHandler":a[11]||(a[11]=()=>{re.value=!1,console.log("Falling in main")})},null,8,["isOpen","taskId","projectID","startDate"])):j("",!0)])}}}),[["__scopeId","data-v-432125c6"]]),Z={class:"page-content-inner"},ee=n("div",{class:"lifestyle-dashboard-bg has-top-nav"},null,-1),te=t({__name:"index",setup:e=>(L().setPageTitle("Manage Projects"),x({title:"Manage Projects"}),(e,t)=>{const a=q;return o(),r("div",Z,[(o(),y(D,{to:"[data-teleport-bg]"},[ee])),i(a)])})});export{te as default};
