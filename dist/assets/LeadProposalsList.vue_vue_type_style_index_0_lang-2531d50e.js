import{_ as e,a}from"./ProposalViewModal.vue_vue_type_style_index_0_lang-cc9c171e.js";import{_ as l}from"./SweetAlert.vue_vue_type_style_index_0_lang-b918f7d0.js";import{a as s,_ as t,b as o}from"./CreateProposalTasksModal-bc0c7a8b.js";import{_ as i}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-ce523aee.js";import{_ as r,c as n}from"./VFlexTable.vue_vue_type_style_index_0_lang-1b4919ef.js";import{_ as d}from"./VTag.vue_vue_type_style_index_0_lang-8cc0f38e.js";import{_ as c}from"./VAvatar.vue_vue_type_style_index_0_lang-c716de6a.js";import{f as p,x as u,y as m,r as v,$ as _,o as f,av as y,C as k,D as g,m as h,F as b,E as w,G as C,L as P,X as x,k as A,V as S,W as I,K as j,O,N as T,aS as D,P as L,I as M,U as V}from"./index-27c88c30.js";import{_ as $}from"./VField.vue_vue_type_script_setup_true_lang-eb404a69.js";import{_ as U}from"./VDropdown.vue_vue_type_style_index_0_lang-2446db18.js";import{_ as H}from"./VControl-40991241.js";import{_ as N}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-7a5c3eb2.js";import{_ as E,a as F}from"./search-4-dark-3664abd4.js";import{u as z}from"./useAPI-5ec06f46.js";import{u as Y}from"./useNotyf-d44b5a33.js";import{f as q,j as B}from"./useSupportElement-6b7f44cb.js";import{b as G,c as K,d as R,e as W}from"./estimatesScripts-aa115846.js";const X={key:0},J={key:1},Q={class:"flex-toolbar is-reversed is-flex space-between my-4"},Z={class:"is-flex g-2"},ee=["value","onClick"],ae={class:"icon"},le={class:"meta"},se={class:"is-flex"},te=w("i",{class:"fas fa-plus"},null,-1),oe=w("i",{class:"fas fa-cogs"},null,-1),ie=w("span",{class:"h-hidden-mobile"}," Proposals ",-1),re={class:"flex-list-wrapper flex-list-v2"},ne={class:"item-name dark-inverted show-text-250"},de={class:"item-meta"},ce=w("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),pe={class:"item-name dark-inverted"},ue=["onClick"],me=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),w("div",{class:"meta"},[w("span",null,"Edit"),w("span",null,"Edit Proposal Details")],-1)],ve=["onClick"],_e=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),w("div",{class:"meta"},[w("span",null,"Preview"),w("span",null,"Preview proposal detail")],-1)],fe=["onClick"],ye=[w("div",{class:"icon"},[w("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),w("div",{class:"meta"},[w("span",null,"Create Tasks"),w("span",null,"Create tasks in chart ")],-1)],ke=["onClick"],ge=[w("div",{class:"icon"},[w("i",{class:"lnir lnir-copy","aria-hidden":"true"})],-1),w("div",{class:"meta"},[w("span",null,"Duplicate "),w("span",null,"Duplicate the proposal")],-1)],he=w("hr",{class:"dropdown-divider"},null,-1),be=["onClick"],we=[w("div",{class:"icon"},[w("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),w("div",{class:"meta"},[w("span",null,"Mark Approved"),w("span",null,"Mark Proposal As Approved")],-1)],Ce=["onClick"],Pe=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),w("div",{class:"meta"},[w("span",null,"Delete"),w("span",null,"Delete from list")],-1)],xe=w("img",{class:"light-image",src:E,alt:""},null,-1),Ae=w("img",{class:"dark-image",src:F,alt:""},null,-1),Se=p({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},emits:["updateCompany"],setup(p,{emit:E}){const F=p,Se=u();m();const Ie=z(),je=Y(),Oe=v([]),Te=v(""),De=v(!1),Le=v(!1),Me=v(!1),Ve=v(!1),$e=v(!1),Ue=v(!1),He=v(!1),Ne=v(""),Ee=v(""),Fe=v("");v(F.activeTab);const ze={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},Ye=v({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),qe=v({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),Be=async()=>{try{De.value=!0;await Ie.delete(`/api/lead-proposal/${Fe.value}/`);je.success("Proposal delete successfully"),Re()}catch(e){je.error(` ${e}, Proposal`),je.error("Something went wrong please try later")}finally{De.value=!1,Ye.value.isSweetAlertOpen=!1}},Ge=async()=>{try{De.value=!0;const e=await Ie.get(`/api/lead-proposal/by-project/${F.leadId}/`);Oe.value=e.data}catch(e){je.error(` ${e}, Lead`)}finally{De.value=!1}},Ke=e=>{Se.push(`/sidebar/dashboard/proposals/${e}`)},Re=()=>{1==F.allProposal?(async()=>{try{De.value=!0;const e=await Ie.get("/api/lead-proposal/");Oe.value=e.data}catch(e){je.error(` ${e}, Lead`)}finally{De.value=!1}})():F.leadId&&Ge()},We=v(""),Xe=v([{desc:"Proposals default list. ",icon:"fas fa-align-left",value:"default",label:"Default"},{desc:"Newly created proposals ",icon:"fas fa-calendar-day",value:"recent",label:"New Proposals"},{desc:"Proposals created recently ",icon:"fas fa-calendar-minus ",value:"old",label:"Old Proposals"},{desc:"Proposals ascending order ",icon:"fas fa-sort-alpha-down",value:"asc",label:"Ascending"},{desc:"Proposals descending order ",icon:"fas fa-sort-alpha-up ",value:"desc",label:"Descending"}]),Je=_((()=>{let e=Oe.value;if(Ee.value){const a=new RegExp(Ee.value,"i");e=e.filter((e=>e.title.match(a)))}switch(We.value){case"recent":e=[...e].sort(((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime()));break;case"old":e=[...e].sort(((e,a)=>new Date(e.created_at).getTime()-new Date(a.created_at).getTime()));break;case"asc":e=[...e].sort(((e,a)=>e.title.localeCompare(a.title)));break;case"desc":e=[...e].sort(((e,a)=>a.title.localeCompare(e.title)))}return e=[...e].sort(((e,a)=>"draft"===e.type&&"draft"!==a.type?1:"draft"!==e.type&&"draft"===a.type?-1:0)),e}));return f((()=>{Re()})),(p,u)=>{const m=N,v=H,_=U,f=$,z=L,Y=c,Se=n,Qe=d,Ze=r,ea=i,aa=s,la=t,sa=e,ta=o,oa=l,ia=a,ra=y("tooltip");return k(),g("div",null,[h(De)?(k(),g("div",X,[b(m)])):(k(),g("div",J,[w("div",Q,[w("div",Z,[b(v,{icon:"feather:search"},{default:C((()=>[P(w("input",{"onUpdate:modelValue":u[0]||(u[0]=e=>A(Ee)?Ee.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[x,h(Ee)]])])),_:1}),b(f,{class:"ml-2"},{default:C((()=>[b(_,{title:"Sort proposal",spaced:""},{content:C((()=>[(k(!0),g(S,null,I(h(Xe),(e=>(k(),g("a",{value:e.value,onClick:a=>We.value=e.value,class:M(["dropdown-item is-media",h(We)===e.value&&"is-active"])},[w("div",ae,[w("i",{class:M(e.icon)},null,2)]),w("div",le,[w("span",null,V(e.label),1),w("span",null,V(e.desc),1)])],10,ee)))),256))])),_:1})])),_:1})]),w("div",se,[b(z,{class:"h-hidden-mobile",color:"primary",onClick:u[1]||(u[1]=e=>Le.value=!h(Le)),icon:"fas fa-plus"},{default:C((()=>[j("Lead Proposal ")])),_:1}),b(z,{class:"h-hidden-desktop",color:"primary",onClick:u[2]||(u[2]=e=>Le.value=!h(Le))},{default:C((()=>[te])),_:1}),F.leadId?(k(),O(z,{key:0,color:"warning",class:"ml-2",onClick:u[3]||(u[3]=e=>{Ve.value=!0})},{default:C((()=>[oe,ie])),_:1})):T("",!0)])]),w("div",re,[h(Je).length>0&&h(Oe).length>0?(k(),O(Ze,{key:0,data:h(Je),columns:ze,rounded:""},{body:C((()=>[b(D,{name:"list",tag:"div",class:"flex-list-inner"},{default:C((()=>[(k(!0),g(S,null,I(h(Je),(e=>(k(),g("div",{key:e.id,class:"flex-table-item"},[b(Se,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>Ke(e.id)},{default:C((()=>[b(Y,{picture:"/images/dummyShareProf/document.png\n                    ",squared:"",size:"medium"}),P((k(),g("div",null,[w("span",ne,V(e.title),1),w("span",de,[w("span",null,[ce,j(V(h(q)(e.created_at)),1)])])])),[[ra,`${e.title}`,void 0,{rounded:!0,light:!0}]])])),_:2},1032,["onClick"]),b(Se,{class:"cu-pointer",onClick:a=>Ke(e.id)},{default:C((()=>[b(Qe,{rounded:"",color:h(G)[e.type]},{default:C((()=>[j(V(h(K)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),b(Se,{class:"cu-pointer",onClick:a=>Ke(e.id)},{default:C((()=>[b(Qe,{class:"capitalized",rounded:"",color:h(R)[e.status]},{default:C((()=>[j(V(h(W)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),b(Se,{class:"cu-pointer",onClick:a=>Ke(e.id),column:{media:!0}},{default:C((()=>[w("div",null,[w("span",pe,V(h(B)(e?.proposalAmount)),1)])])),_:2},1032,["onClick"]),b(Se,{class:"cu-pointer",onClick:a=>Ke(e.id)},{default:C((()=>[b(Qe,{color:"purple",outlined:""},{default:C((()=>[j(V(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),b(Se,{column:{align:"end"}},{default:C((()=>[b(_,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:C((()=>[w("a",{role:"menuitem",onClick:a=>{return l=e.id,Te.value=l,void(Le.value=!0);var l},class:"dropdown-item is-media"},me,8,ue),w("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Ue.value=l,void($e.value=!$e.value);var l},class:"dropdown-item is-media"},_e,8,ve),"approved"==e.status?(k(),g("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,Te.value=l,void(Me.value=!0);var l},class:"dropdown-item is-media"},ye,8,fe)):T("",!0),w("a",{role:"menuitem",onClick:a=>(async e=>{try{await Ie.post(`/api/lead-proposal/${e}/duplicate/`,{project:F.leadId}),je.purple("Proposal duplicated successfully"),Ge()}catch(a){console.log(a)}})(e.id),class:"dropdown-item is-media"},ge,8,ke),he,"approved"!=e.status?(k(),g("a",{key:1,role:"menuitem",onClick:a=>(async(e,a)=>{try{await Ie.patch(`/api/lead-proposal/${a}/`,{status:e}),je.success(`You have ${e} this proposal.`),"approved"==e&&E("updateCompany",null),Re()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},we,8,be)):T("",!0),w("a",{role:"menuitem",onClick:a=>{return l=e.id,Fe.value=l,void(Ye.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},Pe,8,Ce)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):T("",!0),h(Oe).length<1&&0==h(Je).length?(k(),O(ea,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:C((()=>[xe,Ae])),_:1})):T("",!0)]),h(Me)?(k(),O(aa,{key:0,createProposalTasksModal:h(Me),proposalId:h(Te),onCloseModalHandler:u[4]||(u[4]=e=>Me.value=!1),"onUpdate:OnSuccess":u[5]||(u[5]=e=>Re())},null,8,["createProposalTasksModal","proposalId"])):T("",!0),h(Le)?(k(),O(la,{key:1,leadId:F.leadId,proposalId:h(Te),leadProposalModal:h(Le),getLeadsList:F.allProposal,"onUpdate:modalHandler":u[6]||(u[6]=()=>{Re(),Le.value=!1}),onClearProposalId:u[7]||(u[7]=e=>Te.value="")},null,8,["leadId","proposalId","leadProposalModal","getLeadsList"])):T("",!0),h($e)?(k(),O(sa,{key:2,"preview-modal":h($e),proposalId:h(Ue),"onUpdate:modalHandler":u[8]||(u[8]=e=>$e.value=!1)},null,8,["preview-modal","proposalId"])):T("",!0),h(He)?(k(),O(ta,{key:3,costItemModal:h(He),proposalId:h(Ne),"onUpdate:modalHandler":u[9]||(u[9]=e=>He.value=!1),"onUpdate:OnSuccess":Re},null,8,["costItemModal","proposalId"])):T("",!0),h(Ye).isSweetAlertOpen?(k(),O(oa,{key:4,isSweetAlertOpen:h(Ye).isSweetAlertOpen,title:h(Ye).title,subtitle:h(Ye).subtitle,btntext:h(Ye).btntext,onConfirm:Be,onCancel:()=>h(Ye).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):T("",!0),h(qe).isSweetAlertOpen?(k(),O(oa,{key:5,isSweetAlertOpen:h(qe).isSweetAlertOpen,title:h(qe).title,subtitle:h(qe).subtitle,btntext:h(qe).btntext,onConfirm:Be,onCancel:()=>h(qe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):T("",!0),h(Ve)?(k(),O(ia,{key:6,leadProposalListModal:h(Ve),leadID:F.leadId,"group-proposal-modal":h(Ve),"onUpdate:modalHandler":u[10]||(u[10]=e=>Ve.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):T("",!0)]))])}}});export{Se as _};
