import{e,s as l,x as t,v as a,r as s,b as o,_ as i,o as r,B as n,C as p,D as u,E as d,F as c,J as m,l as _,T as v,M as f,K as y,W as b,N as g,O as w,z as h}from"./index-70af507c.js";import{u as x,_ as V,b as C}from"./CreateProposalTasksModal-7ead2602.js";import{_ as A}from"./SweetAlert.vue_vue_type_style_index_0_lang-d291204b.js";import{_ as j}from"./VCollapse.vue_vue_type_style_index_0_lang-5b6ad5e1.js";import{_ as S}from"./VTextarea.vue_vue_type_script_setup_true_lang-e812f757.js";import{_ as O}from"./VField.vue_vue_type_script_setup_true_lang-f9f54325.js";import{_ as I}from"./VControl-a243656f.js";import{_ as k}from"./VRadio.vue_vue_type_style_index_0_lang-ca7f2326.js";import{_ as T}from"./VMessage.vue_vue_type_style_index_0_lang-1b61e863.js";import{u as P}from"./useAPI-7526ffb5.js";import{u as D}from"./useNotyf-98b938b1.js";import{a as U}from"./useSupportElement-6fb37513.js";import{u as N}from"./userSession-2550218b.js";import{u as M}from"./viewWrapper-6f8a849a.js";import"./VModal.vue_vue_type_style_index_0_lang-2bee2677.js";import"./VInput.vue_vue_type_script_setup_true_lang-8c98f35b.js";import"./useVFieldContext-cbf89cef.js";import"./VOption.vue_vue_type_style_index_0_lang-f51655a1.js";import"./VAvatar.vue_vue_type_style_index_0_lang-f1d074f0.js";import"./costItems-db4736e1.js";import"./VDropdown.vue_vue_type_style_index_0_lang-1d6d26a5.js";import"./VIcon.vue_vue_type_script_setup_true_lang-730ef7fb.js";import"./useDropdown-173195f9.js";import"./VLabel.vue_vue_type_script_setup_true_lang-cbf449a1.js";import"./notyf-09d30f13.js";import"./useThemeColors-7b5c93a7.js";const q={class:"modal-form columns is-multiline"},$={class:"column is-12 is-flex space-between align-items-center"},L={key:0,class:"column is-12"},z={class:"field column is-6 mb-0"},E=u("label",null,"Title: *",-1),Y={class:"control"},F={class:"column is-6"},H={class:"field column is-6"},R=u("label",null,"Approval Deadline *",-1),J={class:"control"},W={class:"field column is-6"},B=u("label",null,"Attachments",-1),G=u("div",{class:"file"},[u("label",{class:"file-label"},[u("input",{class:"file-input",type:"file",name:"resume"}),u("span",{class:"file-cta"},[u("span",{class:"file-icon"},[u("i",{class:"fas fa-cloud-upload-alt"})]),u("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),K={class:"field column is-12"},Q={class:"body-inner-content"},X={class:"field columns is-multiline mb-0"},Z={class:"field column is-11 mb-0"},ee=u("label",{for:"",class:"label"},"Internal Notes",-1),le={class:"field column is-11 mb-0"},te=u("label",{for:"",class:"label"},"Introductory Text",-1),ae={class:"field column is-11 mb-0"},se=u("label",{for:"",class:"label"},"Closing Text",-1),oe={class:"column is-12"},ie=e({__name:"ProposalDetailComponent",props:{proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:h}){const M=e,ie=l(),re=x();N();const ne=D(),pe=P(),ue=t(),de=a();s({});const ce=s(!1),me=[{title:"More Details",content:"Add additional information about rota, rate or worker"}],_e=s({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"});s({title:"",description:"",quantity:0,unit:0,unitCost:0,markup:0,clientPrice:0,costCode:"",costType:"",builderCost:"",margin:0,profit:0,internalNotes:""});const ve=s({title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",client_note:"",worksheetItems:[],columns_to_show:[],type:"proposal"}),fe=async()=>{try{ce.value=!0,ve.value.columns_to_show=JSON.stringify(selectedColumnsToShow.value);const e=U(ve.value,[]);if(M.proposalId||ve.value.id){const l=await pe.patch(`/api/lead-proposal/${M.proposalId?M.proposalId:ve.value.id}/`,e);ve.value=l.data}ne.success("Proposal updated successfully")}catch(e){ne.error("Something went wrong, try again")}finally{ce.value=!1}},ye=s(""),be=s(""),ge=s({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),we=async()=>{try{ce.value=!0;await pe.delete(`/api/lead-proposal/${be.value}/`);_e.value.isSweetAlertOpen=!1,ne.success("Proposal delete successfully"),de.go(-1)}catch(e){ne.error(` ${e}, Proposal`),ne.error("Something went wrong please try later")}finally{ce.value=!1}},he=e=>{ye.value=e,_e.value={title:`${ye.value.toLocaleUpperCase()} proposal ?`,subtitle:""+("approve"==ye.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site."),btntext:""+("approve"==ye.value?"Approve":"Disapprove"),isSweetAlertOpen:!0}},xe=async()=>{try{ce.value=!0;await pe.patch(`/api/lead-proposal/${ue.params.id}/`,{status:ye.value});ne.success(`You have ${ye.value} this proposal.`),_e.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{ce.value=!1}},Ve=s(!1),Ce=s("");s("worksheet");const Ae=o((()=>i((()=>import("./ckeditor-dbf08bf4.js").then((e=>e.c))),["assets/ckeditor-dbf08bf4.js","assets/index-70af507c.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-c9a83e39.js"]).then((e=>e.default.component)))),je={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"};return r((async()=>{ie.value=await i((()=>import("./ckeditor-2554a6f6.js").then((e=>e.c))),["assets/ckeditor-2554a6f6.js","assets/index-70af507c.js","assets/index-ce8747cd.css"]).then((e=>e.default)),(M.proposalId||ue.params.id)&&((async()=>{try{const e=await pe.get(`/api/lead-proposal/${ue.params.id}/detail/`);ve.value=e.data,re.getProposalCostItems(ue.params.id)}catch(e){console.log(e)}})(),re.getProposalDetail(M.proposalId||ue.params.id))})),(e,l)=>{const t=w,a=T,s=k,o=I,i=O,r=S,h=j,x=V,P=A,D=C;return n(),p("div",q,[u("div",$,[u("div",null,[d(t,{onClick:l[0]||(l[0]=e=>he("approve")),size:"small",class:"mr-2",light:"",outlined:"",color:"info",raised:""},{default:c((()=>[m(" Approve ")])),_:1}),d(t,{onClick:l[1]||(l[1]=e=>he("disapprove")),size:"small",light:"",outlined:"",color:"warning",raised:""},{default:c((()=>[m(" Disapprove ")])),_:1})]),u("div",null,[d(t,{onClick:fe,size:"small",class:"mr-2",light:"",outlined:"",color:"primary",raised:""},{default:c((()=>[m(" Update ")])),_:1}),d(t,{onClick:l[2]||(l[2]=e=>{return l=_(ue).params.id,Ce.value=l,void(Ve.value=!0);var l}),size:"small",class:"mr-2",light:"",outlined:"",color:"success",raised:""},{default:c((()=>[m(" Generate Tasks ")])),_:1}),d(t,{size:"small",onClick:l[3]||(l[3]=e=>{return l=_(ve).id,be.value=l,void(ge.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l}),light:"",outlined:"",color:"danger",raised:""},{default:c((()=>[m(" Delete ")])),_:1})])]),_(ve).client_note&&"review"==_(ve).status?(n(),p("div",L,[d(a,{color:"warning"},{default:c((()=>[m(v(_(ve).client_note),1)])),_:1})])):f("",!0),u("div",z,[E,u("div",Y,[y(u("input",{type:"text",name:"firstName","onUpdate:modelValue":l[4]||(l[4]=e=>_(ve).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[b,_(ve).title]])])]),u("div",F,[d(i,{class:"m-0 p-0",label:"Type"},{default:c((()=>[d(o,null,{default:c((()=>[d(s,{modelValue:_(ve).type,"onUpdate:modelValue":l[5]||(l[5]=e=>_(ve).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),d(s,{modelValue:_(ve).type,"onUpdate:modelValue":l[6]||(l[6]=e=>_(ve).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),d(s,{modelValue:_(ve).type,"onUpdate:modelValue":l[7]||(l[7]=e=>_(ve).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",H,[R,u("div",J,[y(u("input",{type:"date",name:"firstName","onUpdate:modelValue":l[8]||(l[8]=e=>_(ve).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[b,_(ve).approval_deadline]])])]),u("div",W,[B,d(i,{grouped:""},{default:c((()=>[d(o,null,{default:c((()=>[G])),_:1})])),_:1})]),u("div",K,[d(h,{items:me,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":c((e=>[u("div",Q,[u("div",X,[u("div",Z,[ee,d(i,null,{default:c((()=>[d(o,null,{default:c((()=>[d(r,{modelValue:_(ve).internalNotes,"onUpdate:modelValue":l[9]||(l[9]=e=>_(ve).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",le,[te,_(ie)?(n(),g(_(Ae),{key:0,modelValue:_(ve).introductoryText,"onUpdate:modelValue":l[10]||(l[10]=e=>_(ve).introductoryText=e),editor:_(ie),config:je},null,8,["modelValue","editor"])):f("",!0)]),u("div",ae,[se,_(ie)?(n(),g(_(Ae),{key:0,modelValue:_(ve).closingText,"onUpdate:modelValue":l[11]||(l[11]=e=>_(ve).closingText=e),editor:_(ie),config:je},null,8,["modelValue","editor"])):f("",!0)])])])])),_:1})]),u("div",oe,[d(x,{proposalData:_(ve),proposalId:_(ve).id},null,8,["proposalData","proposalId"])]),_(_e).isSweetAlertOpen?(n(),g(P,{key:1,isSweetAlertOpen:_(_e).isSweetAlertOpen,title:_(_e).title,subtitle:_(_e).subtitle,btntext:_(_e).btntext,onConfirm:xe,onCancel:()=>_(_e).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):f("",!0),_(ge).isSweetAlertOpen?(n(),g(P,{key:2,isSweetAlertOpen:_(ge).isSweetAlertOpen,title:_(ge).title,subtitle:_(ge).subtitle,btntext:_(ge).btntext,onConfirm:we,onCancel:()=>_(ge).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):f("",!0),_(Ve)?(n(),g(D,{key:3,createProposalTasksModal:_(Ve),proposalId:_(Ce),onCloseModalHandler:l[12]||(l[12]=e=>Ve.value=!1),"onUpdate:OnSuccess":e.getCompanyProposalList},null,8,["createProposalTasksModal","proposalId","onUpdate:OnSuccess"])):f("",!0)])}}}),re=e({__name:"[id]",setup:e=>(M().setPageTitle("Lead Proposals"),h({title:"Lead Proposals - Ibex"}),(e,l)=>(n(),p("div",null,[d(ie)])))});export{re as default};
