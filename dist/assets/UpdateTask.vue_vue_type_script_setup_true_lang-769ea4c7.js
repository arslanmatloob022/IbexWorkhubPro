import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-c80cad58.js";import{f as a,av as l,C as t,O as s,G as o,E as u,K as d,U as n,m as i,D as r,V as c,W as p,L as m,F as v,N as f,P as _,r as y,w as k,o as g,B as h,k as V,J as D}from"./index-c7fdba5c.js";import{d as b,a as w}from"./useSupportElement-4d6d7334.js";import{_ as S}from"./VTextarea.vue_vue_type_script_setup_true_lang-7d5dafec.js";import{_ as C,a as x}from"./VOption.vue_vue_type_style_index_0_lang-aaafa272.js";import{_ as U}from"./VField.vue_vue_type_script_setup_true_lang-e3a9734a.js";import{_ as j}from"./VControl-1b31c447.js";import{_ as I}from"./VInput.vue_vue_type_script_setup_true_lang-fffc240a.js";import{_ as T}from"./VLabel.vue_vue_type_script_setup_true_lang-d25b2bf0.js";import{u as L}from"./useAPI-8008ad3e.js";import{u as O}from"./useNotyf-6a61ea77.js";import{C as q}from"./estimatesScripts-caa14913.js";const N={class:"heatmap-wrapper"},$={class:"heatmap-title"},A={class:"title-meta"},M={class:"primary-text"},H={class:"primary-text"},E={class:"heatmap-inner"},B={class:"heatmap-row"},F={class:"heatmap-row-label"},Q={class:"heatmap-row-content"},z={style:{position:"absolute","font-weight":"bold",top:"1px",right:"1px",color:"var(--primary)"}},G={key:0,class:"fas fa-exclamation-triangle warning-text","aria-hidden":"true"},J={key:1,class:"fas fa-check primary-text","aria-hidden":"true"},P=a({__name:"WorkerTasksConflicts",props:{conflictsDetailModal:{type:Boolean},conflictData:{},startDate:{},endDate:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:y}){const k=a,g=()=>{y("update:modalHandler",!0)};return(a,y)=>{const h=_,V=e,D=l("tooltip");return k.conflictsDetailModal?(t(),s(V,{key:0,open:k.conflictsDetailModal,title:"Conflicts Details",actions:"right",size:"big",onClose:g},{content:o((()=>[u("div",N,[u("div",$,[u("div",A,[u("p",null,[d(" Tasks found within given date range: "),u("span",M,n(i(b)(k.startDate)),1),d(" to "),u("span",H,n(i(b)(k.endDate)),1),d(". ")])])]),u("div",E,[(t(!0),r(c,null,p(k.conflictData?.map,(e=>(t(),r("div",B,[u("div",F,[u("span",null,n(e.month),1)]),u("div",Q,[(t(!0),r(c,null,p(e.dates,(a=>{return m((t(),r("div",{key:e.date,class:"heatmap-row-item is-relative"},[u("span",z,n(a.date.slice(8,10)),1),a.count?(t(),r("i",G)):(t(),r("i",J))])),[[D,(l=a.tasks,l&&0!==l.length?l.map((e=>e.title)).join("; "):"No tasks available"),void 0,{rounded:!0,warning:!0}]]);var l})),128))])])))),256))])])])),action:o((()=>[v(h,{style:{display:"none"},color:"primary",raised:""},{default:o((()=>[d(" Confirm ")])),_:1})])),cancel:o((()=>[v(h,{onClick:g,raised:""},{default:o((()=>[d(" Close ")])),_:1})])),_:1},8,["open"])):f("",!0)}}}),W={class:"modal-form columns is-multiline"},K={class:"field column is-6 mb-0"},R={class:"field column is-6 mb-0"},X=u("label",null,"Status ",-1),Y={class:"field column is-6 mb-0"},Z={class:"field column is-6"},ee=u("label",null,"New Cost Code List *",-1),ae={class:"field column is-3 mb-0"},le={class:"field column is-3 mb-0"},te={class:"field column is-3 mb-0"},se={class:"field column is-3 mb-0"},oe={class:"field column is-6 mb-0"},ue=u("label",null,"Select workers * ",-1),de=u("i",{class:"fas fa-exclamation-triangle ml-2","aria-hidden":"true"},null,-1),ne={class:"field column is-6 mb-0"},ie=u("label",null,"Select Subcontractor * ",-1),re={class:"field column is-6 mb-0"},ce={class:"field column is-6 mb-0"},pe=a({__name:"UpdateTask",props:{isOpen:{type:Boolean,default:!1},taskIdSelected:{default:""},projectID:{default:""},endDate:{default:""},startDate:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:l}){const m=a,b=O(),N=L(),$=y([]),A=y([]),M=y(!1),H=y(!1);let E=y([]);y([]),y([]),y();const B=y({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",supplier:"",unit:"",costCode:"",color:"",project:"",priority:"",internalNotes:"",workers:[]});k(E.value,(()=>{console.log("data type",E)}));const F=async()=>{try{M.value=!0,B.value.workers=E.value;let e=w(B.value,["workers"]);m.taskIdSelected?(e.append("schedule_mode","false"),await N.patch(`/api/task/${B.value.id}/`,e),b.success("Task updated successfully"),l("update:OnSuccess",null)):(e.append("schedule_mode","false"),e.append("project",`${m.projectID}`),await N.post("/api/task/",e),l("update:OnSuccess",null),b.success("Task added successfully")),fe()}catch(e){console.log(e)}finally{M.value=!1}},Q=async()=>{try{H.value=!0;const e=await N.delete(`/api/task/${m.taskIdSelected}/`);console.log(e),b.error("Task deleted successfully"),fe(),l("update:OnSuccess",null)}catch(e){console.log(e)}finally{H.value=!1}},z=y({found_tasks:!1,map:[{month:"April 2025",found_task:!1,dates:[{date:"2025-04-15",count:0,tasks:[]}]}]}),G=y(!1),J=y(!1);k((()=>E.value),(()=>{J.value?(async()=>{try{const e=await N.get(`/api/task/worker-wise-date-map/${E.value}/?start_date=${B.value.startDate}&end_date=${B.value.endDate}`);z.value=e.data}catch(e){console.log(e)}})():J.value=!0}));const pe=y(!1),me=y([]),ve=y([]),fe=()=>{l("update:modalHandler",!1),console.log("modal closed")};return g((()=>{m.taskIdSelected&&(async()=>{try{M.value=!0;const e=await N.get(`/api/task/${m.taskIdSelected?m.taskIdSelected:""}/`);B.value=e.data,E.value=e.data.workers.map((e=>e.id))}catch(e){console.log(e)}finally{M.value=!1}})(),(async()=>{try{pe.value=!0;const e=await N.get("/api/cost-code/");me.value=e.data,ve.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{pe.value=!1}})(),(async()=>{try{M.value=!0;const e=await N.get("/api/users/by-role-option/worker/",{});$.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{M.value=!1}})(),(async()=>{try{M.value=!0;const e=await N.get("/api/users/by-role-option/supplier/",{});A.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{M.value=!1}})(),m.startDate&&(B.value.startDate=m.startDate,B.value.endDate=m.endDate)})),(a,l)=>{const y=T,k=I,g=j,b=U,w=C,L=x,O=h("Multiselect"),N=S,J=P,pe=_,me=e;return t(),s(me,{is:"form",open:m.isOpen,title:m.taskIdSelected?"Update Task":"Add Task",size:"big",actions:"right",onSubmit:D(F,["prevent"]),onClose:fe},{content:o((()=>[u("div",W,[u("div",K,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("Title: *")])),_:1}),v(g,null,{default:o((()=>[v(k,{required:"",modelValue:B.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>B.value.title=e),type:"text",placeholder:M.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),u("div",R,[X,v(b,null,{default:o((()=>[v(g,null,{default:o((()=>[v(L,{modelValue:B.value.status,"onUpdate:modelValue":l[1]||(l[1]=e=>B.value.status=e),name:"status",class:"is-rounded"},{default:o((()=>[v(w,{value:""},{default:o((()=>[d("Select Status")])),_:1}),(t(!0),r(c,null,p(i(q),(e=>(t(),s(w,{key:e.value,value:e.value},{default:o((()=>[d(n(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),u("div",Y,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("Cost Code: *")])),_:1}),v(g,null,{default:o((()=>[v(k,{required:"",type:"text",placeholder:M.value?"Loading...":"Cost code",modelValue:B.value.costCode,"onUpdate:modelValue":l[2]||(l[2]=e=>B.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),u("div",Z,[ee,v(b,null,{default:o((({id:e})=>[v(g,null,{default:o((()=>[v(O,{required:"",modelValue:B.value.costCode,"onUpdate:modelValue":l[3]||(l[3]=e=>B.value.costCode=e),attrs:{id:e},searchable:!0,options:ve.value,placeholder:"Select a cost code"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),u("div",ae,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("Quantity")])),_:1}),v(g,null,{default:o((()=>[v(k,{type:"text",placeholder:M.value?"Loading...":"Quantity",modelValue:B.value.quantity,"onUpdate:modelValue":l[4]||(l[4]=e=>B.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),u("div",le,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("Unit")])),_:1}),v(g,null,{default:o((()=>[v(k,{type:"text",placeholder:M.value?"Loading...":"Unit",modelValue:B.value.unit,"onUpdate:modelValue":l[5]||(l[5]=e=>B.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),u("div",te,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("Start Date")])),_:1}),v(g,null,{default:o((()=>[v(k,{type:"date",placeholder:M.value?"Loading...":"Start date",modelValue:B.value.startDate,"onUpdate:modelValue":l[6]||(l[6]=e=>B.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),u("div",se,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("End Date")])),_:1}),v(g,null,{default:o((()=>[v(k,{type:"date",placeholder:M.value?"Loading...":"End date",modelValue:B.value.endDate,"onUpdate:modelValue":l[7]||(l[7]=e=>B.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),u("div",oe,[ue,z.value.found_tasks?(t(),r("span",{key:0,onClick:l[8]||(l[8]=e=>G.value=!0),class:"warning-text cu-pointer"},[d(" Found Tasks Conflicts "),de])):f("",!0),v(b,null,{default:o((({id:e})=>[v(g,null,{default:o((()=>[v(O,{modelValue:i(E),"onUpdate:modelValue":l[9]||(l[9]=e=>V(E)?E.value=e:E=e),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:$.value,placeholder:"Add workers"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),u("div",ne,[ie,v(b,null,{default:o((({id:e})=>[v(g,null,{default:o((()=>[v(O,{modelValue:B.value.supplier,"onUpdate:modelValue":l[10]||(l[10]=e=>B.value.supplier=e),required:!i(E),attrs:{id:e},searchable:!0,"create-tag":!0,options:A.value,placeholder:"Add sub-contractor"},null,8,["modelValue","required","attrs","options"])])),_:2},1024)])),_:1})]),u("div",re,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("Description")])),_:1}),v(g,null,{default:o((()=>[v(N,{type:"text",rows:"3",placeholder:M.value?"Loading...":"Description",modelValue:B.value.description,"onUpdate:modelValue":l[11]||(l[11]=e=>B.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),u("div",ce,[v(b,null,{default:o((()=>[v(y,null,{default:o((()=>[d("Internal Notes")])),_:1}),v(g,null,{default:o((()=>[v(N,{type:"text",rows:"3",placeholder:M.value?"Loading...":"Internal notes",modelValue:B.value.internalNotes,"onUpdate:modelValue":l[12]||(l[12]=e=>B.value.internalNotes=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),G.value?(t(),s(J,{key:0,"conflicts-detail-modal":G.value,"conflict-data":z.value,startDate:B.value.startDate,endDate:B.value.endDate,"onUpdate:modalHandler":l[13]||(l[13]=e=>G.value=!1)},null,8,["conflicts-detail-modal","conflict-data","startDate","endDate"])):f("",!0)])])),action:o((()=>[m.taskIdSelected?(t(),s(pe,{key:0,onClick:Q,class:"is-left",color:"danger",loading:H.value,raised:""},{default:o((()=>[d("Delete")])),_:1},8,["loading"])):f("",!0),v(pe,{type:"submit",loading:M.value,color:"primary",raised:""},{default:o((()=>[d(n(m.taskIdSelected?"Update Task":"Add Task"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{pe as _};
