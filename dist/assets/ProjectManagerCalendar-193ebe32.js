import{_ as e}from"./UpdateTask.vue_vue_type_script_setup_true_lang-1bf5bb9b.js";import{_ as t}from"./VAvatar.vue_vue_type_style_index_0_lang-dab4f5e2.js";import{e as a,r as l,w as s,o as r,A as o,B as n,C as i,D as d,E as c,F as u,l as p,j as v,M as m,H as g,I as y,T as f,U as h,V as _,N as k,ak as w,P as b,Q as j,R as x}from"./index-1cb8d9c0.js";import{_ as C}from"./VDropdown.vue_vue_type_style_index_0_lang-fc61dac7.js";import{_ as D}from"./VField.vue_vue_type_script_setup_true_lang-0ea257de.js";import{_ as S}from"./VControl-b74a7031.js";import{_ as P}from"./VInput.vue_vue_type_script_setup_true_lang-37d30bee.js";import{F as I}from"./FullCalendar-03067f2d.js";import{i as A}from"./index-f52ed8ce.js";import{i as T}from"./index-75e08f06.js";import{u as V}from"./userSession-b1ca1311.js";import{u as H}from"./useNotyf-9453b632.js";import{u as F}from"./useAPI-bf2fd13d.js";const O=e=>(b("data-v-d91d9313"),e=e(),j(),e),U=["onSubmit"],$={class:"datatable-toolbar"},E={key:0,class:"rota-loader"},L=[O((()=>d("div",{class:"icon"},[d("i",{class:"lnil lnil-menu","aria-hidden":"true"})],-1))),O((()=>d("div",{class:"meta"},[d("span",null,"All"),d("span",null,"All projects owned by company")],-1)))],M=[O((()=>d("div",{class:"icon"},[d("i",{class:"lnil lnil-play","aria-hidden":"true"})],-1))),O((()=>d("div",{class:"meta"},[d("span",null,"Active"),d("span",null,"Projects that are in progress")],-1)))],R=[O((()=>d("div",{class:"icon"},[d("i",{class:"lnil lnil-alarm-clock","aria-hidden":"true"})],-1))),O((()=>d("div",{class:"meta"},[d("span",null,"Pending"),d("span",null,"Projects listed but not started")],-1)))],N=O((()=>d("hr",{class:"dropdown-divider"},null,-1))),W=[O((()=>d("div",{class:"icon"},[d("i",{class:"lnil lnil-round-box-check","aria-hidden":"true"})],-1))),O((()=>d("div",{class:"meta"},[d("span",null,"Completed"),d("span",null,"Projects that are done")],-1)))],Y={style:{height:"100%",position:"relative"}},z={key:0,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px",color:"black"}},B=["onClick"],J={style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},Z={key:0,class:"avatars"},K=["src","onClick","title","data-bs-original-title"],Q={class:"v-popover-content is-text"},q={class:"popover-head"},G={class:"dark-inverted"},X={class:"popover-body"},ee=["onClick","data-bs-original-title","title"],te=["data-bs-original-title","title"],ae={key:1,style:{"font-weight":"500","margin-bottom":"0px","padding-left":"10px"}},le=x(a({__name:"ProjectManagerCalendar",setup(a){const b=F(),j=l(null),x=V(),O=H(),le=l(!1);l(!1);const se=l("all"),re=l(""),oe=l([]),ne=l([]),ie=l([]),de=l(0),ce=l(""),ue=l(""),pe=l(""),ve=l(0),me=l(!0),ge=l(!1),ye=l(""),fe=l({pending:"#8392ab",active:"#fbcf33",completed:"#82d616",canceled:"#344767"}),he=l({plugins:[A,T],schedulerLicenseKey:"0965592368-fcs-1694657447",initialView:"resourceTimelineMonth",height:"auto",themeSystem:"cerulean",resourceAreaWidth:"20%",resourcesInitiallyExpanded:!1,selectable:!0,headerToolbar:{left:"today prev,next",center:"title",right:"resourceTimelineWeek,resourceTimelineMonth,resourceTimelineYear"},editable:!0,views:{resourceTimelineWeek:{slotDuration:{days:1,hours:1},slotLabelFormat:{weekday:"short",month:"numeric",day:"numeric",year:"numeric"}}},resourceAreaHeaderContent:"Projects",resources:[],eventDrop:e=>{_e(e),e.revert()},eventResize:e=>{_e(e)},select:e=>{"contractor"!==x.user.role&&("manager"!==x.user.role||e.resource.extendedProps.managers.includes(x.user.id))&&(console.log("start date",e.startStr),ye.value=0,de.value=e.resource.extendedProps.project,ue.value=e.startStr,pe.value=e.endStr,ge.value=!0)}}),_e=e=>{if(console.warn("inside func"),console.log("inside ",x.user.role),"contractor"===x.user.role)return void e.revert();if("manager"===x.user.role&&!e.event.extendedProps.managers.includes(x.user.id))return e.revert(),void O.error("You can modify the task only for the projects for which you are a manager.");let t=e.event.startStr,a=e.event.end.toISOString().substring(0,10);console.log("resource ids",e.event),console.log("event",e.event),e.event.id==e.event._def.publicId&&confirm(`Are you sure you want to update the project ${e.event.title} date from ${t} to ${a}?`)?be(e.event.id,t,a):e.revert()},ke=e=>{let t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().slice(0,10)},we=e=>{window.location.hash="",ve.value=e.id,ce.value=e.username,window.location.hash="workerCalendar"},be=async(e,t,a)=>{try{await b.patch(`/api/task/${e}/`,{startDate:t,endDate:a,schedule_mode:!1}),O.success("Task updated successfully"),await De(),await Se(),xe()}catch(l){O.error("Something went wrong"),console.log(l)}},je=e=>{const t=ie.value.find((t=>t.id===e));return t?t.managers:[]},xe=()=>{console.log(ie.value);const e=[...oe.value.map((e=>({id:e.id,resourceId:e.id,project:e.project,start:e.startDate,end:ke(e.endDate),title:e.title,color:e.color,description:e.description,workers:e.workers,borderColor:fe[e.status],managers:je(e.project)}))),...ie.value.map((e=>({id:e.id,resourceId:e.id,start:e.startDate,end:e.endDate,title:e.title,display:"background",color:e.color})))],t=ie.value.map((e=>{const t=oe.value.filter((t=>t.project===e.id)).map((e=>({id:e.id,title:e.title,project:e.project,initiallyExpanded:!0})));return{id:e.id,title:e.title,eventBackgroundColor:e.color,project:e.id,initiallyExpanded:!0,children:t}}));he.value.resources=t,he.value.events=e},Ce=()=>{if(console.log("func called",se.value),"all"!==se.value){let e=ie.value.filter((e=>e.status===se.value));ne.value=e}else ne.value=ie.value;re.value&&(ne.value=ie.value.filter((e=>e.title.toLowerCase().includes(re.value.toLowerCase())))),he.value.resources=ne.value,console.log(ne.value),console.log(ne.value.length)},De=async()=>{try{le.value=!0,console.log("inside all projects func");const e=await b.get("/api/project/projects/",{});ie.value=e.data,ne.value=e.data,le.value=!1}catch(e){console.error(e),ie.value=[],le.value=!1}},Se=async()=>{try{le.value=!0;const e=await b.get("/api/task/",{});oe.value=e.data}catch(e){oe.value=[]}finally{le.value=!1}};s(se,((e,t)=>{Ce()}));const Pe=async()=>{await Promise.all([De(),Se()]),await xe()};return r((async()=>{await Pe(),me.value=!0})),(a,l)=>{const s=P,r=S,b=D,A=C,T=w,V=t,H=o("Tippy"),F=e;return n(),i("div",null,[d("form",{onSubmit:y(Ce,["prevent"])},[d("div",$,[c(b,{elevated:""},{default:u((()=>[c(r,{icon:"fas fa-search"},{default:u((()=>[c(s,{type:"text",placeholder:"Search projects...",modelValue:p(re),"onUpdate:modelValue":l[0]||(l[0]=e=>v(re)?re.value=e:null),onInput:l[1]||(l[1]=e=>Ce()),class:""},null,8,["modelValue"])])),_:1})])),_:1}),p(le)?(n(),i("div",E)):m("",!0),c(T,null,{default:u((()=>[c(A,{class:"mr-1",title:"Select project filter",right:"",spaced:""},{content:u((()=>[d("a",{onClick:l[2]||(l[2]=()=>{Ce(),se.value="all"}),class:g(["dropdown-item is-media","all"==p(se)?"is-active":""])},L,2),d("a",{href:"#",onClick:l[3]||(l[3]=()=>{Ce(),se.value="active"}),class:g(["active"==p(se)?"is-active":"","dropdown-item is-media"])},M,2),d("a",{onClick:l[4]||(l[4]=()=>{Ce(),se.value="pending"}),class:g(["pending"==p(se)?"is-active":"","dropdown-item is-media"])},R,2),N,d("a",{onClick:l[5]||(l[5]=()=>{Ce(),se.value="completed"}),class:g(["completed"==p(se)?"is-active":"","dropdown-item is-media"])},W,2)])),_:1})])),_:1})])],40,U),c(p(I),{options:p(he),ref_key:"calendarRef",ref:j},{eventContent:u((e=>[d("div",Y,["background"==e.event?.display?(n(),i("p",z," Job: "+f(e.event.title),1)):(n(),i("div",{key:1,onClick:t=>{return a=e,console.log(a.event),void("contractor"!==x.user.role&&("manager"!==x.user.role||a.event.extendedProps.managers.includes(x.user.id)?(ue.value="",ge.value=!0,de.value=0,ye.value=a.event.id):O.error("You can modify the task only for the projects for which you are a manager")));var a},style:{display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"space-between"}},[d("p",J,[(n(!0),i(h,null,_(e.event.extendedProps?.workers,(e=>(n(),i("span",{key:e.id},f(e.username)+", ",1)))),128))]),e.event.extendedProps?.workers?.length?(n(),i("div",Z,[(n(!0),i(h,null,_(e.event.extendedProps.workers,(t=>(n(),i("div",{class:"avatars__item",key:t.id},[c(H,null,{content:u((()=>[d("div",Q,[d("div",q,[c(V,{picture:t.avatar,size:"small"},null,8,["picture"]),d("h4",G,f(t.username?t.username:""),1)]),d("div",X,[d("p",null,f(e.event?.title),1)])])])),default:u((()=>[t.avatar?(n(),i("img",{key:0,src:t.avatar,alt:"",onClick:e=>we(t),title:t.username,"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi"},null,8,K)):m("",!0)])),_:2},1024),0==e.event.extendedProps?.workers?.length?(n(),i("div",{key:0,onClick:e=>we(t),"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username,style:{width:"100%",height:"100%","background-color":"#292f3c",display:"flex","align-items":"center","justify-content":"center"}},[d("h6",{class:"mb-0",style:{color:"white"},"data-bs-toggle":"tooltip","data-bs-placement":"bottom","data-bs-original-title":t.username?t.username:"Hi",title:t.username},f(t.username?t.username.slice(0,2):"AA"),9,te)],8,ee)):m("",!0),d("p",null,f(t.username),1)])))),128))])):m("",!0),e.event.extendedProps?.workers?.length||"background"==e.event?.display?m("",!0):(n(),i("p",ae," No worker is assigned yet "))],8,B))])])),_:1},8,["options"]),p(ge)?(n(),k(F,{key:0,isOpen:p(ge),taskIdSelected:p(ye),projectID:p(de),startDate:p(ue),endDate:p(pe),"onUpdate:OnSuccess":Pe,"onUpdate:modalHandler":l[6]||(l[6]=()=>{ge.value=!1,console.log("Falling in main")})},null,8,["isOpen","taskIdSelected","projectID","startDate","endDate"])):m("",!0)])}}}),[["__scopeId","data-v-d91d9313"]]);export{le as _};
