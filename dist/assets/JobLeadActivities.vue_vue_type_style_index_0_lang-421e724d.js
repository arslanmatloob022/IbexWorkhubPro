import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-1e7bf8a6.js";import{_ as t}from"./ScheduleEmailModal.vue_vue_type_script_setup_true_lang-cb0ee8a8.js";import{_ as l}from"./VModal.vue_vue_type_style_index_0_lang-613ce219.js";import{f as a,r as i,b as s,o as n,B as o,C as u,O as d,G as c,E as r,F as p,L as m,m as v,X as y,D as f,V as _,W as b,K as g,U as h,J as A,N as V,a5 as k,P as w,$ as S,av as C,k as I,I as j,aS as U,a4 as x}from"./index-7c1dcaaf.js";import{_ as $}from"./VTextarea.vue_vue_type_script_setup_true_lang-b143180c.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-680a4511.js";import{_ as M}from"./VField.vue_vue_type_script_setup_true_lang-771aa9b9.js";import{_ as O}from"./VControl-39887b1d.js";import{_ as z,a as P}from"./VOption.vue_vue_type_style_index_0_lang-4d057cdb.js";import{u as E}from"./useAPI-406751a8.js";import{u as q}from"./useNotyf-105f747a.js";import{a as B,g as D,d as H}from"./useSupportElement-83f217cb.js";import{a as L}from"./estimatesScripts-58b89ed3.js";import{_ as R}from"./VAvatar.vue_vue_type_style_index_0_lang-c8c3850c.js";import{_ as N}from"./VIcon.vue_vue_type_script_setup_true_lang-259e8859.js";import{_ as Y}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-47a43eac.js";import{_ as Z}from"./PlaceloadV3.vue_vue_type_style_index_0_lang-85ae075e.js";import{_ as F,a as G}from"./search-3-dark-1eb6ae2e.js";const J={class:"modal-form columns is-multiline"},K={class:"column is-12"},W=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Activity Information")],-1),X={class:"field column is-12 mb-0"},Q=r("label",null,"Title *",-1),ee={class:"control"},te={class:"field column is-6 mb-0"},le=r("label",null,"Activity Type *",-1),ae={class:"field column is-6"},ie=r("label",null,"Status",-1),se={class:"multiselect-single-label"},ne={class:"field column is-6 mb-0"},oe=r("label",null,"Date ",-1),ue={class:"field column is-3 mb-0"},de=r("label",null,"Start Time ",-1),ce={class:"field column is-3 mb-0"},re=r("label",null,"End Time ",-1),pe={class:"field column is-3 mb-0"},me=r("label",null,"Color ",-1),ve=r("datalist",{id:"colors-list"},[r("option",{value:"#84cc16"}),r("option",{value:"#22c55e"}),r("option",{value:"#0ea5e9"}),r("option",{value:"#6366f1"}),r("option",{value:"#8b5cf6"}),r("option",{value:"#d946ef"}),r("option",{value:"#f43f5e"}),r("option",{value:"#facc15"}),r("option",{value:"#fb923c"}),r("option",{value:"#9ca3af"})],-1),ye={class:"field column is-3 mb-0"},fe=r("label",null,"Reminder time: ",-1),_e={class:"field column is-3 mb-0"},be=r("label",null,"Attachment ",-1),ge={class:"file"},he={class:"file-label"},Ae={class:"file-cta"},Ve=r("span",{class:"file-icon"},[r("i",{class:"fas fa-cloud-upload-alt"})],-1),ke={class:"file-label"},we={class:"field column is-12 mb-0"},Se=r("label",null,"Assigned * ",-1),Ce={class:"multiselect-tag is-user"},Ie=["src"],je=["onMousedown"],Ue=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Location")],-1),xe={class:"field column is-4 mb-0"},$e=r("label",null,"Zip Code ",-1),Te={class:"control"},Me={class:"field column is-4 mb-0"},Oe=r("label",null,"City ",-1),ze={class:"control"},Pe={class:"field column is-4 mb-0"},Ee=r("label",null,"State ",-1),qe={class:"control"},Be={class:"field column is-12 mb-0"},De=r("label",null,"Street Address",-1),He={class:"control"},Le={class:"field column is-12 mb-0"},Re=r("label",null,"Description ",-1),Ne=a({__name:"LeadActivityModal",props:{addUpdateContactModal:{type:Boolean},activityId:{},objectId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const a=e;i(null);const S=s(),C=q(),I=E(),j=i(!1),U=()=>{t("update:modalHandler",!1)},x=i([{value:"",name:"",image:""}]),H=i([{label:"Pending",value:"pending"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"},{label:"Rescheduled",value:"rescheduled"},{label:"In Progress",value:"in_progress"}]),R=i({title:"",objectId:a.objectId??"",type:"",color:"",status:"pending",date:"",start_time:"",end_time:"",reminder_time:"",assignedUser:"",attendees:[],initiated_by:S.user.id,address:"",city:"",state:"",zip_code:"",description:"",latitude:0,longitude:0,file:""}),N=async()=>{try{j.value=!0;const e=B(R.value,["file"]);if(a.activityId){await I.patch(`/api/activity/${a.activityId}/`,e);C.success("Activity updated successfully")}else{await I.post("/api/activity/",e);C.success("Activity added successfully")}t("update:OnSuccess",null),U()}catch(e){C.error(` ${e}, Activity`)}finally{j.value=!1}},Y=async()=>{if(!R.value.zip_code)return;const e=await D(R.value.zip_code);console.log("API Response:",e),e?.status&&e.data?(R.value.latitude=e.data.lat,R.value.longitude=e.data.lng,R.value.address=e.data.address,R.value.city=e.data.city,R.value.state=e.data.state,C.success("Address fetched successfully")):console.log("Address not found.")},Z=i(""),F=i(0),G=e=>{const t=e.target,l=t.files?.[0];t.value="",l&&(R.value.file=l,Z.value=l.name,F.value=l.size)};return n((()=>{(async()=>{try{j.value=!0;const e=await I.get("/api/users/");x.value=e.data.map((e=>({value:e.id,name:`${e.username??"N/A"} ${e.last_name??""}`,icon:e.avatar})))}catch(e){C.error("something get wrong")}finally{j.value=!1}})(),a.activityId&&(async()=>{try{j.value=!0;const e=await I.get(`/api/activity/${a.activityId}/`);R.value=e.data}catch(e){C.error(` ${e}, Get Activity`)}finally{j.value=!1}})()})),(e,t)=>{const i=z,s=P,n=O,S=M,C=o("Multiselect"),I=T,E=k,q=$,B=w,D=l;return u(),d(D,{is:"form",open:a.addUpdateContactModal,title:"Activity Details",size:"large",actions:"right",onSubmit:A(N,["prevent"]),onClose:U},{content:c((()=>[r("div",J,[r("div",K,[p(E,{class:"columns is-multiline"},{default:c((()=>[W,r("div",X,[Q,r("div",ee,[m(r("input",{type:"text",name:"title","onUpdate:modelValue":t[0]||(t[0]=e=>v(R).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Title"},null,512),[[y,v(R).title]])])]),r("div",te,[le,p(S,null,{default:c((()=>[p(n,null,{default:c((()=>[p(s,{modelValue:v(R).type,"onUpdate:modelValue":t[1]||(t[1]=e=>v(R).type=e),required:""},{default:c((()=>[(u(!0),f(_,null,b(v(L),(e=>(u(),d(i,{value:e.value},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),r("div",ae,[ie,p(S,null,{default:c((({id:e})=>[p(n,null,{default:c((()=>[p(C,{modelValue:v(R).status,"onUpdate:modelValue":t[2]||(t[2]=e=>v(R).status=e),attrs:{id:e},placeholder:"Select status",label:"name",options:v(H),searchable:!0,"track-by":"name","max-height":145},{singlelabel:c((({value:e})=>[r("div",se,h(e.label),1)])),option:c((({option:e})=>[g(h(e.label),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),r("div",ne,[oe,m(r("input",{type:"date",name:"date","onUpdate:modelValue":t[3]||(t[3]=e=>v(R).date=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(R).date]])]),r("div",ue,[de,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[4]||(t[4]=e=>v(R).start_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(R).start_time]])]),r("div",ce,[re,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[5]||(t[5]=e=>v(R).end_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(R).end_time]])]),r("div",pe,[me,p(S,null,{default:c((()=>[p(n,null,{default:c((()=>[p(I,{modelValue:v(R).color,"onUpdate:modelValue":t[6]||(t[6]=e=>v(R).color=e),list:"colors-list",type:"color",placeholder:"Pick a color"},null,8,["modelValue"]),ve])),_:1})])),_:1})]),r("div",ye,[fe,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[7]||(t[7]=e=>v(R).reminder_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(R).reminder_time]])]),r("div",_e,[be,p(S,{grouped:""},{default:c((()=>[p(n,null,{default:c((()=>[r("div",ge,[r("label",he,[r("input",{onChange:G,class:"file-input",type:"file",name:"resume"},null,32),r("span",Ae,[Ve,r("span",ke,h(v(Z)?v(Z):"Choose a file to attacheâ€¦"),1)])])])])),_:1})])),_:1})]),r("div",we,[Se,p(S,null,{default:c((({id:e})=>[p(n,null,{default:c((()=>[p(C,{required:"",modelValue:v(R).attendees,"onUpdate:modelValue":t[9]||(t[9]=e=>v(R).attendees=e),attrs:{id:e},mode:"tags",placeholder:"Select a user","track-by":"name",label:"name",search:!0,searchable:!0,options:v(x),"max-height":145},{tag:c((({option:e,remove:l,disabled:a})=>[r("div",Ce,[r("img",{src:e.image,alt:""},null,8,Ie),g(" "+h(e.name)+" ",1),a?V("",!0):(u(),f("i",{key:0,role:"button",tabindex:"0",onClick:t[8]||(t[8]=A((()=>{}),["prevent"])),onMousedown:A((t=>l(e)),["prevent","stop"])},null,40,je))])])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])])),_:1}),p(E,{class:"columns is-multiline mt-3"},{default:c((()=>[Ue,r("div",xe,[$e,r("div",Te,[m(r("input",{type:"text",name:"state",onBlur:Y,"onUpdate:modelValue":t[10]||(t[10]=e=>v(R).zip_code=e),class:"input is-primary-focus is-primary-focus",placeholder:"Zip Code"},null,544),[[y,v(R).zip_code]])])]),r("div",Me,[Oe,r("div",ze,[m(r("input",{type:"text",name:"city","onUpdate:modelValue":t[11]||(t[11]=e=>v(R).city=e),class:"input is-primary-focus is-primary-focus",placeholder:"City"},null,512),[[y,v(R).city]])])]),r("div",Pe,[Ee,r("div",qe,[m(r("input",{type:"text",name:"state","onUpdate:modelValue":t[12]||(t[12]=e=>v(R).state=e),class:"input is-primary-focus is-primary-focus",placeholder:"State"},null,512),[[y,v(R).state]])])]),r("div",Be,[De,r("div",He,[m(r("input",{type:"tel",name:"phone","onUpdate:modelValue":t[13]||(t[13]=e=>v(R).address=e),class:"input is-primary-focus is-primary-focus",placeholder:"Street Address"},null,512),[[y,v(R).address]])])]),r("div",Le,[Re,p(S,null,{default:c((()=>[p(n,null,{default:c((()=>[p(q,{modelValue:v(R).description,"onUpdate:modelValue":t[14]||(t[14]=e=>v(R).description=e),rows:"3",placeholder:"Enter description..."},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1})])])])),action:c((()=>[p(B,{loading:v(j),type:"submit",color:"primary",raised:""},{default:c((()=>[g(h(a.activityId?"Update":"Create")+" Activity",1)])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Ye={key:1},Ze={class:"card-grid-toolbar"},Fe={class:"buttons"},Ge={class:"card-grid card-grid-v3"},Je=r("img",{class:"light-image",src:F,alt:""},null,-1),Ke=r("img",{class:"dark-image",src:G,alt:""},null,-1),We=["onClick"],Xe=["checked"],Qe={class:"toggler"},et=r("span",{class:"active"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:check"})],-1),tt={class:"inactive"},lt={class:"dark-inverted"},at={class:"people"},it={class:"buttons"},st=["onClick"],nt=[r("span",{class:"icon"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:edit-2"})],-1),r("span",null,"Edit",-1)],ot=a({__name:"JobLeadActivities",props:{jobId:{},getUserActivities:{type:Boolean},user:{}},setup(l){const a=l,o=i(""),A=i({}),k=i(!1),$=i(!1),T=i([{id:"",attendees_info:[{id:"",username:"",last_name:null,email:"",role:"",avatar:""}],initiated_by_info:{id:"",username:"",last_name:"",email:"",role:"",avatar:""},title:"",description:"",objectId:"",type:"",color:"",status:"",date:"",start_time:"",end_time:"",reminder_time:"",created_at:"",address:"",city:"",state:"",zip_code:"",file:null,latitude:0,longitude:0,initiated_by:"",attendees:[""]}]),B=E(),D=q(),F=s(),G=i(!1),J=i(""),K=async e=>{try{G.value=!0;const t=await B.get(`/api/activity/by-user/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{G.value=!1}},W=i(!1),X=S((()=>{if(!T.value)return[];const e=new RegExp(o.value,"i"),t=J.value?.trim();return T.value.filter((l=>{const a=!o.value||e.test(l.title)||e.test(l.start_time)||e.test(l.end_time)||e.test(l.date)||e.test(l.status)||e.test(l.type),i=!t||l.type===t;return a&&i}))})),Q=i({}),ee=i(""),te=i({title:"Are you sure?",subtitle:"This action cannot be undone.",color:"warning",btnText:"Yes Complete It",icon:"fas fa-bell",isSweetAlertOpen:!1}),le=async()=>{try{G.value=!1;let e={status:"completed"==Q.value.status?"pending":"completed"};await B.patch(`/api/activity/${ee.value}/`,e);D.success("Activity updated successfully"),ae(),te.value.isSweetAlertOpen=!1}catch(e){D.error(` ${e}, Activity`)}finally{G.value=!1}},ae=()=>{a.getUserActivities?K(F.user.id):a.user?K(a.user):a.jobId?(async e=>{try{G.value=!0;const t=await B.get(`/api/activity/by-object/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{G.value=!1}})(a.jobId):(async()=>{try{G.value=!0;const e=await B.get("/api/activity/");T.value=e.data}catch(e){D.error("something get wrong")}finally{G.value=!1}})()};return n((()=>{ae()})),(l,i)=>{const s=Z,n=O,S=z,T=P,E=M,q=w,F=Y,K=N,ie=R,se=Ne,ne=t,oe=e,ue=C("tooltip");return v(G)?(u(),d(s,{key:0})):(u(),f("div",Ye,[r("div",Ze,[p(n,{icon:"feather:search"},{default:c((()=>[m(r("input",{"onUpdate:modelValue":i[0]||(i[0]=e=>I(o)?o.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[y,v(o)]])])),_:1}),r("div",Fe,[p(E,null,{default:c((()=>[p(n,null,{default:c((()=>[p(T,{modelValue:v(J),"onUpdate:modelValue":i[1]||(i[1]=e=>I(J)?J.value=e:null),required:""},{default:c((()=>[p(S,{value:""},{default:c((()=>[g("All")])),_:1}),(u(!0),f(_,null,b(v(L),(e=>(u(),d(S,{value:e.value},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1}),p(q,{onClick:i[2]||(i[2]=e=>k.value=!v(k)),color:"warning",icon:"lnir lnir-alarm"},{default:c((()=>[g(" Create Activity ")])),_:1}),p(q,{onClick:i[3]||(i[3]=e=>$.value=!v($)),color:"success",class:"ml-2",icon:"fas fa-envelope"},{default:c((()=>[g(" Schedule Email ")])),_:1})])]),r("div",Ge,[p(F,{class:j([0!==v(X).length&&"is-hidden"]),title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\nsearch terms you've entered. Please try different search terms or\ncriteria.",larger:""},{image:c((()=>[Je,Ke])),_:1},8,["class"]),p(U,{name:"list",tag:"div",class:"columns is-multiline is-flex-tablet-p is-half-tablet-p"},{default:c((()=>[(u(!0),f(_,null,b(v(X),(e=>(u(),f("div",{key:e.id,class:"column is-4"},[r("div",{class:"card-grid-item",style:x({backgroundImage:`linear-gradient(\n-175deg,\ntransparent 70%,\n${e.color}30\n`})},[r("label",{class:"h-toggle",onClick:t=>{return l=e,Q.value=l,ee.value=l.id,void(te.value={title:`${l.title}`,subtitle:`Are you sure you have ${"completed"==Q.value.status?"pending":"completed"} this activity?`,color:"warning",btnText:"Yes, Mark "+("completed"==Q.value.status?"pending":"completed"),icon:"fas fa-bell",isSweetAlertOpen:!0});var l}},[r("input",{type:"checkbox",checked:"completed"==e.status},null,8,Xe),r("span",Qe,[et,r("span",tt,[p(K,{icon:"lucide:activity"})])])],8,We),p(ie,{size:"large",picture:`/IbexIcons/ActivitiesIcons/${e.type}.png`,squared:""},null,8,["picture"]),r("h3",lt,h(e.title),1),r("p",null,h(v(H)(e.date))+" remaining",1),r("div",at,[(u(!0),f(_,null,b(e.attendees_info,(e=>m((u(),d(ie,{key:e.id,size:"small",initials:e.username.slice(0,2),picture:e.avatar},null,8,["initials","picture"])),[[ue,`${e.username} ${e.last_name?e.last_name:""}`,void 0,{rounded:!0}]]))),128))]),r("div",it,[p(q,{onClick:t=>(async(e="")=>{try{W.value=!0,204===(await B.delete(`/api/activity/${e}/`)).status?(D.success("Activity deleted successfully"),ae()):D.error("Something went wrong")}catch(t){console.log("Err in deleting activity",t)}finally{W.value=!1}})(e.id),loading:v(W),icon:"feather:trash",outlined:""},{default:c((()=>[g(" Delete ")])),_:2},1032,["onClick","loading"]),r("button",{onClick:t=>{return l=e.id,A.value=l,void(k.value=!0);var l},class:"button v-button is-dark-outlined"},nt,8,st)])],4)])))),128))])),_:1})]),v(k)?(u(),d(se,{key:0,addUpdateContactModal:v(k),objectId:a.jobId,activityId:v(A),"onUpdate:modalHandler":i[4]||(i[4]=e=>k.value=!1),"onUpdate:OnSuccess":ae},null,8,["addUpdateContactModal","objectId","activityId"])):V("",!0),v($)?(u(),d(ne,{key:1,mailSchedulerModal:v($),"onUpdate:modalHandler":i[5]||(i[5]=e=>$.value=!1)},null,8,["mailSchedulerModal"])):V("",!0),v(te).isSweetAlertOpen?(u(),d(oe,{key:2,isSweetAlertOpen:v(te).isSweetAlertOpen,title:v(te).title,subtitle:v(te).subtitle,btntext:v(te).btnText,onConfirm:le,onCancel:()=>{v(te).isSweetAlertOpen=!1,ae()}},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):V("",!0)]))}}});export{ot as _};
