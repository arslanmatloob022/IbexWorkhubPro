import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-e23a966f.js";import{_ as t}from"./ScheduleEmailModal.vue_vue_type_script_setup_true_lang-7bf05230.js";import{_ as l}from"./VModal.vue_vue_type_style_index_0_lang-201942aa.js";import{f as a,r as i,b as s,o as n,B as o,C as u,O as d,G as c,E as r,F as p,L as m,m as v,X as y,D as f,V as _,W as b,K as g,U as h,J as A,N as V,a5 as k,P as w,$ as C,av as S,k as j,I,aS as U,a4 as x}from"./index-5437c3ff.js";import{_ as $}from"./VTextarea.vue_vue_type_script_setup_true_lang-8a1a778e.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-b86e2a7b.js";import{_ as O}from"./VField.vue_vue_type_script_setup_true_lang-88afe542.js";import{_ as M}from"./VControl-99928d1c.js";import{_ as z,a as P}from"./VOption.vue_vue_type_style_index_0_lang-4400f155.js";import{u as E}from"./useAPI-15ad727f.js";import{u as q}from"./useNotyf-19e6534b.js";import{a as L,g as D,d as H}from"./useSupportElement-64af5555.js";import{a as B}from"./estimatesScripts-a303076d.js";import{_ as N}from"./VAvatar.vue_vue_type_style_index_0_lang-84b318a5.js";import{_ as R}from"./VIcon.vue_vue_type_script_setup_true_lang-6f36a692.js";import{_ as Z}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-b09384ab.js";import{_ as F}from"./PlaceloadV3.vue_vue_type_style_index_0_lang-f2ac2b2d.js";import{_ as G,a as J}from"./search-3-dark-1eb6ae2e.js";const W={class:"modal-form columns is-multiline"},Y={class:"column is-12"},K=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Activity Information")],-1),X={class:"field column is-12 mb-0"},Q=r("label",null,"Title *",-1),ee={class:"control"},te={class:"field column is-6 mb-0"},le=r("label",null,"Activity Type *",-1),ae={class:"field column is-6"},ie=r("label",null,"Status",-1),se={class:"multiselect-single-label"},ne={class:"field column is-6 mb-0"},oe=r("label",null,"Date ",-1),ue={class:"field column is-3 mb-0"},de=r("label",null,"Start Time ",-1),ce={class:"field column is-3 mb-0"},re=r("label",null,"End Time ",-1),pe={class:"field column is-3 mb-0"},me=r("label",null,"Color ",-1),ve=r("datalist",{id:"colors-list"},[r("option",{value:"#84cc16"}),r("option",{value:"#22c55e"}),r("option",{value:"#0ea5e9"}),r("option",{value:"#6366f1"}),r("option",{value:"#8b5cf6"}),r("option",{value:"#d946ef"}),r("option",{value:"#f43f5e"}),r("option",{value:"#facc15"}),r("option",{value:"#fb923c"}),r("option",{value:"#9ca3af"})],-1),ye={class:"field column is-3 mb-0"},fe=r("label",null,"Reminder time: ",-1),_e={class:"field column is-3 mb-0"},be=r("label",null,"Attachment ",-1),ge={class:"file"},he={class:"file-label"},Ae={class:"file-cta"},Ve=r("span",{class:"file-icon"},[r("i",{class:"fas fa-cloud-upload-alt"})],-1),ke={class:"file-label"},we={class:"field column is-12 mb-0"},Ce=r("label",null,"Assigned * ",-1),Se={class:"multiselect-tag is-user"},je=["src"],Ie=["onMousedown"],Ue=r("div",{class:"column is-12"},[r("h3",{class:"title is-6 mb-2"},"Location")],-1),xe={class:"field column is-4 mb-0"},$e=r("label",null,"Zip Code ",-1),Te={class:"control"},Oe={class:"field column is-4 mb-0"},Me=r("label",null,"City ",-1),ze={class:"control"},Pe={class:"field column is-4 mb-0"},Ee=r("label",null,"State ",-1),qe={class:"control"},Le={class:"field column is-12 mb-0"},De=r("label",null,"Street Address",-1),He={class:"control"},Be={class:"field column is-12 mb-0"},Ne=r("label",null,"Description ",-1),Re=a({__name:"LeadActivityModal",props:{addUpdateContactModal:{type:Boolean},activityId:{},objectId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const a=e;i(null);const C=s(),S=q(),j=E(),I=i(!1),U=()=>{t("update:modalHandler",!1)},x=i([{value:"",name:"",image:""}]),H=i([{label:"Pending",value:"pending"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"},{label:"Rescheduled",value:"rescheduled"},{label:"In Progress",value:"in_progress"}]),N=i({title:"",objectId:a.objectId??"",type:"",color:"",status:"pending",date:"",start_time:"",end_time:"",reminder_time:"",assignedUser:"",attendees:[],initiated_by:C.user.id,address:"",city:"",state:"",zip_code:"",description:"",latitude:0,longitude:0,file:""}),R=async()=>{try{I.value=!0;const e=L(N.value,["file"]);if(a.activityId){await j.patch(`/api/activity/${a.activityId}/`,e);S.success("Activity updated successfully")}else{await j.post("/api/activity/",e);S.success("Activity added successfully")}t("update:OnSuccess",null),U()}catch(e){S.error(` ${e}, Activity`)}finally{I.value=!1}},Z=async()=>{if(!N.value.zip_code)return;const e=await D(N.value.zip_code);console.log("API Response:",e),e?.status&&e.data?(N.value.latitude=e.data.lat,N.value.longitude=e.data.lng,N.value.address=e.data.address,N.value.city=e.data.city,N.value.state=e.data.state,S.success("Address fetched successfully")):console.log("Address not found.")},F=i(""),G=i(0),J=e=>{const t=e.target,l=t.files?.[0];t.value="",l&&(N.value.file=l,F.value=l.name,G.value=l.size)};return n((()=>{(async()=>{try{I.value=!0;const e=await j.get("/api/users/");x.value=e.data.map((e=>({value:e.id,name:`${e.username??"N/A"} ${e.last_name??""}`,icon:e.avatar})))}catch(e){S.error("something get wrong")}finally{I.value=!1}})(),a.activityId&&(async()=>{try{I.value=!0;const e=await j.get(`/api/activity/${a.activityId}/`);N.value=e.data}catch(e){S.error(` ${e}, Get Activity`)}finally{I.value=!1}})()})),(e,t)=>{const i=z,s=P,n=M,C=O,S=o("Multiselect"),j=T,E=k,q=$,L=w,D=l;return u(),d(D,{is:"form",open:a.addUpdateContactModal,title:"Activity Details",size:"large",actions:"right",onSubmit:A(R,["prevent"]),onClose:U},{content:c((()=>[r("div",W,[r("div",Y,[p(E,{class:"columns is-multiline"},{default:c((()=>[K,r("div",X,[Q,r("div",ee,[m(r("input",{type:"text",name:"title","onUpdate:modelValue":t[0]||(t[0]=e=>v(N).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Title"},null,512),[[y,v(N).title]])])]),r("div",te,[le,p(C,null,{default:c((()=>[p(n,null,{default:c((()=>[p(s,{modelValue:v(N).type,"onUpdate:modelValue":t[1]||(t[1]=e=>v(N).type=e),required:""},{default:c((()=>[(u(!0),f(_,null,b(v(B),(e=>(u(),d(i,{value:e.value},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),r("div",ae,[ie,p(C,null,{default:c((({id:e})=>[p(n,null,{default:c((()=>[p(S,{modelValue:v(N).status,"onUpdate:modelValue":t[2]||(t[2]=e=>v(N).status=e),attrs:{id:e},placeholder:"Select status",label:"name",options:v(H),searchable:!0,"track-by":"name","max-height":145},{singlelabel:c((({value:e})=>[r("div",se,h(e.label),1)])),option:c((({option:e})=>[g(h(e.label),1)])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),r("div",ne,[oe,m(r("input",{type:"date",name:"date","onUpdate:modelValue":t[3]||(t[3]=e=>v(N).date=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).date]])]),r("div",ue,[de,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[4]||(t[4]=e=>v(N).start_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).start_time]])]),r("div",ce,[re,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[5]||(t[5]=e=>v(N).end_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).end_time]])]),r("div",pe,[me,p(C,null,{default:c((()=>[p(n,null,{default:c((()=>[p(j,{modelValue:v(N).color,"onUpdate:modelValue":t[6]||(t[6]=e=>v(N).color=e),list:"colors-list",type:"color",placeholder:"Pick a color"},null,8,["modelValue"]),ve])),_:1})])),_:1})]),r("div",ye,[fe,m(r("input",{type:"time",name:"date","onUpdate:modelValue":t[7]||(t[7]=e=>v(N).reminder_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[y,v(N).reminder_time]])]),r("div",_e,[be,p(C,{grouped:""},{default:c((()=>[p(n,null,{default:c((()=>[r("div",ge,[r("label",he,[r("input",{onChange:J,class:"file-input",type:"file",name:"resume"},null,32),r("span",Ae,[Ve,r("span",ke,h(v(F)?v(F):"Choose a file to attacheâ€¦"),1)])])])])),_:1})])),_:1})]),r("div",we,[Ce,p(C,null,{default:c((({id:e})=>[p(n,null,{default:c((()=>[p(S,{required:"",modelValue:v(N).attendees,"onUpdate:modelValue":t[9]||(t[9]=e=>v(N).attendees=e),attrs:{id:e},mode:"tags",placeholder:"Select a user","track-by":"name",label:"name",search:!0,searchable:!0,options:v(x),"max-height":145},{tag:c((({option:e,remove:l,disabled:a})=>[r("div",Se,[r("img",{src:e.image,alt:""},null,8,je),g(" "+h(e.name)+" ",1),a?V("",!0):(u(),f("i",{key:0,role:"button",tabindex:"0",onClick:t[8]||(t[8]=A((()=>{}),["prevent"])),onMousedown:A((t=>l(e)),["prevent","stop"])},null,40,Ie))])])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])])),_:1}),p(E,{class:"columns is-multiline mt-3"},{default:c((()=>[Ue,r("div",xe,[$e,r("div",Te,[m(r("input",{type:"text",name:"state",onBlur:Z,"onUpdate:modelValue":t[10]||(t[10]=e=>v(N).zip_code=e),class:"input is-primary-focus is-primary-focus",placeholder:"Zip Code"},null,544),[[y,v(N).zip_code]])])]),r("div",Oe,[Me,r("div",ze,[m(r("input",{type:"text",name:"city","onUpdate:modelValue":t[11]||(t[11]=e=>v(N).city=e),class:"input is-primary-focus is-primary-focus",placeholder:"City"},null,512),[[y,v(N).city]])])]),r("div",Pe,[Ee,r("div",qe,[m(r("input",{type:"text",name:"state","onUpdate:modelValue":t[12]||(t[12]=e=>v(N).state=e),class:"input is-primary-focus is-primary-focus",placeholder:"State"},null,512),[[y,v(N).state]])])]),r("div",Le,[De,r("div",He,[m(r("input",{type:"tel",name:"phone","onUpdate:modelValue":t[13]||(t[13]=e=>v(N).address=e),class:"input is-primary-focus is-primary-focus",placeholder:"Street Address"},null,512),[[y,v(N).address]])])]),r("div",Be,[Ne,p(C,null,{default:c((()=>[p(n,null,{default:c((()=>[p(q,{modelValue:v(N).description,"onUpdate:modelValue":t[14]||(t[14]=e=>v(N).description=e),rows:"3",placeholder:"Enter description..."},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1})])])])),action:c((()=>[p(L,{loading:v(I),type:"submit",color:"primary",raised:""},{default:c((()=>[g(h(a.activityId?"Update":"Create")+" Activity",1)])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Ze={key:1},Fe={class:"card-grid-toolbar"},Ge={class:"buttons"},Je={class:"card-grid card-grid-v3"},We=r("img",{class:"light-image",src:G,alt:""},null,-1),Ye=r("img",{class:"dark-image",src:J,alt:""},null,-1),Ke=["onClick"],Xe=["checked"],Qe={class:"toggler"},et=r("span",{class:"active"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:check"})],-1),tt={class:"inactive"},lt={class:"dark-inverted"},at={class:"people"},it={class:"buttons"},st=["onClick"],nt=[r("span",{class:"icon"},[r("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:edit-2"})],-1),r("span",null,"Edit",-1)],ot=a({__name:"JobLeadActivities",props:{jobId:{},getUserActivities:{type:Boolean},user:{}},setup(l){const a=l,o=i(""),A=i({}),k=i(!1),$=i(!1),T=i([{id:"",attendees_info:[{id:"",username:"",last_name:null,email:"",role:"",avatar:""}],initiated_by_info:{id:"",username:"",last_name:"",email:"",role:"",avatar:""},title:"",description:"",objectId:"",type:"",color:"",status:"",date:"",start_time:"",end_time:"",reminder_time:"",created_at:"",address:"",city:"",state:"",zip_code:"",file:null,latitude:0,longitude:0,initiated_by:"",attendees:[""]}]),L=E(),D=q(),G=s(),J=i(!1),W=i(""),Y=async e=>{try{J.value=!0;const t=await L.get(`/api/activity/by-user/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{J.value=!1}},K=i(!1),X=C((()=>{if(!T.value)return[];const e=new RegExp(o.value,"i"),t=W.value?.trim();return T.value.filter((l=>{const a=!o.value||e.test(l.title)||e.test(l.start_time)||e.test(l.end_time)||e.test(l.date)||e.test(l.status)||e.test(l.type),i=!t||l.type===t;return a&&i}))})),Q=i({}),ee=i(""),te=i({title:"Are you sure?",subtitle:"This action cannot be undone.",color:"warning",btnText:"Yes Complete It",icon:"fas fa-bell",isSweetAlertOpen:!1}),le=async()=>{try{J.value=!1;let e={status:"completed"==Q.value.status?"pending":"completed"};await L.patch(`/api/activity/${ee.value}/`,e);D.success("Activity updated successfully"),ae(),te.value.isSweetAlertOpen=!1}catch(e){D.error(` ${e}, Activity`)}finally{J.value=!1}},ae=()=>{a.getUserActivities?Y(G.user.id):a.user?Y(a.user):a.jobId?(async e=>{try{J.value=!0;const t=await L.get(`/api/activity/by-object/${e}/`);T.value=t.data}catch(t){D.error("something get wrong")}finally{J.value=!1}})(a.jobId):(async()=>{try{J.value=!0;const e=await L.get("/api/activity/");T.value=e.data}catch(e){D.error("something get wrong")}finally{J.value=!1}})()};return n((()=>{ae()})),(l,i)=>{const s=F,n=M,C=z,T=P,E=O,q=w,G=Z,Y=R,ie=N,se=Re,ne=t,oe=e,ue=S("tooltip");return v(J)?(u(),d(s,{key:0})):(u(),f("div",Ze,[r("div",Fe,[p(n,{icon:"feather:search"},{default:c((()=>[m(r("input",{"onUpdate:modelValue":i[0]||(i[0]=e=>j(o)?o.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[y,v(o)]])])),_:1}),r("div",Ge,[p(E,null,{default:c((()=>[p(n,null,{default:c((()=>[p(T,{modelValue:v(W),"onUpdate:modelValue":i[1]||(i[1]=e=>j(W)?W.value=e:null),required:""},{default:c((()=>[p(C,{value:""},{default:c((()=>[g("All")])),_:1}),(u(!0),f(_,null,b(v(B),(e=>(u(),d(C,{value:e.value},{default:c((()=>[g(h(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1}),p(q,{onClick:i[2]||(i[2]=e=>k.value=!v(k)),color:"warning",icon:"lnir lnir-alarm"},{default:c((()=>[g(" Create Activity ")])),_:1}),p(q,{onClick:i[3]||(i[3]=e=>$.value=!v($)),color:"success",class:"ml-2",icon:"fas fa-envelope"},{default:c((()=>[g(" Schedule Email ")])),_:1})])]),r("div",Je,[p(G,{class:I([0!==v(X).length&&"is-hidden"]),title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\nsearch terms you've entered. Please try different search terms or\ncriteria.",larger:""},{image:c((()=>[We,Ye])),_:1},8,["class"]),p(U,{name:"list",tag:"div",class:"columns is-multiline is-flex-tablet-p is-half-tablet-p"},{default:c((()=>[(u(!0),f(_,null,b(v(X),(e=>(u(),f("div",{key:e.id,class:"column is-4"},[r("div",{class:"card-grid-item",style:x({backgroundImage:`linear-gradient(\n-175deg,\ntransparent 70%,\n${e.color}30\n`})},[r("label",{class:"h-toggle",onClick:t=>{return l=e,Q.value=l,ee.value=l.id,void(te.value={title:`${l.title}`,subtitle:`Are you sure you have ${"completed"==Q.value.status?"pending":"completed"} this activity?`,color:"warning",btnText:"Yes, Mark "+("completed"==Q.value.status?"pending":"completed"),icon:"fas fa-bell",isSweetAlertOpen:!0});var l}},[r("input",{type:"checkbox",checked:"completed"==e.status},null,8,Xe),r("span",Qe,[et,r("span",tt,[p(Y,{icon:"lucide:activity"})])])],8,Ke),p(ie,{size:"large",picture:`/IbexIcons/ActivitiesIcons/${e.type}.png`,squared:""},null,8,["picture"]),r("h3",lt,h(e.title),1),r("p",null,h(v(H)(e.date))+" remaining",1),r("div",at,[(u(!0),f(_,null,b(e.attendees_info,(e=>m((u(),d(ie,{key:e.id,size:"small",initials:e.username.slice(0,2),picture:e.avatar},null,8,["initials","picture"])),[[ue,`${e.username} ${e.last_name?e.last_name:""}`,void 0,{rounded:!0}]]))),128))]),r("div",it,[p(q,{onClick:t=>(async(e="")=>{try{K.value=!0,204===(await L.delete(`/api/activity/${e}/`)).status?(D.success("Activity deleted successfully"),ae()):D.error("Something went wrong")}catch(t){console.log("Err in deleting activity",t)}finally{K.value=!1}})(e.id),loading:v(K),icon:"feather:trash",outlined:""},{default:c((()=>[g(" Delete ")])),_:2},1032,["onClick","loading"]),r("button",{onClick:t=>{return l=e.id,A.value=l,void(k.value=!0);var l},class:"button v-button is-dark-outlined"},nt,8,st)])],4)])))),128))])),_:1})]),v(k)?(u(),d(se,{key:0,addUpdateContactModal:v(k),objectId:a.jobId,activityId:v(A),"onUpdate:modalHandler":i[4]||(i[4]=e=>k.value=!1),"onUpdate:OnSuccess":ae},null,8,["addUpdateContactModal","objectId","activityId"])):V("",!0),v($)?(u(),d(ne,{key:1,mailSchedulerModal:v($),"onUpdate:modalHandler":i[5]||(i[5]=e=>$.value=!1)},null,8,["mailSchedulerModal"])):V("",!0),v(te).isSweetAlertOpen?(u(),d(oe,{key:2,isSweetAlertOpen:v(te).isSweetAlertOpen,title:v(te).title,subtitle:v(te).subtitle,btntext:v(te).btnText,onConfirm:le,onCancel:()=>{v(te).isSweetAlertOpen=!1,ae()}},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):V("",!0)]))}}});export{ot as _};
