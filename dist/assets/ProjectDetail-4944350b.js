import{_ as e,a,b as s}from"./ProjectFiles-5ee9f8a4.js";import{_ as l}from"./ProjectTodayTasks.vue_vue_type_style_index_0_lang-e3d46910.js";import{_ as t,a as i}from"./VOption.vue_vue_type_style_index_0_lang-4400f155.js";import{_ as r}from"./VLabel.vue_vue_type_script_setup_true_lang-2653a3df.js";import{_ as o}from"./VField.vue_vue_type_script_setup_true_lang-88afe542.js";import{_ as n}from"./VControl-99928d1c.js";import{_ as c}from"./UserPopoverContent.vue_vue_type_script_setup_true_lang-6f47479b.js";import{_ as d}from"./VAvatar.vue_vue_type_style_index_0_lang-84b318a5.js";import{_ as u}from"./VIcon.vue_vue_type_script_setup_true_lang-6f36a692.js";import{f as p,y as v,x as m,b as h,r as f,s as g,o as y,B as _,C as k,D as b,E as j,m as x,O as C,N as w,F as I,U as V,G as D,K as T,I as A,H as N,V as S,W as U,k as P,Q as E,R as $,J as M,S as z}from"./index-5437c3ff.js";import{A as F}from"./vue3-apexcharts.common-a964da4b.js";import{u as L}from"./useNotyf-19e6534b.js";import{u as B}from"./useAPI-15ad727f.js";import{a as H}from"./useSupportElement-64af5555.js";import{u as K}from"./useThemeColors-fa4464c7.js";const O=e=>(E("data-v-7687b796"),e=e(),$(),e),q={class:"personal-dashboard personal-dashboard-v2"},R={class:"columns is-multiline"},G={class:"column is-12"},J={class:"dashboard-header is-relative"},Q={class:"user-meta is-dark-bordered-12"},W={class:"title is-4 is-narrow is-bold"},Y=O((()=>j("i",{class:"fas fa-home"},null,-1))),X={class:"user-action"},Z=O((()=>j("h3",{class:"title is-5 is-narrow"},"Information",-1))),ee={class:"light-text"},ae={class:"light-text"},se={class:"light-text"},le={class:"media-flex inverted-text"},te=O((()=>j("a",{class:"link inverted-text"},"Change status",-1))),ie={class:"tabs-wrapper"},re={key:0,class:"tabs-inner"},oe={class:"tabs is-boxed",slider:""},ne=[O((()=>j("span",null,"Project Info",-1)))],ce=[O((()=>j("span",null,"Tasks Calendar",-1)))],de=[O((()=>j("span",null,"Tasks",-1)))],ue=O((()=>j("li",{class:"tab-naver"},null,-1))),pe={key:0,class:"columns is-multiline"},ve={key:0,class:"column is-8"},me={class:"dashboard-card has-margin-bottom"},he=["innerHTML"],fe={class:"dashboard-card has-margin-bottom"},ge={class:"dashboard-card"},ye=O((()=>j("div",{class:"card-head"},[j("h3",{class:"dark-inverted"},"Task Completion"),j("a",{class:"action-link",tabindex:"0"},"Reports")],-1))),_e={class:"dashboard-card"},ke={class:"card-head"},be=O((()=>j("h3",{class:"dark-inverted"},"Assigned Manager",-1))),je={class:"active-team"},xe={key:0,class:"user-list"},Ce={class:"user-list-info"},we={class:"name dark-inverted"},Ie={class:"position"},Ve=O((()=>j("div",{class:"user-list-icons"},null,-1))),De={key:1,class:"user-list"},Te=[O((()=>j("div",{class:"user-list-info"},[j("div",{class:"name dark-inverted"},"No Manager assigned yet")],-1)))],Ae={key:2},Ne={class:"is-flex space-between"},Se={key:0},Ue={class:"dashboard-card"},Pe={class:"card-head"},Ee=O((()=>j("h3",{class:"dark-inverted"},"Client Information",-1))),$e={class:"active-team"},Me={key:0,class:"user-list"},ze={class:"user-list-info"},Fe={class:"name dark-inverted"},Le={class:"position"},Be=O((()=>j("div",{class:"user-list-icons"},null,-1))),He={key:1,class:"user-list"},Ke=[O((()=>j("div",{class:"user-list-info"},[j("div",{class:"name dark-inverted"},"No Client Info Added yet")],-1)))],Oe={key:2},qe={class:"dashboard-card"},Re={class:"card-head"},Ge=O((()=>j("h3",{class:"dark-inverted"},"Contractor Information",-1))),Je={class:"active-team"},Qe={key:0,class:"user-list"},We={class:"user-list-info"},Ye={class:"name dark-inverted"},Xe={class:"position"},Ze=O((()=>j("div",{class:"user-list-icons"},null,-1))),ea={key:1,class:"user-list"},aa=[O((()=>j("div",{class:"user-list-info"},[j("div",{class:"name dark-inverted"}," No contractor Info Added yet ")],-1)))],sa={key:2},la={class:"dashboard-card"},ta={key:1,class:"columns is-multiline"},ia={class:"column is-12"},ra={key:2,class:"columns is-multiline"},oa=z(p({__name:"ProjectDetail",setup(p){const E=K(),$=B(),z=L(),O=v(),oa=m(),na=h(),ca=f("detail"),da=f(!1),ua=f(!1);f(!1);const pa=f(!1);f(!1);const va=f(!1),ma=f([]),ha=f([]),fa=f([]),ga=f([]),ya=f([]);f(0);const _a=f(0),ka=f(0),ba=f(""),ja=f("");f("");const xa=f([{id:0,username:"",email:"",phoneNumber:""}]),Ca=f([]),wa=f({id:0,title:"",created:"",startDate:"",color:"",endDate:"",description:"",image:"",is_active:null,status:"",address:"",total_tasks:0,client:0,contractor:0,clientInfo:{id:0,username:"",email:"",password:"",avatar:null},uploaded_files:[],contractorInfo:{id:0,username:"",email:"",password:"",avatar:null},managers:[{id:0,username:"",avatar:null,email:"",role:""}]});f({title:"",description:"",startDate:"",endDate:"",status:"",project:O.params.id,workers:[]});const Ia=f([{id:0,title:"",description:"",startDate:"",endDate:"",project:0,status:"",worker:[{id:0,username:"",email:"",role:"",avatar:""}]}]),Va=g({height:180,type:"radialBar",series:[],title:{text:""},chart:{toolbar:{show:!1}},colors:[E.primary,E.purple,E.orange],plotOptions:{radialBar:{hollow:{size:"55%"}}},labels:["Progress"]}),Da=g({series:[],chart:{height:295,type:"pie",toolbar:{show:!1}},labels:["Active","Pending","Completed","Canceled"],colors:[E.accent,E.info,E.primary,E.orange],legend:{position:"right",horizontalAlign:"center"},responsive:[{breakpoint:480,options:{chart:{width:315,toolbar:{show:!1}},legend:{position:"top"}}}],dataLabels:{enabled:!1}}),Ta=()=>{pa.value=!pa.value},Aa=()=>{ua.value=!ua.value},Na=f(!1),Sa=()=>{Na.value=!Na.value},Ua=()=>{try{va.value=!0;$.delete(`/api/project/${O.params.id}/`);z.green("Selected project deleted successfully!"),oa.push("/sidebar/dashboard/projects")}catch(e){console.log(e)}finally{va.value=!1}};f(0);const Pa=async()=>{try{da.value=!0;const e=await $.get(`/api/project/${ja.value}/`);wa.value=e.data;let a=e.data.percentage.toFixed(2);Va.value.series.push(a),ba.value=e.data.image,fa.value=e.data.managers?e.data.managers:[],Ea()}catch(e){console.log(e)}finally{da.value=!1}};f([]);const Ea=async()=>{try{da.value=!0;const e=await $.get(`api/task/${O.params.id}/project/`);Ia.value=e.data;const a={pending:0,completed:0,active:0,canceled:0};Ia.value.forEach((e=>{const s=e.status||"Unknown";void 0!==a[s]&&a[s]++})),Da.value.series=[a.completed,a.pending,a.active,a.canceled],da.value=!1}catch(e){console.log(e),da.value=!1}},$a=f([]),Ma=async()=>{try{wa.value.managers=$a.value;let e=H(wa.value,["image"]);e.delete("clientInfo"),e.delete("contractorInfo"),"object"==typeof wa.value.client&&e.delete("client"),"object"==typeof wa.value.contractor&&e.delete("contractor");const a=await $.patch(`/api/project/${O.params.id}/`,e);ua.value=!1,pa.value=!1,z.green("Project updated successfully"),Na.value=!1,Pa(a.data.id)}catch(e){console.log(e)}};f("");const za=e=>{_a.value=e},Fa=e=>{ka.value=e};return y((async()=>{ja.value=O.params.id,Pa(),(async()=>{try{va.value=!0;const e=await $.get("/api/users/",{});xa.value=e.data.filter((e=>"worker"==e.role)),ma.value=e.data.filter((e=>"client"==e.role)),ha.value=e.data.filter((e=>"contractor"==e.role)),ga.value=e.data.filter((e=>"manager"==e.role)),ya.value=ga.value.map((e=>({value:e.id.toString(),name:`${e.username}`,supplier:e.partner?e.partner:"",image:e.avatar}))),console.log("data",xa.value)}catch(e){console.log(e)}finally{va.value=!1}})(),await Ea(),(async()=>{try{const e=await $.get(`/api/task/today-tasks/?project=${O.params.id}`);Ca.value=e.data}catch(e){console.log(e)}})()})),(p,v)=>{const m=u,h=d,f=_("Address"),g=e,y=c,E=_("Tippy"),$=_("Multiselect"),z=n,L=o,B=r,H=t,K=i,va=l,ga=a,_a=s;return k(),b("div",q,[j("div",R,[j("div",G,[j("div",J,["admin"==x(na).user.role||"manager"==x(na).user.role?(k(),C(m,{key:0,style:{position:"absolute",top:"10px","font-size":"18px","font-weight":"600",right:"36px",color:"var(--info)"},class:"cu-pointer",onClick:v[0]||(v[0]=()=>{x(oa).push(`/sidebar/dashboard/projects/add-project/?id=${x(wa).id}`)}),icon:"lucide:edit"})):w("",!0),"admin"==x(na).user.role||"manager"==x(na).user.role?(k(),C(m,{key:1,style:{position:"absolute",top:"10px","font-size":"18px","font-weight":"600",right:"10px",color:"var(--danger)"},class:"cu-pointer",onClick:Ua,icon:"lucide:trash"})):w("",!0),I(h,{picture:x(wa).image,squared:"",color:"primary",size:"xxl"},null,8,["picture"]),j("div",Q,[j("h3",W,V(x(wa).title?x(wa).title:"N/A"),1),I(f,null,{default:D((()=>[Y,T(" "+V(x(wa).address),1)])),_:1})]),j("div",X,[Z,j("p",ee," Started at: "+V(x(wa)?.startDate?x(wa)?.startDate:"N/A"),1),j("p",ae," Expected end: "+V(x(wa)?.endDate?x(wa)?.endDate:"N/A"),1),j("p",se," Total jobs: "+V(x(wa).total_tasks?x(wa).total_tasks:"N/A")+" Tasks ",1)]),j("div",null,[j("div",le,[x(da)?w("",!0):(k(),C(x(F),{key:0,id:"completion-chart",height:x(Va).height,type:x(Va).type,series:x(Va).series,options:x(Va)},null,8,["height","type","series","options"]))]),te])])])]),j("div",ie,["admin"==x(na).user.role||"manager"==x(na).user.role||"client"==x(na).user.role?(k(),b("div",re,[j("div",oe,[j("ul",null,[j("li",{class:A(["detail"===x(ca)&&"is-active"])},[j("a",{tabindex:"0",role:"button",onKeydown:v[1]||(v[1]=N(M((e=>ca.value="detail"),["prevent"]),["space"])),onClick:v[2]||(v[2]=e=>ca.value="detail")},ne,32)],2),j("li",{class:A(["calendar"===x(ca)&&"is-active"])},[j("a",{tabindex:"0",role:"button",onKeydown:v[3]||(v[3]=N(M((e=>ca.value="calendar"),["prevent"]),["space"])),onClick:v[4]||(v[4]=e=>ca.value="calendar")},ce,32)],2),j("li",{class:A(["tasks"===x(ca)&&"is-active"])},[j("a",{tabindex:"0",role:"button",onKeydown:v[5]||(v[5]=N(M((e=>ca.value="tasks"),["prevent"]),["space"])),onClick:v[6]||(v[6]=e=>ca.value="tasks")},de,32)],2),ue])])])):w("",!0)]),"detail"===x(ca)?(k(),b("div",pe,["admin"==x(na).user.role||"manager"==x(na).user.role?(k(),b("div",ve,[j("div",me,[j("div",{innerHTML:x(wa).description},null,8,he)]),j("div",fe,[I(g,{projectId:x(O).params.id,files:x(wa).uploaded_files,"onUpdate:onUploadFile":Pa},null,8,["projectId","files"])]),j("div",ge,[ye,0!=x(Ia).length?(k(),C(x(F),{key:0,height:x(Da).chart.height,type:x(Da).chart.type,series:x(Da).series,options:x(Da)},null,8,["height","type","series","options"])):w("",!0)])])):w("",!0),j("div",{class:A("admin"==x(na).user.role||"manager"==x(na).user.role?"column is-4":"column is-12")},[j("div",_e,[j("div",ke,[be,"admin"==x(na).user.role||"manager"==x(na).user.role?(k(),b("a",{key:0,onClick:Sa,class:"action-link",tabindex:"0"},V(x(Na)?"Close":"Edit"),1)):w("",!0)]),j("div",je,[x(fa).length>0?(k(),b("ul",xe,[(k(!0),b(S,null,U(x(fa),(e=>(k(),b("li",{key:e.id},[j("div",null,[I(E,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:D((()=>[I(y,{user:e},null,8,["user"])])),default:D((()=>[I(h,{picture:e.avatar},null,8,["picture"])])),_:2},1024)]),j("div",Ce,[j("div",we,V(e.username),1),j("div",Ie,V(e.email),1)]),Ve])))),128))])):(k(),b("ul",De,Te)),x(Na)?(k(),b("div",Ae,[I(L,null,{default:D((({id:e})=>[I(z,null,{default:D((()=>[I($,{modelValue:x($a),"onUpdate:modelValue":v[7]||(v[7]=e=>P($a)?$a.value=e:null),attrs:{id:e},mode:"tags",placeholder:"Select manager","track-by":"name",label:"name",searchable:!0,"create-tag":!0,options:x(ya),"max-height":145},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):w("",!0),j("div",Ne,[x(Na)?(k(),b("a",Se)):w("",!0),x(Na)?(k(),b("a",{key:1,onClick:Ma,class:"action-link",tabindex:"0"},"Save ")):w("",!0)])])]),j("div",Ue,[j("div",Pe,[Ee,"admin"==x(na).user.role||"manager"==x(na).user.role?(k(),b("a",{key:0,onClick:Aa,class:"action-link",tabindex:"0"},V(x(ua)?"Close":"Edit"),1)):w("",!0)]),j("div",$e,[x(wa).client?(k(),b("ul",Me,[j("li",null,[j("div",null,[I(E,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:D((()=>[I(y,{user:x(wa).client},null,8,["user"])])),default:D((()=>[I(h,{picture:x(wa).client.avatar},null,8,["picture"])])),_:1})]),j("div",ze,[j("div",Fe,V(x(wa).client.username),1),j("div",Le,V(x(wa).client.email),1)]),Be])])):(k(),b("ul",He,Ke)),x(ua)?(k(),b("div",Oe,[I(L,null,{default:D((()=>[I(B,null,{default:D((()=>[T("Select client")])),_:1}),I(z,null,{default:D((()=>[I(K,{modelValue:x(wa).client,"onUpdate:modelValue":v[8]||(v[8]=e=>x(wa).client=e),onChange:Ma},{default:D((()=>[I(H,{value:""},{default:D((()=>[T(" Clients ")])),_:1}),(k(!0),b(S,null,U(x(ma),(e=>(k(),C(H,{key:e.id,value:e.id},{default:D((()=>[T(V(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])):w("",!0)])]),j("div",qe,[j("div",Re,[Ge,"admin"==x(na).user.role||"manager"==x(na).user.role?(k(),b("a",{key:0,onClick:Ta,class:"action-link",tabindex:"0"},V(x(pa)?"Close":"Edit"),1)):w("",!0)]),j("div",Je,[x(wa).contractor?(k(),b("ul",Qe,[j("li",null,[j("div",null,[I(E,{class:"has-help-cursor",interactive:"",offset:[0,10]},{content:D((()=>[I(y,{user:x(wa).contractor},null,8,["user"])])),default:D((()=>[I(h,{picture:x(wa).contractor.avatar},null,8,["picture"])])),_:1})]),j("div",We,[j("div",Ye,V(x(wa).contractor.username),1),j("div",Xe,V(x(wa).contractor.email),1)]),Ze])])):(k(),b("ul",ea,aa)),x(pa)?(k(),b("div",sa,[I(L,null,{default:D((()=>[I(B,null,{default:D((()=>[T("Select contractor")])),_:1}),I(z,null,{default:D((()=>[I(K,{modelValue:x(wa).contractor,"onUpdate:modelValue":v[9]||(v[9]=e=>x(wa).contractor=e),onChange:Ma},{default:D((()=>[(k(!0),b(S,null,U(x(ha),(e=>(k(),C(H,{key:e.id,value:e.id},{default:D((()=>[T(V(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])):w("",!0)])]),j("div",la,[I(va,{projectId:x(O).params.id},null,8,["projectId"])])],2)])):w("",!0),"tasks"===x(ca)?(k(),b("div",ta,[j("div",ia,[I(ga,{"onUpdate:completedTasks":za,"onUpdate:activeTasks":Fa,projectID:x(O).params.id},null,8,["projectID"])])])):w("",!0),"calendar"===x(ca)?(k(),b("div",ra,[I(_a,{projectID:x(O).params.id},null,8,["projectID"])])):w("",!0)])}}}),[["__scopeId","data-v-7687b796"]]);export{oa as _};
