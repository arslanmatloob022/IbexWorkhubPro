import{a6 as e,r as l,e as a,s as o,b as t,_ as s,o as n,B as i,C as d,E as r,F as u,I as c,D as p,K as m,W as v,l as f,N as _,M as b,J as y,a0 as h,O as g,Z as I,A as w,V as k,U as C,j as P,T as V,a4 as D,X as x,P as S,Q as T,R as j,i as O,aR as M,H as U,G as A}from"./index-797f323c.js";import{_ as F}from"./VModal.vue_vue_type_style_index_0_lang-ea769eae.js";import{_ as E}from"./VTextarea.vue_vue_type_script_setup_true_lang-db18e983.js";import{_ as L}from"./VInput.vue_vue_type_script_setup_true_lang-228d2028.js";import{_ as $}from"./VCheckbox.vue_vue_type_style_index_0_lang-0e6ca9b5.js";import{_ as H}from"./VField.vue_vue_type_script_setup_true_lang-309269dc.js";import{_ as R}from"./VControl-bbf92ffd.js";import{a as q,_ as B}from"./VOption.vue_vue_type_style_index_0_lang-048157b0.js";import{u as N}from"./useAPI-b2b28f22.js";import{u as z}from"./useNotyf-b138f887.js";import{a as W}from"./useSupportElement-012e6b86.js";import{u as J}from"./userSession-591942fc.js";import{_ as G}from"./VAvatar.vue_vue_type_style_index_0_lang-415ba8c9.js";import{_ as K}from"./VIconButton-1fbf9a94.js";import{a as Q,g as X,s as Y,c as Z}from"./costItems-33806892.js";import{_ as ee}from"./SweetAlert.vue_vue_type_style_index_0_lang-77a5b8b5.js";import{_ as le}from"./VDropdown.vue_vue_type_style_index_0_lang-0868859d.js";const ae=e("useProposal",(()=>{const e=l(!0),a=z(),o=N(),t=l("");l("");const s=l([]),n=l([]),i=l({id:"",jobInfo:{id:"",sales_people_info:[],clientInfo:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},created_by_info:{id:"",username:"",last_name:null,email:"",role:"",avatar:null},managers_list:[],title:"",address:"",current_state:"",city:"",state:"",status:"",zip_code:"",confidence:"",sale_date:"",tags:[],estimated_from:"",estimated_to:"",sources:"",project_type:"",notes:"",attach_mail:"",latitude:0,longitude:0,created_at:"",updated_at:"",created_by:"",client:"",contractor:null,sales_people:[],managers:[]},proposalAmount:0,title:"",approval_deadline:"",internal_notes:"",introductory_text:"",closing_text:"",payment_status:"",type:"",status:"",columns_to_show:[],created_at:"",updated_at:"",job:""}),d=l([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]);return{loading:e,proposalCostItems:d,leadProposalFormData:i,companyProposalsList:s,leadProposalsList:n,getLeadProposals:async l=>{try{l.value=l,e.value=!0;const a=await o.get(`/api/lead-proposal/by-job/${l.value}/`);n.value=a.data}catch(t){a.error(` ${t}, Lead`)}finally{e.value=!1}},getProposalDetail:async e=>{try{const l=await o.get(`/api/lead-proposal/${e}/detail/`);i.value=l.data}catch(l){console.log(l)}},getCompanyProposals:async()=>{try{e.value=!0;const l=await o.get("/api/lead-proposal/");s.value=l.data}catch(l){a.error(` ${l}, Lead`)}finally{e.value=!1}},getProposalCostItems:async function(e){try{t.value=e;const l=await o.get(`/api/cost/by-proposal/${e}/`);d.value=l.data}catch(l){console.log(l)}},clearProposalId:function(){t.value="",d.value=[]}}})),oe={class:"modal-form columns is-multiline"},te={class:"column is-full"},se={class:"field"},ne=p("label",{class:"label"},"Send To ",-1),ie={class:"control"},de={class:"column is-full"},re={class:"field"},ue=p("label",{class:"label"},"Subject ",-1),ce={class:"control"},pe={class:"field column is-full mt-5"},me=p("label",{class:"label"},"Message",-1),ve=p("i",{class:"feather:mail"},null,-1),fe=a({__name:"SendProposalEmailModal",props:{proposalSenderModal:{type:Boolean},proposalData:{},columnsToShow:{},selectedProposalsIds:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:a}){const I=e,w=ae(),k=N(),C=z(),P=l(!1),V=o(),D=window.origin;l(`${D}/proposal-view/?proposal=${I.proposalData?.id}`);const x=()=>{a("update:modalHandler",!1)},S=I.selectedProposalsIds.map((e=>e.id)),T=I.selectedProposalsIds.map((e=>e.proposalAmount)).map(((e,l)=>`<li>Total of proposal ${l+1}:<b> $${e} </b></li>`)).join("<br>"),j=S.map(((e,l)=>`<a href="${D}/proposal-view/?proposal=${e}" style="color: #007bff; text-decoration: none; font-weight: bold;">View Proposal ${l+1}, </a>`)).join("<br>"),O=l({email:w.leadProposalFormData?.jobInfo?.clientInfo?.email?w.leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A",subject:`Proposal ${w.leadProposalFormData?.jobInfo?.title} `,message:`<p><b>Hi ${w.leadProposalFormData?.jobInfo?.clientInfo?.username?w.leadProposalFormData?.jobInfo?.clientInfo?.username:"N/A"} ${w.leadProposalFormData?.jobInfo?.clientInfo?.last_name?w.leadProposalFormData?.jobInfo?.clientInfo?.last_name:""},</b></p>\n\n  <p>We hope this message finds you well.</p>\n\n  <p>\n    Please find attached a detailed proposal outlining the cost items associated with the services/products we will be providing.\n    We have carefully curated this proposal to ensure complete transparency and alignment with your expectations.\n  </p>\n\n  <p>\n    Actions required for all proposals, and uou can review the full proposal(s), including the cost breakdown, by clicking the link below: <br />\n    ${j}\n  </p>\n\n  <p><b>Respectively proposal(s) amount are:</b></p>\n  <ul>\n    ${T}\n  </ul>\n\n  <p>\n    If you have any questions or require further clarification, feel free to reach out to us at your earliest convenience.\n    We are here to assist you.\n  </p>\n\n  <p>Thank you for trusting <b>Ibex Team</b> with your project.</p>\n\n  <p><b>Best Regards,</b><br />\n    Ibex Team\n  </p>`,link:j[0],columns:["cost_code","title","description","unit_cost"],showClient:!0,proposal_ids:S}),M=async()=>{try{P.value=!0;let e=O.value;e.proposal_ids=JSON.stringify(O.value.proposal_ids),e.columns=JSON.stringify(O.value.columns);await k.post("/api/lead-proposal/send-proposal-template/",e);C.success("Email sent successfully"),x()}catch(e){console.log(e)}finally{P.value=!1}},U=t((()=>s((()=>import("./ckeditor-a40f5948.js").then((e=>e.c))),["assets/ckeditor-a40f5948.js","assets/index-797f323c.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-33ed4b7f.js"]).then((e=>e.default.component)))),A={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px",maxHeight:"600px"};return n((async()=>{V.value=await s((()=>import("./ckeditor-65aad31c.js").then((e=>e.c))),["assets/ckeditor-65aad31c.js","assets/index-797f323c.js","assets/index-ce8747cd.css"]).then((e=>e.default))})),(e,l)=>{const a=g,o=F;return i(),d("div",null,[r(h,{name:"fade-slow"},{default:u((()=>[r(o,{is:"form",open:I.proposalSenderModal,title:"Send Proposal",size:"large",actions:"right",onSubmit:c(M,["prevent"]),onClose:x},{content:u((()=>[p("div",oe,[p("div",te,[p("div",se,[ne,p("div",ie,[m(p("input",{type:"email",required:"",class:"input",placeholder:"Enter Mail","onUpdate:modelValue":l[0]||(l[0]=e=>f(O).email=e)},null,512),[[v,f(O).email]])])])]),p("div",de,[p("div",re,[ue,p("div",ce,[m(p("input",{type:"text",required:"",class:"input",placeholder:"Enter mail subject","onUpdate:modelValue":l[1]||(l[1]=e=>f(O).subject=e)},null,512),[[v,f(O).subject]])])])]),p("div",pe,[me,f(V)?(i(),_(f(U),{key:0,modelValue:f(O).message,"onUpdate:modelValue":l[2]||(l[2]=e=>f(O).message=e),editor:f(V),config:A},null,8,["modelValue","editor"])):b("",!0)])])])),action:u((()=>[r(a,{type:"submit",color:"primary",loading:f(P),raised:""},{default:u((()=>[ve,y(" Send Proposal")])),_:1},8,["loading"])])),cancel:u((()=>[r(a,{color:"light",onClick:x,raised:""},{default:u((()=>[y("Close ")])),_:1})])),_:1},8,["open","onSubmit"])])),_:1})])}}}),_e={class:"modal-form columns is-multiline"},be={class:"columns is-multiline"},ye={class:"field column is-12 mb-0"},he=p("label",null,"Title: ",-1),ge={class:"control"},Ie=["disabled"],we={class:"field column is-6"},ke=p("label",{for:""},"Cost Type",-1),Ce={class:"field column is-3"},Pe=p("label",{for:""},"Catalog",-1),Ve={class:"field column is-3"},De=p("label",{for:""},"Mark As",-1),xe={class:"field column is-6"},Se=p("label",null,"Cost Code *",-1),Te={class:"field column is-6"},je=p("label",{for:""},"Group Cost",-1),Oe={class:"field column is-12 mb-0"},Me=p("label",{for:"",class:"label"},"Description",-1),Ue={class:"field column is-12 mb-0"},Ae=p("label",{for:"",class:"label"},"Internal Notes",-1),Fe={class:"columns is-multiline"},Ee={class:"field column is-6"},Le=p("label",null,"Unit Cost",-1),$e={class:"field column is-6"},He=p("label",null,"Quantity",-1),Re={class:"field column is-6"},qe=p("label",null,"Unit",-1),Be={class:"field column is-6"},Ne=p("label",null,"Builder Cost",-1),ze={class:"field column is-6"},We=p("label",null,"Markup (%)",-1),Je={class:"field column is-6"},Ge=p("label",null,"Client Price",-1),Ke={class:"field column is-6"},Qe=p("label",null,"Margin (%)",-1),Xe=a({__name:"EstimateCostItemModal",props:{costItemModal:{type:Boolean},proposalId:{},previousItemIndex:{},costItemId:{},previewCostItems:{type:Boolean}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:a}){const h=e,x=o();J();const S=z(),T=N(),j=l(!1);l([]),l([]);const O=l({previousItemIndex:0,index:0,id:"",type:"",total_price:0,cost_code:"",cost_type:"",builder_cost:0,internal_notes:"",mark_as:"",state:"",title:"",description:"",quantity:0,unit:"",unit_cost:0,markup:0,margin:0,profit:0,group:"",catalog:!1,proposal:h.proposalId}),M=l([{value:"labour",label:"Labour"},{value:"material",label:"Material"},{value:"equipment",label:"Equipment"},{value:"subcontractor",label:"Subcontractor"},{value:"other",label:"Others"}]),U=l([{value:"11011",label:"Labour"},{value:"11012",label:"Material"},{value:"11013",label:"Equipment"},{value:"11014",label:"Subcontractor"},{value:"11015",label:"Others"}]);l([{value:"Tiling",label:"Tiling"},{value:"Material",label:"Material"},{value:"Paint",label:"Paint"},{value:"Carpenter",label:"Carpenter"}]);const A=l([{value:"bid",label:"Bid"},{value:"allowance",label:"Allowance"}]);l([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const G=async()=>{try{j.value=!0;const e=W(O.value,[]);if(h.costItemId){await T.patch(`/api/cost/${h.costItemId}/`,e)}else{const l=await T.post("/api/cost/",e);if(O.value.catalog){await T.post(`/api/cost/${l.data.id}/create-catalog/`)}}K(),Q(),S.success("Item added successfully.")}catch(e){S.error(` ${e}, New Worker`)}finally{j.value=!1}},K=()=>{a("update:modalHandler",!1)},Q=()=>{a("update:OnSuccess",null)};l(0),l(0);const X=I((()=>O.value.unit_cost*O.value.quantity));l(0),l(0);const Y=I((()=>O.value.markup>0?X.value+X.value*O.value.markup/100:O.value.margin>0?X.value/(1-O.value.margin/100):X.value));I((()=>(Y.value-X.value)/X.value*100)),I((()=>(Y.value-X.value)/Y.value*100));const Z=t((()=>s((()=>import("./ckeditor-a40f5948.js").then((e=>e.c))),["assets/ckeditor-a40f5948.js","assets/index-797f323c.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-33ed4b7f.js"]).then((e=>e.default.component)))),ee={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"},le=l(!1),ae=l(!1);return n((async()=>{x.value=await s((()=>import("./ckeditor-65aad31c.js").then((e=>e.c))),["assets/ckeditor-65aad31c.js","assets/index-797f323c.js","assets/index-ce8747cd.css"]).then((e=>e.default)),h.previousItemIndex&&(O.value.previousItemIndex=h.previousItemIndex),h.costItemId&&(async()=>{try{le.value=!0;const e=await T.get(`/api/cost/${h.costItemId}/`);O.value=e.data}catch(e){console.log(e)}finally{le.value=!1}})(),(async()=>{try{ae.value=!0;const e=await T.get("/api/cost-code/");U.value=e.data.map((e=>({value:e.id,label:e.name})))}catch(e){console.log(e)}finally{ae.value=!1}})()})),(e,l)=>{const a=B,o=q,t=R,s=H,n=$,I=w("Multiselect"),S=L,T=E,N=D,z=g,W=F;return i(),_(W,{is:"form",open:h.costItemModal,title:"Cost Item ",size:"xl",actions:"right",onSubmit:c(G,["prevent"]),onClose:K},{content:u((()=>[p("div",_e,[r(N,{class:"column is-12"},{default:u((()=>[p("div",be,[p("div",ye,[he,p("div",ge,[m(p("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>f(O).title=e),required:"",disabled:h.previewCostItems,class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,8,Ie),[[v,f(O).title]])])]),p("div",we,[ke,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(o,{modelValue:f(O).cost_type,"onUpdate:modelValue":l[1]||(l[1]=e=>f(O).cost_type=e),disabled:h.previewCostItems},{default:u((()=>[(i(!0),d(C,null,k(f(M),((e,l)=>(i(),_(a,{value:e.value},{default:u((()=>[y(V(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",Ce,[Pe,p("div",null,[r(t,{raw:"",subcontrol:""},{default:u((()=>[r(n,{modelValue:f(O).catalog,"onUpdate:modelValue":l[2]||(l[2]=e=>f(O).catalog=e),label:"Create Template",color:"info"},null,8,["modelValue"])])),_:1})])]),p("div",Ve,[De,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(o,{modelValue:f(O).mark_as,"onUpdate:modelValue":l[3]||(l[3]=e=>f(O).mark_as=e),disabled:h.previewCostItems},{default:u((()=>[(i(!0),d(C,null,k(f(A),((e,l)=>(i(),_(a,{value:e.value},{default:u((()=>[y(V(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",xe,[Se,r(s,null,{default:u((({id:e})=>[r(t,null,{default:u((()=>[r(I,{required:"",modelValue:f(O).cost_code,"onUpdate:modelValue":l[4]||(l[4]=e=>f(O).cost_code=e),disabled:h.previewCostItems,attrs:{id:e},searchable:!0,options:f(U),placeholder:"Select a cost code"},null,8,["modelValue","disabled","attrs","options"])])),_:2},1024)])),_:1})]),p("div",Te,[je,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(O).group,"onUpdate:modelValue":l[5]||(l[5]=e=>f(O).group=e),name:"gcost",placeholder:"Group Cost"},null,8,["modelValue"])])),_:1})])),_:1})]),p("div",Oe,[Me,f(x)?(i(),_(f(Z),{key:0,disabled:h.previewCostItems,modelValue:f(O).description,"onUpdate:modelValue":l[6]||(l[6]=e=>f(O).description=e),editor:f(x),config:ee},null,8,["disabled","modelValue","editor"])):b("",!0)]),p("div",Ue,[Ae,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(T,{modelValue:f(O).internal_notes,"onUpdate:modelValue":l[7]||(l[7]=e=>f(O).internal_notes=e),disabled:h.previewCostItems,rows:"4",placeholder:"Internal notes..."},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1}),r(N,{class:"column is-12 mt-3"},{default:u((()=>[p("div",Fe,[p("div",Ee,[Le,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(O).unit_cost,"onUpdate:modelValue":l[8]||(l[8]=e=>f(O).unit_cost=e),disabled:h.previewCostItems,type:"number",name:"unitCost",step:"any",placeholder:"Unit cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",$e,[He,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(O).quantity,"onUpdate:modelValue":l[9]||(l[9]=e=>f(O).quantity=e),disabled:h.previewCostItems,type:"number",name:"quantity",step:"any",placeholder:"Quantity"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",Re,[qe,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(O).unit,"onUpdate:modelValue":l[10]||(l[10]=e=>f(O).unit=e),disabled:h.previewCostItems,type:"text",name:"unit",placeholder:"Unit"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",Be,[Ne,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(X),"onUpdate:modelValue":l[11]||(l[11]=e=>P(X)?X.value=e:null),disabled:h.previewCostItems,type:"number",step:"any",name:"builderCost",placeholder:"Builder cost"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",ze,[We,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(O).markup,"onUpdate:modelValue":l[12]||(l[12]=e=>f(O).markup=e),disabled:h.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Markup"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",Je,[Ge,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(Y),"onUpdate:modelValue":l[13]||(l[13]=e=>P(Y)?Y.value=e:null),disabled:h.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Total Price"},null,8,["modelValue","disabled"])])),_:1})])),_:1})]),p("div",Ke,[Qe,r(s,null,{default:u((()=>[r(t,null,{default:u((()=>[r(S,{modelValue:f(O).margin,"onUpdate:modelValue":l[14]||(l[14]=e=>f(O).margin=e),disabled:h.previewCostItems,type:"number",name:"markup",step:"any",placeholder:"Margin"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])])])),_:1})])])),action:u((()=>[r(z,{loading:f(j),type:"submit",color:"primary",icon:h.costItemId?"":"fas fa-plus",raised:""},{default:u((()=>[y(V(h.costItemId?"Update":"Add"),1)])),_:1},8,["loading","icon"])])),_:1},8,["open","onSubmit"])}}}),Ye=N();z();const Ze=l(0),el=async e=>{try{Ze.value=3;const l=await Ye.get(`/api/lead-proposal/${e.id}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`Proposal-${e.title}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href)}catch(l){console.error("Error downloading PDF:",l)}finally{Ze.value=0}},ll=async e=>{try{Ze.value=1;const l=await Ye.get(`/api/lead-proposal/${e}/download/`,{responseType:"blob"}),a=new Blob([l.data],{type:"application/pdf"}),o=URL.createObjectURL(a),t=document.createElement("iframe");t.style.display="none",t.src=o,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print(),document.body.removeChild(t)}}catch(l){console.error("Error printing PDF:",l)}finally{Ze.value=0}},al=e=>(S("data-v-1f82fdab"),e=e(),T(),e),ol={class:"columns is-multiline"},tl=al((()=>p("div",{class:"column is-9"},[p("h1",{class:"title is-5 m-1 p-0"},"Preview Lead Proposal"),p("p",{class:"m-1"}," Below is a preview of the proposal that will be sent as a link to the email addresses on this client contact. The proposal can be accessed through the link while it is Released. ")],-1))),sl={class:"column is-12"},nl={class:"invoice-wrapper"},il={class:"invoice-header"},dl={class:"left"},rl={class:"right"},ul={class:"controls"},cl=[al((()=>p("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:printer"},null,-1)))],pl=[al((()=>p("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download-cloud"},null,-1)))],ml=[al((()=>p("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"},null,-1)))],vl={class:"invoice-body"},fl={class:"invoice-card"},_l={class:"invoice-section is-flex is-bordered"},bl=al((()=>p("div",{class:"meta"},null,-1))),yl=al((()=>p("div",{class:"end is-right"},[p("span",null,"PO Box 242"),p("span",null,"Evergreen, CO 80437-0242"),p("span",null,"Phone: 720 272-9061"),p("span",null,"Premium Trades for Premier Builders")],-1))),hl={class:"invoice-section is-flex is-bordered"},gl={class:"meta"},Il={class:"end is-left"},wl={class:"invoice-section"},kl={class:"responsive-table"},Cl=["innerHTML"],Pl={key:1},Vl={key:2},Dl={class:"invoice-section is-flex mt-0 pt-0"},xl={class:"end is-left"},Sl={class:"text-right"},Tl=x('<div class="invoice-section is-flex mt-0 pt-0" data-v-1f82fdab><div class="footer" data-v-1f82fdab><div class="footer-meta" data-v-1f82fdab><p data-v-1f82fdab>Signature:</p><div data-v-1f82fdab></div></div><div class="footer-meta" data-v-1f82fdab><p data-v-1f82fdab>Date:</p><div data-v-1f82fdab></div></div><div class="footer-meta" data-v-1f82fdab><p class="no-wrap" data-v-1f82fdab>Print Name:</p><div data-v-1f82fdab></div></div></div></div>',1),jl=j(a({__name:"ProposalPreview",props:{columnsToShow:{},proposalData:{}},setup(e){const a=e,o=ae(),t=l(!1),s=l([]),u=l([]),c=l({}),m=()=>{u.value.push(a.proposalData),c.value=a.proposalData,s.value=o.leadProposalFormData.columns_to_show,t.value=!t.value};return n((()=>{})),(e,l)=>{const s=K,n=G,c=fe;return i(),d("div",ol,[tl,p("div",sl,[p("div",nl,[p("div",il,[p("div",dl,[p("h3",null," Proposal-ID "+V(f(o).leadProposalFormData?.id.slice(0,8)),1)]),p("div",rl,[p("div",ul,[1==f(Ze)?(i(),_(s,{key:0,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(i(),d("a",{key:1,class:"action",onClick:l[0]||(l[0]=e=>f(ll)(f(o).leadProposalFormData?.id))},cl)),3==f(Ze)?(i(),_(s,{key:2,color:"primary",outlined:"",size:"small",loading:"",circle:"",icon:"lucide:plus"})):(i(),d("a",{key:3,class:"action",onClick:l[1]||(l[1]=e=>f(el)(f(o).leadProposalFormData))},pl)),p("a",{class:"action",onClick:m},ml)])])]),p("div",vl,[p("div",fl,[p("div",_l,[r(n,{size:"xl",picture:"/logos/IbexFavicon.png"}),bl,yl]),p("div",hl,[p("div",gl,[p("h3",null,V(f(o).leadProposalFormData?.jobInfo?.clientInfo?.username??"N/A")+" "+V(f(o).leadProposalFormData?.jobInfo?.clientInfo?.last_name??""),1),p("span",null,V(f(o).leadProposalFormData?.jobInfo?.clientInfo?.email?f(o).leadProposalFormData?.jobInfo?.clientInfo?.email:"N/A"),1)]),p("div",Il,[p("h3",null,V(f(o).leadProposalFormData?.title),1),p("p",null," Job Address: "+V(f(o).leadProposalFormData?.jobInfo?.address??"N/A"),1)])]),p("div",wl,[p("table",kl,[p("thead",null,[(i(!0),d(C,null,k(f(o).leadProposalFormData.columns_to_show,((e,l)=>(i(),d("th",{key:l},V(f(Q)[e]),1)))),128))]),p("tbody",null,[(i(!0),d(C,null,k(f(o).proposalCostItems,((e,l)=>(i(),d("tr",{key:e.id},[(i(!0),d(C,null,k(f(o).leadProposalFormData.columns_to_show,((l,a)=>(i(),d("td",{key:a},["description"===l?(i(),d("div",{key:0,innerHTML:e[f(X)[l]]},null,8,Cl)):(i(),d("span",Pl,V(e[f(X)[l]]),1)),"cost_code"===l?(i(),d("span",Vl,V(e?.cost_code_info?.name),1)):b("",!0)])))),128))])))),128))])])]),p("div",Dl,[p("div",xl,[p("h3",Sl," Total Price: $"+V(f(o).leadProposalFormData?.proposalAmount),1)])]),Tl])])])]),f(t)?(i(),_(c,{key:0,proposalSenderModal:f(t),selectedProposalsIds:f(u),proposalData:a.proposalData,columnsToShow:a.columnsToShow,"onUpdate:modalHandler":l[2]||(l[2]=e=>{t.value=!1,u.value=[]})},null,8,["proposalSenderModal","selectedProposalsIds","proposalData","columnsToShow"])):b("",!0)])}}}),[["__scopeId","data-v-1f82fdab"]]),Ol=e=>(S("data-v-87e119fc"),e=e(),T(),e),Ml={class:"datatable-wrapper mt-0"},Ul={class:"table-container"},Al={class:"table datatable-table is-fullwidth",id:"external-events"},Fl=Ol((()=>p("th",null,null,-1))),El=Ol((()=>p("th",null,"Actions",-1))),Ll=["data-event","onDragstart","onDrop","onDblclick"],$l={class:"is-relative"},Hl=["onClick"],Rl=["innerHTML"],ql={key:1},Bl={key:2},Nl=["onClick"],zl=[Ol((()=>p("div",{class:"icon"},[p("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1))),Ol((()=>p("div",{class:"meta"},[p("span",null,"Edit"),p("span",null,"Edit Cost Item")],-1)))],Wl=Ol((()=>p("hr",{class:"dropdown-divider"},null,-1))),Jl=["onClick"],Gl=[Ol((()=>p("div",{class:"icon"},[p("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1))),Ol((()=>p("div",{class:"meta"},[p("span",null,"Remove"),p("span",null,"Remove from list")],-1)))],Kl=a({__name:"CostItemsTable",props:{columnsToShow:{},itemsList:{}},setup(e){const a=e,o=ae(),t=z(),s=l({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),m=N(),v=l(""),y=l(!1);l([]);const h=e=>{e.preventDefault()},g=e=>{e.preventDefault(),e.currentTarget?.classList.add("drag-over")},I=e=>{e.preventDefault(),e.currentTarget?.classList.remove("drag-over")},w=l(""),P=l(0),D=l(""),x=l(!1),S=l(!1),T=async()=>{try{S.value=!0;await m.delete(`/api/cost/${D.value}/`);O(),s.value.isSweetAlertOpen=!1,t.success("Cost item deleted")}catch(e){console.log(e)}finally{S.value=!1}},j=(e,l=!1)=>{D.value=e.id,x.value=l,w.value=e.proposal,y.value=!y.value},O=()=>{o.getProposalCostItems(w.value)};return n((()=>{})),(e,l)=>{const t=le,n=ee,S=Xe;return i(),d("div",Ml,[p("div",Ul,[p("table",Al,[p("thead",null,[Fl,(i(!0),d(C,null,k(a.columnsToShow,((e,l)=>(i(),d("th",{key:l},V(f(Q)[e]),1)))),128)),El]),p("tbody",null,[f(o).proposalCostItems.length>0?(i(!0),d(C,{key:0},k(f(o).proposalCostItems,((e,l)=>(i(),d("tr",{key:e.id,"data-event":JSON.stringify(e),draggable:"true",onDragstart:l=>{return a=e.id,v.value=a,void console.log("Drag started for ID:",a);var a},onDrop:l=>(e=>{console.log("Dropped on ID:",e);const l=o.proposalCostItems.find((e=>e.id===v.value)),a=o.proposalCostItems.find((l=>l.id===e));if(l&&a){m.post("/api/cost/drag-drop-items/",{dragged_item_id:l.id,dropped_item_id:a.id});const e=o.proposalCostItems.indexOf(l),t=o.proposalCostItems.indexOf(a);e>=0&&t>=0&&(o.proposalCostItems.splice(e,1),o.proposalCostItems.splice(t,0,l))}else console.error("Dragged or Dropped Item not found");v.value=null})(e.id),onDragover:h,onDragenter:g,onDragleave:I,onDblclick:l=>j(e,!1),class:"draggable-item events"},[p("td",$l,[p("i",{style:{position:"absolute",bottom:"-7px",left:"1px",cursor:"pointer","font-weight":"600"},onClick:l=>(e=>{w.value=e.proposal,P.value=e.index,y.value=!y.value})(e),class:"lnir lnir-circle-plus info-text","aria-hidden":"true"},null,8,Hl)]),(i(!0),d(C,null,k(a.columnsToShow,((l,a)=>(i(),d("td",{key:a},["description"===l?(i(),d("div",{key:0,innerHTML:e[f(X)[l]]},null,8,Rl)):(i(),d("span",ql,V(e[f(X)[l]]),1)),"cost_code"===l?(i(),d("span",Bl,V(e?.cost_code_info?.name),1)):b("",!0)])))),128)),p("td",null,[r(t,{icon:"feather:more-vertical",class:"is-pushed-mobile",spaced:"",right:"",up:""},{content:u((({close:l})=>[p("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:c((()=>{j(e,!1),l()}),["prevent"])},zl,8,Nl),Wl,p("a",{role:"menuitem",href:"#",class:"dropdown-item is-media",onClick:c((()=>{(e=>{D.value=e.id,w.value=e.proposal,s.value={title:"Are you sure?",subtitle:"You will not be able to recover this cost item!",btntext:"Delete",isSweetAlertOpen:!0}})(e),l()}),["prevent"])},Gl,8,Jl)])),_:2},1024)])],40,Ll)))),128)):b("",!0)])])]),f(s).isSweetAlertOpen?(i(),_(n,{key:0,isSweetAlertOpen:f(s).isSweetAlertOpen,title:f(s).title,subtitle:f(s).subtitle,btntext:f(s).btntext,onConfirm:T,onCancel:()=>f(s).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),f(y)?(i(),_(S,{key:1,costItemModal:f(y),proposalId:f(w),costItemId:f(D),previousItemIndex:f(P),previewCostItems:f(x),"onUpdate:modalHandler":l[0]||(l[0]=e=>{y.value=!1,D.value=""}),"onUpdate:OnSuccess":O},null,8,["costItemModal","proposalId","costItemId","previousItemIndex","previewCostItems"])):b("",!0)])}}}),Ql=j(Kl,[["__scopeId","data-v-87e119fc"]]),Xl={class:"columns is-multiline"},Yl={class:"column is-12 is-flex space-between"},Zl=p("div",null,[p("h1",{class:"title is-4"},"Proposal Worksheet")],-1),ea={key:0,class:"column is-12"},la={class:"tabs-wrapper column is-12 m-0"},aa={class:"tabs-inner mt-4"},oa={class:"tabs is-boxed"},ta=[p("span",null,"Worksheet",-1)],sa=[p("span",null,"Format",-1)],na=[p("span",null,"Preview",-1)],ia={key:0,class:"column is-12"},da={key:0,class:"column is-12"},ra={class:"columns is-multiline"},ua=p("div",{class:"column is-12",style:{"text-align":"center"}},[p("h1",{class:"title is-4"},"Connect your clients to their projects"),p("h1",{class:"title is-5"}," Create a client contact and assign them to jobs and lead opportunities effortlessly. ")],-1),ca={class:"column is-12"},pa={key:0,class:"column is-12"},ma=a({__name:"WorksheetItems",props:{leadProposalModal:{type:Boolean},proposalId:{},proposalData:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:a}){const m=e,v=o(),h=ae(),I=l(!1),k=l(!1),C=l("worksheet");t((()=>s((()=>import("./ckeditor-a40f5948.js").then((e=>e.c))),["assets/ckeditor-a40f5948.js","assets/index-797f323c.js","assets/index-ce8747cd.css","assets/vue.runtime.esm-bundler-33ed4b7f.js"]).then((e=>e.default.component))));const V=async()=>{try{h.getProposalCostItems(m.proposalId)}catch(e){console.log(e)}};return n((async()=>{v.value=await s((()=>import("./ckeditor-65aad31c.js").then((e=>e.c))),["assets/ckeditor-65aad31c.js","assets/index-797f323c.js","assets/index-ce8747cd.css"]).then((e=>e.default)),m.proposalId&&(V(),h.getProposalDetail(m.proposalId))})),O((()=>{h.clearProposalId()})),(e,l)=>{const a=g,o=w("Multiselect"),t=R,s=H,n=Ql,v=D,h=jl,x=Xe;return i(),d("div",null,[p("div",Xl,[p("div",Yl,[Zl,p("div",null,[r(a,{size:"small",light:"",outlined:"",icon:"fas fa-cog",class:"mr-2",color:f(k)?"danger":"success",onClick:l[0]||(l[0]=e=>k.value=!f(k))},{default:u((()=>[y("Table")])),_:1},8,["color"]),r(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"info",onClick:l[1]||(l[1]=e=>I.value=!f(I))},{default:u((()=>[y("Import")])),_:1}),r(a,{size:"small",light:"",outlined:"",class:"mr-2",color:"primary",onClick:l[2]||(l[2]=e=>I.value=!f(I))},{default:u((()=>[y("Add From")])),_:1}),r(a,{size:"small",light:"",outlined:"",color:"warning",onClick:l[3]||(l[3]=e=>I.value=!f(I))},{default:u((()=>[y("Add Item")])),_:1})])]),r(M,{class:"fade-slow",name:"fade-slow"},{default:u((()=>[f(k)?(i(),d("div",ea,[r(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[r(t,null,{default:u((()=>[r(o,{modelValue:f(Y),"onUpdate:modelValue":l[4]||(l[4]=e=>P(Y)?Y.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:f(Z),placeholder:"Add columns"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])):b("",!0)])),_:1}),p("div",la,[p("div",aa,[p("div",oa,[p("ul",null,[p("li",{class:U(["worksheet"===f(C)?"is-active":"not-active"])},[p("a",{tabindex:"0",role:"button",onKeydown:l[5]||(l[5]=A(c((e=>C.value="worksheet"),["prevent"]),["space"])),onClick:l[6]||(l[6]=e=>C.value="worksheet")},ta,32)],2),p("li",{class:U(["format"===f(C)?"is-active":"not-active"])},[p("a",{tabindex:"0",role:"button",onKeydown:l[7]||(l[7]=A(c((e=>C.value="format"),["prevent"]),["space"])),onClick:l[8]||(l[8]=e=>C.value="format")},sa,32)],2),p("li",{class:U(["preview"===f(C)?"is-active":"not-active"])},[p("a",{tabindex:"0",role:"button",onKeydown:l[9]||(l[9]=A(c((e=>C.value="preview"),["prevent"]),["space"])),onClick:l[10]||(l[10]=e=>C.value="preview")},na,32)],2)])])])]),r(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["worksheet"===f(C)?(i(),d("div",ia,[r(n,{columnsToShow:f(Y),proposalId:m.proposalId},null,8,["columnsToShow","proposalId"])])):b("",!0)])),_:1}),r(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["format"===f(C)?(i(),d("div",da,[p("div",ra,[r(s,{label:"Choose what to show to lead",class:"column is-12"},{default:u((({id:e})=>[r(t,null,{default:u((()=>[r(o,{modelValue:f(Y),"onUpdate:modelValue":l[11]||(l[11]=e=>P(Y)?Y.value=e:null),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:f(Z),placeholder:"Add tags"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),r(v,{class:"columns is-multiline m-0"},{default:u((()=>[ua,p("div",ca,[r(n,{columnsToShow:f(Y)},null,8,["columnsToShow"])])])),_:1})])):b("",!0)])),_:1}),r(M,{class:"fade-slow",name:"slide-x"},{default:u((()=>["preview"===f(C)?(i(),d("div",pa,[r(h,{proposalData:m.proposalData,columnsToShow:f(Y)},null,8,["proposalData","columnsToShow"])])):b("",!0)])),_:1})]),f(I)?(i(),_(x,{key:0,costItemModal:f(I),proposalId:m.proposalId,"onUpdate:modalHandler":l[12]||(l[12]=e=>I.value=!1),"onUpdate:OnSuccess":V},null,8,["costItemModal","proposalId"])):b("",!0)])}}}),va=e=>(S("data-v-0317543a"),e=e(),T(),e),fa={class:"columns is-multiline"},_a=va((()=>p("div",{class:"column is-2"},null,-1))),ba={class:"column is-8"},ya=va((()=>p("div",{class:"column is-2"},null,-1))),ha=va((()=>p("div",{class:"column is-2"},null,-1))),ga=va((()=>p("div",{class:"column is-8"},[p("p",null," All the tasks will be generated and will start from the date you will put. ")],-1))),Ia=va((()=>p("div",{class:"column is-2"},null,-1))),wa=a({__name:"CreateProposalTasksModal",props:{createProposalTasksModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(e,{emit:a}){const o=e,t=z(),s=N(),d=l(""),m=l(!1),v=()=>{a("update:OnSuccess",null),a("closeModalHandler",!1)},b=async()=>{try{await s.post("/api/lead-proposal/create-tasks/",{start:d.value,proposal:o.proposalId});t.success("Tasks of this proposal are created in calendar successfully."),v()}catch(e){console.log(e),t.error("Something went wrong, please review the cost codes")}};return n((()=>{})),(e,l)=>{const a=L,t=R,s=H,n=g,h=F;return i(),_(h,{is:"form",open:o.createProposalTasksModal,title:"Generate Tasks",size:"small",actions:"center",onSubmit:c(b,["prevent"]),onClose:v},{content:u((()=>[p("div",fa,[_a,p("div",ba,[r(s,{label:"Enter Tasks Starting Date"},{default:u((()=>[r(t,null,{default:u((()=>[r(a,{modelValue:f(d),"onUpdate:modelValue":l[0]||(l[0]=e=>P(d)?d.value=e:null),required:"",name:"startDate",type:"date"},null,8,["modelValue"])])),_:1})])),_:1})]),ya,ha,ga,Ia])])),cancel:u((()=>[r(n,{light:"",onClick:l[1]||(l[1]=e=>v())},{default:u((()=>[y("Cancel")])),_:1})])),action:u((()=>[r(n,{loading:f(m),type:"submit",color:"info",light:"",raised:""},{default:u((()=>[y("Generate")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),ka=j(wa,[["__scopeId","data-v-0317543a"]]);export{ka as _,Xe as a,fe as b,ma as c,el as d,ae as u};
