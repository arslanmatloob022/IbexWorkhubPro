import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-fcee34f7.js";import{f as s,r as t,o,C as a,O as l,G as i,E as n,F as r,m as p,k as u,K as d,J as c,P as v,x as m,D as _,U as y,H as f,y as h,V as g,W as w,N as b,Y as k}from"./index-4e38c655.js";import{_ as x}from"./VField.vue_vue_type_script_setup_true_lang-23536ba1.js";import{_ as j}from"./VControl-1ffc0c3c.js";import{_ as I}from"./VTextarea.vue_vue_type_script_setup_true_lang-5b9202d4.js";import{u as A}from"./useNotyf-0584fd98.js";import{u as S}from"./useAPI-471f8e84.js";import{_ as C}from"./SweetAlert.vue_vue_type_style_index_0_lang-e16701c7.js";import{_ as O}from"./VAvatar.vue_vue_type_style_index_0_lang-3d7b77f3.js";import{s as M}from"./sleep-fd7a5d8b.js";import{g as N,a as V}from"./costItems-989aeab3.js";import"./VLabel.vue_vue_type_script_setup_true_lang-92ca55a9.js";import"./useVFieldContext-0f3560dc.js";import"./notyf-2c68889b.js";import"./useThemeColors-4d6e9237.js";const P={class:"columns is-multiline"},T={class:"column is-12"},q=s({__name:"ProposalReviewModal",props:{proposalReviewModal:{type:Boolean,default:!1},proposalId:{default:""}},emits:["closeModalHandler","update:OnSuccess"],setup(s,{emit:m}){const _=s,y=A(),f=S(),h=t(""),g=t(!1),w=()=>{m("closeModalHandler",!1)},b=async()=>{try{g.value=!0;await f.patch(`/api/lead-proposal/${_.proposalId}/`,{client_note:h.value,status:"review"});y.success("Your review submitted on proposal."),w(),m("update:OnSuccess",null)}catch(e){console.log(e)}finally{g.value=!1}};return o((()=>{})),(s,t)=>{const o=I,m=j,y=x,f=v,k=e;return a(),l(k,{is:"form",open:_.proposalReviewModal,title:"Review Proposal",size:"small",actions:"center",onSubmit:c(b,["prevent"]),onClose:w},{content:i((()=>[n("div",P,[n("div",T,[r(y,{label:"Enter Review Notes"},{default:i((()=>[r(m,null,{default:i((()=>[r(o,{modelValue:p(h),"onUpdate:modelValue":t[0]||(t[0]=e=>u(h)?h.value=e:null),rows:"4",placeholder:"Enter Notes"},null,8,["modelValue"])])),_:1})])),_:1})])])])),cancel:i((()=>[r(f,{light:"",onClick:t[1]||(t[1]=e=>w())},{default:i((()=>[d("Cancel")])),_:1})])),action:i((()=>[r(f,{loading:p(g),type:"submit",color:"info",raised:""},{default:i((()=>[d("Submit Review")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),B={class:"action-page-wrapper action-page-v1"},R={class:"wrapper-inner"},H={class:"action-box"},Y={class:"box-content"},$={class:"dark-inverted"},D={class:"is-dark-primary"},E={class:"sender-message is-dark-card-bordered is-dark-bg-4"},L=n("h4",{class:"dark-inverted"},"Message",-1),z={class:"dark-inverted"},F={class:"buttons"},U=s({__name:"ClientProposalsActionsMessage",props:{actions:{},message:{}},setup(e){const s=e,o=A(),l=m(),u=t(!1),h=()=>{window.location.href="https://www.google.com"},g=async()=>{u.value=!0,o.success("Thanks for your precious time!"),await M(),l.push("https://ibexbuilderstudios.com/"),u.value=!1};return(e,t)=>{const o=O,l=v;return a(),_("div",B,[n("div",R,[n("div",H,[n("div",Y,[r(o,{size:"big",picture:"/logos/IBEXDark.png"}),n("h3",$,[n("span",D,y(s.actions??"No Action"),1)]),n("div",E,[L,n("p",z,y(s.message??"No Message"),1)]),n("div",F,[r(l,{"dark-outlined":"",onClick:h},{default:i((()=>[d(" Close ")])),_:1}),r(l,{color:"primary",loading:p(u),raised:"",tabindex:"0",onKeydown:f(c(g,["prevent"]),["space"]),onClick:g},{default:i((()=>[d(" Visit Ibex Builders ")])),_:1},8,["loading","onKeydown"])])])])])])}}}),K={class:"columns is-multiline"},W={class:"column is-12 mt-4"},J={class:"invoice-wrapper"},X={class:"invoice-header"},G={class:"left"},Q={class:"right"},Z={class:"controls"},ee={key:0},se={key:1,class:"invoice-body"},te={class:"invoice-card"},oe={class:"invoice-section is-flex"},ae=n("div",{class:"meta"},null,-1),le=n("div",{class:"end"},[n("span",null,"PO Box 242"),n("span",null,"Evergreen, CO 80437-0242"),n("span",null,"Phone: 720 272-9061"),n("span",null,"Premium Trades for Premier Builders")],-1),ie={class:"invoice-section is-flex"},ne={key:0,class:"meta"},re={key:1,class:"meta"},pe={class:"end is-left"},ue={key:0,class:"invoice-section"},de={class:"responsive-table"},ce=["innerHTML"],ve={key:1},me={key:2},_e={class:"invoice-section is-flex mt-0 pt-0"},ye={class:"end is-left"},fe={class:"text-right"},he=k('<div class="invoice-section is-flex mt-0 pt-0"><div class="footer"><div class="footer-meta"><p>Signature:</p><div></div></div><div class="footer-meta"><p>Date:</p><div></div></div><div class="footer-meta"><p class="no-wrap">Print Name:</p><div></div></div></div></div>',1),ge=s({__name:"proposal-view",emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:s}){const u=t(""),c=A(),m=h(),f=S(),k=t(""),x=t(""),j=t(!1),I=t(!1),M=t({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),P=t({id:"",title:"",approval_deadline:"",internal_notes:null,introductory_text:null,closing_text:null,columns_to_show:[],payment_status:"",type:"",status:"",created_at:"",updated_at:"",job:""}),T=t([{id:"",index:0,title:"",description:"",type:"",quantity:0,unit:"",unit_cost:"",markup:"",total_price:"",cost_code:"",cost_type:"",builder_cost:"",margin:"",profit:"",internal_notes:"",mark_as:"",state:"",group_amount:"",status:null,created_at:"",proposal:""}]),B=t({review:{short:"Thank you for submitting your review.",full:"Your request for a review has been received. Our team at Ibex Builders Studios will carefully assess the proposal and make any necessary adjustments to align with your expectations. Weâ€™ll get back to you shortly with an updated version."},disapprove:{short:"Thank you for your feedback.",full:"We appreciate your time in reviewing our proposal. If there are any concerns or adjustments needed, please let us know. Ibex Builders Studios is happy to revise and accommodate your requirements."},approved:{short:"Thank you for approving the proposal!",full:"Your approval confirms the agreed cost items and expenditures. Our team at Ibex Builders Studios will now proceed with the next steps to ensure a smooth and efficient construction process."}}),R=t(""),H=async()=>{try{I.value=!0;const e=await f.get(`/api/lead-proposal/${m.query.proposal}/detail/`);$(),P.value=e.data,R.value=e.data.status;let s=B.value[e.data.status];k.value=s.short,x.value=s.full}catch(e){console.log(e)}finally{I.value=!1}},Y=async()=>{try{I.value=!0;await f.patch(`/api/lead-proposal/${m.query.proposal}/`,{status:u.value});H(),c.success(`You have ${u.value} this proposal.`),M.value.isSweetAlertOpen=!1}catch(e){console.log(e)}finally{I.value=!1}},$=async()=>{try{const e=await f.get(`api/cost/by-proposal/${m.query.proposal}/`);T.value=e.data}catch(e){console.log(e)}};return o((()=>{m.query.proposal&&H()})),(e,s)=>{const t=v,o=U,c=O,f=C,h=q;return a(),_("div",K,[n("div",W,[n("div",J,[n("div",X,[n("div",G,[n("h3",null,"Proposal "+y(p(m).query.proposal?.slice(0,8)),1)]),n("div",Q,[n("div",Z,[r(t,{size:"xsmall",onClick:s[0]||(s[0]=e=>{return s="approved",u.value=s,void(M.value={title:`${u.value.toLocaleUpperCase()} proposal ?`,subtitle:"approved"==u.value?"You are going to approve this proposal and as you do so Ibex Team will start working on mentioned work.":"You are about to Disapprove the proposal that will identify us that you are not going to have done the mentioned work at your site.",btntext:"approved"==u.value?"Approve":"Disapprove",isSweetAlertOpen:!0});var s}),outlined:"",color:"primary"},{default:i((()=>[d("Approve")])),_:1})])])]),"pending"!=p(R)?(a(),_("div",ee,[r(o,{actions:p(k),message:p(x)},null,8,["actions","message"])])):(a(),_("div",se,[n("div",te,[n("div",oe,[r(c,{size:"xl",picture:"/logos/IbexFavicon.png"}),ae,le]),n("div",ie,[p(P)?.jobInfo?.clientInfo?(a(),_("div",ne,[n("h3",null,y(p(P)?.jobInfo?.clientInfo?.username??"N/A"),1),n("span",null,y(p(P)?.jobInfo?.clientInfo?.email??"N/A"),1)])):(a(),_("div",re,[n("h3",null,y(p(P)?.jobInfo?.contractor_info?.username??"N/A"),1),n("span",null,y(p(P)?.jobInfo?.contractor_info?.email??"N/A"),1)])),n("div",pe,[n("h3",null,"Job: "+y(p(P).jobInfo?.title??"N/A"),1),n("p",null,"Address: "+y(p(P).jobInfo?.address??"N/A"),1)])]),p(T).length?(a(),_("div",ue,[n("table",de,[n("thead",null,[(a(!0),_(g,null,w(p(P).columns_to_show,((e,s)=>(a(),_("th",{key:s},y(p(N)[e]),1)))),128))]),n("tbody",null,[(a(!0),_(g,null,w(p(T),((e,s)=>(a(),_("tr",{key:e.id},[(a(!0),_(g,null,w(p(P).columns_to_show,((s,t)=>(a(),_("td",{key:t},["description"===s?(a(),_("div",{key:0,style:{color:"#222"},innerHTML:e[p(V)[s]]},null,8,ce)):(a(),_("span",ve,y(e[p(V)[s]]),1)),"cost_code"===s?(a(),_("span",me,y(e?.cost_code_info?.name),1)):b("",!0)])))),128))])))),128))])])])):b("",!0),n("div",_e,[n("div",ye,[n("h3",fe," Total Price: $"+y(p(P).proposalAmount??0),1)])]),he])]))])]),p(M).isSweetAlertOpen?(a(),l(f,{key:0,isSweetAlertOpen:p(M).isSweetAlertOpen,title:p(M).title,subtitle:p(M).subtitle,btntext:p(M).btntext,onConfirm:Y,onCancel:()=>p(M).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):b("",!0),p(j)?(a(),l(h,{key:1,proposalReviewModal:p(j),proposalId:p(m).query.proposal,onCloseModalHandler:s[1]||(s[1]=e=>j.value=!1),"onUpdate:OnSuccess":H},null,8,["proposalReviewModal","proposalId"])):b("",!0)])}}});export{ge as default};
