import{_ as e}from"./VMessage.vue_vue_type_style_index_0_lang-5b45899a.js";import{e as a,r as s,t as l,v as o,x as t,o as i,y as n,z as r,A as d,B as u,C as c,D as p,E as m,F as v,G as f,l as h,H as g,I as y,J as b,j as _,K as w,L as k,M as x,N as j,X as C,O as V,P as z,Q as I,R as P}from"./index-67ab4c5c.js";import{_ as A}from"./VField.vue_vue_type_script_setup_true_lang-c10b4195.js";import{_ as L}from"./VControl-6f918ee4.js";import{_ as S}from"./VInput.vue_vue_type_script_setup_true_lang-6e7deff6.js";import{_ as R}from"./VLabel.vue_vue_type_script_setup_true_lang-7c22ae02.js";import{_ as U}from"./AnimatedLogo-f7ed7d57.js";import{u as F}from"./userSession-6cdea213.js";import{u as K}from"./useNotyf-3d9d3b2a.js";import{u as q,a as D}from"./useAPI-af66b40f.js";import{u as E}from"./layoutSwitcher-1d9e859f.js";import"./useVFieldContext-97c78d0b.js";import"./notyf-b66a7ab7.js";import"./useThemeColors-b9551253.js";const T=e=>(z("data-v-8acce7d6"),e=e(),I(),e),W={class:"modern-login"},H=T((()=>p("div",{class:"underlay h-hidden-mobile h-hidden-tablet-p"},null,-1))),M={class:"columns is-gapless is-vcentered"},G=C('<div style="background-image:url(&quot;/IbexImages/ibexnight.png&quot;);" class="column is-relative is-8 h-hidden-mobile h-hidden-tablet-p" data-v-8acce7d6><div class="hero is-fullheight is-image" data-v-8acce7d6><div class="hero-body" data-v-8acce7d6><div class="container" data-v-8acce7d6><div class="columns" data-v-8acce7d6><div class="column" data-v-8acce7d6></div></div></div></div></div></div>',1),J={style:{"z-index":"99999"},class:"column is-4 is-relative"},N={class:"top-tools"},O=T((()=>p("h3",{style:{"font-size":"1.8rem","font-weight":"600","margin-left":"1rem",color:"#777"}},[p("span",{style:{color:"#2aac8e","font-size":"1.9rem"}},"Ibex"),b(" WorkHub ")],-1))),Q=["checked"],B=T((()=>p("span",null,null,-1))),X={class:"is-form"},$={class:"is-form-inner"},Y=[T((()=>p("h2",null,"Sign In",-1))),T((()=>p("p",null,"Welcome back to your account.",-1)))],Z=[T((()=>p("h2",null,"Recover Account",-1))),T((()=>p("p",null,"Reset your account password.",-1)))],ee=["onSubmit"],ae=[T((()=>p("i",{class:"iconify","data-icon":"feather:eye","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],se=[T((()=>p("i",{class:"iconify","data-icon":"feather:eye-off","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],le=T((()=>p("span",{class:"toggler"},[p("span",{class:"active"},[p("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:check"})]),p("span",{class:"inactive"},[p("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:circle"})])],-1))),oe={class:"button-wrap has-help"},te={key:0,class:"recover-text"},ie={class:"button-wrap"},ne=P(a({__name:"login",setup(a){const C=E(),z=s("login"),I=s(!1),P=l(),T=o(),ne=t(),re=K(),de=q(),ue=F();ne.query.redirect;const ce=s(""),pe=s(""),me=s(""),ve=s(!1),fe=s(!1),he=s(!1),ge=async()=>{if(!I.value){I.value=!0;try{const e=await D.post("https://api.ibexworkhub.com/api/auth/login/",{email:ce.value,password:pe.value});console.log("resp",e.data);const a=e.data.token,s=e.data.user;ue.setToken(a),ue.setUser(s),ye()}catch(e){I.value=!1}finally{I.value=!1}}},ye=()=>{console.log("inside login success"),C.setDynamicLayoutId("sideblock-default"),re.success(`Welcome back, ${ue.user.username}`),I.value=!1,"admin"==ue.user.role?T.push("/sidebar/dashboard"):"worker"==ue.user.role?T.push("/sidebar/worker/tasks"):"manager"==ue.user.role?T.push("/sidebar/manager/projects"):"contractor"==ue.user.role?T.push("/sidebar/contractor/projects"):"client"==ue.user.role&&T.push("/sidebar/client/projects")},be=()=>{ve.value=!ve.value};return i((()=>{})),n((()=>{const e=window.location.search,a=new URLSearchParams(e);console.log("urlDAta",window.location.search);const s=a.get("token");s?ue.setToken(s):console.log("Invalid token")})),r({title:"Login - Ibex"}),(a,s)=>{const l=U,o=d("RouterLink"),t=R,i=S,n=L,r=A,C=V,F=e;return u(),c("div",W,[H,p("div",M,[G,p("div",J,[p("div",N,[m(o,{to:"/auth/login",class:"top-logo"},{default:v((()=>[m(l,{style:{width:"38px",height:"38px"}}),O])),_:1}),p("label",{class:"dark-mode",tabindex:"0",role:"button",onKeydown:s[1]||(s[1]=f(y((e=>e.target.click()),["prevent"]),["space"]))},[p("input",{"data-cy":"dark-mode-toggle",type:"checkbox",checked:!h(P).isDark,onChange:s[0]||(s[0]=(...e)=>h(P).onChange&&h(P).onChange(...e))},null,40,Q),B],32)]),p("div",X,[p("div",$,[p("div",{class:g(["form-text",["login"!==h(z)&&"is-hidden"]])},Y,2),p("div",{class:g(["form-text",["login"===h(z)&&"is-hidden"]])},Z,2),p("form",{method:"post",novalidate:"","data-cy":"login-form",class:g([["login"!==h(z)&&"is-hidden"],"login-wrapper"]),onSubmit:y(ge,["prevent"])},[m(r,null,{default:v((()=>[m(n,{icon:"lnil lnil-envelope autv-icon"},{default:v((()=>[m(t,{class:"auth-label"},{default:v((()=>[b(" Email Address ")])),_:1}),m(i,{modelValue:h(ce),"onUpdate:modelValue":s[2]||(s[2]=e=>_(ce)?ce.value=e:null),"data-cy":"email-input",type:"email",autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),m(r,null,{default:v((()=>[m(n,{icon:"lnil lnil-lock-alt autv-icon",style:{position:"relative"}},{default:v((()=>[w(p("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:be},ae,512),[[k,!h(ve)]]),w(p("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:be},se,512),[[k,h(ve)]]),m(t,{class:"auth-label"},{default:v((()=>[b("Password")])),_:1}),m(i,{modelValue:h(pe),"onUpdate:modelValue":s[3]||(s[3]=e=>_(pe)?pe.value=e:null),"data-cy":"password-input",type:h(ve)?"text":"password",autocomplete:"current-password"},null,8,["modelValue","type"])])),_:1})])),_:1}),m(r,null,{default:v((()=>[m(n,{class:"is-flex"},{default:v((()=>[m(t,{raw:"",class:"remember-toggle"},{default:v((()=>[m(i,{raw:"",type:"checkbox"}),le])),_:1}),m(t,{raw:"",class:"remember-me"},{default:v((()=>[b(" Remember Me ")])),_:1}),p("a",{tabindex:"0",role:"button",onKeydown:s[4]||(s[4]=f(y((e=>z.value="forgot-password"),["prevent"]),["space"])),onClick:s[5]||(s[5]=e=>z.value="forgot-password")}," Forgot Password? ",32)])),_:1})])),_:1}),p("div",oe,[m(C,{id:"login-button",loading:h(I),color:"primary",type:"submit",size:"big",rounded:"",raised:"",bold:""},{default:v((()=>[b(" Confirm ")])),_:1},8,["loading"]),p("span",null,[b(" Or "),m(o,{to:"/auth/signup-1"},{default:v((()=>[b("Create")])),_:1}),b(" an account. ")])])],42,ee),p("form",{method:"post",novalidate:"",class:g([["forgot-password"!==h(z)&&"is-hidden"],"login-wrapper"]),onSubmit:s[12]||(s[12]=y((()=>{}),["prevent"]))},[h(fe)?x("",!0):(u(),c("p",te," Enter your email and click on the confirm button to reset your password. We'll send you an email detailing the steps to complete the procedure. ")),h(fe)?(u(),j(F,{key:1,color:"primary",class:"is-flex",closable:"",onClose:s[6]||(s[6]=e=>fe.value=!1)},{default:v((()=>[b(" A password reset request has been sent to your email. Please check your inbox to change your password. ")])),_:1})):x("",!0),h(he)?(u(),j(F,{key:2,color:"danger",class:"is-flex mt-4",closable:"",onClose:s[7]||(s[7]=e=>he.value=!1)},{default:v((()=>[b(" Please enter valid email address. ")])),_:1})):x("",!0),m(r,null,{default:v((()=>[m(n,{icon:"lnil lnil-envelope autv-icon"},{default:v((()=>[m(t,{class:"auth-label"},{default:v((()=>[b(" Email Address ")])),_:1}),m(i,{type:"email",modelValue:h(me),"onUpdate:modelValue":s[8]||(s[8]=e=>_(me)?me.value=e:null),autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),m(r,null,{default:v((()=>[m(n,{class:"is-flex"},{default:v((()=>[p("a",{tabindex:"0",role:"button",onKeydown:s[9]||(s[9]=f(y((e=>z.value="login"),["prevent"]),["space"])),onClick:s[10]||(s[10]=e=>z.value="login")}," Login ? ",32)])),_:1})])),_:1}),p("div",ie,[m(C,{loading:h(I),color:"primary",size:"big",type:"submit",lower:"",rounded:"",solid:"",onClick:s[11]||(s[11]=e=>(async e=>{try{I.value=!0,await de.post("/v3/api/account/auth/forget-password/",{email:e}),fe.value=!0}catch(a){he.value=!0,re.error("Please enter your valid email address")}finally{I.value=!1}})(h(me)))},{default:v((()=>[b(" Confirm ")])),_:1},8,["loading"])])],34)])])])])])}}}),[["__scopeId","data-v-8acce7d6"]]);export{ne as default};
