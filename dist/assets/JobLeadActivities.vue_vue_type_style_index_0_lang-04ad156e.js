import{_ as e}from"./ScheduleEmailModal.vue_vue_type_script_setup_true_lang-bfcf48c3.js";import{_ as a}from"./VModal.vue_vue_type_style_index_0_lang-2551e5bf.js";import{f as t,r as l,b as i,o as s,B as n,C as o,O as u,G as d,E as c,F as r,L as p,m,X as v,D as y,V as f,W as _,K as g,U as b,J as h,N as V,a5 as A,P as I,$ as j,av as k,k as U,I as C,aS as w,a4 as S}from"./index-203aa1df.js";import{_ as x}from"./VTextarea.vue_vue_type_script_setup_true_lang-8fa47c16.js";import{_ as $}from"./VInput.vue_vue_type_script_setup_true_lang-9ccb4bbf.js";import{_ as M}from"./VField.vue_vue_type_script_setup_true_lang-ecacee0a.js";import{_ as T}from"./VControl-8ec090b2.js";import{_ as z,a as E}from"./VOption.vue_vue_type_style_index_0_lang-4c6ba6df.js";import{u as P}from"./useAPI-fb22fc83.js";import{u as q}from"./useNotyf-4bfde6a7.js";import{a as D,h as L,f as N}from"./useSupportElement-14efeaf4.js";import{e as O}from"./estimatesScripts-0e766b81.js";import{_ as B}from"./VAvatar.vue_vue_type_style_index_0_lang-752f1522.js";import{_ as H}from"./VIcon.vue_vue_type_script_setup_true_lang-df6ebd27.js";import{_ as R}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-8c5e7b0f.js";import{_ as F}from"./PlaceloadV3.vue_vue_type_style_index_0_lang-8d7281ca.js";import{_ as G,a as J}from"./search-3-dark-1eb6ae2e.js";const W={class:"modal-form columns is-multiline"},Z={class:"column is-12"},K=c("div",{class:"column is-12"},[c("h3",{class:"title is-6 mb-2"},"Activity Information")],-1),X={class:"field column is-6 mb-0"},Q=c("label",null,"Title *",-1),Y={class:"control"},ee={class:"field column is-6 mb-0"},ae=c("label",null,"Activity Type *",-1),te={class:"field column is-6 mb-0"},le=c("label",null,"Date ",-1),ie={class:"field column is-3 mb-0"},se=c("label",null,"Start Time ",-1),ne={class:"field column is-3 mb-0"},oe=c("label",null,"End Time ",-1),ue={class:"field column is-3 mb-0"},de=c("label",null,"Color ",-1),ce=c("datalist",{id:"colors-list"},[c("option",{value:"#84cc16"}),c("option",{value:"#22c55e"}),c("option",{value:"#0ea5e9"}),c("option",{value:"#6366f1"}),c("option",{value:"#8b5cf6"}),c("option",{value:"#d946ef"}),c("option",{value:"#f43f5e"}),c("option",{value:"#facc15"}),c("option",{value:"#fb923c"}),c("option",{value:"#9ca3af"})],-1),re={class:"field column is-3 mb-0"},pe=c("label",null,"Reminder time: ",-1),me={class:"field column is-3 mb-0"},ve=c("label",null,"Attachment ",-1),ye={class:"file"},fe={class:"file-label"},_e={class:"file-cta"},ge=c("span",{class:"file-icon"},[c("i",{class:"fas fa-cloud-upload-alt"})],-1),be={class:"file-label"},he={class:"field column is-12 mb-0"},Ve=c("label",null,"Assigned * ",-1),Ae={class:"multiselect-tag is-user"},Ie=["src"],je=["onMousedown"],ke=c("div",{class:"column is-12"},[c("h3",{class:"title is-6 mb-2"},"Location")],-1),Ue={class:"field column is-4 mb-0"},Ce=c("label",null,"Zip Code ",-1),we={class:"control"},Se={class:"field column is-4 mb-0"},xe=c("label",null,"City ",-1),$e={class:"control"},Me={class:"field column is-4 mb-0"},Te=c("label",null,"State ",-1),ze={class:"control"},Ee={class:"field column is-12 mb-0"},Pe=c("label",null,"Street Address",-1),qe={class:"control"},De={class:"field column is-12 mb-0"},Le=c("label",null,"Description ",-1),Ne=t({__name:"LeadActivityModal",props:{addUpdateContactModal:{type:Boolean},activityId:{},objectId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:t}){const j=e;l(null);const k=i(),U=q(),C=P(),w=l(!1),S=()=>{t("update:modalHandler",!1)},N=l([{value:"",name:"",image:""}]),B=l({title:"",objectId:j.objectId??"",type:"",color:"",status:"",date:"",start_time:"",end_time:"",reminder_time:"",assignedUser:"",attendees:[],initiated_by:k.user.id,address:"",city:"",state:"",zip_code:"",description:"",latitude:0,longitude:0,file:""}),H=async()=>{try{w.value=!0;const e=D(B.value,["file"]);if(j.activityId){await C.patch(`/api/activity/${j.activityId}/`,e);U.success("Activity updated successfully")}else{await C.post("/api/activity/",e);U.success("Activity added successfully")}t("update:OnSuccess",null),S()}catch(e){U.error(` ${e}, Activity`)}finally{w.value=!1}},R=async()=>{if(!B.value.zip_code)return;const e=await L(B.value.zip_code);console.log("API Response:",e),e?.status&&e.data?(B.value.latitude=e.data.lat,B.value.longitude=e.data.lng,B.value.address=e.data.address,B.value.city=e.data.city,B.value.state=e.data.state,U.success("Address fetched successfully")):console.log("Address not found.")},F=l(""),G=l(0),J=e=>{const a=e.target,t=a.files?.[0];a.value="",t&&(B.value.file=t,F.value=t.name,G.value=t.size)};return s((()=>{(async()=>{try{w.value=!0;const e=await C.get("/api/users/");N.value=e.data.map((e=>({value:e.id,name:`${e.username??"N/A"} ${e.last_name??""}`,icon:e.avatar})))}catch(e){U.error("something get wrong")}finally{w.value=!1}})(),j.activityId&&(async()=>{try{w.value=!0;const e=await C.get(`/api/activity/${j.activityId}/`);B.value=e.data}catch(e){U.error(` ${e}, Get Activity`)}finally{w.value=!1}})()})),(e,t)=>{const l=z,i=E,s=T,k=M,U=$,C=n("Multiselect"),P=A,q=x,D=I,L=a;return o(),u(L,{is:"form",open:j.addUpdateContactModal,title:"Activity Details",size:"large",actions:"right",onSubmit:h(H,["prevent"]),onClose:S},{content:d((()=>[c("div",W,[c("div",Z,[r(P,{class:"columns is-multiline"},{default:d((()=>[K,c("div",X,[Q,c("div",Y,[p(c("input",{type:"text",name:"title","onUpdate:modelValue":t[0]||(t[0]=e=>m(B).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Title"},null,512),[[v,m(B).title]])])]),c("div",ee,[ae,r(k,null,{default:d((()=>[r(s,null,{default:d((()=>[r(i,{modelValue:m(B).type,"onUpdate:modelValue":t[1]||(t[1]=e=>m(B).type=e),required:""},{default:d((()=>[(o(!0),y(f,null,_(m(O),(e=>(o(),u(l,{value:e.value},{default:d((()=>[g(b(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),c("div",te,[le,p(c("input",{type:"date",name:"date","onUpdate:modelValue":t[2]||(t[2]=e=>m(B).date=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[v,m(B).date]])]),c("div",ie,[se,p(c("input",{type:"time",name:"date","onUpdate:modelValue":t[3]||(t[3]=e=>m(B).start_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[v,m(B).start_time]])]),c("div",ne,[oe,p(c("input",{type:"time",name:"date","onUpdate:modelValue":t[4]||(t[4]=e=>m(B).end_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[v,m(B).end_time]])]),c("div",ue,[de,r(k,null,{default:d((()=>[r(s,null,{default:d((()=>[r(U,{modelValue:m(B).color,"onUpdate:modelValue":t[5]||(t[5]=e=>m(B).color=e),list:"colors-list",type:"color",placeholder:"Pick a color"},null,8,["modelValue"]),ce])),_:1})])),_:1})]),c("div",re,[pe,p(c("input",{type:"time",name:"date","onUpdate:modelValue":t[6]||(t[6]=e=>m(B).reminder_time=e),class:"input is-primary-focus is-primary-focus",placeholder:"Activity Type"},null,512),[[v,m(B).reminder_time]])]),c("div",me,[ve,r(k,{grouped:""},{default:d((()=>[r(s,null,{default:d((()=>[c("div",ye,[c("label",fe,[c("input",{onChange:J,class:"file-input",type:"file",name:"resume"},null,32),c("span",_e,[ge,c("span",be,b(m(F)?m(F):"Choose a fileâ€¦"),1)])])])])),_:1})])),_:1})]),c("div",he,[Ve,r(k,null,{default:d((({id:e})=>[r(s,null,{default:d((()=>[r(C,{required:"",modelValue:m(B).attendees,"onUpdate:modelValue":t[8]||(t[8]=e=>m(B).attendees=e),attrs:{id:e},mode:"tags",placeholder:"Select a user","track-by":"name",label:"name",search:!0,searchable:!0,options:m(N),"max-height":145},{tag:d((({option:e,remove:a,disabled:l})=>[c("div",Ae,[c("img",{src:e.image,alt:""},null,8,Ie),g(" "+b(e.name)+" ",1),l?V("",!0):(o(),y("i",{key:0,role:"button",tabindex:"0",onClick:t[7]||(t[7]=h((()=>{}),["prevent"])),onMousedown:h((t=>a(e)),["prevent","stop"])},null,40,je))])])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})])])),_:1}),r(P,{class:"columns is-multiline mt-3"},{default:d((()=>[ke,c("div",Ue,[Ce,c("div",we,[p(c("input",{type:"text",name:"state",onBlur:R,"onUpdate:modelValue":t[9]||(t[9]=e=>m(B).zip_code=e),class:"input is-primary-focus is-primary-focus",placeholder:"Zip Code"},null,544),[[v,m(B).zip_code]])])]),c("div",Se,[xe,c("div",$e,[p(c("input",{type:"text",name:"city","onUpdate:modelValue":t[10]||(t[10]=e=>m(B).city=e),class:"input is-primary-focus is-primary-focus",placeholder:"City"},null,512),[[v,m(B).city]])])]),c("div",Me,[Te,c("div",ze,[p(c("input",{type:"text",name:"state","onUpdate:modelValue":t[11]||(t[11]=e=>m(B).state=e),class:"input is-primary-focus is-primary-focus",placeholder:"State"},null,512),[[v,m(B).state]])])]),c("div",Ee,[Pe,c("div",qe,[p(c("input",{type:"tel",name:"phone","onUpdate:modelValue":t[12]||(t[12]=e=>m(B).address=e),class:"input is-primary-focus is-primary-focus",placeholder:"Street Address"},null,512),[[v,m(B).address]])])]),c("div",De,[Le,r(k,null,{default:d((()=>[r(s,null,{default:d((()=>[r(q,{modelValue:m(B).description,"onUpdate:modelValue":t[13]||(t[13]=e=>m(B).description=e),rows:"3",placeholder:"Enter description..."},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1})])])])),action:d((()=>[r(D,{loading:m(w),type:"submit",color:"primary",raised:""},{default:d((()=>[g(b(j.activityId?"Update":"Create")+" Activity",1)])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),Oe={key:1},Be={class:"card-grid-toolbar"},He={class:"buttons"},Re={class:"card-grid card-grid-v3"},Fe=c("img",{class:"light-image",src:G,alt:""},null,-1),Ge=c("img",{class:"dark-image",src:J,alt:""},null,-1),Je={class:"h-toggle"},We=["checked"],Ze={class:"toggler"},Ke=c("span",{class:"active"},[c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:check"})],-1),Xe={class:"inactive"},Qe={class:"dark-inverted"},Ye={class:"description"},ea={class:"people"},aa={class:"buttons"},ta=["onClick"],la=[c("span",{class:"icon"},[c("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:edit-2"})],-1),c("span",null,"Edit",-1)],ia=t({__name:"JobLeadActivities",props:{jobId:{},getUserActivities:{type:Boolean}},setup(a){const t=a,n=l(""),h=l(""),A=l(!1),x=l(!1),$=l([{id:"",attendees_info:[{id:"",username:"",last_name:null,email:"",role:"",avatar:""}],initiated_by_info:{id:"",username:"",last_name:"",email:"",role:"",avatar:""},title:"",description:"",objectId:"",type:"",color:"",status:"",date:"",start_time:"",end_time:"",reminder_time:"",created_at:"",address:"",city:"",state:"",zip_code:"",file:null,latitude:0,longitude:0,initiated_by:"",attendees:[""]}]),D=P(),L=q(),G=i(),J=l(!1),W=l(""),Z=l(!1),K=j((()=>{if(!$.value)return[];const e=new RegExp(n.value,"i"),a=W.value?.trim();return $.value.filter((t=>{const l=!n.value||e.test(t.title)||e.test(t.start_time)||e.test(t.end_time)||e.test(t.date)||e.test(t.status)||e.test(t.type),i=!a||t.type===a;return l&&i}))})),X=()=>{t.getUserActivities?(async()=>{try{J.value=!0;const e=await D.get(`/api/activity/by-user/${G.user.id}/`);$.value=e.data}catch(e){L.error("something get wrong")}finally{J.value=!1}})():t.jobId?(async()=>{try{J.value=!0;const e=await D.get(`/api/activity/by-object/${t.jobId}/`);$.value=e.data}catch(e){L.error("something get wrong")}finally{J.value=!1}})():(async()=>{try{J.value=!0;const e=await D.get("/api/activity/");$.value=e.data}catch(e){L.error("something get wrong")}finally{J.value=!1}})()};return s((()=>{X()})),(a,l)=>{const i=F,s=T,j=z,$=E,P=M,q=I,G=R,Q=H,Y=B,ee=Ne,ae=e,te=k("tooltip");return m(J)?(o(),u(i,{key:0})):(o(),y("div",Oe,[c("div",Be,[r(s,{icon:"feather:search"},{default:d((()=>[p(c("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>U(n)?n.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[v,m(n)]])])),_:1}),c("div",He,[r(P,null,{default:d((()=>[r(s,null,{default:d((()=>[r($,{modelValue:m(W),"onUpdate:modelValue":l[1]||(l[1]=e=>U(W)?W.value=e:null),required:""},{default:d((()=>[r(j,{value:""},{default:d((()=>[g("All")])),_:1}),(o(!0),y(f,null,_(m(O),(e=>(o(),u(j,{value:e.value},{default:d((()=>[g(b(e.label),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1}),r(q,{onClick:l[2]||(l[2]=e=>A.value=!m(A)),color:"warning",icon:"lnir lnir-alarm"},{default:d((()=>[g(" Create Activity ")])),_:1}),r(q,{onClick:l[3]||(l[3]=e=>x.value=!m(x)),color:"success",class:"ml-2",icon:"fas fa-envelope"},{default:d((()=>[g(" Schedule Email ")])),_:1})])]),c("div",Re,[r(G,{class:C([0!==m(K).length&&"is-hidden"]),title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\n          search terms you've entered. Please try different search terms or\n          criteria.",larger:""},{image:d((()=>[Fe,Ge])),_:1},8,["class"]),r(w,{name:"list",tag:"div",class:"columns is-multiline is-flex-tablet-p is-half-tablet-p"},{default:d((()=>[(o(!0),y(f,null,_(m(K),(e=>(o(),y("div",{key:e.id,class:"column is-4"},[c("div",{class:"card-grid-item",style:S({backgroundImage:`linear-gradient(\n                    -175deg,\n                    transparent 70%,\n                  ${e.color}30\n                  `})},[c("label",Je,[c("input",{type:"checkbox",checked:"completed"==e.status},null,8,We),c("span",Ze,[Ke,c("span",Xe,[r(Q,{icon:"lucide:activity"})])])]),r(Y,{size:"large",picture:`/IbexIcons/ActivitiesIcons/${e.type}.png`,squared:""},null,8,["picture"]),c("h3",Qe,b(e.title),1),c("p",null,b(m(N)(e.date))+" remaining",1),c("div",Ye,[c("p",null,b(e.description??"Not Added"),1)]),c("div",ea,[(o(!0),y(f,null,_(e.attendees_info,(e=>p((o(),u(Y,{key:e.id,size:"small",initials:e.username.slice(0,2),picture:e.avatar},null,8,["initials","picture"])),[[te,`${e.username} ${e.last_name?e.last_name:""}`,void 0,{rounded:!0}]]))),128))]),c("div",aa,[r(q,{onClick:a=>(async(e="")=>{try{Z.value=!0,204===(await D.delete(`/api/activity/${e}/`)).status?(L.success("Activity deleted successfully"),X()):L.error("Something went wrong")}catch(a){console.log("Err in deleting activity",a)}finally{Z.value=!1}})(e.id),loading:m(Z),icon:"feather:trash",outlined:""},{default:d((()=>[g(" Delete ")])),_:2},1032,["onClick","loading"]),c("button",{onClick:a=>{return t=e.id,h.value=t,void(A.value=!0);var t},class:"button v-button is-dark-outlined"},la,8,ta)])],4)])))),128))])),_:1})]),m(A)?(o(),u(ee,{key:0,addUpdateContactModal:m(A),objectId:t.jobId,activityId:m(h),"onUpdate:modalHandler":l[4]||(l[4]=e=>A.value=!1),"onUpdate:OnSuccess":X},null,8,["addUpdateContactModal","objectId","activityId"])):V("",!0),m(x)?(o(),u(ae,{key:1,mailSchedulerModal:m(x),"onUpdate:modalHandler":l[5]||(l[5]=e=>x.value=!1)},null,8,["mailSchedulerModal"])):V("",!0)]))}}});export{ia as _};
