import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-5bc69d1a.js";import{_ as l}from"./VCollapse.vue_vue_type_style_index_0_lang-fbcf2e46.js";import{_ as a}from"./VTextarea.vue_vue_type_script_setup_true_lang-e1d809a1.js";import{e as t,r as s,w as o,o as i,K as n,v as d,F as u,z as r,A as c,y as m,B as p,l as v,j as _,H as f,C as g,ad as y,V as b,W as h,J as j}from"./index-a3511ab8.js";import{_ as V}from"./VSwitchSegment.vue_vue_type_style_index_0_lang-17e4fc05.js";import{_ as w}from"./VField.vue_vue_type_script_setup_true_lang-e06a2d38.js";import{_ as x}from"./VControl-f6dba4dd.js";import{_ as C}from"./VInput.vue_vue_type_script_setup_true_lang-17074c81.js";import{_ as I}from"./VLabel.vue_vue_type_script_setup_true_lang-dfa6e2cd.js";import{u as S}from"./useAPI-2f913358.js";import{u as k}from"./useNotyf-bee6672a.js";import{u as J}from"./company-ca9a809c.js";const W=e=>(b("data-v-c5341aef"),e=e(),h(),e),$={class:"modal-form columns is-multiline cu-all-input",id:"addJob"},A={class:"field column is-12 mb-0",id:"rota-celender-two"},M={class:"columns is-multiline mb-3 cu-all-input"},U={class:"column is-12"},F={class:"columns is-multiline cu-all-input"},E={class:"column is-6"},D={class:"column is-6"},P={class:"column is-12 smart-search-dropdown"},z={class:"multiselect-single-label",style:{"background-color":"transparent"}},H=["src"],O={class:"options-div"},T={class:"option-cdiv"},B=["src"],N={class:"option-ddiv"},K={class:"option-span"},L={class:"mail-span"},R=W((()=>c("span",{class:"email-span"},"Email:",-1))),X={class:"column is-6"},Y={class:"column is-6"},q=W((()=>c("i",{class:"lnil lnil-envelope mr-2","aria-hidden":"true"},null,-1))),G=W((()=>c("i",{class:"lnil lnil-envelope mr-2","aria-hidden":"true"},null,-1))),Q=W((()=>c("div",{class:"head-info"},[c("div",{class:"head-progress"})],-1))),Z={class:"body-inner-content"},ee={class:"field columns is-multiline mb-0"},le={class:"column is-12"},ae={class:"columns is-multiline"},te={class:"field column is-5 mb-0"},se=W((()=>c("label",null,"Upload File",-1))),oe=W((()=>c("div",{class:"file has-name"},[c("label",{class:"file-label"},[c("input",{class:"file-input",type:"file",name:"resume"}),c("span",{class:"file-cta"},[c("span",{class:"file-icon"},[c("i",{class:"fas fa-cloud-upload-alt"})]),c("span",{class:"file-label"}," Choose a fileâ€¦ ")]),c("span",{class:"file-name light-text"}," filename... ")])],-1))),ie={class:"",style:{width:"97%"}},ne=j(t({__name:"AddJobsModal",props:{jobId:{},AddJobModalOpen:{type:Boolean}},emits:["update:modalHandler","update:onSuccess"],setup(t,{emit:b}){const h=t,j=J(),W=s(!1),ne=k(),de=S(),ue=s(""),re=s({}),ce=s({}),me=s([]),pe=s(""),ve=s(!1),_e=s(0),fe=s([]),ge=s([]),ye=s([]);let be=s([]);const he=s(""),je=[{title:"Additional Information",content:"Add additional information about job"}],Ve=s({externalId:"",title:"",company:"",description:"",manager:0,isWorkWithContractor:!0,file:File}),we=()=>{b("update:modalHandler",!1)},xe=()=>{h.jobId?Ie():Ce()},Ce=async()=>{W.value=!0;try{if(he.value){Ve.value.company=j.loggedCompany.id;await de.post("/v3/api/vixen-job/",Ve.value);ne.success("Job Added Successfuly"),we(),b("update:onSuccess",null)}else ne.error("Please select a Manager");W.value=!1}catch(e){console.log(e),ne.error("Error while adding a job"),W.value=!1}},Ie=async()=>{W.value=!0;try{await de.patch(`/v3/api/vixen-job/${h.jobId}/`,Ve.value);ne.success("Job Added Successfuly"),we(),b("update:onSuccess",null),W.value=!1}catch(e){console.log(e),ne.error("Error while adding a job"),W.value=!1}},Se=async()=>{await xe(),ke()},ke=async()=>{try{await de.post("/v3/api/vixen-job/rams-mail/",{job:_e.value});ne.green("Email sent sucessfuly")}catch(e){console.log(e)}},Je=e=>{const l=new Date(e),a=new Intl.DateTimeFormat("en-US",{weekday:"long",day:"2-digit",month:"long"});Ve.value.title=`Job at ${a.format(l)}`};return o(he,((e,l)=>{Ve.value.manager=e})),o(ue,((e,l)=>{ve.value=!1;const a=me.value.find((l=>l.id==e));a&&(re.value=a,ve.value=!0)})),o(pe,((e,l)=>{ve.value=!1;const a=fe.value.find((l=>l.id==e));a&&(ye.value.push(a),ce.value=a,ve.value=!0)})),i((()=>{(()=>{let e=new Date,l=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");Je(`${l}-${a}-${t}`)})(),(async()=>{try{const e=await de.get(`/v3/api/account/user/company-managers/${j.loggedCompany.id}/`,{});be.value=e.data.map((e=>({value:e.id.toString(),name:`${e.first_name} ${e.last_name}`,icon:e.profileImage,email:e.email}))),ge.value=e.data}catch{ne.error("Invalid data")}finally{W.value=!1}})(),h.jobId&&(async()=>{try{W.value=!0;const e=await de.get(`/v3/api/vixen-job/${h.jobId}/`);Ve.value=e.data,e.data.manager&&h.jobId&&(he.value=e.data.manager,console.log("current manager",he.value)),W.value=!1}catch(e){console.log(e)}})()})),(t,s)=>{const o=I,i=C,b=x,j=w,S=n("Multiselect"),k=V,J=g,ne=y,de=a,ue=l,re=e;return d(),u(re,{is:"form",size:"large",open:h.AddJobModalOpen,title:"Create Job",actions:"right",onClose:we},{content:r((()=>[c("div",$,[c("div",A,[c("div",M,[c("div",U,[c("div",F,[c("div",E,[m(j,null,{default:r((()=>[m(o,null,{default:r((()=>[p("Name")])),_:1}),m(b,null,{default:r((()=>[m(i,{modelValue:v(Ve).title,"onUpdate:modelValue":s[0]||(s[0]=e=>v(Ve).title=e),type:"text",placeholder:"Title"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",D,[m(j,null,{default:r((()=>[m(o,null,{default:r((()=>[p("External Id (Optional)")])),_:1}),m(b,null,{default:r((()=>[m(i,{modelValue:v(Ve).externalId,"onUpdate:modelValue":s[1]||(s[1]=e=>v(Ve).externalId=e),type:"text",placeholder:"External id"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",P,[m(j,null,{default:r((({id:e})=>[m(o,null,{default:r((()=>[p("Select Manager (PM)")])),_:1}),m(b,{class:"placement-wrapper"},{default:r((()=>[m(S,{class:"multi-select",modelValue:v(he),"onUpdate:modelValue":s[2]||(s[2]=e=>_(he)?he.value=e:null),attrs:{id:e},placeholder:"Select a manager",label:"name",options:v(be),searchable:!0,"track-by":"name",height:40,multiselectable:""},{singlelabel:r((({value:e})=>[c("div",z,[c("img",{class:"select-label-icon mr-2 value-image",src:e.icon,alt:""},null,8,H),p(" "+f(e.name),1)])])),option:r((({option:e})=>[c("div",O,[c("div",T,[c("img",{class:"select-option-icon mr-2 option-image",src:e.icon,alt:""},null,8,B),c("div",N,[c("span",K,f(e.name),1),c("span",L,[R,p(" "+f(e.email),1)])])])])])),_:2},1032,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),c("div",X,[m(j,{horizontal:""},{default:r((()=>[m(b,null,{default:r((()=>[m(k,{modelValue:v(Ve).isWorkWithContractor,"onUpdate:modelValue":s[3]||(s[3]=e=>v(Ve).isWorkWithContractor=e),"label-true":"Work with contractor","label-false":"Self Serve",color:"primary"},null,8,["modelValue"])])),_:1})])),_:1})]),c("div",Y,[m(ne,null,{default:r((()=>[v(Ve).isWorkWithContractor?(d(),u(J,{key:0,light:"",onClick:Se,rounded:"",color:"info"},{default:r((()=>[q,p("Initiate RAMS")])),_:1})):(d(),u(J,{key:1,light:"",rounded:"",color:"info"},{default:r((()=>[G,p("Initiate CPP")])),_:1}))])),_:1})]),m(ue,{items:je,"with-chevron":"",style:{"border-radius":"14px"}},{"collapse-item-head":r((e=>[Q])),"collapse-item-content":r((e=>[c("div",Z,[c("div",ee,[c("div",le,[c("div",ae,[c("div",te,[se,m(j,{grouped:""},{default:r((()=>[m(b,null,{default:r((()=>[oe])),_:1})])),_:1})]),c("div",ie,[m(j,null,{default:r((()=>[m(o,null,{default:r((()=>[p("Description")])),_:1}),m(b,null,{default:r((()=>[m(de,{modelValue:v(Ve).description,"onUpdate:modelValue":s[4]||(s[4]=e=>v(Ve).description=e),type:"text",placeholder:"Job description"},null,8,["modelValue"])])),_:1})])),_:1})])])])])])])),_:1})])])])])]),m(J,{style:{float:"right"},class:"mr-5",onClick:xe,rounded:"",color:"primary"},{default:r((()=>[p(f(t.$props.jobId?"Update Job":"Create Job"),1)])),_:1})])),cancel:r((()=>[m(J,{style:{display:"none"},type:"cancel",color:"primary",loading:v(W),raised:""},{default:r((()=>[p("Create job schedule")])),_:1},8,["loading"]),m(J,{style:{display:"none"},type:"submit",color:"primary",loading:v(W),raised:""},{default:r((()=>[p("Create job schedule")])),_:1},8,["loading"])])),action:r((()=>[m(J,{onClick:xe,color:"primary",style:{display:"none"},loading:v(W),raised:""},{default:r((()=>[p("Create job ")])),_:1},8,["loading"])])),_:1},8,["open"])}}}),[["__scopeId","data-v-c5341aef"]]);export{ne as _};
