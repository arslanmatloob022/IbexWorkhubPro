import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-c3aad769.js";import{f as a,r as l,B as t,C as s,O as o,G as u,E as d,K as n,U as i,m as c,D as r,V as p,W as m,F as v,N as f,P as _,Q as y,R as k,S as h,w as g,o as V,k as b,J as D}from"./index-328eb2c0.js";import{d as w,a as S}from"./useSupportElement-e83ab8f5.js";import{u as C}from"./useNotyf-1cd498f3.js";import{_ as x}from"./VTextarea.vue_vue_type_script_setup_true_lang-445fe831.js";import{_ as U,a as T}from"./VOption.vue_vue_type_style_index_0_lang-f8e5572e.js";import{_ as j}from"./VField.vue_vue_type_script_setup_true_lang-f6902b19.js";import{_ as I}from"./VControl-828ba86a.js";import{_ as L}from"./VInput.vue_vue_type_script_setup_true_lang-f2bfc214.js";import{_ as O}from"./VLabel.vue_vue_type_script_setup_true_lang-50c75ce5.js";import{u as N}from"./useAPI-20b23756.js";import{C as q}from"./estimatesScripts-49483d6c.js";const $={class:"heatmap-wrapper"},A={class:"heatmap-title"},H={class:"title-meta"},B={class:"primary-text"},F={class:"primary-text"},M={class:"heatmap-inner"},E={class:"heatmap-row"},Q={class:"heatmap-row-label"},z={class:"heatmap-row-content"},P={style:{position:"absolute","font-weight":"bold",top:"1px",right:"1px",color:"var(--dark-inverted)"}},W={key:0,class:"fas fa-exclamation-triangle danger-text cu-pointer","aria-hidden":"true"},G={key:1,class:"fas fa-check primary-text","aria-hidden":"true"},J={class:"v-popover-content is-text"},K={class:"popover-head"},R={class:"dark-inverted"},Y={key:0,class:"popover-body"},X={class:"primary-text"},Z={key:1,class:"popover-body"},ee=[(e=>(y("data-v-7c016a7e"),e=e(),k(),e))((()=>d("p",null,"You can add tasks on this date",-1)))],ae=h(a({__name:"WorkerTasksConflicts",props:{conflictsDetailModal:{type:Boolean},conflictData:{},startDate:{},endDate:{}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:y}){const k=a;C();const h=()=>{y("update:modalHandler",!0)};return l({visible:!1,tasks:[{id:"36913bdf-8056-4a06-823a-86e92c591615",title:"Bathroom Tiling 3"},{id:"369178bdf-8056-4a06-823a-86e92c591615",title:"Bathroom Tiling 1"}],x:0,y:0}),(a,l)=>{const y=t("Tippy"),g=_,V=e;return k.conflictsDetailModal?(s(),o(V,{key:0,open:k.conflictsDetailModal,title:"Conflicts Details",actions:"right",size:"big",onClose:h},{content:u((()=>[d("div",$,[d("div",A,[d("div",H,[d("p",null,[n(" Tasks found within given date range: "),d("span",B,i(c(w)(k.startDate)),1),n(" to "),d("span",F,i(c(w)(k.endDate)),1),n(". ")])])]),d("div",M,[(s(!0),r(p,null,m(k.conflictData?.map,(e=>(s(),r("div",E,[d("div",Q,[d("span",null,i(e.month),1)]),d("div",z,[(s(!0),r(p,null,m(e.dates,(a=>(s(),r("div",{key:e.date,class:"heatmap-row-item is-relative"},[v(y,{placement:"top"},{content:u((()=>[d("div",J,[d("div",K,[d("h4",R,i(a.tasks?.length?"Conflicts Found":"No Conflicts Found"),1)]),a.tasks?.length?(s(),r("div",Y,[d("ol",null,[(s(!0),r(p,null,m(a.tasks,(e=>(s(),r("li",{key:e.id},[d("p",X,i(e.job_title),1),d("p",null,i(e.title),1)])))),128))])])):(s(),r("div",Z,ee))])])),default:u((()=>[d("span",P,i(a.date.slice(8,10)),1),a.count?(s(),r("i",W)):f("",!0),a.count?f("",!0):(s(),r("i",G))])),_:2},1024)])))),128))])])))),256))])])])),action:u((()=>[v(g,{style:{display:"none"},color:"primary",raised:""},{default:u((()=>[n(" Confirm ")])),_:1})])),cancel:u((()=>[v(g,{onClick:h,raised:""},{default:u((()=>[n(" Close ")])),_:1})])),_:1},8,["open"])):f("",!0)}}}),[["__scopeId","data-v-7c016a7e"]]),le={class:"modal-form columns is-multiline"},te={class:"field column is-6 mb-0"},se={class:"field column is-6 mb-0"},oe=d("label",null,"Status ",-1),ue={class:"field column is-6 mb-0"},de={class:"field column is-6"},ne=d("label",null,"New Cost Code List *",-1),ie={class:"field column is-3 mb-0"},ce={class:"field column is-3 mb-0"},re={class:"field column is-3 mb-0"},pe={class:"field column is-3 mb-0"},me={class:"field column is-6 mb-0"},ve=d("label",null,"Select workers * ",-1),fe=d("i",{class:"fas fa-exclamation-triangle ml-2","aria-hidden":"true"},null,-1),_e={class:"field column is-6 mb-0"},ye=d("label",null,"Select Subcontractor * ",-1),ke={class:"field column is-6 mb-0"},he={class:"field column is-6 mb-0"},ge=a({__name:"UpdateTask",props:{isOpen:{type:Boolean,default:!1},taskIdSelected:{default:""},projectID:{default:""},endDate:{default:""},startDate:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(a,{emit:y}){const k=a,h=C(),w=N(),$=l([]),A=l([]),H=l(!1),B=l(!1);let F=l([]);const M=l(!1),E=l([]),Q=l([]),z=l(!1),P=l(!1),W=l({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",supplier:"",unit:"",costCode:"",color:"",project:"",priority:"",internalNotes:"",workers:[]}),G=async()=>{try{H.value=!0,W.value.workers=F.value;let e=S(W.value,["workers"]);k.taskIdSelected?(e.append("schedule_mode","false"),await w.patch(`/api/task/${W.value.id}/`,e),h.success("Task updated successfully"),y("update:OnSuccess",null)):(e.append("schedule_mode","false"),e.append("project",`${k.projectID}`),await w.post("/api/task/",e),y("update:OnSuccess",null),h.success("Task added successfully")),Y()}catch(e){console.log(e)}finally{H.value=!1}},J=async()=>{try{B.value=!0;const e=await w.delete(`/api/task/${k.taskIdSelected}/`);console.log(e),h.error("Task deleted successfully"),Y(),y("update:OnSuccess",null)}catch(e){console.log(e)}finally{B.value=!1}},K=l({found_tasks:!1,map:[{month:"April 2025",found_task:!1,dates:[{date:"2025-04-15",count:0,tasks:[]}]}]}),R=async()=>{try{const e=await w.get(`/api/task/worker-wise-date-map/${F.value}/?start_date=${W.value.startDate}&end_date=${W.value.endDate}`);K.value=e.data}catch(e){console.log(e)}},Y=()=>{y("update:modalHandler",!1),console.log("modal closed")};return g((()=>F.value),(()=>{z.value?R():z.value=!0})),g((()=>W.value.endDate),(()=>{z.value?R():z.value=!0})),V((()=>{k.taskIdSelected&&(async()=>{try{H.value=!0;const e=await w.get(`/api/task/${k.taskIdSelected?k.taskIdSelected:""}/`);W.value=e.data,F.value=e.data.workers.map((e=>e.id))}catch(e){console.log(e)}finally{H.value=!1}})(),z.value=!0,(async()=>{try{M.value=!0;const e=await w.get("/api/cost-code/");E.value=e.data,Q.value=e.data.map((e=>({value:e.id,label:e.name,labour_cost:e.labour_cost,unit_cost:e.unit_cost??0,worker_cost:e.worker_cost??0,unit:e.unit??"--"})))}catch(e){console.log(e)}finally{M.value=!1}})(),(async()=>{try{H.value=!0;const e=await w.get("/api/users/by-role-option/worker/",{});$.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{H.value=!1}})(),(async()=>{try{H.value=!0;const e=await w.get("/api/users/by-role-option/supplier/",{});A.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{H.value=!1}})(),k.startDate&&(W.value.startDate=k.startDate,W.value.endDate=k.endDate)})),(a,l)=>{const y=O,h=L,g=I,V=j,w=U,S=T,C=t("Multiselect"),N=x,M=ae,E=_,z=e;return s(),o(z,{is:"form",open:k.isOpen,title:k.taskIdSelected?"Update Task":"Add Task",size:"big",actions:"right",onSubmit:D(G,["prevent"]),onClose:Y},{content:u((()=>[d("div",le,[d("div",te,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("Title: *")])),_:1}),v(g,null,{default:u((()=>[v(h,{required:"",modelValue:W.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>W.value.title=e),type:"text",placeholder:H.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),d("div",se,[oe,v(V,null,{default:u((()=>[v(g,null,{default:u((()=>[v(S,{modelValue:W.value.status,"onUpdate:modelValue":l[1]||(l[1]=e=>W.value.status=e),name:"status",class:"is-rounded"},{default:u((()=>[v(w,{value:""},{default:u((()=>[n("Select Status")])),_:1}),(s(!0),r(p,null,m(c(q),(e=>(s(),o(w,{key:e.value,value:e.value},{default:u((()=>[n(i(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),d("div",ue,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("Cost Code: *")])),_:1}),v(g,null,{default:u((()=>[v(h,{required:"",type:"text",placeholder:H.value?"Loading...":"Cost code",modelValue:W.value.costCode,"onUpdate:modelValue":l[2]||(l[2]=e=>W.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",de,[ne,v(V,null,{default:u((({id:e})=>[v(g,null,{default:u((()=>[v(C,{required:"",modelValue:W.value.costCode,"onUpdate:modelValue":l[3]||(l[3]=e=>W.value.costCode=e),attrs:{id:e},searchable:!0,options:Q.value,placeholder:"Select a cost code"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",ie,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("Quantity")])),_:1}),v(g,null,{default:u((()=>[v(h,{type:"text",placeholder:H.value?"Loading...":"Quantity",modelValue:W.value.quantity,"onUpdate:modelValue":l[4]||(l[4]=e=>W.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",ce,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("Unit")])),_:1}),v(g,null,{default:u((()=>[v(h,{type:"text",placeholder:H.value?"Loading...":"Unit",modelValue:W.value.unit,"onUpdate:modelValue":l[5]||(l[5]=e=>W.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",re,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("Start Date")])),_:1}),v(g,null,{default:u((()=>[v(h,{type:"date",placeholder:H.value?"Loading...":"Start date",modelValue:W.value.startDate,"onUpdate:modelValue":l[6]||(l[6]=e=>W.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",pe,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("End Date")])),_:1}),v(g,null,{default:u((()=>[v(h,{type:"date",placeholder:H.value?"Loading...":"End date",modelValue:W.value.endDate,"onUpdate:modelValue":l[7]||(l[7]=e=>W.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",me,[ve,K.value.found_tasks?(s(),r("span",{key:0,onClick:l[8]||(l[8]=e=>P.value=!0),class:"warning-text cu-pointer"},[n(" Found Tasks Conflicts "),fe])):f("",!0),v(V,null,{default:u((({id:e})=>[v(g,null,{default:u((()=>[v(C,{modelValue:c(F),"onUpdate:modelValue":l[9]||(l[9]=e=>b(F)?F.value=e:F=e),attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:$.value,placeholder:"Add workers"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),d("div",_e,[ye,v(V,null,{default:u((({id:e})=>[v(g,null,{default:u((()=>[v(C,{modelValue:W.value.supplier,"onUpdate:modelValue":l[10]||(l[10]=e=>W.value.supplier=e),required:!c(F),attrs:{id:e},searchable:!0,"create-tag":!0,options:A.value,placeholder:"Add sub-contractor"},null,8,["modelValue","required","attrs","options"])])),_:2},1024)])),_:1})]),d("div",ke,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("Description")])),_:1}),v(g,null,{default:u((()=>[v(N,{type:"text",rows:"3",placeholder:H.value?"Loading...":"Description",modelValue:W.value.description,"onUpdate:modelValue":l[11]||(l[11]=e=>W.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),d("div",he,[v(V,null,{default:u((()=>[v(y,null,{default:u((()=>[n("Internal Notes")])),_:1}),v(g,null,{default:u((()=>[v(N,{type:"text",rows:"3",placeholder:H.value?"Loading...":"Internal notes",modelValue:W.value.internalNotes,"onUpdate:modelValue":l[12]||(l[12]=e=>W.value.internalNotes=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),P.value?(s(),o(M,{key:0,"conflicts-detail-modal":P.value,"conflict-data":K.value,startDate:W.value.startDate,endDate:W.value.endDate,"onUpdate:modalHandler":l[13]||(l[13]=e=>P.value=!1)},null,8,["conflicts-detail-modal","conflict-data","startDate","endDate"])):f("",!0)])])),action:u((()=>[k.taskIdSelected?(s(),o(E,{key:0,onClick:J,class:"is-left",color:"danger",loading:B.value,raised:""},{default:u((()=>[n("Delete")])),_:1},8,["loading"])):f("",!0),v(E,{type:"submit",loading:H.value,color:"primary",raised:""},{default:u((()=>[n(i(k.taskIdSelected?"Update Task":"Add Task"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{ge as _};
