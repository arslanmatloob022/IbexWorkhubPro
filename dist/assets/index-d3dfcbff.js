import{_ as e}from"./VMessage.vue_vue_type_style_index_0_lang-61a2c5d9.js";import{e as a,r as o,t as s,v as l,x as t,o as n,y as i,z as r,A as u,B as d,C as c,D as p,l as m,E as v,F as f,G as h,H as g,I as y,J as _,j as b,K as w,L as k,M as x,N as j,O as C,P as V,Q as I,R as z}from"./index-ac4917f9.js";import{_ as L}from"./VField.vue_vue_type_script_setup_true_lang-634488de.js";import{_ as A}from"./VControl-3e9804de.js";import{_ as P}from"./VInput.vue_vue_type_script_setup_true_lang-bd56c13b.js";import{_ as S}from"./VLabel.vue_vue_type_script_setup_true_lang-268a393f.js";import{_ as D}from"./AnimatedLogo-4a2fe480.js";import{u as F}from"./userSession-ad0c47a5.js";import{u as K}from"./useNotyf-a74570f6.js";import{u as U,a as E}from"./useAPI-ec9c5882.js";import{u as T}from"./layoutSwitcher-43fa4a98.js";import"./useVFieldContext-4bbb7cd2.js";import"./notyf-e75d564d.js";import"./useThemeColors-3d31f8ef.js";const W=e=>(V("data-v-882011c9"),e=e(),I(),e),q={class:"modern-login"},H=W((()=>p("div",{class:"underlay h-hidden-mobile h-hidden-tablet-p"},null,-1))),M={class:"columns is-gapless is-vcentered"},R={class:"column is-relative is-8 h-hidden-mobile h-hidden-tablet-p"},B={class:"hero is-fullheight is-image"},G={class:"hero-body"},J={class:"container"},N={class:"columns"},O={class:"column"},Q=["src"],$={style:{"z-index":"99999"},class:"column is-4 is-relative"},X={class:"top-tools"},Y=W((()=>p("h3",{style:{"font-size":"1.8rem","font-weight":"600","margin-left":"1rem",color:"#777"}},[p("span",{style:{color:"#2aac8e","font-size":"1.9rem"}},"Ibex"),_(" WorkHub ")],-1))),Z=["checked"],ee=W((()=>p("span",null,null,-1))),ae={class:"is-form"},oe={class:"is-form-inner"},se=[W((()=>p("h2",null,"Sign In",-1))),W((()=>p("p",null,"Welcome back to your account.",-1)))],le=["onSubmit"],te=[W((()=>p("i",{class:"iconify","data-icon":"feather:eye","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],ne=[W((()=>p("i",{class:"iconify","data-icon":"feather:eye-off","aria-hidden":"true",style:{"font-size":"1.5rem",color:"#888"}},null,-1)))],ie={class:"button-wrap has-help"},re=W((()=>p("span",null," To go to the account. ",-1))),ue={key:0,class:"recover-text"},de={class:"button-wrap"},ce=z(a({__name:"index",setup(a){const V=T(),I=o("login"),z=o(!1),W=s(),ce=l(),pe=t(),me=K(),ve=U(),fe=F();pe.query.redirect;const he=o(""),ge=o(""),ye=o(""),_e=o(!1),be=o(!1),we=o(!1),ke=async()=>{if(!z.value){z.value=!0;try{const e=await E.post("https://api.ibexworkhub.com/api/auth/login/",{email:he.value,password:ge.value});console.log("resp",e.data);const a=e.data.token,o=e.data.user;fe.setToken(a),fe.setUser(o),xe()}catch(e){z.value=!1,me.error("Invalid Credentials, Sign In")}finally{z.value=!1}}},xe=()=>{console.log("inside login success"),V.setDynamicLayoutId("sideblock-default"),me.success(`Welcome back, ${fe.user.username}`),z.value=!1,"admin"==fe.user.role?ce.push("/sidebar/dashboard"):"worker"==fe.user.role?ce.push("/sidebar/worker/tasks"):"manager"==fe.user.role?ce.push("/sidebar/manager/projects"):"contractor"==fe.user.role?ce.push("/sidebar/contractor/projects"):"client"==fe.user.role&&ce.push("/sidebar/client/projects")},je=()=>{_e.value=!_e.value};return n((()=>{})),i((()=>{const e=window.location.search,a=new URLSearchParams(e);console.log("urlDAta",window.location.search);const o=a.get("token");o?fe.setToken(o):console.log("Invalid token")})),r({title:"Login - Ibex"}),(a,o)=>{const s=D,l=u("RouterLink"),t=S,n=P,i=A,r=L,V=C,F=e;return d(),c("div",q,[H,p("div",M,[p("div",R,[p("div",B,[p("div",G,[p("div",J,[p("div",N,[p("div",O,[p("img",{src:m(W).isDark?"/logos/ibexwhite.png":"/logos/IbexFaviconDark.png",alt:""},null,8,Q)])])])])])]),p("div",$,[p("div",X,[v(l,{to:"/auth/login",class:"top-logo"},{default:f((()=>[v(s,{style:{width:"38px",height:"38px"}}),Y])),_:1}),p("label",{class:"dark-mode",tabindex:"0",role:"button",onKeydown:o[1]||(o[1]=h(y((e=>e.target.click()),["prevent"]),["space"]))},[p("input",{"data-cy":"dark-mode-toggle",type:"checkbox",checked:!m(W).isDark,onChange:o[0]||(o[0]=(...e)=>m(W).onChange&&m(W).onChange(...e))},null,40,Z),ee],32)]),p("div",ae,[p("div",oe,[p("div",{class:g(["form-text",["login"!==m(I)&&"is-hidden"]])},se,2),p("form",{method:"post",novalidate:"","data-cy":"login-form",class:g([["login"!==m(I)&&"is-hidden"],"login-wrapper"]),onSubmit:y(ke,["prevent"])},[v(r,null,{default:f((()=>[v(i,{icon:"lnil lnil-envelope autv-icon"},{default:f((()=>[v(t,{class:"auth-label"},{default:f((()=>[_(" Email Address ")])),_:1}),v(n,{modelValue:m(he),"onUpdate:modelValue":o[2]||(o[2]=e=>b(he)?he.value=e:null),"data-cy":"email-input",type:"email",autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),v(r,null,{default:f((()=>[v(i,{icon:"lnil lnil-lock-alt autv-icon",style:{position:"relative"}},{default:f((()=>[w(p("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:je},te,512),[[k,!m(_e)]]),w(p("span",{style:{position:"absolute","z-index":"9999",right:"1rem",top:"1.4rem"},onClick:je},ne,512),[[k,m(_e)]]),v(t,{class:"auth-label"},{default:f((()=>[_("Password")])),_:1}),v(n,{modelValue:m(ge),"onUpdate:modelValue":o[3]||(o[3]=e=>b(ge)?ge.value=e:null),"data-cy":"password-input",type:m(_e)?"text":"password",autocomplete:"current-password"},null,8,["modelValue","type"])])),_:1})])),_:1}),v(r,null,{default:f((()=>[v(i,{class:"is-flex"},{default:f((()=>[p("a",{tabindex:"0",role:"button",onKeydown:o[4]||(o[4]=h(y((e=>I.value="forgot-password"),["prevent"]),["space"])),onClick:o[5]||(o[5]=e=>I.value="forgot-password")}," Forgot Password? ",32)])),_:1})])),_:1}),p("div",ie,[v(V,{id:"login-button",loading:m(z),color:"primary",type:"submit",size:"big",rounded:"",raised:"",bold:""},{default:f((()=>[_(" Confirm ")])),_:1},8,["loading"]),re])],42,le),p("form",{method:"post",novalidate:"",class:g([["forgot-password"!==m(I)&&"is-hidden"],"login-wrapper"]),onSubmit:o[12]||(o[12]=y((()=>{}),["prevent"]))},[m(be)?x("",!0):(d(),c("p",ue," Enter your email and click on the confirm button to reset your password. We'll send you an email detailing the steps to complete the procedure. ")),m(be)?(d(),j(F,{key:1,color:"primary",class:"is-flex",closable:"",onClose:o[6]||(o[6]=e=>be.value=!1)},{default:f((()=>[_(" A password reset request has been sent to your email. Please check your inbox to change your password. ")])),_:1})):x("",!0),m(we)?(d(),j(F,{key:2,color:"danger",class:"is-flex mt-4",closable:"",onClose:o[7]||(o[7]=e=>we.value=!1)},{default:f((()=>[_(" Please enter valid email address. ")])),_:1})):x("",!0),v(r,null,{default:f((()=>[v(i,{icon:"lnil lnil-envelope autv-icon"},{default:f((()=>[v(t,{class:"auth-label"},{default:f((()=>[_(" Email Address ")])),_:1}),v(n,{type:"email",modelValue:m(ye),"onUpdate:modelValue":o[8]||(o[8]=e=>b(ye)?ye.value=e:null),autocomplete:"current-password"},null,8,["modelValue"])])),_:1})])),_:1}),v(r,null,{default:f((()=>[v(i,{class:"is-flex"},{default:f((()=>[p("a",{tabindex:"0",role:"button",onKeydown:o[9]||(o[9]=h(y((e=>I.value="login"),["prevent"]),["space"])),onClick:o[10]||(o[10]=e=>I.value="login")}," Login ? ",32)])),_:1})])),_:1}),p("div",de,[v(V,{loading:m(z),color:"primary",size:"big",type:"submit",lower:"",rounded:"",solid:"",onClick:o[11]||(o[11]=e=>(async e=>{try{z.value=!0,await ve.post("/api/account/auth/forget-password/",{email:e}),be.value=!0}catch(a){we.value=!0,me.error("Please enter your valid email address")}finally{z.value=!1}})(m(ye)))},{default:f((()=>[_(" Confirm ")])),_:1},8,["loading"])])],34)])])])])])}}}),[["__scopeId","data-v-882011c9"]]);export{ce as default};
