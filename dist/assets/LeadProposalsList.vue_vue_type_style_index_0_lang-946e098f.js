import{_ as e,a}from"./ProposalViewModal.vue_vue_type_style_index_0_lang-bc2934fa.js";import{_ as l}from"./SweetAlert.vue_vue_type_style_index_0_lang-ef8ed49c.js";import{a as s,_ as t,b as o}from"./CreateProposalTasksModal-e8d4b577.js";import{_ as i}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-c7bf8fe9.js";import{_ as r,c as n}from"./VFlexTable.vue_vue_type_style_index_0_lang-dad5dbac.js";import{_ as d}from"./VTag.vue_vue_type_style_index_0_lang-1cf6c532.js";import{_ as c}from"./VAvatar.vue_vue_type_style_index_0_lang-3b75f600.js";import{f as p,x as u,y as m,r as v,$ as _,o as f,av as y,C as k,D as b,m as g,F as h,E as w,G as C,L as P,X as x,k as A,V as S,W as I,K as j,O,N as T,aS as L,P as D,I as M,U as V}from"./index-9ef04237.js";import{_ as $}from"./VField.vue_vue_type_script_setup_true_lang-df70cfb6.js";import{_ as U}from"./VDropdown.vue_vue_type_style_index_0_lang-25ba0341.js";import{_ as H}from"./VControl-f99a3ad4.js";import{_ as N}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-e2fa71cd.js";import{_ as E,a as F}from"./search-4-dark-2b5b440c.js";import{u as z}from"./useAPI-fc2f6b33.js";import{u as Y}from"./useNotyf-001b909d.js";import{f as q,j as B}from"./useSupportElement-37cd7025.js";import{b as G,c as K,d as R,e as W}from"./estimatesScripts-3de30073.js";const X={key:0},J={key:1},Q={class:"flex-toolbar is-reversed is-flex space-between my-4"},Z={class:"is-flex g-2"},ee=["value","onClick"],ae={class:"icon"},le={class:"meta"},se={class:"is-flex"},te=w("i",{class:"fas fa-plus"},null,-1),oe=w("i",{class:"fas fa-cogs"},null,-1),ie=w("span",{class:"h-hidden-mobile"}," Proposals ",-1),re={class:"flex-list-wrapper flex-list-v2"},ne={class:"item-name dark-inverted show-text-250"},de={class:"item-meta"},ce=w("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),pe={class:"item-name dark-inverted"},ue=["onClick"],me=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),w("div",{class:"meta"},[w("span",null,"Edit"),w("span",null,"Edit Proposal Details")],-1)],ve=["onClick"],_e=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),w("div",{class:"meta"},[w("span",null,"Preview"),w("span",null,"Preview proposal detail")],-1)],fe=["onClick"],ye=[w("div",{class:"icon"},[w("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),w("div",{class:"meta"},[w("span",null,"Create Tasks"),w("span",null,"Create tasks in chart ")],-1)],ke=w("hr",{class:"dropdown-divider"},null,-1),be=["onClick"],ge=[w("div",{class:"icon"},[w("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),w("div",{class:"meta"},[w("span",null,"Mark Approved"),w("span",null,"Mark Proposal As Approved")],-1)],he=["onClick"],we=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),w("div",{class:"meta"},[w("span",null,"Delete"),w("span",null,"Delete from list")],-1)],Ce=w("img",{class:"light-image",src:E,alt:""},null,-1),Pe=w("img",{class:"dark-image",src:F,alt:""},null,-1),xe=p({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},emits:["updateCompany"],setup(p,{emit:E}){const F=p,xe=u();m();const Ae=z(),Se=Y(),Ie=v([]),je=v(""),Oe=v(!1),Te=v(!1),Le=v(!1),De=v(!1),Me=v(!1),Ve=v(!1),$e=v(!1),Ue=v(""),He=v(""),Ne=v("");v(F.activeTab);const Ee={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},Fe=v({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),ze=v({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),Ye=async()=>{try{Oe.value=!0;await Ae.delete(`/api/lead-proposal/${Ne.value}/`);Se.success("Proposal delete successfully"),Be()}catch(e){Se.error(` ${e}, Proposal`),Se.error("Something went wrong please try later")}finally{Oe.value=!1,Fe.value.isSweetAlertOpen=!1}},qe=e=>{xe.push(`/sidebar/dashboard/proposals/${e}`)},Be=()=>{1==F.allProposal?(async()=>{try{Oe.value=!0;const e=await Ae.get("/api/lead-proposal/");Ie.value=e.data}catch(e){Se.error(` ${e}, Lead`)}finally{Oe.value=!1}})():F.leadId&&(async()=>{try{Oe.value=!0;const e=await Ae.get(`/api/lead-proposal/by-project/${F.leadId}/`);Ie.value=e.data}catch(e){Se.error(` ${e}, Lead`)}finally{Oe.value=!1}})()},Ge=v(""),Ke=v([{desc:"Proposals default list. ",icon:"fas fa-align-left",value:"default",label:"Default"},{desc:"Newly created proposals ",icon:"fas fa-calendar-day",value:"recent",label:"New Proposals"},{desc:"Proposals created recently ",icon:"fas fa-calendar-minus ",value:"old",label:"Old Proposals"},{desc:"Proposals ascending order ",icon:"fas fa-sort-alpha-down",value:"asc",label:"Ascending"},{desc:"Proposals descending order ",icon:"fas fa-sort-alpha-up ",value:"desc",label:"Descending"}]),Re=_((()=>{let e=Ie.value;if(He.value){const a=new RegExp(He.value,"i");e=e.filter((e=>e.title.match(a)))}switch(Ge.value){case"recent":e=[...e].sort(((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime()));break;case"old":e=[...e].sort(((e,a)=>new Date(e.created_at).getTime()-new Date(a.created_at).getTime()));break;case"asc":e=[...e].sort(((e,a)=>e.title.localeCompare(a.title)));break;case"desc":e=[...e].sort(((e,a)=>a.title.localeCompare(e.title)))}return e=[...e].sort(((e,a)=>"draft"===e.type&&"draft"!==a.type?1:"draft"!==e.type&&"draft"===a.type?-1:0)),e}));return f((()=>{Be()})),(p,u)=>{const m=N,v=H,_=U,f=$,z=D,Y=c,xe=n,We=d,Xe=r,Je=i,Qe=s,Ze=t,ea=e,aa=o,la=l,sa=a,ta=y("tooltip");return k(),b("div",null,[g(Oe)?(k(),b("div",X,[h(m)])):(k(),b("div",J,[w("div",Q,[w("div",Z,[h(v,{icon:"feather:search"},{default:C((()=>[P(w("input",{"onUpdate:modelValue":u[0]||(u[0]=e=>A(He)?He.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[x,g(He)]])])),_:1}),h(f,{class:"ml-2"},{default:C((()=>[h(_,{title:"Sort proposal",spaced:""},{content:C((()=>[(k(!0),b(S,null,I(g(Ke),(e=>(k(),b("a",{value:e.value,onClick:a=>Ge.value=e.value,class:M(["dropdown-item is-media",g(Ge)===e.value&&"is-active"])},[w("div",ae,[w("i",{class:M(e.icon)},null,2)]),w("div",le,[w("span",null,V(e.label),1),w("span",null,V(e.desc),1)])],10,ee)))),256))])),_:1})])),_:1})]),w("div",se,[h(z,{class:"h-hidden-mobile",color:"primary",onClick:u[1]||(u[1]=e=>Te.value=!g(Te)),icon:"fas fa-plus"},{default:C((()=>[j("Lead Proposal ")])),_:1}),h(z,{class:"h-hidden-desktop",color:"primary",onClick:u[2]||(u[2]=e=>Te.value=!g(Te))},{default:C((()=>[te])),_:1}),F.leadId?(k(),O(z,{key:0,color:"warning",class:"ml-2",onClick:u[3]||(u[3]=e=>{De.value=!0})},{default:C((()=>[oe,ie])),_:1})):T("",!0)])]),w("div",re,[g(Re).length>0&&g(Ie).length>0?(k(),O(Xe,{key:0,data:g(Re),columns:Ee,rounded:""},{body:C((()=>[h(L,{name:"list",tag:"div",class:"flex-list-inner"},{default:C((()=>[(k(!0),b(S,null,I(g(Re),(e=>(k(),b("div",{key:e.id,class:"flex-table-item"},[h(xe,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>qe(e.id)},{default:C((()=>[h(Y,{picture:"/images/dummyShareProf/document.png\n                    ",squared:"",size:"medium"}),P((k(),b("div",null,[w("span",ne,V(e.title),1),w("span",de,[w("span",null,[ce,j(V(g(q)(e.created_at)),1)])])])),[[ta,`${e.title}`,void 0,{rounded:!0,light:!0}]])])),_:2},1032,["onClick"]),h(xe,{class:"cu-pointer",onClick:a=>qe(e.id)},{default:C((()=>[h(We,{rounded:"",color:g(G)[e.type]},{default:C((()=>[j(V(g(K)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),h(xe,{class:"cu-pointer",onClick:a=>qe(e.id)},{default:C((()=>[h(We,{class:"capitalized",rounded:"",color:g(R)[e.status]},{default:C((()=>[j(V(g(W)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),h(xe,{class:"cu-pointer",onClick:a=>qe(e.id),column:{media:!0}},{default:C((()=>[w("div",null,[w("span",pe,V(g(B)(e?.proposalAmount)),1)])])),_:2},1032,["onClick"]),h(xe,{class:"cu-pointer",onClick:a=>qe(e.id)},{default:C((()=>[h(We,{color:"purple",outlined:""},{default:C((()=>[j(V(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),h(xe,{column:{align:"end"}},{default:C((()=>[h(_,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:C((()=>[w("a",{role:"menuitem",onClick:a=>{return l=e.id,je.value=l,void(Te.value=!0);var l},class:"dropdown-item is-media"},me,8,ue),w("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Ve.value=l,void(Me.value=!Me.value);var l},class:"dropdown-item is-media"},_e,8,ve),"approved"==e.status?(k(),b("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,je.value=l,void(Le.value=!0);var l},class:"dropdown-item is-media"},ye,8,fe)):T("",!0),ke,"approved"!=e.status?(k(),b("a",{key:1,role:"menuitem",onClick:a=>(async(e,a)=>{try{await Ae.patch(`/api/lead-proposal/${a}/`,{status:e}),Se.success(`You have ${e} this proposal.`),"approved"==e&&E("updateCompany",null),Be()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},ge,8,be)):T("",!0),w("a",{role:"menuitem",onClick:a=>{return l=e.id,Ne.value=l,void(Fe.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},we,8,he)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):T("",!0),g(Ie).length<1&&0==g(Re).length?(k(),O(Je,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:C((()=>[Ce,Pe])),_:1})):T("",!0)]),g(Le)?(k(),O(Qe,{key:0,createProposalTasksModal:g(Le),proposalId:g(je),onCloseModalHandler:u[4]||(u[4]=e=>Le.value=!1),"onUpdate:OnSuccess":u[5]||(u[5]=e=>Be())},null,8,["createProposalTasksModal","proposalId"])):T("",!0),g(Te)?(k(),O(Ze,{key:1,leadId:F.leadId,proposalId:g(je),leadProposalModal:g(Te),getLeadsList:F.allProposal,"onUpdate:modalHandler":u[6]||(u[6]=()=>{Be(),Te.value=!1}),onClearProposalId:u[7]||(u[7]=e=>je.value="")},null,8,["leadId","proposalId","leadProposalModal","getLeadsList"])):T("",!0),g(Me)?(k(),O(ea,{key:2,"preview-modal":g(Me),proposalId:g(Ve),"onUpdate:modalHandler":u[8]||(u[8]=e=>Me.value=!1)},null,8,["preview-modal","proposalId"])):T("",!0),g($e)?(k(),O(aa,{key:3,costItemModal:g($e),proposalId:g(Ue),"onUpdate:modalHandler":u[9]||(u[9]=e=>$e.value=!1),"onUpdate:OnSuccess":Be},null,8,["costItemModal","proposalId"])):T("",!0),g(Fe).isSweetAlertOpen?(k(),O(la,{key:4,isSweetAlertOpen:g(Fe).isSweetAlertOpen,title:g(Fe).title,subtitle:g(Fe).subtitle,btntext:g(Fe).btntext,onConfirm:Ye,onCancel:()=>g(Fe).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):T("",!0),g(ze).isSweetAlertOpen?(k(),O(la,{key:5,isSweetAlertOpen:g(ze).isSweetAlertOpen,title:g(ze).title,subtitle:g(ze).subtitle,btntext:g(ze).btntext,onConfirm:Ye,onCancel:()=>g(ze).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):T("",!0),g(De)?(k(),O(sa,{key:6,leadProposalListModal:g(De),leadID:F.leadId,"group-proposal-modal":g(De),"onUpdate:modalHandler":u[10]||(u[10]=e=>De.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):T("",!0)]))])}}});export{xe as _};
