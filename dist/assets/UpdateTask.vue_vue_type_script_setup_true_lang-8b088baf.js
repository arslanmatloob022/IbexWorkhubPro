import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-e7070b82.js";import{e as l,r as a,w as t,o as u,M as d,y as s,H as o,B as n,C as i,A as r,D as c,z as p,Q as m,R as v,J as _,l as f,j as y,P as V,K as g,E as k}from"./index-54a9a01d.js";import{_ as h}from"./VTextarea.vue_vue_type_script_setup_true_lang-b7a0325d.js";import{_ as S,a as b}from"./VOption.vue_vue_type_style_index_0_lang-3cad5f01.js";import{_ as D}from"./VField.vue_vue_type_script_setup_true_lang-3f7007e1.js";import{_ as w}from"./VControl-15a2aeb5.js";import{_ as j}from"./VInput.vue_vue_type_script_setup_true_lang-9846c409.js";import{_ as U}from"./VLabel.vue_vue_type_script_setup_true_lang-997dbbc3.js";import{u as I}from"./useAPI-f85d8e56.js";import{u as C}from"./useNotyf-18e668a8.js";import{a as x}from"./useSupportElement-d4e5428a.js";const L={class:"modal-form columns is-multiline"},T={class:"field column is-6 mb-0"},q={class:"field column is-6 mb-0"},A=i("label",null,"Status ",-1),O={class:"field column is-6 mb-0"},H={class:"field column is-6 mb-0"},M={class:"field column is-6 mb-0"},E={class:"field column is-3 mb-0"},N={class:"field column is-3 mb-0"},P={class:"field column is-6 mb-0"},$={class:"field column is-6 mb-0"},Q=i("label",null,"Select workers * ",-1),z={class:"field column is-6 mb-0"},B={class:"field column is-6 mb-0"},R=l({__name:"UpdateTask",props:{isOpen:{type:Boolean,default:!1},taskIdSelected:{default:""},projectID:{default:""},endDate:{default:""},startDate:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:R}){const F=l,J=C(),K=I(),G=a([]),W=a(!1);let X=a([]);a([]),a();const Y=a({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",unit:"",costCode:"",color:"",project:"",priority:"",workers:[]}),Z=[{value:"active",name:"Active"},{value:"pending",name:"Pending"},{value:"completed",name:"Completed"},{value:"cancelled",name:"Cancelled"}];t(X.value,(()=>{console.log("data type",X)}));const ee=async()=>{try{W.value=!0,Y.value.workers=X.value;let e=x(Y.value,["workers"]);F.taskIdSelected?(e.append("schedule_mode","false"),await K.patch(`/api/task/${Y.value.id}/`,e),J.success("Task updated successfully")):(e.append("schedule_mode","false"),e.append("project",`${F.projectID}`),await K.post("/api/task/",e),J.success("Task added successfully")),ae(),R("update:OnSuccess",null)}catch(e){J.error("Something went wrong"),console.log(e)}finally{W.value=!1}},le=async()=>{try{W.value=!0;const e=await K.delete(`/api/task/${F.taskIdSelected}/`);console.log(e),J.error("Task deleted successfully"),ae(),R("update:OnSuccess",null)}catch(e){console.log(e)}finally{W.value=!1}},ae=()=>{R("update:modalHandler",!1),console.log("modal closed")};return u((()=>{F.taskIdSelected&&(async()=>{try{W.value=!0;const e=await K.get(`/api/task/${F.taskIdSelected?F.taskIdSelected:""}`);Y.value=e.data,X.value=e.data.workers.map((e=>e.id))}catch(e){console.log(e)}finally{W.value=!1}})(),(async()=>{try{W.value=!0;const e=await K.get("/api/users/by-role-option/worker/",{});G.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{W.value=!1}})(),F.startDate&&(Y.value.startDate=F.startDate,Y.value.endDate=F.endDate)})),(l,a)=>{const t=U,u=j,I=w,C=D,x=S,R=b,J=d("Multiselect"),K=h,te=k,ue=e;return s(),o(ue,{is:"form",open:F.isOpen,title:F.taskIdSelected?"Update Task":"Add Task",size:"big",actions:"right",onSubmit:g(ee,["prevent"]),onClose:ae},{content:n((()=>[i("div",L,[i("div",T,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Title: *")])),_:1}),r(I,null,{default:n((()=>[r(u,{required:"",modelValue:Y.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value.title=e),type:"text",placeholder:W.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),i("div",q,[A,r(C,null,{default:n((()=>[r(I,null,{default:n((()=>[r(R,{modelValue:Y.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.value.status=e),name:"status",class:"is-rounded"},{default:n((()=>[r(x,{value:""},{default:n((()=>[c("Select Status")])),_:1}),(s(),p(m,null,v(Z,(e=>r(x,{key:e.value,value:e.value},{default:n((()=>[c(_(e.value),1)])),_:2},1032,["value"]))),64))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),i("div",O,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Cost Code: *")])),_:1}),r(I,null,{default:n((()=>[r(u,{required:"",type:"text",placeholder:W.value?"Loading...":"Cost code",modelValue:Y.value.costCode,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",H,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Quantity")])),_:1}),r(I,null,{default:n((()=>[r(u,{type:"text",placeholder:W.value?"Loading...":"Quantity",modelValue:Y.value.quantity,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",M,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Unit")])),_:1}),r(I,null,{default:n((()=>[r(u,{type:"text",placeholder:W.value?"Loading...":"Unit",modelValue:Y.value.unit,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",E,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Start Date")])),_:1}),r(I,null,{default:n((()=>[r(u,{type:"date",placeholder:W.value?"Loading...":"Start date",modelValue:Y.value.startDate,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",N,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("End Date")])),_:1}),r(I,null,{default:n((()=>[r(u,{type:"date",placeholder:W.value?"Loading...":"End date",modelValue:Y.value.endDate,"onUpdate:modelValue":a[6]||(a[6]=e=>Y.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",P,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Priority")])),_:1}),r(I,null,{default:n((()=>[r(R,{modelValue:Y.value.priority,"onUpdate:modelValue":a[7]||(a[7]=e=>Y.value.priority=e)},{default:n((()=>[r(x,{value:""},{default:n((()=>[c(" Select priority level ")])),_:1}),r(x,{value:"Low"},{default:n((()=>[c(" Low ")])),_:1}),r(x,{value:"Medium"},{default:n((()=>[c(" Medium ")])),_:1}),r(x,{value:"High"},{default:n((()=>[c(" High ")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})]),i("div",$,[Q,r(C,null,{default:n((({id:e})=>[r(I,null,{default:n((()=>[r(J,{modelValue:f(X),"onUpdate:modelValue":a[8]||(a[8]=e=>y(X)?X.value=e:X=e),required:"",attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:G.value,placeholder:"Add workers"},null,8,["modelValue","attrs","options"])])),_:2},1024)])),_:1})]),i("div",z,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Description")])),_:1}),r(I,null,{default:n((()=>[r(K,{type:"text",rows:"3",placeholder:W.value?"Loading...":"Description",modelValue:Y.value.description,"onUpdate:modelValue":a[9]||(a[9]=e=>Y.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",B,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Internal Notes")])),_:1}),r(I,null,{default:n((()=>[r(K,{type:"text",rows:"3",placeholder:W.value?"Loading...":"Internal notes",modelValue:Y.value.internalNotes,"onUpdate:modelValue":a[10]||(a[10]=e=>Y.value.internalNotes=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})])])])),action:n((()=>[F.taskIdSelected?(s(),o(te,{key:0,onClick:le,class:"is-left",color:"danger",raised:""},{default:n((()=>[c("Delete")])),_:1})):V("",!0),r(te,{type:"submit",color:"primary",raised:""},{default:n((()=>[c(_(F.taskIdSelected?"Update Task":"Add Task"),1)])),_:1})])),_:1},8,["open","title","onSubmit"])}}});export{R as _};
