import{_ as e}from"./SweetAlert.vue_vue_type_style_index_0_lang-34087dcf.js";import{e as l,s as a,r as t,b as s,_ as o,o as i,B as n,N as r,F as d,D as u,K as p,W as c,l as m,E as _,M as v,J as f,I as y,O as b,v as g,x as h,Z as x,C as w,j as V,U as k,V as P,aR as I,T as j}from"./index-db185d34.js";import{_ as A}from"./VModal.vue_vue_type_style_index_0_lang-9aa73e83.js";import{u as C,_ as T}from"./WorksheetItems.vue_vue_type_script_setup_true_lang-b352b2f7.js";import{_ as O}from"./VCollapse.vue_vue_type_style_index_0_lang-e646373a.js";import{_ as S}from"./VTextarea.vue_vue_type_script_setup_true_lang-6d90c7dc.js";import{_ as D}from"./VField.vue_vue_type_script_setup_true_lang-1cde99e1.js";import{_ as U}from"./VControl-95c16a72.js";import{_ as N}from"./VRadio.vue_vue_type_style_index_0_lang-dd21f75d.js";import{u as L}from"./useAPI-eab0cf3d.js";import{u as M}from"./useNotyf-e3489deb.js";import{a as q,e as E,g as $}from"./useSupportElement-10fe9bfb.js";import{u as R}from"./userSession-45ed061c.js";import{_ as F}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-f7a333ed.js";import{_ as H,c as W}from"./VFlexTable.vue_vue_type_style_index_0_lang-d895449f.js";import{_ as B}from"./VDropdown.vue_vue_type_style_index_0_lang-0b14654e.js";import{_ as J}from"./VTag.vue_vue_type_style_index_0_lang-86088bcf.js";import{_ as z}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-230dcf02.js";import{_ as G,a as K}from"./search-4-dark-2b5b440c.js";const Y={class:"modal-form columns is-multiline"},Z={class:"field column is-6 mb-0"},Q=u("label",null,"Title: *",-1),X={class:"control"},ee={class:"column is-6"},le={class:"field column is-6"},ae=u("label",null,"Approval Deadline *",-1),te={class:"control"},se={class:"field column is-6"},oe=u("label",null,"Attachments",-1),ie=u("div",{class:"file"},[u("label",{class:"file-label"},[u("input",{class:"file-input",type:"file",name:"resume"}),u("span",{class:"file-cta"},[u("span",{class:"file-icon"},[u("i",{class:"fas fa-cloud-upload-alt"})]),u("span",{class:"file-label"}," Choose a fileâ€¦ ")])])],-1),ne={class:"body-inner-content"},re={class:"field columns is-multiline mb-0"},de={class:"field column is-12 mb-0"},ue=u("label",{for:"",class:"label"},"Internal Notes",-1),pe={class:"field column is-12 mb-0"},ce=u("label",{for:"",class:"label"},"Introductory Text",-1),me={class:"field column is-12 mb-0"},_e=u("label",{for:"",class:"label"},"Closing Text",-1),ve=l({__name:"LeadProposalModal",props:{leadProposalModal:{type:Boolean},proposalId:{},leadId:{}},emits:["update:modalHandler","update:OnSuccess"],setup(e,{emit:l}){const g=e,h=C(),x=a();R();const w=M(),V=L(),k=t(!1);t({}),t(!1),t([]),t([]),t([]);const P=[{title:"More Details",content:"Add additional information about rota, rate or worker"}];t({title:"",description:"",quantity:0,unit:0,unitCost:0,markup:0,clientPrice:0,costCode:"",costType:"",builderCost:"",margin:0,profit:0,internalNotes:""});const I=t({title:"",approval_deadline:"",attachments:[],approvalDeadline:"",internalNotes:"",introductoryText:"",closingText:"",paymentStatus:"",worksheetItems:[],type:"proposal"});t([{value:"all",label:"All"},{value:"contact",label:"Contact Form"},{value:"google",label:"Google"},{value:"referral",label:"Referral"}]),t([{value:"open",label:"Open"},{value:"inProgress",label:"In Progress"},{value:"onHold",label:"On Hold"},{value:"pending",label:"Pending"},{value:"lost",label:"Lost"},{value:"sold",label:"sold"},{value:"noOpportunity",label:"No Opportunity"}]);const j=async()=>{try{k.value=!0;const e=q(I.value,[""]);e.append("job",g.leadId);await V.post("/api/lead-proposal/",e);$(),w.dismissAll(),w.success("Proposal created successfully")}catch(e){w.error(` ${e}, New Worker`)}finally{k.value=!1}},E=()=>{l("update:modalHandler",!1)},$=()=>{l("update:OnSuccess",null)};t("worksheet");const F=s((()=>o((()=>import("./ckeditor-85b8cefa.js").then((e=>e.c))),["assets/ckeditor-85b8cefa.js","assets/index-db185d34.js","assets/index-1c8d8af6.css","assets/vue.runtime.esm-bundler-34333244.js"]).then((e=>e.default.component)))),H={fontFamily:{options:['"Montserrat", sans-serif','"Roboto", sans-serif']},height:"400px",minHeight:"400px"};return i((async()=>{x.value=await o((()=>import("./ckeditor-bb6fde3e.js").then((e=>e.c))),["assets/ckeditor-bb6fde3e.js","assets/index-db185d34.js","assets/index-1c8d8af6.css"]).then((e=>e.default)),g.proposalId&&((async()=>{try{const e=await V.get(`/api/lead-proposal/${g.proposalId}/`);I.value=e.data}catch(e){console.log(e)}})(),h.getProposalCostItems(g.proposalId))})),(e,l)=>{const a=N,t=U,s=D,o=S,i=O,h=T,w=b,V=A;return n(),r(V,{is:"form",open:g.leadProposalModal,title:"Lead Proposal",size:"xl",actions:"right",onSubmit:y(j,["prevent"]),onClose:E},{content:d((()=>[u("div",Y,[u("div",Z,[Q,u("div",X,[p(u("input",{type:"text",name:"firstName","onUpdate:modelValue":l[0]||(l[0]=e=>m(I).title=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Title"},null,512),[[c,m(I).title]])])]),u("div",ee,[_(s,{class:"m-0 p-0",label:"Type"},{default:d((()=>[_(t,null,{default:d((()=>[_(a,{modelValue:m(I).type,"onUpdate:modelValue":l[1]||(l[1]=e=>m(I).type=e),value:"proposal",label:"Proposal",name:"solid_squared_radio",color:"primary",square:"",solid:""},null,8,["modelValue"]),_(a,{modelValue:m(I).type,"onUpdate:modelValue":l[2]||(l[2]=e=>m(I).type=e),value:"change_order",label:"Change Order",name:"solid_squared_radio",color:"info",square:"",solid:""},null,8,["modelValue"]),_(a,{modelValue:m(I).type,"onUpdate:modelValue":l[3]||(l[3]=e=>m(I).type=e),value:"draft",label:"Draft",name:"solid_squared_radio",color:"warning",square:"",solid:""},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",le,[ae,u("div",te,[p(u("input",{type:"date",name:"firstName","onUpdate:modelValue":l[4]||(l[4]=e=>m(I).approval_deadline=e),required:"",class:"input is-primary-focus is-primary-focus",placeholder:"Proposal Approval deadline"},null,512),[[c,m(I).approval_deadline]])])]),u("div",se,[oe,_(s,{grouped:""},{default:d((()=>[_(t,null,{default:d((()=>[ie])),_:1})])),_:1})]),_(i,{items:P,"with-chevron":"",style:{"border-radius":"14px"},class:"m-3"},{"collapse-item-content":d((e=>[u("div",ne,[u("div",re,[u("div",de,[ue,_(s,null,{default:d((()=>[_(t,null,{default:d((()=>[_(o,{modelValue:m(I).internalNotes,"onUpdate:modelValue":l[5]||(l[5]=e=>m(I).internalNotes=e),rows:"4",placeholder:"Internal notes..."},null,8,["modelValue"])])),_:1})])),_:1})]),u("div",pe,[ce,m(x)?(n(),r(m(F),{key:0,modelValue:m(I).introductoryText,"onUpdate:modelValue":l[6]||(l[6]=e=>m(I).introductoryText=e),editor:m(x),config:H},null,8,["modelValue","editor"])):v("",!0)]),u("div",me,[_e,m(x)?(n(),r(m(F),{key:0,modelValue:m(I).closingText,"onUpdate:modelValue":l[7]||(l[7]=e=>m(I).closingText=e),editor:m(x),config:H},null,8,["modelValue","editor"])):v("",!0)])])])])),_:1}),_(h,{proposalId:m(I).id},null,8,["proposalId"])])])),action:d((()=>[_(w,{loading:m(k),type:"submit",color:"primary",icon:"fas fa-plus",raised:""},{default:d((()=>[f("Create")])),_:1},8,["loading"])])),_:1},8,["open","onSubmit"])}}}),fe={class:"flex-toolbar is-reversed is-flex space-between my-4"},ye={class:"flex-list-wrapper flex-list-v2"},be=u("img",{class:"light-image",src:G,alt:""},null,-1),ge=u("img",{class:"dark-image",src:K,alt:""},null,-1),he={class:"item-name dark-inverted"},xe={class:"item-name dark-inverted"},we={class:"light-text"},Ve={class:"light-text"},ke=u("a",{role:"menuitem",class:"dropdown-item is-media"},[u("div",{class:"icon"},[u("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})]),u("div",{class:"meta"},[u("span",null,"View Proposal"),u("span",null,"View proposal detail")])],-1),Pe=["onClick"],Ie=[u("div",{class:"icon"},[u("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),u("div",{class:"meta"},[u("span",null,"Edit"),u("span",null,"Edit project details")],-1)],je=["onClick"],Ae=[u("div",{class:"icon"},[u("i",{"aria-hidden":"true",class:"lnil lnil-briefcase"})],-1),u("div",{class:"meta"},[u("span",null,"View Detail"),u("span",null,"View detail in page")],-1)],Ce=u("a",{role:"menuitem",href:"#",class:"dropdown-item is-media"},[u("div",{class:"icon"},[u("i",{"aria-hidden":"true",class:"lnil lnil-add-files"})]),u("div",{class:"meta"},[u("span",null,"New Task"),u("span",null,"Add a new task")])],-1),Te=u("hr",{class:"dropdown-divider"},null,-1),Oe=["onClick"],Se=[u("div",{class:"icon"},[u("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),u("div",{class:"meta"},[u("span",null,"Delete"),u("span",null,"Delete from list")],-1)],De=l({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},setup(l){const a=l,s=g();h();const o=L(),y=M(),A=t(!1),C=t([{id:"",title:"",approval_deadline:"",internal_notes:null,introductory_text:null,closing_text:null,payment_status:"",type:"",created_at:"",updated_at:"",job:""}]),T=t(!1),O=t(""),S=t(""),D=t("");t(a.activeTab);const N=t({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),q=async()=>{try{A.value=!0;const e=await o.delete(`/api/lead-proposal/${D.value}/`);C.value=e.data,y.success("Proposal delete successfully"),K()}catch(e){y.error(` ${e}, Proposal`),y.error("Something went wrong please try later")}finally{A.value=!1,N.value.isSweetAlertOpen=!1}},R={picture:{label:"Proposal",grow:!0,media:!0},customer:"Created At",industry:"Type",deadline:"Deadline",status:"Status",actions:{label:"Actions",align:"end"}},G=x((()=>{if(S.value){const e=new RegExp(S.value,"i");return C.value.filter((l=>l.title.match(e)||l.approval_deadline.match(e)))}return C.value})),K=()=>{1==a.allProposal?(async()=>{try{A.value=!0;const e=await o.get("/api/lead-proposal/");C.value=e.data}catch(e){y.error(` ${e}, Lead`)}finally{A.value=!1}})():(async()=>{try{A.value=!0;const e=await o.get(`/api/lead-proposal/by-job/${a.leadId}/`);C.value=e.data}catch(e){y.error(` ${e}, Lead`)}finally{A.value=!1}})()};return i((()=>{K()})),(l,t)=>{const o=U,i=b,y=z,g=W,h=J,x=B,A=H,C=F,L=ve,M=e;return n(),w("div",null,[u("div",fe,[_(o,{icon:"feather:search"},{default:d((()=>[p(u("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>V(S)?S.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[c,m(S)]])])),_:1}),u("div",null,[_(i,{color:"primary",onClick:t[1]||(t[1]=e=>T.value=!m(T)),icon:"fas fa-plus"},{default:d((()=>[f("Lead Proposal")])),_:1})])]),u("div",ye,[0===m(G).length?(n(),r(y,{key:0,title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\n          search terms you've entered. Please try different search terms or\n          criteria.",larger:""},{image:d((()=>[be,ge])),_:1})):v("",!0),m(G).length?(n(),r(A,{key:1,data:m(G),columns:R,rounded:""},{body:d((()=>[_(I,{name:"list",tag:"div",class:"flex-list-inner"},{default:d((()=>[(n(!0),w(k,null,P(m(G),(e=>(n(),w("div",{key:e.id,class:"flex-table-item"},[_(g,{column:{media:!0,grow:!0}},{default:d((()=>[u("div",null,[u("span",he,j(e.title),1)])])),_:2},1024),_(g,{column:{media:!0}},{default:d((()=>[u("div",null,[u("span",xe,j(m(E)(e.created_at)),1),u("span",we,j(m($)(e.created_at)),1)])])),_:2},1024),_(g,null,{default:d((()=>[_(h,{rounded:""},{default:d((()=>[f(j(e.type),1)])),_:2},1024)])),_:2},1024),_(g,null,{default:d((()=>[u("span",Ve,j(e.approval_deadline),1)])),_:2},1024),_(g,null,{default:d((()=>[_(h,{rounded:"",color:"info"},{default:d((()=>[f(j(e.payment_status),1)])),_:2},1024)])),_:2},1024),_(g,{column:{align:"end"}},{default:d((()=>[_(x,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:d((()=>[ke,u("a",{role:"menuitem",onClick:l=>{return a=e.id,O.value=a,void(T.value=!0);var a},class:"dropdown-item is-media"},Ie,8,Pe),u("a",{role:"menuitem",onClick:l=>m(s).push(`/sidebar/dashboard/proposals/${e.id}`),class:"dropdown-item is-media"},Ae,8,je),Ce,Te,u("a",{role:"menuitem",onClick:l=>{return a=e.id,D.value=a,void(N.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var a},class:"dropdown-item is-media"},Se,8,Oe)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):v("",!0),m(G).length>5?(n(),r(C,{key:2,"item-per-page":10,"total-items":873,"current-page":42,"max-links-displayed":7})):v("",!0)]),m(T)?(n(),r(L,{key:0,leadId:a.leadId,proposalId:m(O),leadProposalModal:m(T),"onUpdate:modalHandler":t[2]||(t[2]=e=>T.value=!1),"onUpdate:OnSuccess":K},null,8,["leadId","proposalId","leadProposalModal"])):v("",!0),m(N).isSweetAlertOpen?(n(),r(M,{key:1,isSweetAlertOpen:m(N).isSweetAlertOpen,title:m(N).title,subtitle:m(N).subtitle,btntext:m(N).btntext,onConfirm:q,onCancel:()=>m(N).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):v("",!0)])}}});export{De as _};
