import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-c27a3042.js";import{f as l,r as a,w as t,o as u,B as d,C as s,O as o,G as n,E as i,F as r,K as c,D as p,W as m,V as v,m as _,k as f,N as y,U as V,J as g,P as k}from"./index-915cc9a6.js";import{_ as h}from"./VTextarea.vue_vue_type_script_setup_true_lang-6f332117.js";import{_ as b,a as S}from"./VOption.vue_vue_type_style_index_0_lang-03cdf554.js";import{_ as D}from"./VField.vue_vue_type_script_setup_true_lang-9e1b73e4.js";import{_ as w}from"./VControl-f05d5744.js";import{_ as U}from"./VInput.vue_vue_type_script_setup_true_lang-938712c0.js";import{_ as I}from"./VLabel.vue_vue_type_script_setup_true_lang-2a82fc69.js";import{u as j}from"./useAPI-30b97558.js";import{u as C}from"./useNotyf-c199192f.js";import{a as T}from"./useSupportElement-11dc6b93.js";const x={class:"modal-form columns is-multiline"},L={class:"field column is-6 mb-0"},q={class:"field column is-6 mb-0"},O=i("label",null,"Status ",-1),A={class:"field column is-6 mb-0"},N={class:"field column is-3 mb-0"},E={class:"field column is-3 mb-0"},P={class:"field column is-6 mb-0"},$={class:"field column is-6 mb-0"},B={class:"field column is-6 mb-0"},F=i("label",null,"Select workers * ",-1),H={class:"field column is-6 mb-0"},M=i("label",null,"Select Subcontractor * ",-1),Q={class:"field column is-6 mb-0"},z={class:"field column is-6 mb-0"},G=l({__name:"UpdateTask",props:{isOpen:{type:Boolean,default:!1},taskIdSelected:{default:""},projectID:{default:""},endDate:{default:""},startDate:{default:""}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:G}){const J=l,K=C(),W=j(),R=a([]),X=a([]),Y=a(!1),Z=a(!1);let ee=a([]);a([]),a([]),a();const le=a({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",supplier:"",unit:"",costCode:"",color:"",project:"",priority:"",workers:[]}),ae=[{value:"active",name:"Active"},{value:"pending",name:"Pending"},{value:"completed",name:"Completed"},{value:"cancelled",name:"Cancelled"}];t(ee.value,(()=>{console.log("data type",ee)}));const te=async()=>{try{Y.value=!0,le.value.workers=ee.value;let e=T(le.value,["workers"]);J.taskIdSelected?(e.append("schedule_mode","false"),await W.patch(`/api/task/${le.value.id}/`,e),K.success("Task updated successfully"),G("update:OnSuccess",null)):(e.append("schedule_mode","false"),e.append("project",`${J.projectID}`),await W.post("/api/task/",e),G("update:OnSuccess",null),K.success("Task added successfully")),de()}catch(e){K.error("Something went wrong"),console.log(e)}finally{Y.value=!1}},ue=async()=>{try{Z.value=!0;const e=await W.delete(`/api/task/${J.taskIdSelected}/`);console.log(e),K.error("Task deleted successfully"),de(),G("update:OnSuccess",null)}catch(e){console.log(e)}finally{Z.value=!1}},de=()=>{G("update:modalHandler",!1),console.log("modal closed")};return u((()=>{J.taskIdSelected&&(async()=>{try{Y.value=!0;const e=await W.get(`/api/task/${J.taskIdSelected?J.taskIdSelected:""}/`);le.value=e.data,ee.value=e.data.workers.map((e=>e.id))}catch(e){console.log(e)}finally{Y.value=!1}})(),(async()=>{try{Y.value=!0;const e=await W.get("/api/users/by-role-option/worker/",{});R.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{Y.value=!1}})(),(async()=>{try{Y.value=!0;const e=await W.get("/api/users/by-role-option/supplier/",{});X.value=e.data.map((e=>({value:e.id,label:e.username})))}catch(e){console.log(e)}finally{Y.value=!1}})(),J.startDate&&(le.value.startDate=J.startDate,le.value.endDate=J.endDate)})),(l,a)=>{const t=I,u=U,j=w,C=D,T=b,G=S,K=d("Multiselect"),W=h,se=k,oe=e;return s(),o(oe,{is:"form",open:J.isOpen,title:J.taskIdSelected?"Update Task":"Add Task",size:"big",actions:"right",onSubmit:g(te,["prevent"]),onClose:de},{content:n((()=>[i("div",x,[i("div",L,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Title: *")])),_:1}),r(j,null,{default:n((()=>[r(u,{required:"",modelValue:le.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>le.value.title=e),type:"text",placeholder:Y.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),i("div",q,[O,r(C,null,{default:n((()=>[r(j,null,{default:n((()=>[r(G,{modelValue:le.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>le.value.status=e),name:"status",class:"is-rounded"},{default:n((()=>[r(T,{value:""},{default:n((()=>[c("Select Status")])),_:1}),(s(),p(v,null,m(ae,(e=>r(T,{key:e.value,value:e.value},{default:n((()=>[c(V(e.value),1)])),_:2},1032,["value"]))),64))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),i("div",A,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Cost Code: *")])),_:1}),r(j,null,{default:n((()=>[r(u,{required:"",type:"text",placeholder:Y.value?"Loading...":"Cost code",modelValue:le.value.costCode,"onUpdate:modelValue":a[2]||(a[2]=e=>le.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",N,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Quantity")])),_:1}),r(j,null,{default:n((()=>[r(u,{type:"text",placeholder:Y.value?"Loading...":"Quantity",modelValue:le.value.quantity,"onUpdate:modelValue":a[3]||(a[3]=e=>le.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",E,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Unit")])),_:1}),r(j,null,{default:n((()=>[r(u,{type:"text",placeholder:Y.value?"Loading...":"Unit",modelValue:le.value.unit,"onUpdate:modelValue":a[4]||(a[4]=e=>le.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",P,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Start Date")])),_:1}),r(j,null,{default:n((()=>[r(u,{type:"date",placeholder:Y.value?"Loading...":"Start date",modelValue:le.value.startDate,"onUpdate:modelValue":a[5]||(a[5]=e=>le.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",$,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("End Date")])),_:1}),r(j,null,{default:n((()=>[r(u,{type:"date",placeholder:Y.value?"Loading...":"End date",modelValue:le.value.endDate,"onUpdate:modelValue":a[6]||(a[6]=e=>le.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",B,[F,r(C,null,{default:n((({id:e})=>[r(j,null,{default:n((()=>[r(K,{modelValue:_(ee),"onUpdate:modelValue":a[7]||(a[7]=e=>f(ee)?ee.value=e:ee=e),required:!le.value.supplier,attrs:{id:e},mode:"tags",searchable:!0,"create-tag":!0,options:R.value,placeholder:"Add workers"},null,8,["modelValue","required","attrs","options"])])),_:2},1024)])),_:1})]),i("div",H,[M,r(C,null,{default:n((({id:e})=>[r(j,null,{default:n((()=>[r(K,{modelValue:le.value.supplier,"onUpdate:modelValue":a[8]||(a[8]=e=>le.value.supplier=e),required:!_(ee),attrs:{id:e},searchable:!0,"create-tag":!0,options:X.value,placeholder:"Add sub-contractor"},null,8,["modelValue","required","attrs","options"])])),_:2},1024)])),_:1})]),i("div",Q,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Description")])),_:1}),r(j,null,{default:n((()=>[r(W,{type:"text",rows:"3",placeholder:Y.value?"Loading...":"Description",modelValue:le.value.description,"onUpdate:modelValue":a[9]||(a[9]=e=>le.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),i("div",z,[r(C,null,{default:n((()=>[r(t,null,{default:n((()=>[c("Internal Notes")])),_:1}),r(j,null,{default:n((()=>[r(W,{type:"text",rows:"3",placeholder:Y.value?"Loading...":"Internal notes",modelValue:le.value.internalNotes,"onUpdate:modelValue":a[10]||(a[10]=e=>le.value.internalNotes=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})])])])),action:n((()=>[J.taskIdSelected?(s(),o(se,{key:0,onClick:ue,class:"is-left",color:"danger",loading:Z.value,raised:""},{default:n((()=>[c("Delete")])),_:1},8,["loading"])):y("",!0),r(se,{type:"submit",loading:Y.value,color:"primary",raised:""},{default:n((()=>[c(V(J.taskIdSelected?"Update Task":"Add Task"),1)])),_:1},8,["loading"])])),_:1},8,["open","title","onSubmit"])}}});export{G as _};
