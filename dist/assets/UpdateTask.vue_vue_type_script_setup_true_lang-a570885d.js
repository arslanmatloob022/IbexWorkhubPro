import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-02010cfa.js";import{e as l,r as a,Z as t,o as u,y as s,H as d,B as o,C as n,A as i,D as r,z as c,Q as p,R as m,J as _,P as v,K as f,E as y}from"./index-879cc21e.js";import{_ as V}from"./VTextarea.vue_vue_type_script_setup_true_lang-f608710e.js";import{_ as g}from"./VTags.vue_vue_type_script_setup_true_lang-ebc728c4.js";import{_ as k}from"./VTag.vue_vue_type_style_index_0_lang-725ce0ff.js";import{_ as h,a as b}from"./VOption.vue_vue_type_style_index_0_lang-6cc7e380.js";import{_ as j}from"./VField.vue_vue_type_script_setup_true_lang-8fda54d1.js";import{_ as D}from"./VControl-3a0d7b90.js";import{_ as T}from"./VInput.vue_vue_type_script_setup_true_lang-ae22abd0.js";import{_ as C}from"./VLabel.vue_vue_type_script_setup_true_lang-010b6911.js";import{u as U}from"./useAPI-bba6ff57.js";import{u as w}from"./useNotyf-953388fb.js";import{a as I}from"./useSupportElement-23fcf6e3.js";const S={class:"modal-form columns cu-all-input is-multiline"},x={class:"field column is-6 mb-0"},L={class:"field column is-6 mb-0"},q=n("label",null,"Status ",-1),A={class:"field column is-6 mb-0"},E={class:"field column is-6 mb-0"},O={class:"field column is-6 mb-0"},$={class:"field column is-6 mb-0"},H={class:"field column is-6 mb-0"},P={class:"field column is-6 mb-0"},Q={class:"field column is-6 mb-0"},z=n("label",null,"Select workers * ",-1),M={class:"field column is-6 mb-0"},N={class:"flex-grid fullWidth"},B={class:"field column is-12 mb-0"},F=n("div",{class:"field column is-6 mb-0"},null,-1),J=l({__name:"UpdateTask",props:{isOpen:{},taskId:{},projectID:{},startDate:{}},emits:["update:modalHandler","update:OnSuccess"],setup(l,{emit:J}){const K=l,R=w(),W=U(),Z=a([]),G=a(!1),X=a([]),Y=a({title:"",description:"",startDate:"",endDate:"",status:"",quantity:"",unit:"",costCode:"",color:"",project:"",workers:[]}),ee=[{value:"active",name:"Active"},{value:"pending",name:"Pending"},{value:"completed",name:"Completed"},{value:"cancelled",name:"Cancelled"}];t((()=>K.taskId?"Edit Task":"Add Task"));const le=async()=>{try{G.value=!0;let e=X.value.map((e=>e.id));Y.value.workers=e;let l=I(Y.value,[]);K.projectID?(l.append("schedule_mode","false"),l.append("project",`${K.projectID}`),await W.post("/api/task/",l),R.success("Task added successfully")):(l.append("schedule_mode","false"),await W.patch(`/api/task/${Y.value.id}/`,l),R.success("Task updated successfully")),te(),J("update:OnSuccess",null)}catch(e){R.error("Something went wrong"),console.log(e)}finally{G.value=!1}},ae=async()=>{try{G.value=!0;const e=await W.delete(`/api/task/${K.taskId}/`);console.log(e),R.error("Task deleted successfully"),te(),J("update:OnSuccess",null)}catch(e){console.log(e)}finally{G.value=!1}},te=()=>{J("update:modalHandler",!1),console.log("modal closed")};return u((()=>{K.taskId&&(async()=>{try{G.value=!0;const e=await W.get(`/api/task/${K.taskId?K.taskId:""}`);Y.value=e.data,X.value=e.data.workers}catch(e){console.log(e)}finally{G.value=!1}})(),(async()=>{try{G.value=!0;const e=await W.get("/api/users/by-role-option/worker/",{});Z.value=e.data}catch(e){console.log(e)}finally{G.value=!1}})(),K.startDate&&(Y.value.startDate=K.startDate)})),(l,a)=>{const t=C,u=T,U=D,w=j,I=h,J=b,R=k,W=g,ue=V,se=y,de=e;return s(),d(de,{is:"form",open:K.isOpen,title:K.taskId?"Update Task":"Add New Task",size:"big",actions:"right",onSubmit:f(le,["prevent"]),onClose:te},{content:o((()=>[n("div",S,[n("div",x,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("Title: *")])),_:1}),i(U,null,{default:o((()=>[i(u,{required:"",modelValue:Y.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value.title=e),type:"text",placeholder:G.value?"Loading...":"Title"},null,8,["modelValue","placeholder"])])),_:1})])),_:1})]),n("div",L,[q,i(w,null,{default:o((()=>[i(U,null,{default:o((()=>[i(J,{modelValue:Y.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.value.status=e),name:"status",class:"is-rounded"},{default:o((()=>[i(I,{value:""},{default:o((()=>[r("Select Status")])),_:1}),(s(),c(p,null,m(ee,(e=>i(I,{key:e.value,value:e.value},{default:o((()=>[r(_(e.value),1)])),_:2},1032,["value"]))),64))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),n("div",A,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("Cost Code: *")])),_:1}),i(U,null,{default:o((()=>[i(u,{required:"",type:"text",placeholder:G.value?"Loading...":"Cost code",modelValue:Y.value.costCode,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.value.costCode=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),n("div",E,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("Quantity")])),_:1}),i(U,null,{default:o((()=>[i(u,{type:"text",placeholder:G.value?"Loading...":"Quantity",modelValue:Y.value.quantity,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.value.quantity=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),n("div",O,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("Unit")])),_:1}),i(U,null,{default:o((()=>[i(u,{type:"text",placeholder:G.value?"Loading...":"Unit",modelValue:Y.value.unit,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.value.unit=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),n("div",$,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("Start Date")])),_:1}),i(U,null,{default:o((()=>[i(u,{type:"date",placeholder:G.value?"Loading...":"Start date",modelValue:Y.value.startDate,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.value.startDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),n("div",H,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("End Date")])),_:1}),i(U,null,{default:o((()=>[i(u,{type:"date",placeholder:G.value?"Loading...":"End date",modelValue:Y.value.endDate,"onUpdate:modelValue":a[6]||(a[6]=e=>Y.value.endDate=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),n("div",P,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("Color")])),_:1}),i(U,null,{default:o((()=>[i(u,{type:"color",placeholder:G.value?"Loading...":"End date",modelValue:Y.value.color,"onUpdate:modelValue":a[7]||(a[7]=e=>Y.value.color=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),n("div",Q,[z,i(w,null,{default:o((()=>[i(U,null,{default:o((()=>[i(J,{modelValue:X.value,"onUpdate:modelValue":a[8]||(a[8]=e=>X.value=e),multiple:"",required:"",name:"status",class:"is-rounded"},{default:o((()=>[(s(!0),c(p,null,m(Z.value,(e=>(s(),d(I,{key:e.id,value:e},{default:o((()=>[r(_(e.username),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),n("div",M,[n("div",N,[(s(!0),c(p,null,m(X.value,((e,l)=>(s(),d(W,{key:l,addons:""},{default:o((()=>[i(R,{label:e.username,color:"primary"},null,8,["label"]),i(R,{onClick:e=>(e=>{X.value.splice(e,1)})(l),remove:""},null,8,["onClick"])])),_:2},1024)))),128))])]),n("div",B,[i(w,null,{default:o((()=>[i(t,null,{default:o((()=>[r("Description")])),_:1}),i(U,null,{default:o((()=>[i(ue,{type:"text",rows:"3",placeholder:G.value?"Loading...":"Description",modelValue:Y.value.description,"onUpdate:modelValue":a[9]||(a[9]=e=>Y.value.description=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})]),F])])),action:o((()=>[K.taskId?(s(),d(se,{key:0,onClick:ae,class:"is-left",color:"danger",raised:""},{default:o((()=>[r("Delete")])),_:1})):v("",!0),i(se,{type:"submit",color:"primary",raised:""},{default:o((()=>[r(_(K.taskId?"Update Task":"Add Task"),1)])),_:1})])),_:1},8,["open","title","onSubmit"])}}});export{J as _};
