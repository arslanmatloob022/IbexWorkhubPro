import{_ as e,a}from"./ProposalViewModal.vue_vue_type_style_index_0_lang-1807d0ef.js";import{_ as l}from"./SweetAlert.vue_vue_type_style_index_0_lang-a70d17a0.js";import{a as t,_ as s,b as o}from"./CreateProposalTasksModal-e4f152cb.js";import{_ as i}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-605a1948.js";import{_ as r,c as n}from"./VFlexTable.vue_vue_type_style_index_0_lang-606f7a9a.js";import{_ as d}from"./VTag.vue_vue_type_style_index_0_lang-6997dbda.js";import{f as c,x as p,y as u,r as m,$ as v,o as _,av as f,C as y,D as k,m as b,F as g,E as w,G as h,L as C,X as P,k as x,V as A,W as S,K as I,O as j,N as O,aS as T,P as L,I as D,U as M}from"./index-0e38fcf4.js";import{_ as V}from"./VField.vue_vue_type_script_setup_true_lang-cdef6163.js";import{_ as $}from"./VDropdown.vue_vue_type_style_index_0_lang-d69ddc68.js";import{_ as U}from"./VControl-2f19040c.js";import{_ as H}from"./PlaceloadV1.vue_vue_type_style_index_0_lang-996de979.js";import{_ as N,a as E}from"./search-4-dark-2b5b440c.js";import{u as F}from"./useAPI-b1f6313f.js";import{u as Y}from"./useNotyf-466f476c.js";import{f as z,j as B}from"./useSupportElement-53d5d1ec.js";import{b as G,c as K,d as R,e as W}from"./estimatesScripts-f56b1627.js";const X={key:0},q={key:1},J={class:"flex-toolbar is-reversed is-flex space-between my-4"},Q={class:"is-flex g-2"},Z=["value","onClick"],ee={class:"icon"},ae={class:"meta"},le={class:"flex-list-wrapper flex-list-v2"},te={class:"item-name dark-inverted show-text-250"},se={class:"item-meta"},oe=w("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:clock"},null,-1),ie={class:"item-name dark-inverted"},re=["onClick"],ne=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),w("div",{class:"meta"},[w("span",null,"Edit"),w("span",null,"Edit Proposal Details")],-1)],de=["onClick"],ce=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-eye"})],-1),w("div",{class:"meta"},[w("span",null,"Preview"),w("span",null,"Preview proposal detail")],-1)],pe=["onClick"],ue=[w("div",{class:"icon"},[w("i",{class:"lnil lnil-calender-alt-1","aria-hidden":"true"})],-1),w("div",{class:"meta"},[w("span",null,"Create Tasks"),w("span",null,"Create tasks in chart ")],-1)],me=w("hr",{class:"dropdown-divider"},null,-1),ve=["onClick"],_e=[w("div",{class:"icon"},[w("i",{class:"lnir lnir-round-box-check","aria-hidden":"true"})],-1),w("div",{class:"meta"},[w("span",null,"Mark Approved"),w("span",null,"Mark Proposal As Approved")],-1)],fe=["onClick"],ye=[w("div",{class:"icon"},[w("i",{"aria-hidden":"true",class:"lnil lnil-trash-can-alt"})],-1),w("div",{class:"meta"},[w("span",null,"Delete"),w("span",null,"Delete from list")],-1)],ke=w("img",{class:"light-image",src:N,alt:""},null,-1),be=w("img",{class:"dark-image",src:E,alt:""},null,-1),ge=c({__name:"LeadProposalsList",props:{activeTab:{default:"active"},leadId:{default:""},allProposal:{type:Boolean,default:!1}},emits:["updateCompany"],setup(c,{emit:N}){const E=c,ge=p();u();const we=F(),he=Y(),Ce=m([]),Pe=m(""),xe=m(!1),Ae=m(!1),Se=m(!1),Ie=m(!1),je=m(!1),Oe=m(!1),Te=m(!1),Le=m(""),De=m(""),Me=m("");m(E.activeTab);const Ve={picture:{label:"Proposal",grow:!0,media:!0},industry:"Type",status:"Status",amount:{label:"Total Amount",media:!0},customer:"Calendar Tasks ",actions:{label:"Actions",align:"end"}},$e=m({title:"",subtitle:"test",isSweetAlertOpen:!1,btntext:"text"}),Ue=m({title:"",subtitle:"",isSweetAlertOpen:!1,btntext:""}),He=async()=>{try{xe.value=!0;await we.delete(`/api/lead-proposal/${Me.value}/`);he.success("Proposal delete successfully"),Ee()}catch(e){he.error(` ${e}, Proposal`),he.error("Something went wrong please try later")}finally{xe.value=!1,$e.value.isSweetAlertOpen=!1}},Ne=e=>{ge.push(`/sidebar/dashboard/proposals/${e}`)},Ee=()=>{1==E.allProposal?(async()=>{try{xe.value=!0;const e=await we.get("/api/lead-proposal/");Ce.value=e.data}catch(e){he.error(` ${e}, Lead`)}finally{xe.value=!1}})():E.leadId&&(async()=>{try{xe.value=!0;const e=await we.get(`/api/lead-proposal/by-project/${E.leadId}/`);Ce.value=e.data}catch(e){he.error(` ${e}, Lead`)}finally{xe.value=!1}})()},Fe=m(""),Ye=m([{desc:"Proposals default list. ",icon:"fas fa-align-left",value:"default",label:"Default"},{desc:"Newly created proposals ",icon:"fas fa-calendar-day",value:"recent",label:"New Proposals"},{desc:"Proposals created recently ",icon:"fas fa-calendar-minus ",value:"old",label:"Old Proposals"},{desc:"Proposals ascending order ",icon:"fas fa-sort-alpha-down",value:"asc",label:"Ascending"},{desc:"Proposals descending order ",icon:"fas fa-sort-alpha-up ",value:"desc",label:"Descending"}]),ze=v((()=>{let e=Ce.value;if(De.value){const a=new RegExp(De.value,"i");e=e.filter((e=>e.title.match(a)))}switch(Fe.value){case"recent":e=[...e].sort(((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime()));break;case"old":e=[...e].sort(((e,a)=>new Date(e.created_at).getTime()-new Date(a.created_at).getTime()));break;case"asc":e=[...e].sort(((e,a)=>e.title.localeCompare(a.title)));break;case"desc":e=[...e].sort(((e,a)=>a.title.localeCompare(e.title)))}return e=[...e].sort(((e,a)=>"draft"===e.type&&"draft"!==a.type?1:"draft"!==e.type&&"draft"===a.type?-1:0)),e}));return _((()=>{Ee()})),(c,p)=>{const u=H,m=U,v=$,_=V,F=L,Y=n,ge=d,Be=r,Ge=i,Ke=t,Re=s,We=e,Xe=o,qe=l,Je=a,Qe=f("tooltip");return y(),k("div",null,[b(xe)?(y(),k("div",X,[g(u)])):(y(),k("div",q,[w("div",J,[w("div",Q,[g(m,{icon:"feather:search"},{default:h((()=>[C(w("input",{"onUpdate:modelValue":p[0]||(p[0]=e=>x(De)?De.value=e:null),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[P,b(De)]])])),_:1}),g(_,{class:"ml-2"},{default:h((()=>[g(v,{title:"Sort proposal",spaced:""},{content:h((()=>[(y(!0),k(A,null,S(b(Ye),(e=>(y(),k("a",{value:e.value,onClick:a=>Fe.value=e.value,class:D(["dropdown-item is-media",b(Fe)===e.value&&"is-active"])},[w("div",ee,[w("i",{class:D(e.icon)},null,2)]),w("div",ae,[w("span",null,M(e.label),1),w("span",null,M(e.desc),1)])],10,Z)))),256))])),_:1})])),_:1})]),w("div",null,[g(F,{color:"primary",onClick:p[1]||(p[1]=e=>Ae.value=!b(Ae)),icon:"fas fa-plus"},{default:h((()=>[I("Lead Proposal ")])),_:1}),E.leadId?(y(),j(F,{key:0,color:"warning",class:"ml-2",onClick:p[2]||(p[2]=e=>{Ie.value=!0}),icon:"fas fa-cogs"},{default:h((()=>[I("Proposals")])),_:1})):O("",!0)])]),w("div",le,[b(ze).length>0&&b(Ce).length>0?(y(),j(Be,{key:0,data:b(ze),columns:Ve,rounded:""},{body:h((()=>[g(T,{name:"list",tag:"div",class:"flex-list-inner"},{default:h((()=>[(y(!0),k(A,null,S(b(ze),(e=>(y(),k("div",{key:e.id,class:"flex-table-item"},[g(Y,{column:{media:!0,grow:!0},class:"cu-pointer",onClick:a=>Ne(e.id)},{default:h((()=>[C((y(),k("div",null,[w("span",te,M(e.title),1),w("span",se,[w("span",null,[oe,I(M(b(z)(e.created_at)),1)])])])),[[Qe,`${e.title}`,void 0,{rounded:!0,light:!0}]])])),_:2},1032,["onClick"]),g(Y,{class:"cu-pointer",onClick:a=>Ne(e.id)},{default:h((()=>[g(ge,{rounded:"",color:b(G)[e.type]},{default:h((()=>[I(M(b(K)[e.type]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),g(Y,{class:"cu-pointer",onClick:a=>Ne(e.id)},{default:h((()=>[g(ge,{class:"capitalized",rounded:"",color:b(R)[e.status]},{default:h((()=>[I(M(b(W)[e.status]),1)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),g(Y,{class:"cu-pointer",onClick:a=>Ne(e.id),column:{media:!0}},{default:h((()=>[w("div",null,[w("span",ie,M(b(B)(e?.proposalAmount)),1)])])),_:2},1032,["onClick"]),g(Y,{class:"cu-pointer",onClick:a=>Ne(e.id)},{default:h((()=>[g(ge,{color:"purple",outlined:""},{default:h((()=>[I(M(e.is_task_created?"Created":"Not Created"),1)])),_:2},1024)])),_:2},1032,["onClick"]),g(Y,{column:{align:"end"}},{default:h((()=>[g(v,{class:"is-pushed-mobile",icon:"feather:more-vertical",spaced:"",right:""},{content:h((()=>[w("a",{role:"menuitem",onClick:a=>{return l=e.id,Pe.value=l,void(Ae.value=!0);var l},class:"dropdown-item is-media"},ne,8,re),w("a",{disabled:"",role:"menuitem",onClick:a=>{return l=e.id,Oe.value=l,void(je.value=!je.value);var l},class:"dropdown-item is-media"},ce,8,de),"approved"==e.status?(y(),k("a",{key:0,role:"menuitem",onClick:a=>{return l=e.id,Pe.value=l,void(Se.value=!0);var l},class:"dropdown-item is-media"},ue,8,pe)):O("",!0),me,"approved"!=e.status?(y(),k("a",{key:1,role:"menuitem",onClick:a=>(async(e,a)=>{try{await we.patch(`/api/lead-proposal/${a}/`,{status:e}),he.success(`You have ${e} this proposal.`),"approved"==e&&N("updateCompany",null),Ee()}catch(l){console.log(l)}})("approved",e.id),class:"dropdown-item is-media"},_e,8,ve)):O("",!0),w("a",{role:"menuitem",onClick:a=>{return l=e.id,Me.value=l,void($e.value={title:"Delete Proposal?",subtitle:"Are you sure to delete this proposal? After delete you will not be able to recover it again.",btntext:"Yes delete",isSweetAlertOpen:!0});var l},class:"dropdown-item is-media"},ye,8,fe)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):O("",!0),b(Ce).length<1&&0==b(ze).length?(y(),j(Ge,{key:1,title:"There is no proposal created on this lead!",subtitle:"Too bad. Looks like we couldn't created any proposal on this Lead, please create proposal and release to the client",larger:""},{image:h((()=>[ke,be])),_:1})):O("",!0)]),b(Se)?(y(),j(Ke,{key:0,createProposalTasksModal:b(Se),proposalId:b(Pe),onCloseModalHandler:p[3]||(p[3]=e=>Se.value=!1),"onUpdate:OnSuccess":p[4]||(p[4]=e=>Ee())},null,8,["createProposalTasksModal","proposalId"])):O("",!0),b(Ae)?(y(),j(Re,{key:1,leadId:E.leadId,proposalId:b(Pe),leadProposalModal:b(Ae),getLeadsList:E.allProposal,"onUpdate:modalHandler":p[5]||(p[5]=()=>{Ee(),Ae.value=!1}),onClearProposalId:p[6]||(p[6]=e=>Pe.value="")},null,8,["leadId","proposalId","leadProposalModal","getLeadsList"])):O("",!0),b(je)?(y(),j(We,{key:2,"preview-modal":b(je),proposalId:b(Oe),"onUpdate:modalHandler":p[7]||(p[7]=e=>je.value=!1)},null,8,["preview-modal","proposalId"])):O("",!0),b(Te)?(y(),j(Xe,{key:3,costItemModal:b(Te),proposalId:b(Le),"onUpdate:modalHandler":p[8]||(p[8]=e=>Te.value=!1),"onUpdate:OnSuccess":Ee},null,8,["costItemModal","proposalId"])):O("",!0),b($e).isSweetAlertOpen?(y(),j(qe,{key:4,isSweetAlertOpen:b($e).isSweetAlertOpen,title:b($e).title,subtitle:b($e).subtitle,btntext:b($e).btntext,onConfirm:He,onCancel:()=>b($e).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):O("",!0),b(Ue).isSweetAlertOpen?(y(),j(qe,{key:5,isSweetAlertOpen:b(Ue).isSweetAlertOpen,title:b(Ue).title,subtitle:b(Ue).subtitle,btntext:b(Ue).btntext,onConfirm:He,onCancel:()=>b(Ue).isSweetAlertOpen=!1},null,8,["isSweetAlertOpen","title","subtitle","btntext","onCancel"])):O("",!0),b(Ie)?(y(),j(Je,{key:6,leadProposalListModal:b(Ie),leadID:E.leadId,"group-proposal-modal":b(Ie),"onUpdate:modalHandler":p[9]||(p[9]=e=>Ie.value=!1)},null,8,["leadProposalListModal","leadID","group-proposal-modal"])):O("",!0)]))])}}});export{ge as _};
